A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE     1


MACRO ASSEMBLER A51 V8.2.7.0
OBJECT MODULE PLACED IN .\Objects\BLHeli_S.obj
ASSEMBLER INVOKED BY: D:\Keil_v5\C51\BIN\A51.EXE BLHeli_S.asm SET(SMALL) DEBUG PRINT(.\Listings\BLHeli_S.lst) OBJECT(.\O
                      bjects\BLHeli_S.obj) EP

LOC  OBJ            LINE     SOURCE

                       1     $nomod51 
                       2     ;**** **** **** **** ****
                       3     ;
                       4     ; BLHeli program for controlling brushless motors in multirotors
                       5     ;
                       6     ; Copyright 2011, 2012 Steffen Skaug
                       7     ; This program is distributed under the terms of the GNU General Public License
                       8     ;
                       9     ; This file is part of BLHeli.
                      10     ;
                      11     ; BLHeli is free software: you can redistribute it and/or modify
                      12     ; it under the terms of the GNU General Public License as published by
                      13     ; the Free Software Foundation, either version 3 of the License, or
                      14     ; (at your option) any later version.
                      15     ;
                      16     ; BLHeli is distributed in the hope that it will be useful,
                      17     ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                      18     ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                      19     ; GNU General Public License for more details.
                      20     ;
                      21     ; You should have received a copy of the GNU General Public License
                      22     ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                      23     ;
                      24     ;**** **** **** **** ****
                      25     ;
                      26     ; This software was initially designed for use with Eflite mCP X, but is now adapted to cop
                             ters/planes in general
                      27     ;
                      28     ; The software was inspired by and started from from Bernard Konze's BLMC: http://home.vers
                             anet.de/~bkonze/blc_6a/blc_6a.htm
                      29     ; And also Simon Kirby's TGY: https://github.com/sim-/tgy
                      30     ;
                      31     ; This file is best viewed with tab width set to 5
                      32     ;
                      33     ; The code is designed for multirotor applications, running damped light mode
                      34     ;
                      35     ; The input signal can be Normal (1-2ms), OneShot125 (125-250us), OneShot42 (41.7-83.3us) o
                             r Multishot (5-25us) at rates as high as allowed by the format.
                      36     ; Three Dshot signal rates are also supported, Dshot150, Dshot300 and Dshot600. A 48MHz MCU
                              is required for Dshot600.
                      37     ; The code autodetects normal, OneShot125, Oneshot42, Multishot or Dshot.
                      38     ;
                      39     ; The first lines of the software must be modified according to the chosen environment:
                      40     ; ESCNO EQU "ESC"
                      41     ; MCU_48MHZ EQU "N"
                      42     ; FETON_DELAY EQU "N"
                      43     ; 
                      44     ;**** **** **** **** ****
                      45     ; Revision history:
                      46     ; - Rev16.0 Started. Built upon rev 14.5 of base code
                      47     ;           Using hardware pwm for very smooth throttle response, silent running and suppor
                             t of very high rpms
                      48     ;           Implemented reverse bidirectional mode
                      49     ;           Implemented separate throttle gains fwd and rev in bidirectional mode
                      50     ;           Implemented support for Oneshot42 and Multishot
                      51     ; - Rev16.1 Made low rpm power limiting programmable through the startup power parameter
                      52     ; - Rev16.2 Fixed bug that prevented temperature protection
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE     2

                      53     ;           Improved robustness to very high input signal rates
                      54     ;           Beeps can be turned off by programming beep strength to 1
                      55     ;           Throttle cal difference is checked to be above required minimum before storing.
                              Throttle cal max is not stored until successful min throttle cal
                      56     ; - Rev16.3 Implemented programmable temperature protection
                      57     ;           Improved protection of bootloader and generally reduced risk of flash corruption
                      58     ;           Some small changes for improved sync hold
                      59     ; - Rev16.4 Fixed bug where bootloader operation could be blocked by a defective "eeprom" s
                             ignature
                      60     ; - Rev16.5 Added support for DShot150, DShot300 and DShot600
                      61     ; - Rev16.6 Fixed signal detection issue of multishot at 32kHz
                      62     ;           Improved bidirectional mode for high input signal rates
                      63     ; - Rev16.7 Addition of Dshot commands for beeps and temporary reverse direction (largely b
                             y brycedjohnson)
                      64     ;           
                      65     ;
                      66     ;**** **** **** **** ****
                      67     ; Minimum 8K Bytes of In-System Self-Programmable Flash
                      68     ; Minimum 512 Bytes Internal SRAM
                      69     ;
                      70     ;**** **** **** **** ****
                      71     ; Master clock is internal 24MHz oscillator (or 48MHz, for which the times below are halved)
                      72     ; Although 24/48 are used in the code, the exact clock frequencies are 24.5MHz or 49.0 MHz
                      73     ; Timer 0 (41.67ns counts) always counts up and is used for
                      74     ; - RC pulse measurement
                      75     ; Timer 1 (41.67ns counts) always counts up and is used for
                      76     ; - DShot frame sync detection
                      77     ; Timer 2 (500ns counts) always counts up and is used for
                      78     ; - RC pulse timeout counts and commutation times
                      79     ; Timer 3 (500ns counts) always counts up and is used for
                      80     ; - Commutation timeouts
                      81     ; PCA0 (41.67ns counts) always counts up and is used for
                      82     ; - Hardware PWM generation
                      83     ;
                      84     ;**** **** **** **** ****
                      85     ; Interrupt handling
                      86     ; The C8051 does not disable interrupts when entering an interrupt routine.
                      87     ; Also some interrupt flags need to be cleared by software
                      88     ; The code disables interrupts in some interrupt routines
                      89     ; - Interrupts are disabled during beeps, to avoid audible interference from interrupts
                      90     ;
                      91     ;**** **** **** **** ****
                      92     ; Motor control:
                      93     ; - Brushless motor control with 6 states for each electrical 360 degrees
                      94     ; - An advance timing of 0deg has zero cross 30deg after one commutation and 30deg before t
                             he next
                      95     ; - Timing advance in this implementation is set to 15deg nominally
                      96     ; - Motor pwm is always damped light (aka complementary pwm, regenerative braking)
                      97     ; Motor sequence starting from zero crossing:
                      98     ; - Timer wait: Wt_Comm                 15deg   ; Time to wait from zero cross to actual co
                             mmutation
                      99     ; - Timer wait: Wt_Advance              15deg   ; Time to wait for timing advance. Nominal 
                             commutation point is after this
                     100     ; - Timer wait: Wt_Zc_Scan              7.5deg  ; Time to wait before looking for zero cross
                     101     ; - Scan for zero cross                 22.5deg ; Nominal, with some motor variations
                     102     ;
                     103     ; Motor startup:
                     104     ; There is a startup phase and an initial run phase, before normal bemf commutation run beg
                             ins.
                     105     ;
                     106     ;**** **** **** **** ****
                     107     ; List of enumerated supported ESCs
  0001               108     A_                      EQU 1   ; X  X  RC X  MC MB MA CC    X  X  Cc Cp Bc Bp Ac Ap
  0002               109     B_                      EQU 2   ; X  X  RC X  MC MB MA CC    X  X  Ap Ac Bp Bc Cp Cc
  0003               110     C_                      EQU 3   ; Ac Ap MC MB MA CC X  RC    X  X  X  X  Cc Cp Bc Bp
  0004               111     D_                      EQU 4   ; X  X  RC X  CC MA MC MB    X  X  Cc Cp Bc Bp Ac Ap    Com
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE     3

                              fets inverted
  0005               112     E_                      EQU 5   ; L1 L0 RC X  MC MB MA CC    X  L2 Cc Cp Bc Bp Ac Ap    A w
                             ith LEDs
  0006               113     F_                      EQU 6   ; X  X  RC X  MA MB MC CC    X  X  Cc Cp Bc Bp Ac Ap
  0007               114     G_                      EQU 7   ; X  X  RC X  CC MA MC MB    X  X  Cc Cp Bc Bp Ac Ap    Lik
                             e D, but noninverted com fets
  0008               115     H_                      EQU 8   ; RC X  X  X  MA MB CC MC    X  Ap Bp Cp X  Ac Bc Cc
  0009               116     I_                      EQU 9   ; X  X  RC X  MC MB MA CC    X  X  Ac Bc Cc Ap Bp Cp
  000A               117     J_                      EQU 10  ; L2 L1 L0 RC CC MB MC MA    X  X  Cc Bc Ac Cp Bp Ap    LEDs
  000B               118     K_                      EQU 11  ; X  X  MC X  MB CC MA RC    X  X  Ap Bp Cp Cc Bc Ac    Com
                              fets inverted
  000C               119     L_                      EQU 12  ; X  X  RC X  CC MA MB MC    X  X  Ac Bc Cc Ap Bp Cp
  000D               120     M_                      EQU 13  ; MA MC CC MB RC L0 X  X     X  Cc Bc Ac Cp Bp Ap X    LED
  000E               121     N_                      EQU 14  ; X  X  RC X  MC MB MA CC    X  X  Cp Cc Bp Bc Ap Ac
  000F               122     O_                      EQU 15  ; X  X  RC X  CC MA MC MB    X  X  Cc Cp Bc Bp Ac Ap    Lik
                             e D, but low side pwm
  0010               123     P_                      EQU 16  ; X  X  RC MA CC MB MC X     X  Cc Bc Ac Cp Bp Ap X
  0011               124     Q_                      EQU 17  ; Cp Bp Ap L1 L0 X  RC X     X  MA MB MC CC Cc Bc Ac   LEDs
  0012               125     R_                      EQU 18  ; X  X  RC X  MC MB MA CC    X  X  Ac Bc Cc Ap Bp Cp
  0013               126     S_          EQU 19  ; X  X  RC X  CC MA MC MB    X  X  Cc Cp Bc Bp Ac Ap   Like O, but com 
                             fets inverted
  0014               127     T_                      EQU 20  ; RC X  MA X  MB CC MC X     X  X  Cp Bp Ap Ac Bc Cc
  0015               128     U_                      EQU 21  ; MA MC CC MB RC L0 L1 L2    X  Cc Bc Ac Cp Bp Ap X     Lik
                             e M, but with 3 LEDs
  0016               129     V_                      EQU 22  ; Cc X  RC X  MC CC MB MA    X  Ap Ac Bp X  X  Bc Cp
  0017               130     W_          EQU 23  ; RC MC MB X  CC MA X X      X  Ap Bp Cp X  X  X  X     Tristate gate d
                             river
                     131     
                     132     
                     133     ;**** **** **** **** ****
                     134     ; Select the port mapping to use (or unselect all for use with external batch compile file)
                     135     ;ESCNO EQU A_
                     136     ;ESCNO EQU B_
                     137     ;ESCNO EQU C_
                     138     ;ESCNO EQU D_
                     139     ;ESCNO EQU E_
                     140     ;ESCNO EQU F_
                     141     ;ESCNO EQU G_
                     142     ;ESCNO EQU H_
                     143     ;ESCNO EQU I_
                     144     ;ESCNO EQU J_
  000B               145     ESCNO EQU K_
                     146     ;ESCNO EQU L_
                     147     ;ESCNO EQU M_
                     148     ;ESCNO EQU N_
                     149     ;ESCNO EQU O_
                     150     ;ESCNO EQU P_
                     151     ;ESCNO EQU Q_
                     152     ;ESCNO EQU R_
                     153     ;ESCNO EQU S_
                     154     ;ESCNO EQU T_
                     155     ;ESCNO EQU U_
                     156     ;ESCNO EQU V_
                     157     ;ESCNO EQU W_
                     158     
                     159     ;**** **** **** **** ****
                     160     ; Select the MCU type (or unselect for use with external batch compile file)
  0000               161     MCU_48MHZ EQU   0
                     162     
                     163     ;**** **** **** **** ****
                     164     ; Select the fet deadtime (or unselect for use with external batch compile file)
  000F               165     FETON_DELAY EQU 15      ; 20.4ns per step
                     166     
                     167     
                     168     ;**** **** **** **** ****
                     169     ; ESC selection statements
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE     4

                     170     IF ESCNO == A_
                             ;$include (A.inc) ; Select pinout A
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; BLHeli program for controlling brushless motors in helicopters and multirotors
                +1           ;
                +1           ; Copyright 2011, 2012 Steffen Skaug
                +1           ; This program is distributed under the terms of the GNU General Public License
                +1           ;
                +1           ; This file is part of BLHeli.
                +1           ;
                +1           ; BLHeli is free software: you can redistribute it and/or modify
                +1           ; it under the terms of the GNU General Public License as published by
                +1           ; the Free Software Foundation, either version 3 of the License, or
                +1           ; (at your option) any later version.
                +1           ;
                +1           ; BLHeli is distributed in the hope that it will be useful,
                +1           ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                +1           ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                +1           ; GNU General Public License for more details.
                +1           ;
                +1           ; You should have received a copy of the GNU General Public License
                +1           ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                +1           ;
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; Hardware definition file "A"
                +1           ; X  X  RC X  MC MB MA CC    X  X  Cc Cp Bc Bp Ac Ap
                +1           ;
                +1           ;**** **** **** **** ****
                +1           
                +1           
                +1           
                +1           ;*********************
                +1           ; Device SiLabs EFM8BB1x/2x
                +1           ;*********************
                +1           IF MCU_48MHZ == 0
                +1           ;$include (SI_EFM8BB1_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB10F2G
                +2           ;  EFM8BB10F2I
                +2           ;  EFM8BB10F2Y
                +2           ;  EFM8BB10F4G
                +2           ;  EFM8BB10F4I
                +2           ;  EFM8BB10F4Y
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE     5

                +2           ACC      DATA 0E0H; Accumulator                            
                +2           ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF   DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B        DATA 0F0H; B Register                             
                +2           CKCON0   DATA 08EH; Clock Control 0                        
                +2           CLKSEL   DATA 0A9H; Clock Select                           
                +2           CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0MD   DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                +2           CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN   DATA 0DDH; CRC0 Data Input                        
                +2           DERIVID  DATA 0ADH; Derivative Identification              
                +2           DEVICEID DATA 0B5H; Device Identification                  
                +2           DPH      DATA 083H; Data Pointer High                      
                +2           DPL      DATA 082H; Data Pointer Low                       
                +2           EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                +2           FLKEY    DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           IE       DATA 0A8H; Interrupt Enable                       
                +2           IP       DATA 0B8H; Interrupt Priority                     
                +2           IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0       DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK   DATA 0FEH; Port 0 Mask                            
                +2           P0MAT    DATA 0FDH; Port 0 Match                           
                +2           P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP   DATA 0D4H; Port 0 Skip                            
                +2           P1       DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK   DATA 0EEH; Port 1 Mask                            
                +2           P1MAT    DATA 0EDH; Port 1 Match                           
                +2           P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP   DATA 0D5H; Port 1 Skip                            
                +2           P2       DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                +2           PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0  DATA 0D8H; PCA Control                            
                +2           PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE     6

                +2           PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD   DATA 0D9H; PCA Mode                               
                +2           PCA0POL  DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0    DATA 087H; Power Control                          
                +2           PRTDRV   DATA 0F6H; Port Drive Strength                    
                +2           PSCTL    DATA 08FH; Program Store Control                  
                +2           PSW      DATA 0D0H; Program Status Word                    
                +2           REF0CN   DATA 0D1H; Voltage Reference Control              
                +2           REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                +2           REVID    DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC   DATA 0EFH; Reset Source                           
                +2           SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                +2           SCON0    DATA 098H; UART0 Serial Port Control              
                +2           SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                +2           SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SP       DATA 081H; Stack Pointer                          
                +2           SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0  DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT  DATA 0A3H; SPI0 Data                              
                +2           TCON     DATA 088H; Timer 0/1 Control                      
                +2           TH0      DATA 08CH; Timer 0 High Byte                      
                +2           TH1      DATA 08DH; Timer 1 High Byte                      
                +2           TL0      DATA 08AH; Timer 0 Low Byte                       
                +2           TL1      DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD     DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2H    DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0  DATA 091H; Timer 3 Control 0                      
                +2           TMR3H    DATA 095H; Timer 3 High Byte                      
                +2           TMR3L    DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                +2           VDM0CN   DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN    DATA 097H; Watchdog Timer Control                 
                +2           XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE     7

                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE     8

                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE     9

                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +1           
                +1           ELSE
                +1           ;$include (SI_EFM8BB2_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB21F16G_QFN20
                +2           ;  EFM8BB21F16G_QSOP24
                +2           ;  EFM8BB21F16I_QFN20
                +2           ;  EFM8BB21F16I_QSOP24
                +2           ;  EFM8BB22F16G_QFN28
                +2           ;  EFM8BB22F16I_QFN28
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC       DATA 0E0H; Accumulator                            
                +2           ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF    DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR   DATA 0DFH; ADC0 Power Control                     
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    10

                +2           ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B         DATA 0F0H; B Register                             
                +2           CKCON0    DATA 08EH; Clock Control 0                        
                +2           CKCON1    DATA 0A6H; Clock Control 1
                +2           CLKSEL    DATA 0A9H; Clock Select                           
                +2           CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0CN1   DATA 099H; Comparator 0 Control 1
                +2           CMP0MD    DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                +2           CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CN1   DATA 086H; CRC0 Control 1                         
                +2           CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN    DATA 0DDH; CRC0 Data Input                        
                +2           CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                +2           DERIVID   DATA 0ADH; Derivative Identification              
                +2           DEVICEID  DATA 0B5H; Device Identification                  
                +2           DPH       DATA 083H; Data Pointer High                      
                +2           DPL       DATA 082H; Data Pointer Low                       
                +2           EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                +2           EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                +2           EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                +2           EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                +2           EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                +2           EMI0CN    DATA 0E7H; External Memory Interface Control      
                +2           FLKEY     DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                +2           HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                +2           I2C0CN0   DATA 0BAH; I2C0 Control                           
                +2           I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                +2           I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                +2           I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                +2           I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                +2           I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                +2           I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                +2           I2C0STAT  DATA 0B9H; I2C0 Status                            
                +2           IE        DATA 0A8H; Interrupt Enable                       
                +2           IP        DATA 0B8H; Interrupt Priority                     
                +2           IPH       DATA 0F2H; Interrupt Priority High                
                +2           IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0        DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK    DATA 0FEH; Port 0 Mask                            
                +2           P0MAT     DATA 0FDH; Port 0 Match                           
                +2           P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP    DATA 0D4H; Port 0 Skip                            
                +2           P1        DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK    DATA 0EEH; Port 1 Mask                            
                +2           P1MAT     DATA 0EDH; Port 1 Match                           
                +2           P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP    DATA 0D5H; Port 1 Skip                            
                +2           P2        DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MASK    DATA 0FCH; Port 2 Mask                            
                +2           P2MAT     DATA 0FBH; Port 2 Match                           
                +2           P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                +2           P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                +2           P2SKIP    DATA 0CCH; Port 2 Skip                            
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    11

                +2           P3        DATA 0B0H; Port 3 Pin Latch                       
                +2           P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                +2           P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                +2           PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0   DATA 0D8H; PCA Control                            
                +2           PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD    DATA 0D9H; PCA Mode                               
                +2           PCA0POL   DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0     DATA 087H; Power Control                          
                +2           PCON1     DATA 09AH; Power Control 1                        
                +2           PFE0CN    DATA 0C1H; Prefetch Engine Control                
                +2           PRTDRV    DATA 0F6H; Port Drive Strength                    
                +2           PSCTL     DATA 08FH; Program Store Control                  
                +2           PSW       DATA 0D0H; Program Status Word                    
                +2           REF0CN    DATA 0D1H; Voltage Reference Control              
                +2           REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                +2           REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                +2           REVID     DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC    DATA 0EFH; Reset Source                           
                +2           SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                +2           SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                +2           SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                +2           SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                +2           SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                +2           SCON0     DATA 098H; UART0 Serial Port Control              
                +2           SCON1     DATA 0C8H; UART1 Serial Port Control              
                +2           SFRPAGE   DATA 0A7H; SFR Page                               
                +2           SFRPGCN   DATA 0CFH; SFR Page Control                       
                +2           SFRSTACK  DATA 0D7H; SFR Page Stack                         
                +2           SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                +2           SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                +2           SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                +2           SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                +2           SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                +2           SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SMOD1     DATA 093H; UART1 Mode                             
                +2           SP        DATA 081H; Stack Pointer                          
                +2           SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0   DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT   DATA 0A3H; SPI0 Data                              
                +2           SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                +2           SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                +2           SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                +2           TCON      DATA 088H; Timer 0/1 Control                      
                +2           TH0       DATA 08CH; Timer 0 High Byte                      
                +2           TH1       DATA 08DH; Timer 1 High Byte                      
                +2           TL0       DATA 08AH; Timer 0 Low Byte                       
                +2           TL1       DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD      DATA 089H; Timer 0/1 Mode                         
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    12

                +2           TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                +2           TMR2H     DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0   DATA 091H; Timer 3 Control 0                      
                +2           TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                +2           TMR3H     DATA 095H; Timer 3 High Byte                      
                +2           TMR3L     DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                +2           TMR4CN0   DATA 098H; Timer 4 Control 0                      
                +2           TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                +2           TMR4H     DATA 0A5H; Timer 4 High Byte                      
                +2           TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                +2           TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                +2           TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                +2           UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                +2           UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                +2           UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                +2           UART1LIN  DATA 09EH; UART1 LIN Configuration                
                +2           VDM0CN    DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN     DATA 097H; Watchdog Timer Control                 
                +2           XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                +2           TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    13

                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                +2           P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                +2           
                +2           ; P3 0xB0 (Port 3 Pin Latch)
                +2           P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    14

                +2           P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SCON1 0xC8 (UART1 Serial Port Control)
                +2           SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                +2           SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                +2           SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                +2           SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                +2           SCON1_REN  BIT SCON1.4 ; Receive Enable           
                +2           SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                +2           SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    15

                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                +2           TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                +2           
                +2           ; TMR4CN0 0x98 (Timer 4 Control 0)
                +2           TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                +2           TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                +2           TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                +2           TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                +2           TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                +2           TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                +2           TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                +2           TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                +2           
                +2           ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                +2           UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                +2           UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                +2           UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                +2           UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                +2           UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                +2           UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                +2           UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                +2           UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +2           UART1_IRQn   EQU 17 ; UART1                     
                +2           I2C0_IRQn    EQU 18 ; I2C0 Slave                
                +2           TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; SFR Page Definitions
                +2           ;------------------------------------------------------------------------------
                +2           CRC0_PAGE       EQU 000H ; CRC0 Page       
                +2           LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                +2           PCA0_PAGE       EQU 000H ; PCA0 Page       
                +2           PG2_PAGE        EQU 010H ; Page2           
                +2           TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                +2           TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                +2           TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                +2           I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                +2           PG3_PAGE        EQU 020H ; Page3           
                +2           SMB0_PAGE       EQU 020H ; SMBus 0 Page    
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    16

                +2           SPI0_PAGE       EQU 020H ; SPI0 Page       
                +2           UART0_PAGE      EQU 020H ; UART0 Page      
                +2           UART1_PAGE      EQU 020H ; UART1 Page      
                +1           
                +1           ENDIF
                +1           
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Uses internal calibrated oscillator set to 24/48Mhz
                +1           ;**** **** **** **** ****
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Constant definitions
                +1           ;**** **** **** **** ****
                +1           IF MCU_48MHZ == 0
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#A_L_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#A_L_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#A_L_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#A_L_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#A_L_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#A_L_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#A_L_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#A_L_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#A_L_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#A_L_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#A_L_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (16 B
                             ytes)
                +1           
                +1           ELSE
                +1           
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#A_H_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#A_H_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#A_H_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#A_H_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#A_H_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#A_H_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#A_H_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#A_H_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#A_H_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#A_H_70#        "
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    17

                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#A_H_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (16 B
                             ytes)
                +1           ENDIF
                +1           
                +1           TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for whi
                             ch main motor power is limited at 80degC (low byte, assuming high byte is 1)
                +1           TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment for a
                             nother 10degC
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Bootloader definitions
                +1           ;**** **** **** **** ****
                +1           RTX_PORT                                EQU     P0              ; Receive/Transmit port
                +1           RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL            
                                          
                +1           RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL             
                                          
                +1           RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP                
                                          
                +1           RTX_PIN                         EQU     5               ; RTX pin
                +1           
                +1           SIGNATURE_001                   EQU     0E8h            ; Device signature
                +1           IF MCU_48MHZ == 0
                +1           SIGNATURE_002                   EQU     0B1h
                +1           ELSE
                +1           SIGNATURE_002                   EQU     0B2h
                +1           ENDIF
                +1           
                +1           ;*********************
                +1           ; PORT 0 definitions *
                +1           ;*********************  
                +1           ;                       EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           Rcp_In          EQU     5       ;i
                +1           ;                       EQU     4       ;i 
                +1           Mux_C           EQU     3       ;i
                +1           Mux_B           EQU     2       ;i
                +1           Mux_A           EQU     1       ;i
                +1           Comp_Com                EQU     0       ;i
                +1           
                +1           P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                +1           P0_INIT         EQU     0FFh
                +1           P0_PUSHPULL     EQU     0
                +1           P0_SKIP         EQU     0FFh
                +1           
                +1           Get_Rcp_Capture_Values MACRO
                +1                   anl     TCON, #0EFh                             ; Disable timer0
                +1                   mov     Temp1, TL0                              ; Get timer0 values
                +1                   mov     Temp2, TH0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Temp3, Timer0_X
                +1                   jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                +1                   inc     Temp3                                   ; If it is pending, then timer has 
                             already wrapped
                +1           ENDIF
                +1                   mov     TL0, #0                                 ; Reset timer0
                +1                   mov     TH0, #0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Timer0_X, #0
                +1           ENDIF
                +1                   orl     TCON, #10h                              ; Enable timer0 again
                +1           IF MCU_48MHZ == 1
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    18

                +1                   mov     A, Clock_Set_At_48MHz
                +1                   jnz     Get_Rcp_End
                +1                   clr     C
                +1                   mov     A, Temp1
                +1                   rlc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Temp2
                +1                   rlc     A
                +1                   mov     Temp2, A
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1           Get_Rcp_End:
                +1           ENDIF
                +1           ENDM
                +1           Decode_Dshot_2Msb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp4                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp4
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL
                +1           ENDM
                +1           Decode_Dshot_2Lsb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp3                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    19

                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL
                +1           ENDM
                +1           Initialize_PCA MACRO
                +1                   mov     PCA0CN0, #40h                           ; PCA enabled
                +1                   mov     PCA0MD, #08h                            ; PCA clock is system clock
                +1           IF FETON_DELAY == 0
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #00h                          ; Edge aligned pwm
                +1           ELSE
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #03h                          ; Center aligned pwm
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_Polarity MACRO
                +1                   mov     PCA0POL, #02h                           ; Damping inverted, pwm noninverted
                +1           ENDM
                +1           Enable_Power_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, enab
                             le match, set pwm mode
                +1           ELSE
                +1                   mov     PCA0CPM0, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Enable_Damp_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM1, #00h                          ; Disable
                +1           ELSE
                +1                   mov     PCA0CPM1, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Set_Power_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL0, Power_Pwm_Reg_L
                +1                   mov     PCA0CPH0, Power_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Power_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Power_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL0, A
                +1                   mov     PCA0CPH0, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Set_Damp_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL1, Damp_Pwm_Reg_L
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    20

                +1                   mov     PCA0CPH1, Damp_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Damp_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Damp_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL1, A
                +1                   mov     PCA0CPH1, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Clear_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0DFh
                +1           ENDM
                +1           Clear_CCF_Interrupt MACRO
                +1                   anl     PCA0CN0, #0FEh
                +1           ENDM
                +1           Enable_COVF_Interrupt MACRO
                +1                   orl     PCA0PWM, #40h
                +1           ENDM
                +1           Enable_CCF_Interrupt MACRO
                +1                   orl     PCA0CPM0,#01h
                +1           ENDM
                +1           Disable_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0BFh
                +1           ENDM
                +1           Disable_CCF_Interrupt MACRO
                +1                   anl     PCA0CPM0,#0FEh
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 1 definitions *
                +1           ;*********************
                +1           ;                       EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           CcomFET         EQU     5       ;o
                +1           CpwmFET         EQU     4       ;o
                +1           BcomFET         EQU     3       ;o
                +1           BpwmFET         EQU     2       ;o
                +1           AcomFET         EQU     1       ;o
                +1           ApwmFET         EQU     0       ;o
                +1           
                +1           P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_INIT         EQU     00h             
                +1           P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_SKIP         EQU     3Fh
                +1           
                +1           ApwmFET_on MACRO
                +1                   setb    P1.ApwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           ApwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_on MACRO
                +1                   setb    P1.BpwmFET
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    21

                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.BpwmFET
                +1           ELSE
                +1                   clr     P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_on MACRO
                +1                   setb    P1.CpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           All_pwmFETs_Off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1                   clr     P1.BpwmFET
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           
                +1           AcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.ApwmFET
                +1           ENDIF
                +1                   setb    P1.AcomFET
                +1           ENDM
                +1           AcomFET_off MACRO
                +1                   clr     P1.AcomFET
                +1           ENDM
                +1           BcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.BpwmFET
                +1           ENDIF
                +1                   setb    P1.BcomFET
                +1           ENDM
                +1           BcomFET_off MACRO
                +1                   clr     P1.BcomFET
                +1           ENDM
                +1           CcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.CpwmFET
                +1           ENDIF
                +1                   setb    P1.CcomFET
                +1           ENDM
                +1           CcomFET_off MACRO
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           All_comFETs_Off MACRO
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    22

                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           
                +1           Set_Pwm_A MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1                   mov     P1SKIP, #3Eh
                +1           ELSE
                +1                   mov     P1SKIP, #3Ch
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_B MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1                   mov     P1SKIP, #3Bh
                +1           ELSE
                +1                   mov     P1SKIP, #33h
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_C MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1                   mov     P1SKIP, #2Fh
                +1           ELSE
                +1                   mov     P1SKIP, #0Fh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwms_Off MACRO
                +1                   mov     P1SKIP, #3Fh
                +1           ENDM
                +1           
                +1           Set_Comp_Phase_A MACRO
                +1                   mov     CMP0MX, #10h    ; Set comparator multiplexer to phase A
                +1           ENDM
                +1           Set_Comp_Phase_B MACRO
                +1                   mov     CMP0MX, #20h    ; Set comparator multiplexer to phase B
                +1           ENDM
                +1           Set_Comp_Phase_C MACRO
                +1                   mov     CMP0MX, #30h    ; Set comparator multiplexer to phase C
                +1           ENDM
                +1           Read_Comp_Out MACRO
                +1                   mov     A, CMP0CN0      ; Read comparator output
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 2 definitions *
                +1           ;*********************
                +1           DebugPin                EQU     0       ;o
                +1           
                +1           P2_PUSHPULL     EQU     (1 SHL DebugPin)
                +1           
                +1           
                +1           ;**********************
                +1           ; MCU specific macros *
                +1           ;**********************
                +1           Interrupt_Table_Definition MACRO
                +1           CSEG AT 0                               ; Code segment start
                +1                   jmp reset
                +1           CSEG AT 03h                     ; Int0 interrupt        
                +1                   jmp     int0_int        
                +1           IF MCU_48MHZ == 1
                +1           CSEG AT 0Bh                     ; Timer0 overflow interrupt
                +1                   jmp     t0_int
                +1           ENDIF
                +1           CSEG AT 13h                     ; Int1 interrupt
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    23

                +1                   jmp     int1_int
                +1           CSEG AT 1Bh                     ; Timer1 overflow interrupt
                +1                   jmp     t1_int
                +1           CSEG AT 2Bh                     ; Timer2 overflow interrupt
                +1                   jmp     t2_int  
                +1           CSEG AT 5Bh                     ; Pca interrupt
                +1                   jmp     pca_int
                +1           CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                +1                   jmp     t3_int  
                +1           ENDM
                +1           
                +1           Initialize_Xbar MACRO
                +1                   mov     XBR2, #40h      ; Xbar enabled                  
                +1                   mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                +1           ENDM
                +1           
                +1           Initialize_Comparator MACRO
                +1                   mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                +1                   mov     CMP0MD, #00h    ; Comparator response time 100ns
                +1           ENDM
                +1           Initialize_Adc MACRO
                +1                   mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bias
                +1           IF MCU_48MHZ == 0
                +1                   mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                +1           ELSE
                +1                   mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                +1           ENDIF
                +1                   mov     ADC0MX, #10h    ; Select temp sensor input
                +1                   mov     ADC0CN0, #80h   ; ADC enabled 
                +1                   mov     ADC0CN1, #01h   ; Common mode buffer enabled
                +1           ENDM
                +1           Start_Adc MACRO
                +1                   mov     ADC0CN0, #90h   ; ADC start
                +1           ENDM
                +1           Read_Adc_Result MACRO
                +1                   mov     Temp1, ADC0L
                +1                   mov     Temp2, ADC0H
                +1           ENDM
                +1           Stop_Adc MACRO
                +1           ENDM
                +1           Set_RPM_Out MACRO
                +1           ENDM
                +1           Clear_RPM_Out MACRO
                +1           ENDM
                +1           Set_MCU_Clk_24MHz MACRO
                +1                   mov     CLKSEL, #13h            ; Set clock to 24MHz
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     Clock_Set_At_48MHz, #0
                +1           ENDM
                +1           Set_MCU_Clk_48MHz MACRO
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     CLKSEL, #03h            ; Set clock to 48MHz
                +1                   mov     Clock_Set_At_48MHz, #1
                +1           ENDM
                +1           Set_LED_0 MACRO
                +1           ENDM
                +1           Clear_LED_0 MACRO
                +1           ENDM
                +1           Set_LED_1 MACRO
                +1           ENDM
                +1           Clear_LED_1 MACRO
                +1           ENDM
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    24

                +1           Set_LED_2 MACRO
                +1           ENDM
                +1           Clear_LED_2 MACRO
                +1           ENDM
                +1           Set_LED_3 MACRO
                +1           ENDM
                +1           Clear_LED_3 MACRO
                +1           ENDM
                             ENDIF
                    1482     
                    1483     IF ESCNO == B_
                             ;$include (B.inc) ; Select pinout B
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; BLHeli program for controlling brushless motors in helicopters and multirotors
                +1           ;
                +1           ; Copyright 2011, 2012 Steffen Skaug
                +1           ; This program is distributed under the terms of the GNU General Public License
                +1           ;
                +1           ; This file is part of BLHeli.
                +1           ;
                +1           ; BLHeli is free software: you can redistribute it and/or modify
                +1           ; it under the terms of the GNU General Public License as published by
                +1           ; the Free Software Foundation, either version 3 of the License, or
                +1           ; (at your option) any later version.
                +1           ;
                +1           ; BLHeli is distributed in the hope that it will be useful,
                +1           ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                +1           ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                +1           ; GNU General Public License for more details.
                +1           ;
                +1           ; You should have received a copy of the GNU General Public License
                +1           ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                +1           ;
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; Hardware definition file "B". Equals "A", but with A and C fets swapped and pwm and com f
                             ets swapped
                +1           ; X  X  RC X  MC MB MA CC    X  X  Ap Ac Bp Bc Cp Cc
                +1           ;
                +1           ;**** **** **** **** ****
                +1           
                +1           
                +1           
                +1           ;*********************
                +1           ; Device SiLabs EFM8BB1x/2x
                +1           ;*********************
                +1           IF MCU_48MHZ == 0
                +1           ;$include (SI_EFM8BB1_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB10F2G
                +2           ;  EFM8BB10F2I
                +2           ;  EFM8BB10F2Y
                +2           ;  EFM8BB10F4G
                +2           ;  EFM8BB10F4I
                +2           ;  EFM8BB10F4Y
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    25

                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC      DATA 0E0H; Accumulator                            
                +2           ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF   DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B        DATA 0F0H; B Register                             
                +2           CKCON0   DATA 08EH; Clock Control 0                        
                +2           CLKSEL   DATA 0A9H; Clock Select                           
                +2           CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0MD   DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                +2           CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN   DATA 0DDH; CRC0 Data Input                        
                +2           DERIVID  DATA 0ADH; Derivative Identification              
                +2           DEVICEID DATA 0B5H; Device Identification                  
                +2           DPH      DATA 083H; Data Pointer High                      
                +2           DPL      DATA 082H; Data Pointer Low                       
                +2           EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                +2           FLKEY    DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           IE       DATA 0A8H; Interrupt Enable                       
                +2           IP       DATA 0B8H; Interrupt Priority                     
                +2           IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0       DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK   DATA 0FEH; Port 0 Mask                            
                +2           P0MAT    DATA 0FDH; Port 0 Match                           
                +2           P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP   DATA 0D4H; Port 0 Skip                            
                +2           P1       DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK   DATA 0EEH; Port 1 Mask                            
                +2           P1MAT    DATA 0EDH; Port 1 Match                           
                +2           P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP   DATA 0D5H; Port 1 Skip                            
                +2           P2       DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    26

                +2           PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0  DATA 0D8H; PCA Control                            
                +2           PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD   DATA 0D9H; PCA Mode                               
                +2           PCA0POL  DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0    DATA 087H; Power Control                          
                +2           PRTDRV   DATA 0F6H; Port Drive Strength                    
                +2           PSCTL    DATA 08FH; Program Store Control                  
                +2           PSW      DATA 0D0H; Program Status Word                    
                +2           REF0CN   DATA 0D1H; Voltage Reference Control              
                +2           REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                +2           REVID    DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC   DATA 0EFH; Reset Source                           
                +2           SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                +2           SCON0    DATA 098H; UART0 Serial Port Control              
                +2           SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                +2           SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SP       DATA 081H; Stack Pointer                          
                +2           SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0  DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT  DATA 0A3H; SPI0 Data                              
                +2           TCON     DATA 088H; Timer 0/1 Control                      
                +2           TH0      DATA 08CH; Timer 0 High Byte                      
                +2           TH1      DATA 08DH; Timer 1 High Byte                      
                +2           TL0      DATA 08AH; Timer 0 Low Byte                       
                +2           TL1      DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD     DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2H    DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0  DATA 091H; Timer 3 Control 0                      
                +2           TMR3H    DATA 095H; Timer 3 High Byte                      
                +2           TMR3L    DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                +2           VDM0CN   DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN    DATA 097H; Watchdog Timer Control                 
                +2           XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    27

                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    28

                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    29

                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +1           
                +1           ELSE
                +1           ;$include (SI_EFM8BB2_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB21F16G_QFN20
                +2           ;  EFM8BB21F16G_QSOP24
                +2           ;  EFM8BB21F16I_QFN20
                +2           ;  EFM8BB21F16I_QSOP24
                +2           ;  EFM8BB22F16G_QFN28
                +2           ;  EFM8BB22F16I_QFN28
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC       DATA 0E0H; Accumulator                            
                +2           ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    30

                +2           ADC0CF    DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B         DATA 0F0H; B Register                             
                +2           CKCON0    DATA 08EH; Clock Control 0                        
                +2           CKCON1    DATA 0A6H; Clock Control 1
                +2           CLKSEL    DATA 0A9H; Clock Select                           
                +2           CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0CN1   DATA 099H; Comparator 0 Control 1
                +2           CMP0MD    DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                +2           CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CN1   DATA 086H; CRC0 Control 1                         
                +2           CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN    DATA 0DDH; CRC0 Data Input                        
                +2           CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                +2           DERIVID   DATA 0ADH; Derivative Identification              
                +2           DEVICEID  DATA 0B5H; Device Identification                  
                +2           DPH       DATA 083H; Data Pointer High                      
                +2           DPL       DATA 082H; Data Pointer Low                       
                +2           EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                +2           EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                +2           EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                +2           EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                +2           EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                +2           EMI0CN    DATA 0E7H; External Memory Interface Control      
                +2           FLKEY     DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                +2           HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                +2           I2C0CN0   DATA 0BAH; I2C0 Control                           
                +2           I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                +2           I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                +2           I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                +2           I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                +2           I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                +2           I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                +2           I2C0STAT  DATA 0B9H; I2C0 Status                            
                +2           IE        DATA 0A8H; Interrupt Enable                       
                +2           IP        DATA 0B8H; Interrupt Priority                     
                +2           IPH       DATA 0F2H; Interrupt Priority High                
                +2           IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0        DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK    DATA 0FEH; Port 0 Mask                            
                +2           P0MAT     DATA 0FDH; Port 0 Match                           
                +2           P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP    DATA 0D4H; Port 0 Skip                            
                +2           P1        DATA 090H; Port 1 Pin Latch                       
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    31

                +2           P1MASK    DATA 0EEH; Port 1 Mask                            
                +2           P1MAT     DATA 0EDH; Port 1 Match                           
                +2           P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP    DATA 0D5H; Port 1 Skip                            
                +2           P2        DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MASK    DATA 0FCH; Port 2 Mask                            
                +2           P2MAT     DATA 0FBH; Port 2 Match                           
                +2           P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                +2           P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                +2           P2SKIP    DATA 0CCH; Port 2 Skip                            
                +2           P3        DATA 0B0H; Port 3 Pin Latch                       
                +2           P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                +2           P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                +2           PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0   DATA 0D8H; PCA Control                            
                +2           PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD    DATA 0D9H; PCA Mode                               
                +2           PCA0POL   DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0     DATA 087H; Power Control                          
                +2           PCON1     DATA 09AH; Power Control 1                        
                +2           PFE0CN    DATA 0C1H; Prefetch Engine Control                
                +2           PRTDRV    DATA 0F6H; Port Drive Strength                    
                +2           PSCTL     DATA 08FH; Program Store Control                  
                +2           PSW       DATA 0D0H; Program Status Word                    
                +2           REF0CN    DATA 0D1H; Voltage Reference Control              
                +2           REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                +2           REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                +2           REVID     DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC    DATA 0EFH; Reset Source                           
                +2           SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                +2           SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                +2           SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                +2           SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                +2           SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                +2           SCON0     DATA 098H; UART0 Serial Port Control              
                +2           SCON1     DATA 0C8H; UART1 Serial Port Control              
                +2           SFRPAGE   DATA 0A7H; SFR Page                               
                +2           SFRPGCN   DATA 0CFH; SFR Page Control                       
                +2           SFRSTACK  DATA 0D7H; SFR Page Stack                         
                +2           SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                +2           SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                +2           SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                +2           SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                +2           SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                +2           SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SMOD1     DATA 093H; UART1 Mode                             
                +2           SP        DATA 081H; Stack Pointer                          
                +2           SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    32

                +2           SPI0CN0   DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT   DATA 0A3H; SPI0 Data                              
                +2           SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                +2           SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                +2           SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                +2           TCON      DATA 088H; Timer 0/1 Control                      
                +2           TH0       DATA 08CH; Timer 0 High Byte                      
                +2           TH1       DATA 08DH; Timer 1 High Byte                      
                +2           TL0       DATA 08AH; Timer 0 Low Byte                       
                +2           TL1       DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD      DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                +2           TMR2H     DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0   DATA 091H; Timer 3 Control 0                      
                +2           TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                +2           TMR3H     DATA 095H; Timer 3 High Byte                      
                +2           TMR3L     DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                +2           TMR4CN0   DATA 098H; Timer 4 Control 0                      
                +2           TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                +2           TMR4H     DATA 0A5H; Timer 4 High Byte                      
                +2           TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                +2           TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                +2           TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                +2           UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                +2           UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                +2           UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                +2           UART1LIN  DATA 09EH; UART1 LIN Configuration                
                +2           VDM0CN    DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN     DATA 097H; Watchdog Timer Control                 
                +2           XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                +2           TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    33

                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    34

                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                +2           P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                +2           
                +2           ; P3 0xB0 (Port 3 Pin Latch)
                +2           P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                +2           P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SCON1 0xC8 (UART1 Serial Port Control)
                +2           SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                +2           SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                +2           SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                +2           SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                +2           SCON1_REN  BIT SCON1.4 ; Receive Enable           
                +2           SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                +2           SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    35

                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                +2           TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                +2           
                +2           ; TMR4CN0 0x98 (Timer 4 Control 0)
                +2           TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                +2           TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                +2           TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                +2           TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                +2           TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                +2           TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                +2           TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                +2           TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                +2           
                +2           ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                +2           UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                +2           UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                +2           UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                +2           UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                +2           UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                +2           UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                +2           UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                +2           UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +2           UART1_IRQn   EQU 17 ; UART1                     
                +2           I2C0_IRQn    EQU 18 ; I2C0 Slave                
                +2           TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; SFR Page Definitions
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    36

                +2           ;------------------------------------------------------------------------------
                +2           CRC0_PAGE       EQU 000H ; CRC0 Page       
                +2           LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                +2           PCA0_PAGE       EQU 000H ; PCA0 Page       
                +2           PG2_PAGE        EQU 010H ; Page2           
                +2           TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                +2           TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                +2           TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                +2           I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                +2           PG3_PAGE        EQU 020H ; Page3           
                +2           SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                +2           SPI0_PAGE       EQU 020H ; SPI0 Page       
                +2           UART0_PAGE      EQU 020H ; UART0 Page      
                +2           UART1_PAGE      EQU 020H ; UART1 Page      
                +1           
                +1           ENDIF
                +1           
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Uses internal calibrated oscillator set to 24/48Mhz
                +1           ;**** **** **** **** ****
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Constant definitions
                +1           ;**** **** **** **** ****
                +1           IF MCU_48MHZ == 0
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#B_L_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#B_L_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#B_L_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#B_L_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#B_L_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#B_L_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#B_L_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#B_L_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#B_L_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#B_L_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#B_L_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (16 B
                             ytes)
                +1           
                +1           ELSE
                +1           
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#B_H_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#B_H_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#B_H_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#B_H_15#        "
                +1           ELSEIF FETON_DELAY == 20
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    37

                +1           Eep_ESC_Layout:         DB      "#B_H_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#B_H_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#B_H_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#B_H_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#B_H_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#B_H_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#B_H_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (16 B
                             ytes)
                +1           ENDIF
                +1           
                +1           TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for whi
                             ch main motor power is limited at 80degC (low byte, assuming high byte is 1)
                +1           TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment for a
                             nother 10degC
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Bootloader definitions
                +1           ;**** **** **** **** ****
                +1           RTX_PORT                                EQU     P0              ; Receive/Transmit port
                +1           RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL            
                                          
                +1           RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL             
                                          
                +1           RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP                
                                          
                +1           RTX_PIN                         EQU     5               ; RTX pin
                +1           
                +1           SIGNATURE_001                   EQU     0E8h            ; Device signature
                +1           IF MCU_48MHZ == 0
                +1           SIGNATURE_002                   EQU     0B1h
                +1           ELSE
                +1           SIGNATURE_002                   EQU     0B2h
                +1           ENDIF
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 0 definitions *
                +1           ;*********************  
                +1           ;                       EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           Rcp_In          EQU     5       ;i
                +1           ;                       EQU     4       ;i 
                +1           Mux_C           EQU     3       ;i
                +1           Mux_B           EQU     2       ;i
                +1           Mux_A           EQU     1       ;i
                +1           Comp_Com                EQU     0       ;i
                +1           
                +1           P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                +1           P0_INIT         EQU     0FFh
                +1           P0_PUSHPULL     EQU     0
                +1           P0_SKIP         EQU     0FFh
                +1           
                +1           Get_Rcp_Capture_Values MACRO
                +1                   anl     TCON, #0EFh                             ; Disable timer0
                +1                   mov     Temp1, TL0                              ; Get timer0 values
                +1                   mov     Temp2, TH0
                +1           IF MCU_48MHZ == 1
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    38

                +1                   mov     Temp3, Timer0_X
                +1                   jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                +1                   inc     Temp3                                   ; If it is pending, then timer has 
                             already wrapped
                +1           ENDIF
                +1                   mov     TL0, #0                                 ; Reset timer0
                +1                   mov     TH0, #0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Timer0_X, #0
                +1           ENDIF
                +1                   orl     TCON, #10h                              ; Enable timer0 again
                +1           IF MCU_48MHZ == 1
                +1                   mov     A, Clock_Set_At_48MHz
                +1                   jnz     Get_Rcp_End
                +1                   clr     C
                +1                   mov     A, Temp1
                +1                   rlc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Temp2
                +1                   rlc     A
                +1                   mov     Temp2, A
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1           Get_Rcp_End:
                +1           ENDIF
                +1           ENDM
                +1           Decode_Dshot_2Msb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp4                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp4
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL
                +1           ENDM
                +1           Decode_Dshot_2Lsb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    39

                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp3                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL
                +1           ENDM
                +1           Initialize_PCA MACRO
                +1                   mov     PCA0CN0, #40h                           ; PCA enabled
                +1                   mov     PCA0MD, #08h                            ; PCA clock is system clock
                +1           IF FETON_DELAY == 0
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #00h                          ; Edge aligned pwm
                +1           ELSE
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #03h                          ; Center aligned pwm
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_Polarity MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0POL, #00h                           ; Pwm noninverted
                +1           ELSE
                +1                   mov     PCA0POL, #01h                           ; Damping inverted, pwm noninverted
                +1           ENDIF
                +1           ENDM
                +1           Enable_Power_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, enab
                             le match, set pwm mode
                +1           ELSE
                +1                   mov     PCA0CPM1, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Enable_Damp_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM1, #00h                          ; Disable
                +1           ELSE
                +1                   mov     PCA0CPM0, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Set_Power_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    40

                +1                   mov     PCA0CPL0, Power_Pwm_Reg_L
                +1                   mov     PCA0CPH0, Power_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Power_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Power_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL1, A
                +1                   mov     PCA0CPH1, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Set_Damp_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL1, Damp_Pwm_Reg_L
                +1                   mov     PCA0CPH1, Damp_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Damp_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Damp_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL0, A
                +1                   mov     PCA0CPH0, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Clear_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0DFh
                +1           ENDM
                +1           Clear_CCF_Interrupt MACRO       ; CCF interrupt is only used for FETON_DELAY == 0
                +1                   anl     PCA0CN0, #0FEh
                +1           ENDM
                +1           Enable_COVF_Interrupt MACRO
                +1                   orl     PCA0PWM, #40h
                +1           ENDM
                +1           Enable_CCF_Interrupt MACRO
                +1                   orl     PCA0CPM0,#01h
                +1           ENDM
                +1           Disable_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0BFh
                +1           ENDM
                +1           Disable_CCF_Interrupt MACRO
                +1                   anl     PCA0CPM0,#0FEh
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 1 definitions *
                +1           ;*********************
                +1           ;                       EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           ApwmFET         EQU     5       ;o
                +1           AcomFET         EQU     4       ;o
                +1           BpwmFET         EQU     3       ;o
                +1           BcomFET         EQU     2       ;o
                +1           CpwmFET         EQU     1       ;o
                +1           CcomFET         EQU     0       ;o
                +1           
                +1           P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_INIT         EQU     00h             
                +1           P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_SKIP         EQU     3Fh
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    41

                +1           
                +1           ApwmFET_on MACRO
                +1                   setb    P1.ApwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           ApwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_on MACRO
                +1                   setb    P1.BpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.BpwmFET
                +1           ELSE
                +1                   clr     P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_on MACRO
                +1                   setb    P1.CpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           All_pwmFETs_Off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1                   clr     P1.BpwmFET
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           
                +1           AcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.ApwmFET
                +1           ENDIF
                +1                   setb    P1.AcomFET
                +1           ENDM
                +1           AcomFET_off MACRO
                +1                   clr     P1.AcomFET
                +1           ENDM
                +1           BcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.BpwmFET
                +1           ENDIF
                +1                   setb    P1.BcomFET
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    42

                +1           ENDM
                +1           BcomFET_off MACRO
                +1                   clr     P1.BcomFET
                +1           ENDM
                +1           CcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.CpwmFET
                +1           ENDIF
                +1                   setb    P1.CcomFET
                +1           ENDM
                +1           CcomFET_off MACRO
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           All_comFETs_Off MACRO
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           
                +1           Set_Pwm_A MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1                   mov     P1SKIP, #1Fh
                +1           ELSE
                +1                   mov     P1SKIP, #0Fh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_B MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1                   mov     P1SKIP, #37h
                +1           ELSE
                +1                   mov     P1SKIP, #33h
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_C MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1                   mov     P1SKIP, #3Dh
                +1           ELSE
                +1                   mov     P1SKIP, #3Ch
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwms_Off MACRO
                +1                   mov     P1SKIP, #3Fh
                +1           ENDM
                +1           
                +1           Set_Comp_Phase_A MACRO
                +1                   mov     CMP0MX, #10h    ; Set comparator multiplexer to phase A
                +1           ENDM
                +1           Set_Comp_Phase_B MACRO
                +1                   mov     CMP0MX, #20h    ; Set comparator multiplexer to phase B
                +1           ENDM
                +1           Set_Comp_Phase_C MACRO
                +1                   mov     CMP0MX, #30h    ; Set comparator multiplexer to phase C
                +1           ENDM
                +1           Read_Comp_Out MACRO
                +1                   mov     A, CMP0CN0      ; Read comparator output
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 2 definitions *
                +1           ;*********************
                +1           DebugPin                EQU     0       ;o
                +1           
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    43

                +1           P2_PUSHPULL     EQU     (1 SHL DebugPin)
                +1           
                +1           
                +1           ;**********************
                +1           ; MCU specific macros *
                +1           ;**********************
                +1           Interrupt_Table_Definition MACRO
                +1           CSEG AT 0                               ; Code segment start
                +1                   jmp reset
                +1           CSEG AT 03h                     ; Int0 interrupt        
                +1                   jmp     int0_int        
                +1           IF MCU_48MHZ == 1
                +1           CSEG AT 0Bh                     ; Timer0 overflow interrupt
                +1                   jmp     t0_int
                +1           ENDIF
                +1           CSEG AT 13h                     ; Int1 interrupt
                +1                   jmp     int1_int
                +1           CSEG AT 1Bh                     ; Timer1 overflow interrupt
                +1                   jmp     t1_int
                +1           CSEG AT 2Bh                     ; Timer2 overflow interrupt
                +1                   jmp     t2_int  
                +1           CSEG AT 5Bh                     ; Pca interrupt
                +1                   jmp     pca_int
                +1           CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                +1                   jmp     t3_int  
                +1           ENDM
                +1           
                +1           Initialize_Xbar MACRO
                +1                   mov     XBR2, #40h      ; Xbar enabled                  
                +1                   mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                +1           ENDM
                +1           
                +1           Initialize_Comparator MACRO
                +1                   mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                +1                   mov     CMP0MD, #00h    ; Comparator response time 100ns
                +1           ENDM
                +1           Initialize_Adc MACRO
                +1                   mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bias
                +1           IF MCU_48MHZ == 0
                +1                   mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                +1           ELSE
                +1                   mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                +1           ENDIF
                +1                   mov     ADC0MX, #10h    ; Select temp sensor input
                +1                   mov     ADC0CN0, #80h   ; ADC enabled 
                +1                   mov     ADC0CN1, #01h   ; Common mode buffer enabled
                +1           ENDM
                +1           Start_Adc MACRO
                +1                   mov     ADC0CN0, #90h   ; ADC start
                +1           ENDM
                +1           Read_Adc_Result MACRO
                +1                   mov     Temp1, ADC0L
                +1                   mov     Temp2, ADC0H
                +1           ENDM
                +1           Stop_Adc MACRO
                +1           ENDM
                +1           Set_RPM_Out MACRO
                +1           ENDM
                +1           Clear_RPM_Out MACRO
                +1           ENDM
                +1           Set_MCU_Clk_24MHz MACRO
                +1                   mov     CLKSEL, #13h            ; Set clock to 24MHz
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     Clock_Set_At_48MHz, #0
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    44

                +1           ENDM
                +1           Set_MCU_Clk_48MHz MACRO
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     CLKSEL, #03h            ; Set clock to 48MHz
                +1                   mov     Clock_Set_At_48MHz, #1
                +1           ENDM
                +1           Set_LED_0 MACRO
                +1           ENDM
                +1           Clear_LED_0 MACRO
                +1           ENDM
                +1           Set_LED_1 MACRO
                +1           ENDM
                +1           Clear_LED_1 MACRO
                +1           ENDM
                +1           Set_LED_2 MACRO
                +1           ENDM
                +1           Clear_LED_2 MACRO
                +1           ENDM
                +1           Set_LED_3 MACRO
                +1           ENDM
                +1           Clear_LED_3 MACRO
                +1           ENDM
                             ENDIF
                    2800     
                    2801     IF ESCNO == C_
                             ;$include (C.inc) ; Select pinout C
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; BLHeli program for controlling brushless motors in helicopters and multirotors
                +1           ;
                +1           ; Copyright 2011, 2012 Steffen Skaug
                +1           ; This program is distributed under the terms of the GNU General Public License
                +1           ;
                +1           ; This file is part of BLHeli.
                +1           ;
                +1           ; BLHeli is free software: you can redistribute it and/or modify
                +1           ; it under the terms of the GNU General Public License as published by
                +1           ; the Free Software Foundation, either version 3 of the License, or
                +1           ; (at your option) any later version.
                +1           ;
                +1           ; BLHeli is distributed in the hope that it will be useful,
                +1           ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                +1           ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                +1           ; GNU General Public License for more details.
                +1           ;
                +1           ; You should have received a copy of the GNU General Public License
                +1           ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                +1           ;
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; Hardware definition file "C"
                +1           ; Ac Ap MC MB MA CC X  RC    X  X  X  X  Cc Cp Bc Bp
                +1           ;
                +1           ;**** **** **** **** ****
                +1           
                +1           
                +1           
                +1           ;*********************
                +1           ; Device SiLabs EFM8BB1x/2x
                +1           ;*********************
                +1           IF MCU_48MHZ == 0
                +1           ;$include (SI_EFM8BB1_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    45

                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB10F2G
                +2           ;  EFM8BB10F2I
                +2           ;  EFM8BB10F2Y
                +2           ;  EFM8BB10F4G
                +2           ;  EFM8BB10F4I
                +2           ;  EFM8BB10F4Y
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC      DATA 0E0H; Accumulator                            
                +2           ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF   DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B        DATA 0F0H; B Register                             
                +2           CKCON0   DATA 08EH; Clock Control 0                        
                +2           CLKSEL   DATA 0A9H; Clock Select                           
                +2           CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0MD   DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                +2           CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN   DATA 0DDH; CRC0 Data Input                        
                +2           DERIVID  DATA 0ADH; Derivative Identification              
                +2           DEVICEID DATA 0B5H; Device Identification                  
                +2           DPH      DATA 083H; Data Pointer High                      
                +2           DPL      DATA 082H; Data Pointer Low                       
                +2           EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                +2           FLKEY    DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           IE       DATA 0A8H; Interrupt Enable                       
                +2           IP       DATA 0B8H; Interrupt Priority                     
                +2           IT01CF   DATA 0E4H; INT0/INT1 Configuration                
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    46

                +2           LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0       DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK   DATA 0FEH; Port 0 Mask                            
                +2           P0MAT    DATA 0FDH; Port 0 Match                           
                +2           P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP   DATA 0D4H; Port 0 Skip                            
                +2           P1       DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK   DATA 0EEH; Port 1 Mask                            
                +2           P1MAT    DATA 0EDH; Port 1 Match                           
                +2           P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP   DATA 0D5H; Port 1 Skip                            
                +2           P2       DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                +2           PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0  DATA 0D8H; PCA Control                            
                +2           PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD   DATA 0D9H; PCA Mode                               
                +2           PCA0POL  DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0    DATA 087H; Power Control                          
                +2           PRTDRV   DATA 0F6H; Port Drive Strength                    
                +2           PSCTL    DATA 08FH; Program Store Control                  
                +2           PSW      DATA 0D0H; Program Status Word                    
                +2           REF0CN   DATA 0D1H; Voltage Reference Control              
                +2           REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                +2           REVID    DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC   DATA 0EFH; Reset Source                           
                +2           SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                +2           SCON0    DATA 098H; UART0 Serial Port Control              
                +2           SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                +2           SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SP       DATA 081H; Stack Pointer                          
                +2           SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0  DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT  DATA 0A3H; SPI0 Data                              
                +2           TCON     DATA 088H; Timer 0/1 Control                      
                +2           TH0      DATA 08CH; Timer 0 High Byte                      
                +2           TH1      DATA 08DH; Timer 1 High Byte                      
                +2           TL0      DATA 08AH; Timer 0 Low Byte                       
                +2           TL1      DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD     DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2H    DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0  DATA 091H; Timer 3 Control 0                      
                +2           TMR3H    DATA 095H; Timer 3 High Byte                      
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    47

                +2           TMR3L    DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                +2           VDM0CN   DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN    DATA 097H; Watchdog Timer Control                 
                +2           XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    48

                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    49

                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +1           
                +1           ELSE
                +1           ;$include (SI_EFM8BB2_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    50

                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB21F16G_QFN20
                +2           ;  EFM8BB21F16G_QSOP24
                +2           ;  EFM8BB21F16I_QFN20
                +2           ;  EFM8BB21F16I_QSOP24
                +2           ;  EFM8BB22F16G_QFN28
                +2           ;  EFM8BB22F16I_QFN28
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC       DATA 0E0H; Accumulator                            
                +2           ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF    DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B         DATA 0F0H; B Register                             
                +2           CKCON0    DATA 08EH; Clock Control 0                        
                +2           CKCON1    DATA 0A6H; Clock Control 1
                +2           CLKSEL    DATA 0A9H; Clock Select                           
                +2           CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0CN1   DATA 099H; Comparator 0 Control 1
                +2           CMP0MD    DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                +2           CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CN1   DATA 086H; CRC0 Control 1                         
                +2           CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN    DATA 0DDH; CRC0 Data Input                        
                +2           CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                +2           DERIVID   DATA 0ADH; Derivative Identification              
                +2           DEVICEID  DATA 0B5H; Device Identification                  
                +2           DPH       DATA 083H; Data Pointer High                      
                +2           DPL       DATA 082H; Data Pointer Low                       
                +2           EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                +2           EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                +2           EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                +2           EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                +2           EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                +2           EMI0CN    DATA 0E7H; External Memory Interface Control      
                +2           FLKEY     DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                +2           HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                +2           I2C0CN0   DATA 0BAH; I2C0 Control                           
                +2           I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                +2           I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                +2           I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                +2           I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    51

                +2           I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                +2           I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                +2           I2C0STAT  DATA 0B9H; I2C0 Status                            
                +2           IE        DATA 0A8H; Interrupt Enable                       
                +2           IP        DATA 0B8H; Interrupt Priority                     
                +2           IPH       DATA 0F2H; Interrupt Priority High                
                +2           IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0        DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK    DATA 0FEH; Port 0 Mask                            
                +2           P0MAT     DATA 0FDH; Port 0 Match                           
                +2           P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP    DATA 0D4H; Port 0 Skip                            
                +2           P1        DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK    DATA 0EEH; Port 1 Mask                            
                +2           P1MAT     DATA 0EDH; Port 1 Match                           
                +2           P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP    DATA 0D5H; Port 1 Skip                            
                +2           P2        DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MASK    DATA 0FCH; Port 2 Mask                            
                +2           P2MAT     DATA 0FBH; Port 2 Match                           
                +2           P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                +2           P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                +2           P2SKIP    DATA 0CCH; Port 2 Skip                            
                +2           P3        DATA 0B0H; Port 3 Pin Latch                       
                +2           P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                +2           P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                +2           PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0   DATA 0D8H; PCA Control                            
                +2           PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD    DATA 0D9H; PCA Mode                               
                +2           PCA0POL   DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0     DATA 087H; Power Control                          
                +2           PCON1     DATA 09AH; Power Control 1                        
                +2           PFE0CN    DATA 0C1H; Prefetch Engine Control                
                +2           PRTDRV    DATA 0F6H; Port Drive Strength                    
                +2           PSCTL     DATA 08FH; Program Store Control                  
                +2           PSW       DATA 0D0H; Program Status Word                    
                +2           REF0CN    DATA 0D1H; Voltage Reference Control              
                +2           REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                +2           REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                +2           REVID     DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC    DATA 0EFH; Reset Source                           
                +2           SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                +2           SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                +2           SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                +2           SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                +2           SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                +2           SCON0     DATA 098H; UART0 Serial Port Control              
                +2           SCON1     DATA 0C8H; UART1 Serial Port Control              
                +2           SFRPAGE   DATA 0A7H; SFR Page                               
                +2           SFRPGCN   DATA 0CFH; SFR Page Control                       
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    52

                +2           SFRSTACK  DATA 0D7H; SFR Page Stack                         
                +2           SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                +2           SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                +2           SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                +2           SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                +2           SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                +2           SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SMOD1     DATA 093H; UART1 Mode                             
                +2           SP        DATA 081H; Stack Pointer                          
                +2           SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0   DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT   DATA 0A3H; SPI0 Data                              
                +2           SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                +2           SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                +2           SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                +2           TCON      DATA 088H; Timer 0/1 Control                      
                +2           TH0       DATA 08CH; Timer 0 High Byte                      
                +2           TH1       DATA 08DH; Timer 1 High Byte                      
                +2           TL0       DATA 08AH; Timer 0 Low Byte                       
                +2           TL1       DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD      DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                +2           TMR2H     DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0   DATA 091H; Timer 3 Control 0                      
                +2           TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                +2           TMR3H     DATA 095H; Timer 3 High Byte                      
                +2           TMR3L     DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                +2           TMR4CN0   DATA 098H; Timer 4 Control 0                      
                +2           TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                +2           TMR4H     DATA 0A5H; Timer 4 High Byte                      
                +2           TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                +2           TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                +2           TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                +2           UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                +2           UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                +2           UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                +2           UART1LIN  DATA 09EH; UART1 LIN Configuration                
                +2           VDM0CN    DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN     DATA 097H; Watchdog Timer Control                 
                +2           XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    53

                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                +2           TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    54

                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                +2           P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                +2           
                +2           ; P3 0xB0 (Port 3 Pin Latch)
                +2           P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                +2           P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SCON1 0xC8 (UART1 Serial Port Control)
                +2           SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                +2           SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                +2           SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                +2           SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                +2           SCON1_REN  BIT SCON1.4 ; Receive Enable           
                +2           SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                +2           SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    55

                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                +2           TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                +2           
                +2           ; TMR4CN0 0x98 (Timer 4 Control 0)
                +2           TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                +2           TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                +2           TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                +2           TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                +2           TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                +2           TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                +2           TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                +2           TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                +2           
                +2           ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                +2           UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                +2           UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                +2           UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                +2           UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                +2           UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                +2           UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                +2           UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                +2           UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    56

                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +2           UART1_IRQn   EQU 17 ; UART1                     
                +2           I2C0_IRQn    EQU 18 ; I2C0 Slave                
                +2           TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; SFR Page Definitions
                +2           ;------------------------------------------------------------------------------
                +2           CRC0_PAGE       EQU 000H ; CRC0 Page       
                +2           LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                +2           PCA0_PAGE       EQU 000H ; PCA0 Page       
                +2           PG2_PAGE        EQU 010H ; Page2           
                +2           TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                +2           TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                +2           TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                +2           I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                +2           PG3_PAGE        EQU 020H ; Page3           
                +2           SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                +2           SPI0_PAGE       EQU 020H ; SPI0 Page       
                +2           UART0_PAGE      EQU 020H ; UART0 Page      
                +2           UART1_PAGE      EQU 020H ; UART1 Page      
                +1           
                +1           ENDIF
                +1           
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Uses internal calibrated oscillator set to 24/48Mhz
                +1           ;**** **** **** **** ****
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Constant definitions
                +1           ;**** **** **** **** ****
                +1           IF MCU_48MHZ == 0
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#C_L_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#C_L_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#C_L_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#C_L_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#C_L_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#C_L_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#C_L_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#C_L_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#C_L_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#C_L_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#C_L_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    57

                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (16 B
                             ytes)
                +1           
                +1           ELSE
                +1           
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#C_H_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#C_H_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#C_H_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#C_H_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#C_H_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#C_H_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#C_H_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#C_H_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#C_H_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#C_H_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#C_H_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (16 B
                             ytes)
                +1           ENDIF
                +1           
                +1           TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for whi
                             ch main motor power is limited at 80degC (low byte, assuming high byte is 1)
                +1           TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment for a
                             nother 10degC
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Bootloader definitions
                +1           ;**** **** **** **** ****
                +1           RTX_PORT                                EQU     P0              ; Receive/Transmit port
                +1           RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL            
                                          
                +1           RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL             
                                          
                +1           RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP                
                                          
                +1           RTX_PIN                         EQU     0               ; RTX pin
                +1           
                +1           SIGNATURE_001                   EQU     0E8h            ; Device signature
                +1           IF MCU_48MHZ == 0
                +1           SIGNATURE_002                   EQU     0B1h
                +1           ELSE
                +1           SIGNATURE_002                   EQU     0B2h
                +1           ENDIF
                +1           
                +1           ;*********************
                +1           ; PORT 0 definitions *
                +1           ;*********************  
                +1           AcomFET         EQU     7       ;o
                +1           ApwmFET         EQU     6       ;o
                +1           Mux_C           EQU     5       ;i
                +1           Mux_B           EQU     4       ;i
                +1           Mux_A           EQU     3       ;i
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    58

                +1           Comp_Com                EQU     2       ;i
                +1           ;                       EQU     1       ;i
                +1           Rcp_In          EQU     0       ;i
                +1           
                +1           P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                +1           P0_INIT         EQU     NOT((1 SHL ApwmFET)+(1 SHL AcomFET))
                +1           P0_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL AcomFET)
                +1           P0_SKIP         EQU     0FFh
                +1           
                +1           Get_Rcp_Capture_Values MACRO
                +1                   anl     TCON, #0EFh                             ; Disable timer0
                +1                   mov     Temp1, TL0                              ; Get timer0 values
                +1                   mov     Temp2, TH0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Temp3, Timer0_X
                +1                   jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                +1                   inc     Temp3                                   ; If it is pending, then timer has 
                             already wrapped
                +1           ENDIF
                +1                   mov     TL0, #0                                 ; Reset timer0
                +1                   mov     TH0, #0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Timer0_X, #0
                +1           ENDIF
                +1                   orl     TCON, #10h                              ; Enable timer0 again
                +1           IF MCU_48MHZ == 1
                +1                   mov     A, Clock_Set_At_48MHz
                +1                   jnz     Get_Rcp_End
                +1                   clr     C
                +1                   mov     A, Temp1
                +1                   rlc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Temp2
                +1                   rlc     A
                +1                   mov     Temp2, A
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1           Get_Rcp_End:
                +1           ENDIF
                +1           ENDM
                +1           Decode_Dshot_2Msb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp4                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail
                +1           
                +1                   subb    A, Temp1
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    59

                +1                   mov     A, Temp4
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL
                +1           ENDM
                +1           Decode_Dshot_2Lsb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp3                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL
                +1           ENDM
                +1           Initialize_PCA MACRO
                +1                   mov     PCA0CN0, #40h                           ; PCA enabled
                +1                   mov     PCA0MD, #08h                            ; PCA clock is system clock
                +1           IF FETON_DELAY == 0
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #00h                          ; Edge aligned pwm
                +1           ELSE
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #03h                          ; Center aligned pwm
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_Polarity MACRO
                +1                   mov     PCA0POL, #02h                           ; Damping inverted, pwm noninverted
                +1           ENDM
                +1           Enable_Power_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, enab
                             le match, set pwm mode
                +1           ELSE
                +1                   mov     PCA0CPM0, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    60

                +1           Enable_Damp_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM1, #00h                          ; Disable
                +1           ELSE
                +1                   mov     PCA0CPM1, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Set_Power_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL0, Power_Pwm_Reg_L
                +1                   mov     PCA0CPH0, Power_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Power_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Power_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL0, A
                +1                   mov     PCA0CPH0, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Set_Damp_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL1, Damp_Pwm_Reg_L
                +1                   mov     PCA0CPH1, Damp_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Damp_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Damp_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL1, A
                +1                   mov     PCA0CPH1, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Clear_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0DFh
                +1           ENDM
                +1           Clear_CCF_Interrupt MACRO
                +1                   anl     PCA0CN0, #0FEh
                +1           ENDM
                +1           Enable_COVF_Interrupt MACRO
                +1                   orl     PCA0PWM, #40h
                +1           ENDM
                +1           Enable_CCF_Interrupt MACRO
                +1                   orl     PCA0CPM0,#01h
                +1           ENDM
                +1           Disable_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0BFh
                +1           ENDM
                +1           Disable_CCF_Interrupt MACRO
                +1                   anl     PCA0CPM0,#0FEh
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 1 definitions *
                +1           ;*********************
                +1           ;                       EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           ;                       EQU     5       ;i
                +1           ;                       EQU     4       ;i
                +1           CcomFET         EQU     3       ;o
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    61

                +1           CpwmFET         EQU     2       ;o
                +1           BcomFET         EQU     1       ;o
                +1           BpwmFET         EQU     0       ;o
                +1           
                +1           P1_DIGITAL      EQU     (1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_INIT         EQU     00h             
                +1           P1_PUSHPULL     EQU     (1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_SKIP         EQU     0Fh
                +1           
                +1           ApwmFET_on MACRO
                +1                   setb    P0.ApwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P0.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           ApwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P0.ApwmFET
                +1           ELSE
                +1                   clr     P0.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_on MACRO
                +1                   setb    P1.BpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.BpwmFET
                +1           ELSE
                +1                   clr     P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_on MACRO
                +1                   setb    P1.CpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           All_pwmFETs_Off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P0.ApwmFET
                +1                   clr     P1.BpwmFET
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P0.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           
                +1           AcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P0.ApwmFET
                +1           ENDIF
                +1                   setb    P0.AcomFET
                +1           ENDM
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    62

                +1           AcomFET_off MACRO
                +1                   clr     P0.AcomFET
                +1           ENDM
                +1           BcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.BpwmFET
                +1           ENDIF
                +1                   setb    P1.BcomFET
                +1           ENDM
                +1           BcomFET_off MACRO
                +1                   clr     P1.BcomFET
                +1           ENDM
                +1           CcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.CpwmFET
                +1           ENDIF
                +1                   setb    P1.CcomFET
                +1           ENDM
                +1           CcomFET_off MACRO
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           All_comFETs_Off MACRO
                +1                   clr     P0.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           
                +1           Set_Pwm_A MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P0.AcomFET
                +1                   mov     P0SKIP, #0BFh
                +1                   mov     P1SKIP, #0Fh
                +1           ELSE
                +1                   mov     P0SKIP, #03Fh
                +1                   mov     P1SKIP, #0Fh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_B MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1                   mov     P0SKIP, #0FFh
                +1                   mov     P1SKIP, #0Eh
                +1           ELSE
                +1                   mov     P0SKIP, #0FFh
                +1                   mov     P1SKIP, #0Ch
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_C MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1                   mov     P0SKIP, #0FFh
                +1                   mov     P1SKIP, #0Bh
                +1           ELSE
                +1                   mov     P0SKIP, #0FFh
                +1                   mov     P1SKIP, #03h
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwms_Off MACRO
                +1                   mov     P0SKIP, #0FFh
                +1                   mov     P1SKIP, #0Fh
                +1           ENDM
                +1           
                +1           Set_Comp_Phase_A MACRO
                +1                   mov     CMP0MX, #32h    ; Set comparator multiplexer to phase A
                +1           ENDM
                +1           Set_Comp_Phase_B MACRO
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    63

                +1                   mov     CMP0MX, #42h    ; Set comparator multiplexer to phase B
                +1           ENDM
                +1           Set_Comp_Phase_C MACRO
                +1                   mov     CMP0MX, #52h    ; Set comparator multiplexer to phase C
                +1           ENDM
                +1           Read_Comp_Out MACRO
                +1                   mov     A, CMP0CN0      ; Read comparator output
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 2 definitions *
                +1           ;*********************
                +1           DebugPin                EQU     0       ;o
                +1           
                +1           P2_PUSHPULL     EQU     (1 SHL DebugPin)
                +1           
                +1           
                +1           ;**********************
                +1           ; MCU specific macros *
                +1           ;**********************
                +1           Interrupt_Table_Definition MACRO
                +1           CSEG AT 0                               ; Code segment start
                +1                   jmp reset
                +1           CSEG AT 03h                     ; Int0 interrupt        
                +1                   jmp     int0_int        
                +1           IF MCU_48MHZ == 1
                +1           CSEG AT 0Bh                     ; Timer0 overflow interrupt
                +1                   jmp     t0_int
                +1           ENDIF
                +1           CSEG AT 13h                     ; Int1 interrupt
                +1                   jmp     int1_int
                +1           CSEG AT 1Bh                     ; Timer1 overflow interrupt
                +1                   jmp     t1_int
                +1           CSEG AT 2Bh                     ; Timer2 overflow interrupt
                +1                   jmp     t2_int  
                +1           CSEG AT 5Bh                     ; Pca interrupt
                +1                   jmp     pca_int
                +1           CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                +1                   jmp     t3_int  
                +1           ENDM
                +1           
                +1           Initialize_Xbar MACRO
                +1                   mov     XBR2, #40h      ; Xbar enabled                  
                +1                   mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                +1           ENDM
                +1           
                +1           Initialize_Comparator MACRO
                +1                   mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                +1                   mov     CMP0MD, #00h    ; Comparator response time 100ns
                +1           ENDM
                +1           Initialize_Adc MACRO
                +1                   mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bias
                +1           IF MCU_48MHZ == 0
                +1                   mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                +1           ELSE
                +1                   mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                +1           ENDIF
                +1                   mov     ADC0MX, #10h    ; Select temp sensor input
                +1                   mov     ADC0CN0, #80h   ; ADC enabled 
                +1                   mov     ADC0CN1, #01h   ; Common mode buffer enabled
                +1           ENDM
                +1           Start_Adc MACRO
                +1                   mov     ADC0CN0, #90h   ; ADC start
                +1           ENDM
                +1           Read_Adc_Result MACRO
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    64

                +1                   mov     Temp1, ADC0L
                +1                   mov     Temp2, ADC0H
                +1           ENDM
                +1           Stop_Adc MACRO
                +1           ENDM
                +1           Set_RPM_Out MACRO
                +1           ENDM
                +1           Clear_RPM_Out MACRO
                +1           ENDM
                +1           Set_MCU_Clk_24MHz MACRO
                +1                   mov     CLKSEL, #13h            ; Set clock to 24MHz
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     Clock_Set_At_48MHz, #0
                +1           ENDM
                +1           Set_MCU_Clk_48MHz MACRO
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     CLKSEL, #03h            ; Set clock to 48MHz
                +1                   mov     Clock_Set_At_48MHz, #1
                +1           ENDM
                +1           Set_LED_0 MACRO
                +1           ENDM
                +1           Clear_LED_0 MACRO
                +1           ENDM
                +1           Set_LED_1 MACRO
                +1           ENDM
                +1           Clear_LED_1 MACRO
                +1           ENDM
                +1           Set_LED_2 MACRO
                +1           ENDM
                +1           Clear_LED_2 MACRO
                +1           ENDM
                +1           Set_LED_3 MACRO
                +1           ENDM
                +1           Clear_LED_3 MACRO
                +1           ENDM
                             ENDIF
                    4120     
                    4121     IF ESCNO == D_
                             ;$include (D.inc) ; Select pinout D
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; BLHeli program for controlling brushless motors in helicopters and multirotors
                +1           ;
                +1           ; Copyright 2011, 2012 Steffen Skaug
                +1           ; This program is distributed under the terms of the GNU General Public License
                +1           ;
                +1           ; This file is part of BLHeli.
                +1           ;
                +1           ; BLHeli is free software: you can redistribute it and/or modify
                +1           ; it under the terms of the GNU General Public License as published by
                +1           ; the Free Software Foundation, either version 3 of the License, or
                +1           ; (at your option) any later version.
                +1           ;
                +1           ; BLHeli is distributed in the hope that it will be useful,
                +1           ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                +1           ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                +1           ; GNU General Public License for more details.
                +1           ;
                +1           ; You should have received a copy of the GNU General Public License
                +1           ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                +1           ;
                +1           ;**** **** **** **** ****
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    65

                +1           ;
                +1           ; Hardware definition file "D". Com fets are active low for H/L_N driver and EN_N/PWM driver
                +1           ; X  X  RC X  CC MA MC MB    X  X  Cc Cp Bc Bp Ac Ap
                +1           ;
                +1           ;**** **** **** **** ****
                +1           
                +1           
                +1           
                +1           ;*********************
                +1           ; Device SiLabs EFM8BB1x/2x
                +1           ;*********************
                +1           IF MCU_48MHZ == 0
                +1           ;$include (SI_EFM8BB1_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB10F2G
                +2           ;  EFM8BB10F2I
                +2           ;  EFM8BB10F2Y
                +2           ;  EFM8BB10F4G
                +2           ;  EFM8BB10F4I
                +2           ;  EFM8BB10F4Y
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC      DATA 0E0H; Accumulator                            
                +2           ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF   DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B        DATA 0F0H; B Register                             
                +2           CKCON0   DATA 08EH; Clock Control 0                        
                +2           CLKSEL   DATA 0A9H; Clock Select                           
                +2           CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0MD   DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                +2           CRC0CN0  DATA 0CEH; CRC0 Control 0                         
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    66

                +2           CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN   DATA 0DDH; CRC0 Data Input                        
                +2           DERIVID  DATA 0ADH; Derivative Identification              
                +2           DEVICEID DATA 0B5H; Device Identification                  
                +2           DPH      DATA 083H; Data Pointer High                      
                +2           DPL      DATA 082H; Data Pointer Low                       
                +2           EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                +2           FLKEY    DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           IE       DATA 0A8H; Interrupt Enable                       
                +2           IP       DATA 0B8H; Interrupt Priority                     
                +2           IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0       DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK   DATA 0FEH; Port 0 Mask                            
                +2           P0MAT    DATA 0FDH; Port 0 Match                           
                +2           P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP   DATA 0D4H; Port 0 Skip                            
                +2           P1       DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK   DATA 0EEH; Port 1 Mask                            
                +2           P1MAT    DATA 0EDH; Port 1 Match                           
                +2           P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP   DATA 0D5H; Port 1 Skip                            
                +2           P2       DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                +2           PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0  DATA 0D8H; PCA Control                            
                +2           PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD   DATA 0D9H; PCA Mode                               
                +2           PCA0POL  DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0    DATA 087H; Power Control                          
                +2           PRTDRV   DATA 0F6H; Port Drive Strength                    
                +2           PSCTL    DATA 08FH; Program Store Control                  
                +2           PSW      DATA 0D0H; Program Status Word                    
                +2           REF0CN   DATA 0D1H; Voltage Reference Control              
                +2           REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                +2           REVID    DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC   DATA 0EFH; Reset Source                           
                +2           SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                +2           SCON0    DATA 098H; UART0 Serial Port Control              
                +2           SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                +2           SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SP       DATA 081H; Stack Pointer                          
                +2           SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    67

                +2           SPI0CN0  DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT  DATA 0A3H; SPI0 Data                              
                +2           TCON     DATA 088H; Timer 0/1 Control                      
                +2           TH0      DATA 08CH; Timer 0 High Byte                      
                +2           TH1      DATA 08DH; Timer 1 High Byte                      
                +2           TL0      DATA 08AH; Timer 0 Low Byte                       
                +2           TL1      DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD     DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2H    DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0  DATA 091H; Timer 3 Control 0                      
                +2           TMR3H    DATA 095H; Timer 3 High Byte                      
                +2           TMR3L    DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                +2           VDM0CN   DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN    DATA 097H; Watchdog Timer Control                 
                +2           XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    68

                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    69

                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    70

                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +1           
                +1           ELSE
                +1           ;$include (SI_EFM8BB2_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB21F16G_QFN20
                +2           ;  EFM8BB21F16G_QSOP24
                +2           ;  EFM8BB21F16I_QFN20
                +2           ;  EFM8BB21F16I_QSOP24
                +2           ;  EFM8BB22F16G_QFN28
                +2           ;  EFM8BB22F16I_QFN28
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC       DATA 0E0H; Accumulator                            
                +2           ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF    DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B         DATA 0F0H; B Register                             
                +2           CKCON0    DATA 08EH; Clock Control 0                        
                +2           CKCON1    DATA 0A6H; Clock Control 1
                +2           CLKSEL    DATA 0A9H; Clock Select                           
                +2           CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0CN1   DATA 099H; Comparator 0 Control 1
                +2           CMP0MD    DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                +2           CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CN1   DATA 086H; CRC0 Control 1                         
                +2           CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN    DATA 0DDH; CRC0 Data Input                        
                +2           CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                +2           DERIVID   DATA 0ADH; Derivative Identification              
                +2           DEVICEID  DATA 0B5H; Device Identification                  
                +2           DPH       DATA 083H; Data Pointer High                      
                +2           DPL       DATA 082H; Data Pointer Low                       
                +2           EIE1      DATA 0E6H; Extended Interrupt Enable 1            
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    71

                +2           EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                +2           EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                +2           EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                +2           EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                +2           EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                +2           EMI0CN    DATA 0E7H; External Memory Interface Control      
                +2           FLKEY     DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                +2           HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                +2           I2C0CN0   DATA 0BAH; I2C0 Control                           
                +2           I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                +2           I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                +2           I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                +2           I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                +2           I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                +2           I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                +2           I2C0STAT  DATA 0B9H; I2C0 Status                            
                +2           IE        DATA 0A8H; Interrupt Enable                       
                +2           IP        DATA 0B8H; Interrupt Priority                     
                +2           IPH       DATA 0F2H; Interrupt Priority High                
                +2           IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0        DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK    DATA 0FEH; Port 0 Mask                            
                +2           P0MAT     DATA 0FDH; Port 0 Match                           
                +2           P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP    DATA 0D4H; Port 0 Skip                            
                +2           P1        DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK    DATA 0EEH; Port 1 Mask                            
                +2           P1MAT     DATA 0EDH; Port 1 Match                           
                +2           P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP    DATA 0D5H; Port 1 Skip                            
                +2           P2        DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MASK    DATA 0FCH; Port 2 Mask                            
                +2           P2MAT     DATA 0FBH; Port 2 Match                           
                +2           P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                +2           P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                +2           P2SKIP    DATA 0CCH; Port 2 Skip                            
                +2           P3        DATA 0B0H; Port 3 Pin Latch                       
                +2           P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                +2           P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                +2           PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0   DATA 0D8H; PCA Control                            
                +2           PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD    DATA 0D9H; PCA Mode                               
                +2           PCA0POL   DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0     DATA 087H; Power Control                          
                +2           PCON1     DATA 09AH; Power Control 1                        
                +2           PFE0CN    DATA 0C1H; Prefetch Engine Control                
                +2           PRTDRV    DATA 0F6H; Port Drive Strength                    
                +2           PSCTL     DATA 08FH; Program Store Control                  
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    72

                +2           PSW       DATA 0D0H; Program Status Word                    
                +2           REF0CN    DATA 0D1H; Voltage Reference Control              
                +2           REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                +2           REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                +2           REVID     DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC    DATA 0EFH; Reset Source                           
                +2           SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                +2           SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                +2           SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                +2           SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                +2           SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                +2           SCON0     DATA 098H; UART0 Serial Port Control              
                +2           SCON1     DATA 0C8H; UART1 Serial Port Control              
                +2           SFRPAGE   DATA 0A7H; SFR Page                               
                +2           SFRPGCN   DATA 0CFH; SFR Page Control                       
                +2           SFRSTACK  DATA 0D7H; SFR Page Stack                         
                +2           SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                +2           SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                +2           SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                +2           SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                +2           SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                +2           SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SMOD1     DATA 093H; UART1 Mode                             
                +2           SP        DATA 081H; Stack Pointer                          
                +2           SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0   DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT   DATA 0A3H; SPI0 Data                              
                +2           SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                +2           SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                +2           SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                +2           TCON      DATA 088H; Timer 0/1 Control                      
                +2           TH0       DATA 08CH; Timer 0 High Byte                      
                +2           TH1       DATA 08DH; Timer 1 High Byte                      
                +2           TL0       DATA 08AH; Timer 0 Low Byte                       
                +2           TL1       DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD      DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                +2           TMR2H     DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0   DATA 091H; Timer 3 Control 0                      
                +2           TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                +2           TMR3H     DATA 095H; Timer 3 High Byte                      
                +2           TMR3L     DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                +2           TMR4CN0   DATA 098H; Timer 4 Control 0                      
                +2           TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                +2           TMR4H     DATA 0A5H; Timer 4 High Byte                      
                +2           TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                +2           TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                +2           TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                +2           UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                +2           UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                +2           UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                +2           UART1LIN  DATA 09EH; UART1 LIN Configuration                
                +2           VDM0CN    DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN     DATA 097H; Watchdog Timer Control                 
                +2           XBR0      DATA 0E1H; Port I/O Crossbar 0                    
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    73

                +2           XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                +2           TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    74

                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                +2           P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                +2           
                +2           ; P3 0xB0 (Port 3 Pin Latch)
                +2           P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                +2           P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    75

                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SCON1 0xC8 (UART1 Serial Port Control)
                +2           SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                +2           SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                +2           SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                +2           SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                +2           SCON1_REN  BIT SCON1.4 ; Receive Enable           
                +2           SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                +2           SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                +2           TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                +2           
                +2           ; TMR4CN0 0x98 (Timer 4 Control 0)
                +2           TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                +2           TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                +2           TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                +2           TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                +2           TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                +2           TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                +2           TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                +2           TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                +2           
                +2           ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                +2           UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                +2           UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                +2           UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    76

                +2           UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                +2           UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                +2           UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                +2           UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                +2           UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +2           UART1_IRQn   EQU 17 ; UART1                     
                +2           I2C0_IRQn    EQU 18 ; I2C0 Slave                
                +2           TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; SFR Page Definitions
                +2           ;------------------------------------------------------------------------------
                +2           CRC0_PAGE       EQU 000H ; CRC0 Page       
                +2           LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                +2           PCA0_PAGE       EQU 000H ; PCA0 Page       
                +2           PG2_PAGE        EQU 010H ; Page2           
                +2           TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                +2           TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                +2           TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                +2           I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                +2           PG3_PAGE        EQU 020H ; Page3           
                +2           SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                +2           SPI0_PAGE       EQU 020H ; SPI0 Page       
                +2           UART0_PAGE      EQU 020H ; UART0 Page      
                +2           UART1_PAGE      EQU 020H ; UART1 Page      
                +1           
                +1           ENDIF
                +1           
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Uses internal calibrated oscillator set to 24/48Mhz
                +1           ;**** **** **** **** ****
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Constant definitions
                +1           ;**** **** **** **** ****
                +1           IF MCU_48MHZ == 0
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#D_L_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#D_L_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#D_L_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#D_L_15#        "
                +1           ELSEIF FETON_DELAY == 20
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    77

                +1           Eep_ESC_Layout:         DB      "#D_L_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#D_L_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#D_L_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#D_L_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#D_L_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#D_L_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#D_L_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (16 B
                             ytes)
                +1           
                +1           ELSE
                +1           
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#D_H_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#D_H_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#D_H_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#D_H_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#D_H_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#D_H_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#D_H_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#D_H_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#D_H_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#D_H_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#D_H_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (16 B
                             ytes)
                +1           ENDIF
                +1           
                +1           TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for whi
                             ch main motor power is limited at 80degC (low byte, assuming high byte is 1)
                +1           TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment for a
                             nother 10degC
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Bootloader definitions
                +1           ;**** **** **** **** ****
                +1           RTX_PORT                                EQU     P0              ; Receive/Transmit port
                +1           RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL            
                                          
                +1           RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL             
                                          
                +1           RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP                
                                          
                +1           RTX_PIN                         EQU     5               ; RTX pin
                +1           
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    78

                +1           SIGNATURE_001                   EQU     0E8h            ; Device signature
                +1           IF MCU_48MHZ == 0
                +1           SIGNATURE_002                   EQU     0B1h
                +1           ELSE
                +1           SIGNATURE_002                   EQU     0B2h
                +1           ENDIF
                +1           
                +1           ;*********************
                +1           ; PORT 0 definitions *
                +1           ;*********************  
                +1           ;                       EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           Rcp_In          EQU     5       ;i
                +1           ;                       EQU     4       ;i 
                +1           Comp_Com                EQU     3       ;i
                +1           Mux_A           EQU     2       ;i
                +1           Mux_C           EQU     1       ;i
                +1           Mux_B           EQU     0       ;i
                +1           
                +1           P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                +1           P0_INIT         EQU     0FFh
                +1           P0_PUSHPULL     EQU     0
                +1           P0_SKIP         EQU     0FFh
                +1           
                +1           Get_Rcp_Capture_Values MACRO
                +1                   anl     TCON, #0EFh                             ; Disable timer0
                +1                   mov     Temp1, TL0                              ; Get timer0 values
                +1                   mov     Temp2, TH0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Temp3, Timer0_X
                +1                   jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                +1                   inc     Temp3                                   ; If it is pending, then timer has 
                             already wrapped
                +1           ENDIF
                +1                   mov     TL0, #0                                 ; Reset timer0
                +1                   mov     TH0, #0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Timer0_X, #0
                +1           ENDIF
                +1                   orl     TCON, #10h                              ; Enable timer0 again
                +1           IF MCU_48MHZ == 1
                +1                   mov     A, Clock_Set_At_48MHz
                +1                   jnz     Get_Rcp_End
                +1                   clr     C
                +1                   mov     A, Temp1
                +1                   rlc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Temp2
                +1                   rlc     A
                +1                   mov     Temp2, A
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1           Get_Rcp_End:
                +1           ENDIF
                +1           ENDM
                +1           Decode_Dshot_2Msb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                +1           
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    79

                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp4                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp4
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL
                +1           ENDM
                +1           Decode_Dshot_2Lsb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp3                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL
                +1           ENDM
                +1           Initialize_PCA MACRO
                +1                   mov     PCA0CN0, #40h                           ; PCA enabled
                +1                   mov     PCA0MD, #08h                            ; PCA clock is system clock
                +1           IF FETON_DELAY == 0
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #00h                          ; Edge aligned pwm
                +1           ELSE
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ENDIF
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    80

                +1                   mov     PCA0CENT, #03h                          ; Center aligned pwm
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_Polarity MACRO
                +1                   mov     PCA0POL, #00h                           ; Damping noninverted, pwm noninver
                             ted
                +1           ENDM
                +1           Enable_Power_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, enab
                             le match, set pwm mode
                +1           ELSE
                +1                   mov     PCA0CPM0, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Enable_Damp_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM1, #00h                          ; Disable
                +1           ELSE
                +1                   mov     PCA0CPM1, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Set_Power_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL0, Power_Pwm_Reg_L
                +1                   mov     PCA0CPH0, Power_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Power_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Power_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL0, A
                +1                   mov     PCA0CPH0, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Set_Damp_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL1, Damp_Pwm_Reg_L
                +1                   mov     PCA0CPH1, Damp_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Damp_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Damp_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL1, A
                +1                   mov     PCA0CPH1, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Clear_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0DFh
                +1           ENDM
                +1           Clear_CCF_Interrupt MACRO
                +1                   anl     PCA0CN0, #0FEh
                +1           ENDM
                +1           Enable_COVF_Interrupt MACRO
                +1                   orl     PCA0PWM, #40h
                +1           ENDM
                +1           Enable_CCF_Interrupt MACRO
                +1                   orl     PCA0CPM0,#01h
                +1           ENDM
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    81

                +1           Disable_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0BFh
                +1           ENDM
                +1           Disable_CCF_Interrupt MACRO
                +1                   anl     PCA0CPM0,#0FEh
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 1 definitions *
                +1           ;*********************
                +1           ;                       EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           CcomFET         EQU     5       ;o
                +1           CpwmFET         EQU     4       ;o
                +1           BcomFET         EQU     3       ;o
                +1           BpwmFET         EQU     2       ;o
                +1           AcomFET         EQU     1       ;o
                +1           ApwmFET         EQU     0       ;o
                +1           
                +1           P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_INIT         EQU     (1 SHL AcomFET)+(1 SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_SKIP         EQU     3Fh
                +1           
                +1           ApwmFET_on MACRO
                +1                   setb    P1.ApwmFET
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           ApwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1           ELSE
                +1                   setb    P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_on MACRO
                +1                   setb    P1.BpwmFET
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.BpwmFET
                +1           ELSE
                +1                   setb    P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_on MACRO
                +1                   setb    P1.CpwmFET
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   setb    P1.CcomFET
                +1           ENDIF
                +1           ENDM
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    82

                +1           All_pwmFETs_Off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1                   clr     P1.BpwmFET
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   setb    P1.AcomFET
                +1                   setb    P1.BcomFET
                +1                   setb    P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           
                +1           AcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.ApwmFET
                +1           ENDIF
                +1                   clr     P1.AcomFET
                +1           ENDM
                +1           AcomFET_off MACRO
                +1                   setb    P1.AcomFET
                +1           ENDM
                +1           BcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.BpwmFET
                +1           ENDIF
                +1                   clr     P1.BcomFET
                +1           ENDM
                +1           BcomFET_off MACRO
                +1                   setb    P1.BcomFET
                +1           ENDM
                +1           CcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.CpwmFET
                +1           ENDIF
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           CcomFET_off MACRO
                +1                   setb    P1.CcomFET
                +1           ENDM
                +1           All_comFETs_Off MACRO
                +1                   setb    P1.AcomFET
                +1                   setb    P1.BcomFET
                +1                   setb    P1.CcomFET
                +1           ENDM
                +1           
                +1           Set_Pwm_A MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.AcomFET
                +1                   mov     P1SKIP, #3Eh
                +1           ELSE
                +1                   mov     P1SKIP, #3Ch
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_B MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.BcomFET
                +1                   mov     P1SKIP, #3Bh
                +1           ELSE
                +1                   mov     P1SKIP, #33h
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_C MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.CcomFET
                +1                   mov     P1SKIP, #2Fh
                +1           ELSE
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    83

                +1                   mov     P1SKIP, #0Fh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwms_Off MACRO
                +1                   mov     P1SKIP, #3Fh
                +1           ENDM
                +1           
                +1           Set_Comp_Phase_A MACRO
                +1                   mov     CMP0MX, #23h    ; Set comparator multiplexer to phase A
                +1           ENDM
                +1           Set_Comp_Phase_B MACRO
                +1                   mov     CMP0MX, #03h    ; Set comparator multiplexer to phase B
                +1           ENDM
                +1           Set_Comp_Phase_C MACRO
                +1                   mov     CMP0MX, #13h    ; Set comparator multiplexer to phase C
                +1           ENDM
                +1           Read_Comp_Out MACRO
                +1                   mov     A, CMP0CN0      ; Read comparator output
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 2 definitions *
                +1           ;*********************
                +1           DebugPin                EQU     0       ;o
                +1           
                +1           P2_PUSHPULL     EQU     (1 SHL DebugPin)
                +1           
                +1           
                +1           ;**********************
                +1           ; MCU specific macros *
                +1           ;**********************
                +1           Interrupt_Table_Definition MACRO
                +1           CSEG AT 0                               ; Code segment start
                +1                   jmp reset
                +1           CSEG AT 03h                     ; Int0 interrupt        
                +1                   jmp     int0_int        
                +1           IF MCU_48MHZ == 1
                +1           CSEG AT 0Bh                     ; Timer0 overflow interrupt
                +1                   jmp     t0_int
                +1           ENDIF
                +1           CSEG AT 13h                     ; Int1 interrupt
                +1                   jmp     int1_int
                +1           CSEG AT 1Bh                     ; Timer1 overflow interrupt
                +1                   jmp     t1_int
                +1           CSEG AT 2Bh                     ; Timer2 overflow interrupt
                +1                   jmp     t2_int  
                +1           CSEG AT 5Bh                     ; Pca interrupt
                +1                   jmp     pca_int
                +1           CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                +1                   jmp     t3_int  
                +1           ENDM
                +1           
                +1           Initialize_Xbar MACRO
                +1                   mov     XBR2, #40h      ; Xbar enabled                  
                +1                   mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                +1           ENDM
                +1           
                +1           Initialize_Comparator MACRO
                +1                   mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                +1                   mov     CMP0MD, #00h    ; Comparator response time 100ns
                +1           ENDM
                +1           Initialize_Adc MACRO
                +1                   mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bias
                +1           IF MCU_48MHZ == 0
                +1                   mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    84

                +1           ELSE
                +1                   mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                +1           ENDIF
                +1                   mov     ADC0MX, #10h    ; Select temp sensor input
                +1                   mov     ADC0CN0, #80h   ; ADC enabled 
                +1                   mov     ADC0CN1, #01h   ; Common mode buffer enabled
                +1           ENDM
                +1           Start_Adc MACRO
                +1                   mov     ADC0CN0, #90h   ; ADC start
                +1           ENDM
                +1           Read_Adc_Result MACRO
                +1                   mov     Temp1, ADC0L
                +1                   mov     Temp2, ADC0H
                +1           ENDM
                +1           Stop_Adc MACRO
                +1           ENDM
                +1           Set_RPM_Out MACRO
                +1           ENDM
                +1           Clear_RPM_Out MACRO
                +1           ENDM
                +1           Set_MCU_Clk_24MHz MACRO
                +1                   mov     CLKSEL, #13h            ; Set clock to 24MHz
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     Clock_Set_At_48MHz, #0
                +1           ENDM
                +1           Set_MCU_Clk_48MHz MACRO
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     CLKSEL, #03h            ; Set clock to 48MHz
                +1                   mov     Clock_Set_At_48MHz, #1
                +1           ENDM
                +1           Set_LED_0 MACRO
                +1           ENDM
                +1           Clear_LED_0 MACRO
                +1           ENDM
                +1           Set_LED_1 MACRO
                +1           ENDM
                +1           Clear_LED_1 MACRO
                +1           ENDM
                +1           Set_LED_2 MACRO
                +1           ENDM
                +1           Clear_LED_2 MACRO
                +1           ENDM
                +1           Set_LED_3 MACRO
                +1           ENDM
                +1           Clear_LED_3 MACRO
                +1           ENDM
                             ENDIF
                    5433     
                    5434     IF ESCNO == E_
                             ;$include (E.inc) ; Select pinout E
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; BLHeli program for controlling brushless motors in helicopters and multirotors
                +1           ;
                +1           ; Copyright 2011, 2012 Steffen Skaug
                +1           ; This program is distributed under the terms of the GNU General Public License
                +1           ;
                +1           ; This file is part of BLHeli.
                +1           ;
                +1           ; BLHeli is free software: you can redistribute it and/or modify
                +1           ; it under the terms of the GNU General Public License as published by
                +1           ; the Free Software Foundation, either version 3 of the License, or
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    85

                +1           ; (at your option) any later version.
                +1           ;
                +1           ; BLHeli is distributed in the hope that it will be useful,
                +1           ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                +1           ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                +1           ; GNU General Public License for more details.
                +1           ;
                +1           ; You should have received a copy of the GNU General Public License
                +1           ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                +1           ;
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; Hardware definition file "E". Equals "A", but with LED control. And with HIP2103/4 driver
                              initialization
                +1           ; L1 L0 RC X  MC MB MA CC    X  L2 Cc Cp Bc Bp Ac Ap
                +1           ;
                +1           ;**** **** **** **** ****
                +1           
                +1           
                +1           
                +1           ;*********************
                +1           ; Device SiLabs EFM8BB1x/2x
                +1           ;*********************
                +1           IF MCU_48MHZ == 0
                +1           ;$include (SI_EFM8BB1_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB10F2G
                +2           ;  EFM8BB10F2I
                +2           ;  EFM8BB10F2Y
                +2           ;  EFM8BB10F4G
                +2           ;  EFM8BB10F4I
                +2           ;  EFM8BB10F4Y
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC      DATA 0E0H; Accumulator                            
                +2           ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF   DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR  DATA 0DFH; ADC0 Power Control                     
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    86

                +2           ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B        DATA 0F0H; B Register                             
                +2           CKCON0   DATA 08EH; Clock Control 0                        
                +2           CLKSEL   DATA 0A9H; Clock Select                           
                +2           CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0MD   DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                +2           CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN   DATA 0DDH; CRC0 Data Input                        
                +2           DERIVID  DATA 0ADH; Derivative Identification              
                +2           DEVICEID DATA 0B5H; Device Identification                  
                +2           DPH      DATA 083H; Data Pointer High                      
                +2           DPL      DATA 082H; Data Pointer Low                       
                +2           EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                +2           FLKEY    DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           IE       DATA 0A8H; Interrupt Enable                       
                +2           IP       DATA 0B8H; Interrupt Priority                     
                +2           IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0       DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK   DATA 0FEH; Port 0 Mask                            
                +2           P0MAT    DATA 0FDH; Port 0 Match                           
                +2           P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP   DATA 0D4H; Port 0 Skip                            
                +2           P1       DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK   DATA 0EEH; Port 1 Mask                            
                +2           P1MAT    DATA 0EDH; Port 1 Match                           
                +2           P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP   DATA 0D5H; Port 1 Skip                            
                +2           P2       DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                +2           PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0  DATA 0D8H; PCA Control                            
                +2           PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD   DATA 0D9H; PCA Mode                               
                +2           PCA0POL  DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0    DATA 087H; Power Control                          
                +2           PRTDRV   DATA 0F6H; Port Drive Strength                    
                +2           PSCTL    DATA 08FH; Program Store Control                  
                +2           PSW      DATA 0D0H; Program Status Word                    
                +2           REF0CN   DATA 0D1H; Voltage Reference Control              
                +2           REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                +2           REVID    DATA 0B6H; Revision Identifcation                 
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    87

                +2           RSTSRC   DATA 0EFH; Reset Source                           
                +2           SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                +2           SCON0    DATA 098H; UART0 Serial Port Control              
                +2           SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                +2           SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SP       DATA 081H; Stack Pointer                          
                +2           SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0  DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT  DATA 0A3H; SPI0 Data                              
                +2           TCON     DATA 088H; Timer 0/1 Control                      
                +2           TH0      DATA 08CH; Timer 0 High Byte                      
                +2           TH1      DATA 08DH; Timer 1 High Byte                      
                +2           TL0      DATA 08AH; Timer 0 Low Byte                       
                +2           TL1      DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD     DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2H    DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0  DATA 091H; Timer 3 Control 0                      
                +2           TMR3H    DATA 095H; Timer 3 High Byte                      
                +2           TMR3L    DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                +2           VDM0CN   DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN    DATA 097H; Watchdog Timer Control                 
                +2           XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    88

                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    89

                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                +2           
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    90

                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +1           
                +1           ELSE
                +1           ;$include (SI_EFM8BB2_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB21F16G_QFN20
                +2           ;  EFM8BB21F16G_QSOP24
                +2           ;  EFM8BB21F16I_QFN20
                +2           ;  EFM8BB21F16I_QSOP24
                +2           ;  EFM8BB22F16G_QFN28
                +2           ;  EFM8BB22F16I_QFN28
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC       DATA 0E0H; Accumulator                            
                +2           ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF    DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B         DATA 0F0H; B Register                             
                +2           CKCON0    DATA 08EH; Clock Control 0                        
                +2           CKCON1    DATA 0A6H; Clock Control 1
                +2           CLKSEL    DATA 0A9H; Clock Select                           
                +2           CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0CN1   DATA 099H; Comparator 0 Control 1
                +2           CMP0MD    DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                +2           CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    91

                +2           CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CN1   DATA 086H; CRC0 Control 1                         
                +2           CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN    DATA 0DDH; CRC0 Data Input                        
                +2           CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                +2           DERIVID   DATA 0ADH; Derivative Identification              
                +2           DEVICEID  DATA 0B5H; Device Identification                  
                +2           DPH       DATA 083H; Data Pointer High                      
                +2           DPL       DATA 082H; Data Pointer Low                       
                +2           EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                +2           EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                +2           EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                +2           EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                +2           EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                +2           EMI0CN    DATA 0E7H; External Memory Interface Control      
                +2           FLKEY     DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                +2           HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                +2           I2C0CN0   DATA 0BAH; I2C0 Control                           
                +2           I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                +2           I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                +2           I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                +2           I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                +2           I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                +2           I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                +2           I2C0STAT  DATA 0B9H; I2C0 Status                            
                +2           IE        DATA 0A8H; Interrupt Enable                       
                +2           IP        DATA 0B8H; Interrupt Priority                     
                +2           IPH       DATA 0F2H; Interrupt Priority High                
                +2           IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0        DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK    DATA 0FEH; Port 0 Mask                            
                +2           P0MAT     DATA 0FDH; Port 0 Match                           
                +2           P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP    DATA 0D4H; Port 0 Skip                            
                +2           P1        DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK    DATA 0EEH; Port 1 Mask                            
                +2           P1MAT     DATA 0EDH; Port 1 Match                           
                +2           P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP    DATA 0D5H; Port 1 Skip                            
                +2           P2        DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MASK    DATA 0FCH; Port 2 Mask                            
                +2           P2MAT     DATA 0FBH; Port 2 Match                           
                +2           P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                +2           P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                +2           P2SKIP    DATA 0CCH; Port 2 Skip                            
                +2           P3        DATA 0B0H; Port 3 Pin Latch                       
                +2           P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                +2           P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                +2           PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0   DATA 0D8H; PCA Control                            
                +2           PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    92

                +2           PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD    DATA 0D9H; PCA Mode                               
                +2           PCA0POL   DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0     DATA 087H; Power Control                          
                +2           PCON1     DATA 09AH; Power Control 1                        
                +2           PFE0CN    DATA 0C1H; Prefetch Engine Control                
                +2           PRTDRV    DATA 0F6H; Port Drive Strength                    
                +2           PSCTL     DATA 08FH; Program Store Control                  
                +2           PSW       DATA 0D0H; Program Status Word                    
                +2           REF0CN    DATA 0D1H; Voltage Reference Control              
                +2           REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                +2           REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                +2           REVID     DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC    DATA 0EFH; Reset Source                           
                +2           SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                +2           SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                +2           SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                +2           SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                +2           SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                +2           SCON0     DATA 098H; UART0 Serial Port Control              
                +2           SCON1     DATA 0C8H; UART1 Serial Port Control              
                +2           SFRPAGE   DATA 0A7H; SFR Page                               
                +2           SFRPGCN   DATA 0CFH; SFR Page Control                       
                +2           SFRSTACK  DATA 0D7H; SFR Page Stack                         
                +2           SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                +2           SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                +2           SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                +2           SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                +2           SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                +2           SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SMOD1     DATA 093H; UART1 Mode                             
                +2           SP        DATA 081H; Stack Pointer                          
                +2           SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0   DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT   DATA 0A3H; SPI0 Data                              
                +2           SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                +2           SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                +2           SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                +2           TCON      DATA 088H; Timer 0/1 Control                      
                +2           TH0       DATA 08CH; Timer 0 High Byte                      
                +2           TH1       DATA 08DH; Timer 1 High Byte                      
                +2           TL0       DATA 08AH; Timer 0 Low Byte                       
                +2           TL1       DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD      DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                +2           TMR2H     DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0   DATA 091H; Timer 3 Control 0                      
                +2           TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                +2           TMR3H     DATA 095H; Timer 3 High Byte                      
                +2           TMR3L     DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                +2           TMR4CN0   DATA 098H; Timer 4 Control 0                      
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    93

                +2           TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                +2           TMR4H     DATA 0A5H; Timer 4 High Byte                      
                +2           TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                +2           TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                +2           TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                +2           UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                +2           UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                +2           UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                +2           UART1LIN  DATA 09EH; UART1 LIN Configuration                
                +2           VDM0CN    DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN     DATA 097H; Watchdog Timer Control                 
                +2           XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                +2           TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    94

                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                +2           P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                +2           
                +2           ; P3 0xB0 (Port 3 Pin Latch)
                +2           P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                +2           P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    95

                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SCON1 0xC8 (UART1 Serial Port Control)
                +2           SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                +2           SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                +2           SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                +2           SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                +2           SCON1_REN  BIT SCON1.4 ; Receive Enable           
                +2           SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                +2           SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                +2           TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                +2           
                +2           ; TMR4CN0 0x98 (Timer 4 Control 0)
                +2           TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    96

                +2           TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                +2           TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                +2           TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                +2           TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                +2           TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                +2           TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                +2           TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                +2           
                +2           ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                +2           UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                +2           UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                +2           UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                +2           UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                +2           UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                +2           UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                +2           UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                +2           UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +2           UART1_IRQn   EQU 17 ; UART1                     
                +2           I2C0_IRQn    EQU 18 ; I2C0 Slave                
                +2           TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; SFR Page Definitions
                +2           ;------------------------------------------------------------------------------
                +2           CRC0_PAGE       EQU 000H ; CRC0 Page       
                +2           LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                +2           PCA0_PAGE       EQU 000H ; PCA0 Page       
                +2           PG2_PAGE        EQU 010H ; Page2           
                +2           TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                +2           TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                +2           TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                +2           I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                +2           PG3_PAGE        EQU 020H ; Page3           
                +2           SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                +2           SPI0_PAGE       EQU 020H ; SPI0 Page       
                +2           UART0_PAGE      EQU 020H ; UART0 Page      
                +2           UART1_PAGE      EQU 020H ; UART1 Page      
                +1           
                +1           ENDIF
                +1           
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Uses internal calibrated oscillator set to 24/48Mhz
                +1           ;**** **** **** **** ****
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Constant definitions
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    97

                +1           ;**** **** **** **** ****
                +1           IF MCU_48MHZ == 0
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#E_L_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#E_L_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#E_L_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#E_L_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#E_L_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#E_L_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#E_L_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#E_L_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#E_L_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#E_L_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#E_L_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (16 B
                             ytes)
                +1           
                +1           ELSE
                +1           
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#E_H_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#E_H_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#E_H_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#E_H_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#E_H_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#E_H_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#E_H_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#E_H_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#E_H_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#E_H_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#E_H_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (16 B
                             ytes)
                +1           ENDIF
                +1           
                +1           TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for whi
                             ch main motor power is limited at 80degC (low byte, assuming high byte is 1)
                +1           TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment for a
                             nother 10degC
                +1           
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    98

                +1           ;**** **** **** **** ****
                +1           ; Bootloader definitions
                +1           ;**** **** **** **** ****
                +1           RTX_PORT                                EQU     P0              ; Receive/Transmit port
                +1           RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL            
                                          
                +1           RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL             
                                          
                +1           RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP                
                                          
                +1           RTX_PIN                         EQU     5               ; RTX pin
                +1           
                +1           SIGNATURE_001                   EQU     0E8h            ; Device signature
                +1           IF MCU_48MHZ == 0
                +1           SIGNATURE_002                   EQU     0B1h
                +1           ELSE
                +1           SIGNATURE_002                   EQU     0B2h
                +1           ENDIF
                +1           
                +1           ;*********************
                +1           ; PORT 0 definitions *
                +1           ;*********************  
                +1           LED_1           EQU     7       ;o
                +1           LED_0           EQU     6       ;o
                +1           Rcp_In          EQU     5       ;i
                +1           ;                       EQU     4       ;i 
                +1           Mux_C           EQU     3       ;i
                +1           Mux_B           EQU     2       ;i
                +1           Mux_A           EQU     1       ;i
                +1           Comp_Com                EQU     0       ;i
                +1           
                +1           P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                +1           P0_INIT         EQU     NOT((1 SHL LED_0)+(1 SHL LED_1))
                +1           P0_PUSHPULL     EQU     (1 SHL LED_0)+(1 SHL LED_1)
                +1           P0_SKIP         EQU     0FFh
                +1           
                +1           Get_Rcp_Capture_Values MACRO
                +1                   anl     TCON, #0EFh                             ; Disable timer0
                +1                   mov     Temp1, TL0                              ; Get timer0 values
                +1                   mov     Temp2, TH0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Temp3, Timer0_X
                +1                   jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                +1                   inc     Temp3                                   ; If it is pending, then timer has 
                             already wrapped
                +1           ENDIF
                +1                   mov     TL0, #0                                 ; Reset timer0
                +1                   mov     TH0, #0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Timer0_X, #0
                +1           ENDIF
                +1                   orl     TCON, #10h                              ; Enable timer0 again
                +1           IF MCU_48MHZ == 1
                +1                   mov     A, Clock_Set_At_48MHz
                +1                   jnz     Get_Rcp_End
                +1                   clr     C
                +1                   mov     A, Temp1
                +1                   rlc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Temp2
                +1                   rlc     A
                +1                   mov     Temp2, A
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1           Get_Rcp_End:
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE    99

                +1           ENDIF
                +1           ENDM
                +1           Decode_Dshot_2Msb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp4                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp4
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL
                +1           ENDM
                +1           Decode_Dshot_2Lsb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp3                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL
                +1           ENDM
                +1           Initialize_PCA MACRO
                +1                   mov     PCA0CN0, #40h                           ; PCA enabled
                +1                   mov     PCA0MD, #08h                            ; PCA clock is system clock
                +1           IF FETON_DELAY == 0
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   100

                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #00h                          ; Edge aligned pwm
                +1           ELSE
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #03h                          ; Center aligned pwm
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_Polarity MACRO
                +1                   mov     PCA0POL, #02h                           ; Damping inverted, pwm noninverted
                +1           ENDM
                +1           Enable_Power_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, enab
                             le match, set pwm mode
                +1           ELSE
                +1                   mov     PCA0CPM0, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Enable_Damp_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM1, #00h                          ; Disable
                +1           ELSE
                +1                   mov     PCA0CPM1, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Set_Power_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL0, Power_Pwm_Reg_L
                +1                   mov     PCA0CPH0, Power_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Power_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Power_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL0, A
                +1                   mov     PCA0CPH0, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Set_Damp_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL1, Damp_Pwm_Reg_L
                +1                   mov     PCA0CPH1, Damp_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Damp_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Damp_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL1, A
                +1                   mov     PCA0CPH1, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Clear_COVF_Interrupt MACRO
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   101

                +1                   anl     PCA0PWM, #0DFh
                +1           ENDM
                +1           Clear_CCF_Interrupt MACRO
                +1                   anl     PCA0CN0, #0FEh
                +1           ENDM
                +1           Enable_COVF_Interrupt MACRO
                +1                   orl     PCA0PWM, #40h
                +1           ENDM
                +1           Enable_CCF_Interrupt MACRO
                +1                   orl     PCA0CPM0,#01h
                +1           ENDM
                +1           Disable_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0BFh
                +1           ENDM
                +1           Disable_CCF_Interrupt MACRO
                +1                   anl     PCA0CPM0,#0FEh
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 1 definitions *
                +1           ;*********************
                +1           ;                       EQU     7       ;i
                +1           LED_2           EQU     6       ;o
                +1           CcomFET         EQU     5       ;o
                +1           CpwmFET         EQU     4       ;o
                +1           BcomFET         EQU     3       ;o
                +1           BpwmFET         EQU     2       ;o
                +1           AcomFET         EQU     1       ;o
                +1           ApwmFET         EQU     0       ;o
                +1           
                +1           P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)+(1 SHL LED_2)
                +1           P1_INIT         EQU     00h             
                +1           P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)+(1 SHL LED_2)
                +1           P1_SKIP         EQU     7Fh
                +1           
                +1           ApwmFET_on MACRO
                +1                   setb    P1.ApwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           ApwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_on MACRO
                +1                   setb    P1.BpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.BpwmFET
                +1           ELSE
                +1                   clr     P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_on MACRO
                +1                   setb    P1.CpwmFET
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   102

                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           All_pwmFETs_Off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1                   clr     P1.BpwmFET
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           
                +1           AcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.ApwmFET
                +1           ENDIF
                +1                   setb    P1.AcomFET
                +1           ENDM
                +1           AcomFET_off MACRO
                +1                   clr     P1.AcomFET
                +1           ENDM
                +1           BcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.BpwmFET
                +1           ENDIF
                +1                   setb    P1.BcomFET
                +1           ENDM
                +1           BcomFET_off MACRO
                +1                   clr     P1.BcomFET
                +1           ENDM
                +1           CcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.CpwmFET
                +1           ENDIF
                +1                   setb    P1.CcomFET
                +1           ENDM
                +1           CcomFET_off MACRO
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           All_comFETs_Off MACRO
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           
                +1           Set_Pwm_A MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1                   mov     P1SKIP, #7Eh
                +1           ELSE
                +1                   mov     P1SKIP, #7Ch
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_B MACRO
                +1           IF FETON_DELAY == 0
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   103

                +1                   setb    P1.BcomFET
                +1                   mov     P1SKIP, #7Bh
                +1           ELSE
                +1                   mov     P1SKIP, #73h
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_C MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1                   mov     P1SKIP, #6Fh
                +1           ELSE
                +1                   mov     P1SKIP, #4Fh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwms_Off MACRO
                +1                   mov     P1SKIP, #7Fh
                +1           ENDM
                +1           
                +1           Set_Comp_Phase_A MACRO
                +1                   mov     CMP0MX, #10h    ; Set comparator multiplexer to phase A
                +1           ENDM
                +1           Set_Comp_Phase_B MACRO
                +1                   mov     CMP0MX, #20h    ; Set comparator multiplexer to phase B
                +1           ENDM
                +1           Set_Comp_Phase_C MACRO
                +1                   mov     CMP0MX, #30h    ; Set comparator multiplexer to phase C
                +1           ENDM
                +1           Read_Comp_Out MACRO
                +1                   mov     A, CMP0CN0      ; Read comparator output
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 2 definitions *
                +1           ;*********************
                +1           DebugPin                EQU     0       ;o
                +1           
                +1           P2_PUSHPULL     EQU     (1 SHL DebugPin)
                +1           
                +1           
                +1           ;**********************
                +1           ; MCU specific macros *
                +1           ;**********************
                +1           Interrupt_Table_Definition MACRO
                +1           CSEG AT 0                               ; Code segment start
                +1                   jmp reset
                +1           CSEG AT 03h                     ; Int0 interrupt        
                +1                   jmp     int0_int        
                +1           IF MCU_48MHZ == 1
                +1           CSEG AT 0Bh                     ; Timer0 overflow interrupt
                +1                   jmp     t0_int
                +1           ENDIF
                +1           CSEG AT 13h                     ; Int1 interrupt
                +1                   jmp     int1_int
                +1           CSEG AT 1Bh                     ; Timer1 overflow interrupt
                +1                   jmp     t1_int
                +1           CSEG AT 2Bh                     ; Timer2 overflow interrupt
                +1                   jmp     t2_int  
                +1           CSEG AT 5Bh                     ; Pca interrupt
                +1                   jmp     pca_int
                +1           CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                +1                   jmp     t3_int  
                +1           ENDM
                +1           
                +1           Initialize_Xbar MACRO
                +1                   mov     XBR2, #40h      ; Xbar enabled                  
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   104

                +1                   mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                +1                   All_pwmFETs_off ; For unlocking of HIP2103/4 driver circuits
                +1                   call wait100ms
                +1                   AcomFET_on
                +1                   BcomFET_on
                +1                   CcomFET_on
                +1                   call wait1ms
                +1                   All_comFETs_off
                +1           ENDM
                +1           
                +1           Initialize_Comparator MACRO
                +1                   mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                +1                   mov     CMP0MD, #00h    ; Comparator response time 100ns
                +1           ENDM
                +1           Initialize_Adc MACRO
                +1                   mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bias
                +1           IF MCU_48MHZ == 0
                +1                   mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                +1           ELSE
                +1                   mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                +1           ENDIF
                +1                   mov     ADC0MX, #10h    ; Select temp sensor input
                +1                   mov     ADC0CN0, #80h   ; ADC enabled 
                +1                   mov     ADC0CN1, #01h   ; Common mode buffer enabled
                +1           ENDM
                +1           Start_Adc MACRO
                +1                   mov     ADC0CN0, #90h   ; ADC start
                +1           ENDM
                +1           Read_Adc_Result MACRO
                +1                   mov     Temp1, ADC0L
                +1                   mov     Temp2, ADC0H
                +1           ENDM
                +1           Stop_Adc MACRO
                +1           ENDM
                +1           Set_RPM_Out MACRO
                +1           ENDM
                +1           Clear_RPM_Out MACRO
                +1           ENDM
                +1           Set_MCU_Clk_24MHz MACRO
                +1                   mov     CLKSEL, #13h            ; Set clock to 24MHz
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     Clock_Set_At_48MHz, #0
                +1           ENDM
                +1           Set_MCU_Clk_48MHz MACRO
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     CLKSEL, #03h            ; Set clock to 48MHz
                +1                   mov     Clock_Set_At_48MHz, #1
                +1           ENDM
                +1           Set_LED_0 MACRO
                +1                   setb    P0.LED_0
                +1           ENDM
                +1           Clear_LED_0 MACRO
                +1                   clr     P0.LED_0
                +1           ENDM
                +1           Set_LED_1 MACRO
                +1                   setb    P0.LED_1
                +1           ENDM
                +1           Clear_LED_1 MACRO
                +1                   clr     P0.LED_1
                +1           ENDM
                +1           Set_LED_2 MACRO
                +1                   setb    P1.LED_2
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   105

                +1           ENDM
                +1           Clear_LED_2 MACRO
                +1                   clr     P1.LED_2
                +1           ENDM
                +1           Set_LED_3 MACRO
                +1           ENDM
                +1           Clear_LED_3 MACRO
                +1           ENDM
                             ENDIF
                    6759     
                    6760     IF ESCNO == F_
                             ;$include (F.inc) ; Select pinout F
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; BLHeli program for controlling brushless motors in helicopters and multirotors
                +1           ;
                +1           ; Copyright 2011, 2012 Steffen Skaug
                +1           ; This program is distributed under the terms of the GNU General Public License
                +1           ;
                +1           ; This file is part of BLHeli.
                +1           ;
                +1           ; BLHeli is free software: you can redistribute it and/or modify
                +1           ; it under the terms of the GNU General Public License as published by
                +1           ; the Free Software Foundation, either version 3 of the License, or
                +1           ; (at your option) any later version.
                +1           ;
                +1           ; BLHeli is distributed in the hope that it will be useful,
                +1           ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                +1           ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                +1           ; GNU General Public License for more details.
                +1           ;
                +1           ; You should have received a copy of the GNU General Public License
                +1           ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                +1           ;
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; Hardware definition file "F". Equals "A", but with Mux_A and Mux_C swapped
                +1           ; X  X  RC X  MA MB MC CC    X  X  Cc Cp Bc Bp Ac Ap
                +1           ;
                +1           ;**** **** **** **** ****
                +1           
                +1           
                +1           
                +1           ;*********************
                +1           ; Device SiLabs EFM8BB1x/2x
                +1           ;*********************
                +1           IF MCU_48MHZ == 0
                +1           ;$include (SI_EFM8BB1_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB10F2G
                +2           ;  EFM8BB10F2I
                +2           ;  EFM8BB10F2Y
                +2           ;  EFM8BB10F4G
                +2           ;  EFM8BB10F4I
                +2           ;  EFM8BB10F4Y
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   106

                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC      DATA 0E0H; Accumulator                            
                +2           ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF   DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B        DATA 0F0H; B Register                             
                +2           CKCON0   DATA 08EH; Clock Control 0                        
                +2           CLKSEL   DATA 0A9H; Clock Select                           
                +2           CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0MD   DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                +2           CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN   DATA 0DDH; CRC0 Data Input                        
                +2           DERIVID  DATA 0ADH; Derivative Identification              
                +2           DEVICEID DATA 0B5H; Device Identification                  
                +2           DPH      DATA 083H; Data Pointer High                      
                +2           DPL      DATA 082H; Data Pointer Low                       
                +2           EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                +2           FLKEY    DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           IE       DATA 0A8H; Interrupt Enable                       
                +2           IP       DATA 0B8H; Interrupt Priority                     
                +2           IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0       DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK   DATA 0FEH; Port 0 Mask                            
                +2           P0MAT    DATA 0FDH; Port 0 Match                           
                +2           P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP   DATA 0D4H; Port 0 Skip                            
                +2           P1       DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK   DATA 0EEH; Port 1 Mask                            
                +2           P1MAT    DATA 0EDH; Port 1 Match                           
                +2           P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP   DATA 0D5H; Port 1 Skip                            
                +2           P2       DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                +2           PCA0CENT DATA 09EH; PCA Center Alignment Enable            
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   107

                +2           PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0  DATA 0D8H; PCA Control                            
                +2           PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD   DATA 0D9H; PCA Mode                               
                +2           PCA0POL  DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0    DATA 087H; Power Control                          
                +2           PRTDRV   DATA 0F6H; Port Drive Strength                    
                +2           PSCTL    DATA 08FH; Program Store Control                  
                +2           PSW      DATA 0D0H; Program Status Word                    
                +2           REF0CN   DATA 0D1H; Voltage Reference Control              
                +2           REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                +2           REVID    DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC   DATA 0EFH; Reset Source                           
                +2           SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                +2           SCON0    DATA 098H; UART0 Serial Port Control              
                +2           SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                +2           SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SP       DATA 081H; Stack Pointer                          
                +2           SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0  DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT  DATA 0A3H; SPI0 Data                              
                +2           TCON     DATA 088H; Timer 0/1 Control                      
                +2           TH0      DATA 08CH; Timer 0 High Byte                      
                +2           TH1      DATA 08DH; Timer 1 High Byte                      
                +2           TL0      DATA 08AH; Timer 0 Low Byte                       
                +2           TL1      DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD     DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2H    DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0  DATA 091H; Timer 3 Control 0                      
                +2           TMR3H    DATA 095H; Timer 3 High Byte                      
                +2           TMR3L    DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                +2           VDM0CN   DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN    DATA 097H; Watchdog Timer Control                 
                +2           XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   108

                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                +2           
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   109

                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   110

                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +1           
                +1           ELSE
                +1           ;$include (SI_EFM8BB2_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB21F16G_QFN20
                +2           ;  EFM8BB21F16G_QSOP24
                +2           ;  EFM8BB21F16I_QFN20
                +2           ;  EFM8BB21F16I_QSOP24
                +2           ;  EFM8BB22F16G_QFN28
                +2           ;  EFM8BB22F16I_QFN28
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC       DATA 0E0H; Accumulator                            
                +2           ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF    DATA 0BCH; ADC0 Configuration                     
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   111

                +2           ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B         DATA 0F0H; B Register                             
                +2           CKCON0    DATA 08EH; Clock Control 0                        
                +2           CKCON1    DATA 0A6H; Clock Control 1
                +2           CLKSEL    DATA 0A9H; Clock Select                           
                +2           CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0CN1   DATA 099H; Comparator 0 Control 1
                +2           CMP0MD    DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                +2           CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CN1   DATA 086H; CRC0 Control 1                         
                +2           CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN    DATA 0DDH; CRC0 Data Input                        
                +2           CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                +2           DERIVID   DATA 0ADH; Derivative Identification              
                +2           DEVICEID  DATA 0B5H; Device Identification                  
                +2           DPH       DATA 083H; Data Pointer High                      
                +2           DPL       DATA 082H; Data Pointer Low                       
                +2           EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                +2           EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                +2           EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                +2           EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                +2           EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                +2           EMI0CN    DATA 0E7H; External Memory Interface Control      
                +2           FLKEY     DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                +2           HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                +2           I2C0CN0   DATA 0BAH; I2C0 Control                           
                +2           I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                +2           I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                +2           I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                +2           I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                +2           I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                +2           I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                +2           I2C0STAT  DATA 0B9H; I2C0 Status                            
                +2           IE        DATA 0A8H; Interrupt Enable                       
                +2           IP        DATA 0B8H; Interrupt Priority                     
                +2           IPH       DATA 0F2H; Interrupt Priority High                
                +2           IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0        DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK    DATA 0FEH; Port 0 Mask                            
                +2           P0MAT     DATA 0FDH; Port 0 Match                           
                +2           P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP    DATA 0D4H; Port 0 Skip                            
                +2           P1        DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK    DATA 0EEH; Port 1 Mask                            
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   112

                +2           P1MAT     DATA 0EDH; Port 1 Match                           
                +2           P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP    DATA 0D5H; Port 1 Skip                            
                +2           P2        DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MASK    DATA 0FCH; Port 2 Mask                            
                +2           P2MAT     DATA 0FBH; Port 2 Match                           
                +2           P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                +2           P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                +2           P2SKIP    DATA 0CCH; Port 2 Skip                            
                +2           P3        DATA 0B0H; Port 3 Pin Latch                       
                +2           P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                +2           P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                +2           PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0   DATA 0D8H; PCA Control                            
                +2           PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD    DATA 0D9H; PCA Mode                               
                +2           PCA0POL   DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0     DATA 087H; Power Control                          
                +2           PCON1     DATA 09AH; Power Control 1                        
                +2           PFE0CN    DATA 0C1H; Prefetch Engine Control                
                +2           PRTDRV    DATA 0F6H; Port Drive Strength                    
                +2           PSCTL     DATA 08FH; Program Store Control                  
                +2           PSW       DATA 0D0H; Program Status Word                    
                +2           REF0CN    DATA 0D1H; Voltage Reference Control              
                +2           REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                +2           REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                +2           REVID     DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC    DATA 0EFH; Reset Source                           
                +2           SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                +2           SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                +2           SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                +2           SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                +2           SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                +2           SCON0     DATA 098H; UART0 Serial Port Control              
                +2           SCON1     DATA 0C8H; UART1 Serial Port Control              
                +2           SFRPAGE   DATA 0A7H; SFR Page                               
                +2           SFRPGCN   DATA 0CFH; SFR Page Control                       
                +2           SFRSTACK  DATA 0D7H; SFR Page Stack                         
                +2           SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                +2           SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                +2           SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                +2           SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                +2           SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                +2           SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SMOD1     DATA 093H; UART1 Mode                             
                +2           SP        DATA 081H; Stack Pointer                          
                +2           SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0   DATA 0F8H; SPI0 Control                           
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   113

                +2           SPI0DAT   DATA 0A3H; SPI0 Data                              
                +2           SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                +2           SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                +2           SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                +2           TCON      DATA 088H; Timer 0/1 Control                      
                +2           TH0       DATA 08CH; Timer 0 High Byte                      
                +2           TH1       DATA 08DH; Timer 1 High Byte                      
                +2           TL0       DATA 08AH; Timer 0 Low Byte                       
                +2           TL1       DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD      DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                +2           TMR2H     DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0   DATA 091H; Timer 3 Control 0                      
                +2           TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                +2           TMR3H     DATA 095H; Timer 3 High Byte                      
                +2           TMR3L     DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                +2           TMR4CN0   DATA 098H; Timer 4 Control 0                      
                +2           TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                +2           TMR4H     DATA 0A5H; Timer 4 High Byte                      
                +2           TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                +2           TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                +2           TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                +2           UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                +2           UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                +2           UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                +2           UART1LIN  DATA 09EH; UART1 LIN Configuration                
                +2           VDM0CN    DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN     DATA 097H; Watchdog Timer Control                 
                +2           XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                +2           TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   114

                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   115

                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                +2           P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                +2           
                +2           ; P3 0xB0 (Port 3 Pin Latch)
                +2           P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                +2           P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SCON1 0xC8 (UART1 Serial Port Control)
                +2           SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                +2           SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                +2           SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                +2           SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                +2           SCON1_REN  BIT SCON1.4 ; Receive Enable           
                +2           SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                +2           SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   116

                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                +2           TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                +2           
                +2           ; TMR4CN0 0x98 (Timer 4 Control 0)
                +2           TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                +2           TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                +2           TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                +2           TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                +2           TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                +2           TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                +2           TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                +2           TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                +2           
                +2           ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                +2           UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                +2           UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                +2           UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                +2           UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                +2           UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                +2           UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                +2           UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                +2           UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +2           UART1_IRQn   EQU 17 ; UART1                     
                +2           I2C0_IRQn    EQU 18 ; I2C0 Slave                
                +2           TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; SFR Page Definitions
                +2           ;------------------------------------------------------------------------------
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   117

                +2           CRC0_PAGE       EQU 000H ; CRC0 Page       
                +2           LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                +2           PCA0_PAGE       EQU 000H ; PCA0 Page       
                +2           PG2_PAGE        EQU 010H ; Page2           
                +2           TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                +2           TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                +2           TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                +2           I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                +2           PG3_PAGE        EQU 020H ; Page3           
                +2           SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                +2           SPI0_PAGE       EQU 020H ; SPI0 Page       
                +2           UART0_PAGE      EQU 020H ; UART0 Page      
                +2           UART1_PAGE      EQU 020H ; UART1 Page      
                +1           
                +1           ENDIF
                +1           
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Uses internal calibrated oscillator set to 24/48Mhz
                +1           ;**** **** **** **** ****
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Constant definitions
                +1           ;**** **** **** **** ****
                +1           IF MCU_48MHZ == 0
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#F_L_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#F_L_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#F_L_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#F_L_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#F_L_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#F_L_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#F_L_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#F_L_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#F_L_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#F_L_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#F_L_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (16 B
                             ytes)
                +1           
                +1           ELSE
                +1           
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#F_H_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#F_H_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#F_H_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#F_H_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#F_H_20#        "
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   118

                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#F_H_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#F_H_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#F_H_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#F_H_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#F_H_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#F_H_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (16 B
                             ytes)
                +1           ENDIF
                +1           
                +1           TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for whi
                             ch main motor power is limited at 80degC (low byte, assuming high byte is 1)
                +1           TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment for a
                             nother 10degC
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Bootloader definitions
                +1           ;**** **** **** **** ****
                +1           RTX_PORT                                EQU     P0              ; Receive/Transmit port
                +1           RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL            
                                          
                +1           RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL             
                                          
                +1           RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP                
                                          
                +1           RTX_PIN                         EQU     5               ; RTX pin
                +1           
                +1           SIGNATURE_001                   EQU     0E8h            ; Device signature
                +1           IF MCU_48MHZ == 0
                +1           SIGNATURE_002                   EQU     0B1h
                +1           ELSE
                +1           SIGNATURE_002                   EQU     0B2h
                +1           ENDIF
                +1           
                +1           ;*********************
                +1           ; PORT 0 definitions *
                +1           ;*********************  
                +1           ;                       EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           Rcp_In          EQU     5       ;i
                +1           ;                       EQU     4       ;i 
                +1           Mux_A           EQU     3       ;i
                +1           Mux_B           EQU     2       ;i
                +1           Mux_C           EQU     1       ;i
                +1           Comp_Com                EQU     0       ;i
                +1           
                +1           P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                +1           P0_INIT         EQU     0FFh
                +1           P0_PUSHPULL     EQU     0
                +1           P0_SKIP         EQU     0FFh
                +1           
                +1           Get_Rcp_Capture_Values MACRO
                +1                   anl     TCON, #0EFh                             ; Disable timer0
                +1                   mov     Temp1, TL0                              ; Get timer0 values
                +1                   mov     Temp2, TH0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Temp3, Timer0_X
                +1                   jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   119

                +1                   inc     Temp3                                   ; If it is pending, then timer has 
                             already wrapped
                +1           ENDIF
                +1                   mov     TL0, #0                                 ; Reset timer0
                +1                   mov     TH0, #0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Timer0_X, #0
                +1           ENDIF
                +1                   orl     TCON, #10h                              ; Enable timer0 again
                +1           IF MCU_48MHZ == 1
                +1                   mov     A, Clock_Set_At_48MHz
                +1                   jnz     Get_Rcp_End
                +1                   clr     C
                +1                   mov     A, Temp1
                +1                   rlc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Temp2
                +1                   rlc     A
                +1                   mov     Temp2, A
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1           Get_Rcp_End:
                +1           ENDIF
                +1           ENDM
                +1           Decode_Dshot_2Msb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp4                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp4
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL
                +1           ENDM
                +1           Decode_Dshot_2Lsb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   120

                             ne
                +1                   mov     A, Temp3                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL
                +1           ENDM
                +1           Initialize_PCA MACRO
                +1                   mov     PCA0CN0, #40h                           ; PCA enabled
                +1                   mov     PCA0MD, #08h                            ; PCA clock is system clock
                +1           IF FETON_DELAY == 0
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #00h                          ; Edge aligned pwm
                +1           ELSE
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #03h                          ; Center aligned pwm
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_Polarity MACRO
                +1                   mov     PCA0POL, #02h                           ; Damping inverted, pwm noninverted
                +1           ENDM
                +1           Enable_Power_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, enab
                             le match, set pwm mode
                +1           ELSE
                +1                   mov     PCA0CPM0, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Enable_Damp_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM1, #00h                          ; Disable
                +1           ELSE
                +1                   mov     PCA0CPM1, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Set_Power_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL0, Power_Pwm_Reg_L
                +1                   mov     PCA0CPH0, Power_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Power_Pwm_Reg_H
                +1                   rrc     A
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   121

                +1                   mov     Temp1, A
                +1                   mov     A, Power_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL0, A
                +1                   mov     PCA0CPH0, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Set_Damp_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL1, Damp_Pwm_Reg_L
                +1                   mov     PCA0CPH1, Damp_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Damp_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Damp_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL1, A
                +1                   mov     PCA0CPH1, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Clear_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0DFh
                +1           ENDM
                +1           Clear_CCF_Interrupt MACRO
                +1                   anl     PCA0CN0, #0FEh
                +1           ENDM
                +1           Enable_COVF_Interrupt MACRO
                +1                   orl     PCA0PWM, #40h
                +1           ENDM
                +1           Enable_CCF_Interrupt MACRO
                +1                   orl     PCA0CPM0,#01h
                +1           ENDM
                +1           Disable_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0BFh
                +1           ENDM
                +1           Disable_CCF_Interrupt MACRO
                +1                   anl     PCA0CPM0,#0FEh
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 1 definitions *
                +1           ;*********************
                +1           ;                       EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           CcomFET         EQU     5       ;o
                +1           CpwmFET         EQU     4       ;o
                +1           BcomFET         EQU     3       ;o
                +1           BpwmFET         EQU     2       ;o
                +1           AcomFET         EQU     1       ;o
                +1           ApwmFET         EQU     0       ;o
                +1           
                +1           P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_INIT         EQU     00h             
                +1           P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_SKIP         EQU     3Fh
                +1           
                +1           ApwmFET_on MACRO
                +1                   setb    P1.ApwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1           ENDIF
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   122

                +1           ENDM
                +1           ApwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_on MACRO
                +1                   setb    P1.BpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.BpwmFET
                +1           ELSE
                +1                   clr     P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_on MACRO
                +1                   setb    P1.CpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           All_pwmFETs_Off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1                   clr     P1.BpwmFET
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           
                +1           AcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.ApwmFET
                +1           ENDIF
                +1                   setb    P1.AcomFET
                +1           ENDM
                +1           AcomFET_off MACRO
                +1                   clr     P1.AcomFET
                +1           ENDM
                +1           BcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.BpwmFET
                +1           ENDIF
                +1                   setb    P1.BcomFET
                +1           ENDM
                +1           BcomFET_off MACRO
                +1                   clr     P1.BcomFET
                +1           ENDM
                +1           CcomFET_on MACRO
                +1           IF FETON_DELAY == 0
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   123

                +1                   clr     P1.CpwmFET
                +1           ENDIF
                +1                   setb    P1.CcomFET
                +1           ENDM
                +1           CcomFET_off MACRO
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           All_comFETs_Off MACRO
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           
                +1           Set_Pwm_A MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1                   mov     P1SKIP, #3Eh
                +1           ELSE
                +1                   mov     P1SKIP, #3Ch
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_B MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1                   mov     P1SKIP, #3Bh
                +1           ELSE
                +1                   mov     P1SKIP, #33h
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_C MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1                   mov     P1SKIP, #2Fh
                +1           ELSE
                +1                   mov     P1SKIP, #0Fh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwms_Off MACRO
                +1                   mov     P1SKIP, #3Fh
                +1           ENDM
                +1           
                +1           Set_Comp_Phase_A MACRO
                +1                   mov     CMP0MX, #30h    ; Set comparator multiplexer to phase A
                +1           ENDM
                +1           Set_Comp_Phase_B MACRO
                +1                   mov     CMP0MX, #20h    ; Set comparator multiplexer to phase B
                +1           ENDM
                +1           Set_Comp_Phase_C MACRO
                +1                   mov     CMP0MX, #10h    ; Set comparator multiplexer to phase C
                +1           ENDM
                +1           Read_Comp_Out MACRO
                +1                   mov     A, CMP0CN0      ; Read comparator output
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 2 definitions *
                +1           ;*********************
                +1           DebugPin                EQU     0       ;o
                +1           
                +1           P2_PUSHPULL     EQU     (1 SHL DebugPin)
                +1           
                +1           
                +1           ;**********************
                +1           ; MCU specific macros *
                +1           ;**********************
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   124

                +1           Interrupt_Table_Definition MACRO
                +1           CSEG AT 0                               ; Code segment start
                +1                   jmp reset
                +1           CSEG AT 03h                     ; Int0 interrupt        
                +1                   jmp     int0_int        
                +1           IF MCU_48MHZ == 1
                +1           CSEG AT 0Bh                     ; Timer0 overflow interrupt
                +1                   jmp     t0_int
                +1           ENDIF
                +1           CSEG AT 13h                     ; Int1 interrupt
                +1                   jmp     int1_int
                +1           CSEG AT 1Bh                     ; Timer1 overflow interrupt
                +1                   jmp     t1_int
                +1           CSEG AT 2Bh                     ; Timer2 overflow interrupt
                +1                   jmp     t2_int  
                +1           CSEG AT 5Bh                     ; Pca interrupt
                +1                   jmp     pca_int
                +1           CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                +1                   jmp     t3_int  
                +1           ENDM
                +1           
                +1           Initialize_Xbar MACRO
                +1                   mov     XBR2, #40h      ; Xbar enabled                  
                +1                   mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                +1           ENDM
                +1           
                +1           Initialize_Comparator MACRO
                +1                   mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                +1                   mov     CMP0MD, #00h    ; Comparator response time 100ns
                +1           ENDM
                +1           Initialize_Adc MACRO
                +1                   mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bias
                +1           IF MCU_48MHZ == 0
                +1                   mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                +1           ELSE
                +1                   mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                +1           ENDIF
                +1                   mov     ADC0MX, #10h    ; Select temp sensor input
                +1                   mov     ADC0CN0, #80h   ; ADC enabled 
                +1                   mov     ADC0CN1, #01h   ; Common mode buffer enabled
                +1           ENDM
                +1           Start_Adc MACRO
                +1                   mov     ADC0CN0, #90h   ; ADC start
                +1           ENDM
                +1           Read_Adc_Result MACRO
                +1                   mov     Temp1, ADC0L
                +1                   mov     Temp2, ADC0H
                +1           ENDM
                +1           Stop_Adc MACRO
                +1           ENDM
                +1           Set_RPM_Out MACRO
                +1           ENDM
                +1           Clear_RPM_Out MACRO
                +1           ENDM
                +1           Set_MCU_Clk_24MHz MACRO
                +1                   mov     CLKSEL, #13h            ; Set clock to 24MHz
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     Clock_Set_At_48MHz, #0
                +1           ENDM
                +1           Set_MCU_Clk_48MHz MACRO
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     CLKSEL, #03h            ; Set clock to 48MHz
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   125

                +1                   mov     Clock_Set_At_48MHz, #1
                +1           ENDM
                +1           Set_LED_0 MACRO
                +1           ENDM
                +1           Clear_LED_0 MACRO
                +1           ENDM
                +1           Set_LED_1 MACRO
                +1           ENDM
                +1           Clear_LED_1 MACRO
                +1           ENDM
                +1           Set_LED_2 MACRO
                +1           ENDM
                +1           Clear_LED_2 MACRO
                +1           ENDM
                +1           Set_LED_3 MACRO
                +1           ENDM
                +1           Clear_LED_3 MACRO
                +1           ENDM
                             ENDIF
                    8072     
                    8073     IF ESCNO == G_
                             ;$include (G.inc) ; Select pinout G
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; BLHeli program for controlling brushless motors in helicopters and multirotors
                +1           ;
                +1           ; Copyright 2011, 2012 Steffen Skaug
                +1           ; This program is distributed under the terms of the GNU General Public License
                +1           ;
                +1           ; This file is part of BLHeli.
                +1           ;
                +1           ; BLHeli is free software: you can redistribute it and/or modify
                +1           ; it under the terms of the GNU General Public License as published by
                +1           ; the Free Software Foundation, either version 3 of the License, or
                +1           ; (at your option) any later version.
                +1           ;
                +1           ; BLHeli is distributed in the hope that it will be useful,
                +1           ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                +1           ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                +1           ; GNU General Public License for more details.
                +1           ;
                +1           ; You should have received a copy of the GNU General Public License
                +1           ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                +1           ;
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; Hardware definition file "G"
                +1           ; X  X  RC X  CC MA MC MB    X  X  Cc Cp Bc Bp Ac Ap
                +1           ;
                +1           ;**** **** **** **** ****
                +1           
                +1           
                +1           
                +1           ;*********************
                +1           ; Device SiLabs EFM8BB1x/2x
                +1           ;*********************
                +1           IF MCU_48MHZ == 0
                +1           ;$include (SI_EFM8BB1_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   126

                +2           ;Supported Devices:
                +2           ;  EFM8BB10F2G
                +2           ;  EFM8BB10F2I
                +2           ;  EFM8BB10F2Y
                +2           ;  EFM8BB10F4G
                +2           ;  EFM8BB10F4I
                +2           ;  EFM8BB10F4Y
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC      DATA 0E0H; Accumulator                            
                +2           ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF   DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B        DATA 0F0H; B Register                             
                +2           CKCON0   DATA 08EH; Clock Control 0                        
                +2           CLKSEL   DATA 0A9H; Clock Select                           
                +2           CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0MD   DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                +2           CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN   DATA 0DDH; CRC0 Data Input                        
                +2           DERIVID  DATA 0ADH; Derivative Identification              
                +2           DEVICEID DATA 0B5H; Device Identification                  
                +2           DPH      DATA 083H; Data Pointer High                      
                +2           DPL      DATA 082H; Data Pointer Low                       
                +2           EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                +2           FLKEY    DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           IE       DATA 0A8H; Interrupt Enable                       
                +2           IP       DATA 0B8H; Interrupt Priority                     
                +2           IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0       DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK   DATA 0FEH; Port 0 Mask                            
                +2           P0MAT    DATA 0FDH; Port 0 Match                           
                +2           P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   127

                +2           P0SKIP   DATA 0D4H; Port 0 Skip                            
                +2           P1       DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK   DATA 0EEH; Port 1 Mask                            
                +2           P1MAT    DATA 0EDH; Port 1 Match                           
                +2           P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP   DATA 0D5H; Port 1 Skip                            
                +2           P2       DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                +2           PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0  DATA 0D8H; PCA Control                            
                +2           PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD   DATA 0D9H; PCA Mode                               
                +2           PCA0POL  DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0    DATA 087H; Power Control                          
                +2           PRTDRV   DATA 0F6H; Port Drive Strength                    
                +2           PSCTL    DATA 08FH; Program Store Control                  
                +2           PSW      DATA 0D0H; Program Status Word                    
                +2           REF0CN   DATA 0D1H; Voltage Reference Control              
                +2           REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                +2           REVID    DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC   DATA 0EFH; Reset Source                           
                +2           SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                +2           SCON0    DATA 098H; UART0 Serial Port Control              
                +2           SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                +2           SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SP       DATA 081H; Stack Pointer                          
                +2           SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0  DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT  DATA 0A3H; SPI0 Data                              
                +2           TCON     DATA 088H; Timer 0/1 Control                      
                +2           TH0      DATA 08CH; Timer 0 High Byte                      
                +2           TH1      DATA 08DH; Timer 1 High Byte                      
                +2           TL0      DATA 08AH; Timer 0 Low Byte                       
                +2           TL1      DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD     DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2H    DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0  DATA 091H; Timer 3 Control 0                      
                +2           TMR3H    DATA 095H; Timer 3 High Byte                      
                +2           TMR3L    DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                +2           VDM0CN   DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN    DATA 097H; Watchdog Timer Control                 
                +2           XBR0     DATA 0E1H; Port I/O Crossbar 0                    
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   128

                +2           XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   129

                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   130

                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +1           
                +1           ELSE
                +1           ;$include (SI_EFM8BB2_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB21F16G_QFN20
                +2           ;  EFM8BB21F16G_QSOP24
                +2           ;  EFM8BB21F16I_QFN20
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   131

                +2           ;  EFM8BB21F16I_QSOP24
                +2           ;  EFM8BB22F16G_QFN28
                +2           ;  EFM8BB22F16I_QFN28
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC       DATA 0E0H; Accumulator                            
                +2           ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF    DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B         DATA 0F0H; B Register                             
                +2           CKCON0    DATA 08EH; Clock Control 0                        
                +2           CKCON1    DATA 0A6H; Clock Control 1
                +2           CLKSEL    DATA 0A9H; Clock Select                           
                +2           CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0CN1   DATA 099H; Comparator 0 Control 1
                +2           CMP0MD    DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                +2           CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CN1   DATA 086H; CRC0 Control 1                         
                +2           CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN    DATA 0DDH; CRC0 Data Input                        
                +2           CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                +2           DERIVID   DATA 0ADH; Derivative Identification              
                +2           DEVICEID  DATA 0B5H; Device Identification                  
                +2           DPH       DATA 083H; Data Pointer High                      
                +2           DPL       DATA 082H; Data Pointer Low                       
                +2           EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                +2           EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                +2           EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                +2           EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                +2           EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                +2           EMI0CN    DATA 0E7H; External Memory Interface Control      
                +2           FLKEY     DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                +2           HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                +2           I2C0CN0   DATA 0BAH; I2C0 Control                           
                +2           I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                +2           I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                +2           I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                +2           I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                +2           I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                +2           I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                +2           I2C0STAT  DATA 0B9H; I2C0 Status                            
                +2           IE        DATA 0A8H; Interrupt Enable                       
                +2           IP        DATA 0B8H; Interrupt Priority                     
                +2           IPH       DATA 0F2H; Interrupt Priority High                
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   132

                +2           IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0        DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK    DATA 0FEH; Port 0 Mask                            
                +2           P0MAT     DATA 0FDH; Port 0 Match                           
                +2           P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP    DATA 0D4H; Port 0 Skip                            
                +2           P1        DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK    DATA 0EEH; Port 1 Mask                            
                +2           P1MAT     DATA 0EDH; Port 1 Match                           
                +2           P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP    DATA 0D5H; Port 1 Skip                            
                +2           P2        DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MASK    DATA 0FCH; Port 2 Mask                            
                +2           P2MAT     DATA 0FBH; Port 2 Match                           
                +2           P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                +2           P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                +2           P2SKIP    DATA 0CCH; Port 2 Skip                            
                +2           P3        DATA 0B0H; Port 3 Pin Latch                       
                +2           P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                +2           P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                +2           PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0   DATA 0D8H; PCA Control                            
                +2           PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD    DATA 0D9H; PCA Mode                               
                +2           PCA0POL   DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0     DATA 087H; Power Control                          
                +2           PCON1     DATA 09AH; Power Control 1                        
                +2           PFE0CN    DATA 0C1H; Prefetch Engine Control                
                +2           PRTDRV    DATA 0F6H; Port Drive Strength                    
                +2           PSCTL     DATA 08FH; Program Store Control                  
                +2           PSW       DATA 0D0H; Program Status Word                    
                +2           REF0CN    DATA 0D1H; Voltage Reference Control              
                +2           REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                +2           REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                +2           REVID     DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC    DATA 0EFH; Reset Source                           
                +2           SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                +2           SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                +2           SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                +2           SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                +2           SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                +2           SCON0     DATA 098H; UART0 Serial Port Control              
                +2           SCON1     DATA 0C8H; UART1 Serial Port Control              
                +2           SFRPAGE   DATA 0A7H; SFR Page                               
                +2           SFRPGCN   DATA 0CFH; SFR Page Control                       
                +2           SFRSTACK  DATA 0D7H; SFR Page Stack                         
                +2           SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT   DATA 0C2H; SMBus 0 Data                           
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   133

                +2           SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                +2           SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                +2           SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                +2           SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                +2           SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SMOD1     DATA 093H; UART1 Mode                             
                +2           SP        DATA 081H; Stack Pointer                          
                +2           SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0   DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT   DATA 0A3H; SPI0 Data                              
                +2           SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                +2           SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                +2           SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                +2           TCON      DATA 088H; Timer 0/1 Control                      
                +2           TH0       DATA 08CH; Timer 0 High Byte                      
                +2           TH1       DATA 08DH; Timer 1 High Byte                      
                +2           TL0       DATA 08AH; Timer 0 Low Byte                       
                +2           TL1       DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD      DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                +2           TMR2H     DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0   DATA 091H; Timer 3 Control 0                      
                +2           TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                +2           TMR3H     DATA 095H; Timer 3 High Byte                      
                +2           TMR3L     DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                +2           TMR4CN0   DATA 098H; Timer 4 Control 0                      
                +2           TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                +2           TMR4H     DATA 0A5H; Timer 4 High Byte                      
                +2           TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                +2           TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                +2           TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                +2           UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                +2           UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                +2           UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                +2           UART1LIN  DATA 09EH; UART1 LIN Configuration                
                +2           VDM0CN    DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN     DATA 097H; Watchdog Timer Control                 
                +2           XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                +2           TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   134

                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   135

                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                +2           P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                +2           
                +2           ; P3 0xB0 (Port 3 Pin Latch)
                +2           P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                +2           P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SCON1 0xC8 (UART1 Serial Port Control)
                +2           SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                +2           SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                +2           SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                +2           SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                +2           SCON1_REN  BIT SCON1.4 ; Receive Enable           
                +2           SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                +2           SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   136

                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                +2           TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                +2           
                +2           ; TMR4CN0 0x98 (Timer 4 Control 0)
                +2           TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                +2           TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                +2           TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                +2           TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                +2           TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                +2           TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                +2           TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                +2           TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                +2           
                +2           ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                +2           UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                +2           UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                +2           UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                +2           UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                +2           UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                +2           UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                +2           UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                +2           UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   137

                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +2           UART1_IRQn   EQU 17 ; UART1                     
                +2           I2C0_IRQn    EQU 18 ; I2C0 Slave                
                +2           TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; SFR Page Definitions
                +2           ;------------------------------------------------------------------------------
                +2           CRC0_PAGE       EQU 000H ; CRC0 Page       
                +2           LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                +2           PCA0_PAGE       EQU 000H ; PCA0 Page       
                +2           PG2_PAGE        EQU 010H ; Page2           
                +2           TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                +2           TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                +2           TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                +2           I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                +2           PG3_PAGE        EQU 020H ; Page3           
                +2           SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                +2           SPI0_PAGE       EQU 020H ; SPI0 Page       
                +2           UART0_PAGE      EQU 020H ; UART0 Page      
                +2           UART1_PAGE      EQU 020H ; UART1 Page      
                +1           
                +1           ENDIF
                +1           
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Uses internal calibrated oscillator set to 24/48Mhz
                +1           ;**** **** **** **** ****
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Constant definitions
                +1           ;**** **** **** **** ****
                +1           IF MCU_48MHZ == 0
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#G_L_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#G_L_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#G_L_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#G_L_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#G_L_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#G_L_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#G_L_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#G_L_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#G_L_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#G_L_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#G_L_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (16 B
                             ytes)
                +1           
                +1           ELSE
                +1           
                +1           CSEG AT 1A40h
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   138

                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#G_H_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#G_H_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#G_H_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#G_H_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#G_H_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#G_H_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#G_H_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#G_H_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#G_H_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#G_H_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#G_H_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (16 B
                             ytes)
                +1           ENDIF
                +1           
                +1           TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for whi
                             ch main motor power is limited at 80degC (low byte, assuming high byte is 1)
                +1           TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment for a
                             nother 10degC
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Bootloader definitions
                +1           ;**** **** **** **** ****
                +1           RTX_PORT                                EQU     P0              ; Receive/Transmit port
                +1           RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL            
                                          
                +1           RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL             
                                          
                +1           RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP                
                                          
                +1           RTX_PIN                         EQU     5               ; RTX pin
                +1           
                +1           SIGNATURE_001                   EQU     0E8h            ; Device signature
                +1           IF MCU_48MHZ == 0
                +1           SIGNATURE_002                   EQU     0B1h
                +1           ELSE
                +1           SIGNATURE_002                   EQU     0B2h
                +1           ENDIF
                +1           
                +1           ;*********************
                +1           ; PORT 0 definitions *
                +1           ;*********************  
                +1           ;                       EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           Rcp_In          EQU     5       ;i
                +1           ;                       EQU     4       ;i 
                +1           Comp_Com                EQU     3       ;i
                +1           Mux_A           EQU     2       ;i
                +1           Mux_C           EQU     1       ;i
                +1           Mux_B           EQU     0       ;i
                +1           
                +1           P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                +1           P0_INIT         EQU     0FFh
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   139

                +1           P0_PUSHPULL     EQU     0
                +1           P0_SKIP         EQU     0FFh
                +1           
                +1           Get_Rcp_Capture_Values MACRO
                +1                   anl     TCON, #0EFh                             ; Disable timer0
                +1                   mov     Temp1, TL0                              ; Get timer0 values
                +1                   mov     Temp2, TH0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Temp3, Timer0_X
                +1                   jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                +1                   inc     Temp3                                   ; If it is pending, then timer has 
                             already wrapped
                +1           ENDIF
                +1                   mov     TL0, #0                                 ; Reset timer0
                +1                   mov     TH0, #0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Timer0_X, #0
                +1           ENDIF
                +1                   orl     TCON, #10h                              ; Enable timer0 again
                +1           IF MCU_48MHZ == 1
                +1                   mov     A, Clock_Set_At_48MHz
                +1                   jnz     Get_Rcp_End
                +1                   clr     C
                +1                   mov     A, Temp1
                +1                   rlc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Temp2
                +1                   rlc     A
                +1                   mov     Temp2, A
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1           Get_Rcp_End:
                +1           ENDIF
                +1           ENDM
                +1           Decode_Dshot_2Msb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp4                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp4
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL
                +1           ENDM
                +1           Decode_Dshot_2Lsb MACRO
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   140

                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp3                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL
                +1           ENDM
                +1           Initialize_PCA MACRO
                +1                   mov     PCA0CN0, #40h                           ; PCA enabled
                +1                   mov     PCA0MD, #08h                            ; PCA clock is system clock
                +1           IF FETON_DELAY == 0
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #00h                          ; Edge aligned pwm
                +1           ELSE
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #03h                          ; Center aligned pwm
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_Polarity MACRO
                +1                   mov     PCA0POL, #02h                           ; Damping inverted, pwm noninverted
                +1           ENDM
                +1           Enable_Power_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, enab
                             le match, set pwm mode
                +1           ELSE
                +1                   mov     PCA0CPM0, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Enable_Damp_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM1, #00h                          ; Disable
                +1           ELSE
                +1                   mov     PCA0CPM1, #42h                          ; Enable comparator of module, set 
                             pwm mode
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   141

                +1           ENDIF
                +1           ENDM
                +1           Set_Power_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL0, Power_Pwm_Reg_L
                +1                   mov     PCA0CPH0, Power_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Power_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Power_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL0, A
                +1                   mov     PCA0CPH0, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Set_Damp_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL1, Damp_Pwm_Reg_L
                +1                   mov     PCA0CPH1, Damp_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Damp_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Damp_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL1, A
                +1                   mov     PCA0CPH1, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Clear_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0DFh
                +1           ENDM
                +1           Clear_CCF_Interrupt MACRO
                +1                   anl     PCA0CN0, #0FEh
                +1           ENDM
                +1           Enable_COVF_Interrupt MACRO
                +1                   orl     PCA0PWM, #40h
                +1           ENDM
                +1           Enable_CCF_Interrupt MACRO
                +1                   orl     PCA0CPM0,#01h
                +1           ENDM
                +1           Disable_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0BFh
                +1           ENDM
                +1           Disable_CCF_Interrupt MACRO
                +1                   anl     PCA0CPM0,#0FEh
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 1 definitions *
                +1           ;*********************
                +1           ;                       EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           CcomFET         EQU     5       ;o
                +1           CpwmFET         EQU     4       ;o
                +1           BcomFET         EQU     3       ;o
                +1           BpwmFET         EQU     2       ;o
                +1           AcomFET         EQU     1       ;o
                +1           ApwmFET         EQU     0       ;o
                +1           
                +1           P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   142

                +1           P1_INIT         EQU     00h             
                +1           P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_SKIP         EQU     3Fh
                +1           
                +1           ApwmFET_on MACRO
                +1                   setb    P1.ApwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           ApwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_on MACRO
                +1                   setb    P1.BpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.BpwmFET
                +1           ELSE
                +1                   clr     P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_on MACRO
                +1                   setb    P1.CpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           All_pwmFETs_Off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1                   clr     P1.BpwmFET
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           
                +1           AcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.ApwmFET
                +1           ENDIF
                +1                   setb    P1.AcomFET
                +1           ENDM
                +1           AcomFET_off MACRO
                +1                   clr     P1.AcomFET
                +1           ENDM
                +1           BcomFET_on MACRO
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   143

                +1           IF FETON_DELAY == 0
                +1                   clr     P1.BpwmFET
                +1           ENDIF
                +1                   setb    P1.BcomFET
                +1           ENDM
                +1           BcomFET_off MACRO
                +1                   clr     P1.BcomFET
                +1           ENDM
                +1           CcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.CpwmFET
                +1           ENDIF
                +1                   setb    P1.CcomFET
                +1           ENDM
                +1           CcomFET_off MACRO
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           All_comFETs_Off MACRO
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           
                +1           Set_Pwm_A MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1                   mov     P1SKIP, #3Eh
                +1           ELSE
                +1                   mov     P1SKIP, #3Ch
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_B MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1                   mov     P1SKIP, #3Bh
                +1           ELSE
                +1                   mov     P1SKIP, #33h
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_C MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1                   mov     P1SKIP, #2Fh
                +1           ELSE
                +1                   mov     P1SKIP, #0Fh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwms_Off MACRO
                +1                   mov     P1SKIP, #3Fh
                +1           ENDM
                +1           
                +1           Set_Comp_Phase_A MACRO
                +1                   mov     CMP0MX, #23h    ; Set comparator multiplexer to phase A
                +1           ENDM
                +1           Set_Comp_Phase_B MACRO
                +1                   mov     CMP0MX, #03h    ; Set comparator multiplexer to phase B
                +1           ENDM
                +1           Set_Comp_Phase_C MACRO
                +1                   mov     CMP0MX, #13h    ; Set comparator multiplexer to phase C
                +1           ENDM
                +1           Read_Comp_Out MACRO
                +1                   mov     A, CMP0CN0      ; Read comparator output
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   144

                +1           ; PORT 2 definitions *
                +1           ;*********************
                +1           DebugPin                EQU     0       ;o
                +1           
                +1           P2_PUSHPULL     EQU     (1 SHL DebugPin)
                +1           
                +1           
                +1           ;**********************
                +1           ; MCU specific macros *
                +1           ;**********************
                +1           Interrupt_Table_Definition MACRO
                +1           CSEG AT 0                               ; Code segment start
                +1                   jmp reset
                +1           CSEG AT 03h                     ; Int0 interrupt        
                +1                   jmp     int0_int        
                +1           IF MCU_48MHZ == 1
                +1           CSEG AT 0Bh                     ; Timer0 overflow interrupt
                +1                   jmp     t0_int
                +1           ENDIF
                +1           CSEG AT 13h                     ; Int1 interrupt
                +1                   jmp     int1_int
                +1           CSEG AT 1Bh                     ; Timer1 overflow interrupt
                +1                   jmp     t1_int
                +1           CSEG AT 2Bh                     ; Timer2 overflow interrupt
                +1                   jmp     t2_int  
                +1           CSEG AT 5Bh                     ; Pca interrupt
                +1                   jmp     pca_int
                +1           CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                +1                   jmp     t3_int  
                +1           ENDM
                +1           
                +1           Initialize_Xbar MACRO
                +1                   mov     XBR2, #40h      ; Xbar enabled                  
                +1                   mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                +1           ENDM
                +1           
                +1           Initialize_Comparator MACRO
                +1                   mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                +1                   mov     CMP0MD, #00h    ; Comparator response time 100ns
                +1           ENDM
                +1           Initialize_Adc MACRO
                +1                   mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bias
                +1           IF MCU_48MHZ == 0
                +1                   mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                +1           ELSE
                +1                   mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                +1           ENDIF
                +1                   mov     ADC0MX, #10h    ; Select temp sensor input
                +1                   mov     ADC0CN0, #80h   ; ADC enabled 
                +1                   mov     ADC0CN1, #01h   ; Common mode buffer enabled
                +1           ENDM
                +1           Start_Adc MACRO
                +1                   mov     ADC0CN0, #90h   ; ADC start
                +1           ENDM
                +1           Read_Adc_Result MACRO
                +1                   mov     Temp1, ADC0L
                +1                   mov     Temp2, ADC0H
                +1           ENDM
                +1           Stop_Adc MACRO
                +1           ENDM
                +1           Set_RPM_Out MACRO
                +1           ENDM
                +1           Clear_RPM_Out MACRO
                +1           ENDM
                +1           Set_MCU_Clk_24MHz MACRO
                +1                   mov     CLKSEL, #13h            ; Set clock to 24MHz
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   145

                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     Clock_Set_At_48MHz, #0
                +1           ENDM
                +1           Set_MCU_Clk_48MHz MACRO
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     CLKSEL, #03h            ; Set clock to 48MHz
                +1                   mov     Clock_Set_At_48MHz, #1
                +1           ENDM
                +1           Set_LED_0 MACRO
                +1           ENDM
                +1           Clear_LED_0 MACRO
                +1           ENDM
                +1           Set_LED_1 MACRO
                +1           ENDM
                +1           Clear_LED_1 MACRO
                +1           ENDM
                +1           Set_LED_2 MACRO
                +1           ENDM
                +1           Clear_LED_2 MACRO
                +1           ENDM
                +1           Set_LED_3 MACRO
                +1           ENDM
                +1           Clear_LED_3 MACRO
                +1           ENDM
                             ENDIF
                    9385     
                    9386     IF ESCNO == H_
                             ;$include (H.inc) ; Select pinout H
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; BLHeli program for controlling brushless motors in helicopters and multirotors
                +1           ;
                +1           ; Copyright 2011, 2012 Steffen Skaug
                +1           ; This program is distributed under the terms of the GNU General Public License
                +1           ;
                +1           ; This file is part of BLHeli.
                +1           ;
                +1           ; BLHeli is free software: you can redistribute it and/or modify
                +1           ; it under the terms of the GNU General Public License as published by
                +1           ; the Free Software Foundation, either version 3 of the License, or
                +1           ; (at your option) any later version.
                +1           ;
                +1           ; BLHeli is distributed in the hope that it will be useful,
                +1           ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                +1           ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                +1           ; GNU General Public License for more details.
                +1           ;
                +1           ; You should have received a copy of the GNU General Public License
                +1           ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                +1           ;
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; Hardware definition file "H". 
                +1           ; RC X  X  X  MA MB CC MC    X  Ap Bp Cp X  Ac Bc Cc 
                +1           ;
                +1           ;**** **** **** **** ****
                +1           
                +1           
                +1           
                +1           ;*********************
                +1           ; Device SiLabs EFM8BB1x/2x
                +1           ;*********************
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   146

                +1           IF MCU_48MHZ == 0
                +1           ;$include (SI_EFM8BB1_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB10F2G
                +2           ;  EFM8BB10F2I
                +2           ;  EFM8BB10F2Y
                +2           ;  EFM8BB10F4G
                +2           ;  EFM8BB10F4I
                +2           ;  EFM8BB10F4Y
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC      DATA 0E0H; Accumulator                            
                +2           ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF   DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B        DATA 0F0H; B Register                             
                +2           CKCON0   DATA 08EH; Clock Control 0                        
                +2           CLKSEL   DATA 0A9H; Clock Select                           
                +2           CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0MD   DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                +2           CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN   DATA 0DDH; CRC0 Data Input                        
                +2           DERIVID  DATA 0ADH; Derivative Identification              
                +2           DEVICEID DATA 0B5H; Device Identification                  
                +2           DPH      DATA 083H; Data Pointer High                      
                +2           DPL      DATA 082H; Data Pointer Low                       
                +2           EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                +2           FLKEY    DATA 0B7H; Flash Lock and Key                     
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   147

                +2           HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           IE       DATA 0A8H; Interrupt Enable                       
                +2           IP       DATA 0B8H; Interrupt Priority                     
                +2           IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0       DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK   DATA 0FEH; Port 0 Mask                            
                +2           P0MAT    DATA 0FDH; Port 0 Match                           
                +2           P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP   DATA 0D4H; Port 0 Skip                            
                +2           P1       DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK   DATA 0EEH; Port 1 Mask                            
                +2           P1MAT    DATA 0EDH; Port 1 Match                           
                +2           P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP   DATA 0D5H; Port 1 Skip                            
                +2           P2       DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                +2           PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0  DATA 0D8H; PCA Control                            
                +2           PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD   DATA 0D9H; PCA Mode                               
                +2           PCA0POL  DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0    DATA 087H; Power Control                          
                +2           PRTDRV   DATA 0F6H; Port Drive Strength                    
                +2           PSCTL    DATA 08FH; Program Store Control                  
                +2           PSW      DATA 0D0H; Program Status Word                    
                +2           REF0CN   DATA 0D1H; Voltage Reference Control              
                +2           REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                +2           REVID    DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC   DATA 0EFH; Reset Source                           
                +2           SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                +2           SCON0    DATA 098H; UART0 Serial Port Control              
                +2           SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                +2           SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SP       DATA 081H; Stack Pointer                          
                +2           SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0  DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT  DATA 0A3H; SPI0 Data                              
                +2           TCON     DATA 088H; Timer 0/1 Control                      
                +2           TH0      DATA 08CH; Timer 0 High Byte                      
                +2           TH1      DATA 08DH; Timer 1 High Byte                      
                +2           TL0      DATA 08AH; Timer 0 Low Byte                       
                +2           TL1      DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD     DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2H    DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L    DATA 0CCH; Timer 2 Low Byte                       
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   148

                +2           TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0  DATA 091H; Timer 3 Control 0                      
                +2           TMR3H    DATA 095H; Timer 3 High Byte                      
                +2           TMR3L    DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                +2           VDM0CN   DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN    DATA 097H; Watchdog Timer Control                 
                +2           XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   149

                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   150

                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +1           
                +1           ELSE
                +1           ;$include (SI_EFM8BB2_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   151

                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB21F16G_QFN20
                +2           ;  EFM8BB21F16G_QSOP24
                +2           ;  EFM8BB21F16I_QFN20
                +2           ;  EFM8BB21F16I_QSOP24
                +2           ;  EFM8BB22F16G_QFN28
                +2           ;  EFM8BB22F16I_QFN28
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC       DATA 0E0H; Accumulator                            
                +2           ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF    DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B         DATA 0F0H; B Register                             
                +2           CKCON0    DATA 08EH; Clock Control 0                        
                +2           CKCON1    DATA 0A6H; Clock Control 1
                +2           CLKSEL    DATA 0A9H; Clock Select                           
                +2           CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0CN1   DATA 099H; Comparator 0 Control 1
                +2           CMP0MD    DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                +2           CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CN1   DATA 086H; CRC0 Control 1                         
                +2           CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN    DATA 0DDH; CRC0 Data Input                        
                +2           CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                +2           DERIVID   DATA 0ADH; Derivative Identification              
                +2           DEVICEID  DATA 0B5H; Device Identification                  
                +2           DPH       DATA 083H; Data Pointer High                      
                +2           DPL       DATA 082H; Data Pointer Low                       
                +2           EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                +2           EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                +2           EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                +2           EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                +2           EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                +2           EMI0CN    DATA 0E7H; External Memory Interface Control      
                +2           FLKEY     DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                +2           HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                +2           I2C0CN0   DATA 0BAH; I2C0 Control                           
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   152

                +2           I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                +2           I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                +2           I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                +2           I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                +2           I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                +2           I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                +2           I2C0STAT  DATA 0B9H; I2C0 Status                            
                +2           IE        DATA 0A8H; Interrupt Enable                       
                +2           IP        DATA 0B8H; Interrupt Priority                     
                +2           IPH       DATA 0F2H; Interrupt Priority High                
                +2           IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0        DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK    DATA 0FEH; Port 0 Mask                            
                +2           P0MAT     DATA 0FDH; Port 0 Match                           
                +2           P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP    DATA 0D4H; Port 0 Skip                            
                +2           P1        DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK    DATA 0EEH; Port 1 Mask                            
                +2           P1MAT     DATA 0EDH; Port 1 Match                           
                +2           P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP    DATA 0D5H; Port 1 Skip                            
                +2           P2        DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MASK    DATA 0FCH; Port 2 Mask                            
                +2           P2MAT     DATA 0FBH; Port 2 Match                           
                +2           P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                +2           P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                +2           P2SKIP    DATA 0CCH; Port 2 Skip                            
                +2           P3        DATA 0B0H; Port 3 Pin Latch                       
                +2           P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                +2           P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                +2           PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0   DATA 0D8H; PCA Control                            
                +2           PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD    DATA 0D9H; PCA Mode                               
                +2           PCA0POL   DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0     DATA 087H; Power Control                          
                +2           PCON1     DATA 09AH; Power Control 1                        
                +2           PFE0CN    DATA 0C1H; Prefetch Engine Control                
                +2           PRTDRV    DATA 0F6H; Port Drive Strength                    
                +2           PSCTL     DATA 08FH; Program Store Control                  
                +2           PSW       DATA 0D0H; Program Status Word                    
                +2           REF0CN    DATA 0D1H; Voltage Reference Control              
                +2           REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                +2           REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                +2           REVID     DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC    DATA 0EFH; Reset Source                           
                +2           SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                +2           SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                +2           SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                +2           SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                +2           SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   153

                +2           SCON0     DATA 098H; UART0 Serial Port Control              
                +2           SCON1     DATA 0C8H; UART1 Serial Port Control              
                +2           SFRPAGE   DATA 0A7H; SFR Page                               
                +2           SFRPGCN   DATA 0CFH; SFR Page Control                       
                +2           SFRSTACK  DATA 0D7H; SFR Page Stack                         
                +2           SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                +2           SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                +2           SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                +2           SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                +2           SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                +2           SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SMOD1     DATA 093H; UART1 Mode                             
                +2           SP        DATA 081H; Stack Pointer                          
                +2           SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0   DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT   DATA 0A3H; SPI0 Data                              
                +2           SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                +2           SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                +2           SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                +2           TCON      DATA 088H; Timer 0/1 Control                      
                +2           TH0       DATA 08CH; Timer 0 High Byte                      
                +2           TH1       DATA 08DH; Timer 1 High Byte                      
                +2           TL0       DATA 08AH; Timer 0 Low Byte                       
                +2           TL1       DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD      DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                +2           TMR2H     DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0   DATA 091H; Timer 3 Control 0                      
                +2           TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                +2           TMR3H     DATA 095H; Timer 3 High Byte                      
                +2           TMR3L     DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                +2           TMR4CN0   DATA 098H; Timer 4 Control 0                      
                +2           TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                +2           TMR4H     DATA 0A5H; Timer 4 High Byte                      
                +2           TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                +2           TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                +2           TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                +2           UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                +2           UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                +2           UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                +2           UART1LIN  DATA 09EH; UART1 LIN Configuration                
                +2           VDM0CN    DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN     DATA 097H; Watchdog Timer Control                 
                +2           XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   154

                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                +2           TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   155

                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                +2           P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                +2           
                +2           ; P3 0xB0 (Port 3 Pin Latch)
                +2           P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                +2           P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SCON1 0xC8 (UART1 Serial Port Control)
                +2           SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                +2           SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                +2           SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                +2           SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                +2           SCON1_REN  BIT SCON1.4 ; Receive Enable           
                +2           SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                +2           SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   156

                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                +2           TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                +2           
                +2           ; TMR4CN0 0x98 (Timer 4 Control 0)
                +2           TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                +2           TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                +2           TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                +2           TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                +2           TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                +2           TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                +2           TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                +2           TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                +2           
                +2           ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                +2           UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                +2           UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                +2           UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                +2           UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                +2           UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                +2           UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                +2           UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                +2           UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   157

                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +2           UART1_IRQn   EQU 17 ; UART1                     
                +2           I2C0_IRQn    EQU 18 ; I2C0 Slave                
                +2           TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; SFR Page Definitions
                +2           ;------------------------------------------------------------------------------
                +2           CRC0_PAGE       EQU 000H ; CRC0 Page       
                +2           LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                +2           PCA0_PAGE       EQU 000H ; PCA0 Page       
                +2           PG2_PAGE        EQU 010H ; Page2           
                +2           TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                +2           TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                +2           TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                +2           I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                +2           PG3_PAGE        EQU 020H ; Page3           
                +2           SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                +2           SPI0_PAGE       EQU 020H ; SPI0 Page       
                +2           UART0_PAGE      EQU 020H ; UART0 Page      
                +2           UART1_PAGE      EQU 020H ; UART1 Page      
                +1           
                +1           ENDIF
                +1           
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Uses internal calibrated oscillator set to 24/48Mhz
                +1           ;**** **** **** **** ****
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Constant definitions
                +1           ;**** **** **** **** ****
                +1           IF MCU_48MHZ == 0
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#H_L_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#H_L_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#H_L_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#H_L_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#H_L_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#H_L_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#H_L_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#H_L_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#H_L_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#H_L_70#        "
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   158

                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#H_L_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (16 B
                             ytes)
                +1           
                +1           ELSE
                +1           
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#H_H_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#H_H_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#H_H_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#H_H_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#H_H_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#H_H_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#H_H_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#H_H_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#H_H_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#H_H_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#H_H_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (16 B
                             ytes)
                +1           ENDIF
                +1           
                +1           TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for whi
                             ch main motor power is limited at 80degC (low byte, assuming high byte is 1)
                +1           TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment for a
                             nother 10degC
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Bootloader definitions
                +1           ;**** **** **** **** ****
                +1           RTX_PORT                                EQU     P0              ; Receive/Transmit port
                +1           RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL            
                                          
                +1           RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL             
                                          
                +1           RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP                
                                          
                +1           RTX_PIN                         EQU     7               ; RTX pin
                +1           
                +1           SIGNATURE_001                   EQU     0E8h            ; Device signature
                +1           IF MCU_48MHZ == 0
                +1           SIGNATURE_002                   EQU     0B1h
                +1           ELSE
                +1           SIGNATURE_002                   EQU     0B2h
                +1           ENDIF
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 0 definitions *
                +1           ;*********************  
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   159

                +1           Rcp_In          EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           ;                       EQU     5       ;i
                +1           ;                       EQU     4       ;i 
                +1           Mux_A           EQU     3       ;i
                +1           Mux_B           EQU     2       ;i
                +1           Comp_Com                EQU     1       ;i
                +1           Mux_C           EQU     0       ;i
                +1           
                +1           P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                +1           P0_INIT         EQU     0FFh
                +1           P0_PUSHPULL     EQU     0
                +1           P0_SKIP         EQU     0FFh
                +1           
                +1           Get_Rcp_Capture_Values MACRO
                +1                   anl     TCON, #0EFh                             ; Disable timer0
                +1                   mov     Temp1, TL0                              ; Get timer0 values
                +1                   mov     Temp2, TH0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Temp3, Timer0_X
                +1                   jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                +1                   inc     Temp3                                   ; If it is pending, then timer has 
                             already wrapped
                +1           ENDIF
                +1                   mov     TL0, #0                                 ; Reset timer0
                +1                   mov     TH0, #0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Timer0_X, #0
                +1           ENDIF
                +1                   orl     TCON, #10h                              ; Enable timer0 again
                +1           IF MCU_48MHZ == 1
                +1                   mov     A, Clock_Set_At_48MHz
                +1                   jnz     Get_Rcp_End
                +1                   clr     C
                +1                   mov     A, Temp1
                +1                   rlc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Temp2
                +1                   rlc     A
                +1                   mov     Temp2, A
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1           Get_Rcp_End:
                +1           ENDIF
                +1           ENDM
                +1           Decode_Dshot_2Msb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp4                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   160

                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp4
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL
                +1           ENDM
                +1           Decode_Dshot_2Lsb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp3                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL
                +1           ENDM
                +1           Initialize_PCA MACRO
                +1                   mov     PCA0CN0, #40h                           ; PCA enabled
                +1                   mov     PCA0MD, #08h                            ; PCA clock is system clock
                +1           IF FETON_DELAY == 0
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #00h                          ; Edge aligned pwm
                +1           ELSE
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #03h                          ; Center aligned pwm
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_Polarity MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0POL, #00h                           ; Pwm noninverted
                +1           ELSE
                +1                   mov     PCA0POL, #01h                           ; Damping inverted, pwm noninverted
                +1           ENDIF
                +1           ENDM
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   161

                +1           Enable_Power_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, enab
                             le match, set pwm mode
                +1           ELSE
                +1                   mov     PCA0CPM1, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Enable_Damp_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM1, #00h                          ; Disable
                +1           ELSE
                +1                   mov     PCA0CPM0, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Set_Power_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL0, Power_Pwm_Reg_L
                +1                   mov     PCA0CPH0, Power_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Power_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Power_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL1, A
                +1                   mov     PCA0CPH1, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Set_Damp_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL1, Damp_Pwm_Reg_L
                +1                   mov     PCA0CPH1, Damp_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Damp_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Damp_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL0, A
                +1                   mov     PCA0CPH0, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Clear_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0DFh
                +1           ENDM
                +1           Clear_CCF_Interrupt MACRO       ; CCF interrupt is only used for FETON_DELAY == 0
                +1                   anl     PCA0CN0, #0FEh
                +1           ENDM
                +1           Enable_COVF_Interrupt MACRO
                +1                   orl     PCA0PWM, #40h
                +1           ENDM
                +1           Enable_CCF_Interrupt MACRO
                +1                   orl     PCA0CPM0,#01h
                +1           ENDM
                +1           Disable_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0BFh
                +1           ENDM
                +1           Disable_CCF_Interrupt MACRO
                +1                   anl     PCA0CPM0,#0FEh
                +1           ENDM
                +1           
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   162

                +1           
                +1           ;*********************
                +1           ; PORT 1 definitions *
                +1           ;*********************
                +1           ;                       EQU     7       ;i
                +1           ApwmFET         EQU     6       ;o
                +1           BpwmFET         EQU     5       ;o
                +1           CpwmFET         EQU     4       ;o
                +1           ;                       EQU     3       ;i
                +1           AcomFET         EQU     2       ;o 
                +1           BcomFET         EQU     1       ;o
                +1           CcomFET         EQU     0       ;o
                +1           
                +1           P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_INIT         EQU     00h             
                +1           P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_SKIP         EQU     7Fh
                +1           
                +1           ApwmFET_on MACRO
                +1                   setb    P1.ApwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           ApwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_on MACRO
                +1                   setb    P1.BpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.BpwmFET
                +1           ELSE
                +1                   clr     P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_on MACRO
                +1                   setb    P1.CpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           All_pwmFETs_Off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1                   clr     P1.BpwmFET
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   163

                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           
                +1           AcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.ApwmFET
                +1           ENDIF
                +1                   setb    P1.AcomFET
                +1           ENDM
                +1           AcomFET_off MACRO
                +1                   clr     P1.AcomFET
                +1           ENDM
                +1           BcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.BpwmFET
                +1           ENDIF
                +1                   setb    P1.BcomFET
                +1           ENDM
                +1           BcomFET_off MACRO
                +1                   clr     P1.BcomFET
                +1           ENDM
                +1           CcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.CpwmFET
                +1           ENDIF
                +1                   setb    P1.CcomFET
                +1           ENDM
                +1           CcomFET_off MACRO
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           All_comFETs_Off MACRO
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           
                +1           Set_Pwm_A MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1                   mov     P1SKIP, #3Fh
                +1           ELSE
                +1                   mov     P1SKIP, #3Bh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_B MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1                   mov     P1SKIP, #5Fh
                +1           ELSE
                +1                   mov     P1SKIP, #5Dh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_C MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1                   mov     P1SKIP, #6Fh
                +1           ELSE
                +1                   mov     P1SKIP, #6Eh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwms_Off MACRO
                +1                   mov     P1SKIP, #7Fh
                +1           ENDM
                +1           
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   164

                +1           Set_Comp_Phase_A MACRO
                +1                   mov     CMP0MX, #31h    ; Set comparator multiplexer to phase A
                +1           ENDM
                +1           Set_Comp_Phase_B MACRO
                +1                   mov     CMP0MX, #21h    ; Set comparator multiplexer to phase B
                +1           ENDM
                +1           Set_Comp_Phase_C MACRO
                +1                   mov     CMP0MX, #01h    ; Set comparator multiplexer to phase C
                +1           ENDM
                +1           Read_Comp_Out MACRO
                +1                   mov     A, CMP0CN0      ; Read comparator output
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 2 definitions *
                +1           ;*********************
                +1           DebugPin                EQU     0       ;o
                +1           
                +1           P2_PUSHPULL     EQU     (1 SHL DebugPin)
                +1           
                +1           
                +1           ;**********************
                +1           ; MCU specific macros *
                +1           ;**********************
                +1           Interrupt_Table_Definition MACRO
                +1           CSEG AT 0                               ; Code segment start
                +1                   jmp reset
                +1           CSEG AT 03h                     ; Int0 interrupt        
                +1                   jmp     int0_int        
                +1           IF MCU_48MHZ == 1
                +1           CSEG AT 0Bh                     ; Timer0 overflow interrupt
                +1                   jmp     t0_int
                +1           ENDIF
                +1           CSEG AT 13h                     ; Int1 interrupt
                +1                   jmp     int1_int
                +1           CSEG AT 1Bh                     ; Timer1 overflow interrupt
                +1                   jmp     t1_int
                +1           CSEG AT 2Bh                     ; Timer2 overflow interrupt
                +1                   jmp     t2_int  
                +1           CSEG AT 5Bh                     ; Pca interrupt
                +1                   jmp     pca_int
                +1           CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                +1                   jmp     t3_int  
                +1           ENDM
                +1           
                +1           Initialize_Xbar MACRO
                +1                   mov     XBR2, #40h      ; Xbar enabled                  
                +1                   mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                +1           ENDM
                +1           
                +1           Initialize_Comparator MACRO
                +1                   mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                +1                   mov     CMP0MD, #00h    ; Comparator response time 100ns
                +1           ENDM
                +1           Initialize_Adc MACRO
                +1                   mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bias
                +1           IF MCU_48MHZ == 0
                +1                   mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                +1           ELSE
                +1                   mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                +1           ENDIF
                +1                   mov     ADC0MX, #10h    ; Select temp sensor input
                +1                   mov     ADC0CN0, #80h   ; ADC enabled 
                +1                   mov     ADC0CN1, #01h   ; Common mode buffer enabled
                +1           ENDM
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   165

                +1           Start_Adc MACRO
                +1                   mov     ADC0CN0, #90h   ; ADC start
                +1           ENDM
                +1           Read_Adc_Result MACRO
                +1                   mov     Temp1, ADC0L
                +1                   mov     Temp2, ADC0H
                +1           ENDM
                +1           Stop_Adc MACRO
                +1           ENDM
                +1           Set_RPM_Out MACRO
                +1           ENDM
                +1           Clear_RPM_Out MACRO
                +1           ENDM
                +1           Set_MCU_Clk_24MHz MACRO
                +1                   mov     CLKSEL, #13h            ; Set clock to 24MHz
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     Clock_Set_At_48MHz, #0
                +1           ENDM
                +1           Set_MCU_Clk_48MHz MACRO
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     CLKSEL, #03h            ; Set clock to 48MHz
                +1                   mov     Clock_Set_At_48MHz, #1
                +1           ENDM
                +1           Set_LED_0 MACRO
                +1           ENDM
                +1           Clear_LED_0 MACRO
                +1           ENDM
                +1           Set_LED_1 MACRO
                +1           ENDM
                +1           Clear_LED_1 MACRO
                +1           ENDM
                +1           Set_LED_2 MACRO
                +1           ENDM
                +1           Clear_LED_2 MACRO
                +1           ENDM
                +1           Set_LED_3 MACRO
                +1           ENDM
                +1           Clear_LED_3 MACRO
                +1           ENDM
                             ENDIF
                   10703     
                   10704     IF ESCNO == I_
                             ;$include (I.inc) ; Select pinout I
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; BLHeli program for controlling brushless motors in helicopters and multirotors
                +1           ;
                +1           ; Copyright 2011, 2012 Steffen Skaug
                +1           ; This program is distributed under the terms of the GNU General Public License
                +1           ;
                +1           ; This file is part of BLHeli.
                +1           ;
                +1           ; BLHeli is free software: you can redistribute it and/or modify
                +1           ; it under the terms of the GNU General Public License as published by
                +1           ; the Free Software Foundation, either version 3 of the License, or
                +1           ; (at your option) any later version.
                +1           ;
                +1           ; BLHeli is distributed in the hope that it will be useful,
                +1           ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                +1           ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                +1           ; GNU General Public License for more details.
                +1           ;
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   166

                +1           ; You should have received a copy of the GNU General Public License
                +1           ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                +1           ;
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; Hardware definition file "I"
                +1           ; X  X  RC X  MC MB MA CC    X  X  Ac Bc Cc Ap Bp Cp
                +1           ;
                +1           ;**** **** **** **** ****
                +1           
                +1           
                +1           
                +1           ;*********************
                +1           ; Device SiLabs EFM8BB1x/2x
                +1           ;*********************
                +1           IF MCU_48MHZ == 0
                +1           ;$include (SI_EFM8BB1_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB10F2G
                +2           ;  EFM8BB10F2I
                +2           ;  EFM8BB10F2Y
                +2           ;  EFM8BB10F4G
                +2           ;  EFM8BB10F4I
                +2           ;  EFM8BB10F4Y
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC      DATA 0E0H; Accumulator                            
                +2           ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF   DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B        DATA 0F0H; B Register                             
                +2           CKCON0   DATA 08EH; Clock Control 0                        
                +2           CLKSEL   DATA 0A9H; Clock Select                           
                +2           CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0MD   DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   167

                +2           CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                +2           CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN   DATA 0DDH; CRC0 Data Input                        
                +2           DERIVID  DATA 0ADH; Derivative Identification              
                +2           DEVICEID DATA 0B5H; Device Identification                  
                +2           DPH      DATA 083H; Data Pointer High                      
                +2           DPL      DATA 082H; Data Pointer Low                       
                +2           EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                +2           FLKEY    DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           IE       DATA 0A8H; Interrupt Enable                       
                +2           IP       DATA 0B8H; Interrupt Priority                     
                +2           IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0       DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK   DATA 0FEH; Port 0 Mask                            
                +2           P0MAT    DATA 0FDH; Port 0 Match                           
                +2           P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP   DATA 0D4H; Port 0 Skip                            
                +2           P1       DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK   DATA 0EEH; Port 1 Mask                            
                +2           P1MAT    DATA 0EDH; Port 1 Match                           
                +2           P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP   DATA 0D5H; Port 1 Skip                            
                +2           P2       DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                +2           PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0  DATA 0D8H; PCA Control                            
                +2           PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD   DATA 0D9H; PCA Mode                               
                +2           PCA0POL  DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0    DATA 087H; Power Control                          
                +2           PRTDRV   DATA 0F6H; Port Drive Strength                    
                +2           PSCTL    DATA 08FH; Program Store Control                  
                +2           PSW      DATA 0D0H; Program Status Word                    
                +2           REF0CN   DATA 0D1H; Voltage Reference Control              
                +2           REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                +2           REVID    DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC   DATA 0EFH; Reset Source                           
                +2           SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                +2           SCON0    DATA 098H; UART0 Serial Port Control              
                +2           SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT  DATA 0C2H; SMBus 0 Data                           
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   168

                +2           SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SP       DATA 081H; Stack Pointer                          
                +2           SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0  DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT  DATA 0A3H; SPI0 Data                              
                +2           TCON     DATA 088H; Timer 0/1 Control                      
                +2           TH0      DATA 08CH; Timer 0 High Byte                      
                +2           TH1      DATA 08DH; Timer 1 High Byte                      
                +2           TL0      DATA 08AH; Timer 0 Low Byte                       
                +2           TL1      DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD     DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2H    DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0  DATA 091H; Timer 3 Control 0                      
                +2           TMR3H    DATA 095H; Timer 3 High Byte                      
                +2           TMR3L    DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                +2           VDM0CN   DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN    DATA 097H; Watchdog Timer Control                 
                +2           XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   169

                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   170

                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   171

                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +1           
                +1           ELSE
                +1           ;$include (SI_EFM8BB2_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB21F16G_QFN20
                +2           ;  EFM8BB21F16G_QSOP24
                +2           ;  EFM8BB21F16I_QFN20
                +2           ;  EFM8BB21F16I_QSOP24
                +2           ;  EFM8BB22F16G_QFN28
                +2           ;  EFM8BB22F16I_QFN28
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC       DATA 0E0H; Accumulator                            
                +2           ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF    DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B         DATA 0F0H; B Register                             
                +2           CKCON0    DATA 08EH; Clock Control 0                        
                +2           CKCON1    DATA 0A6H; Clock Control 1
                +2           CLKSEL    DATA 0A9H; Clock Select                           
                +2           CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0CN1   DATA 099H; Comparator 0 Control 1
                +2           CMP0MD    DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                +2           CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CN1   DATA 086H; CRC0 Control 1                         
                +2           CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN    DATA 0DDH; CRC0 Data Input                        
                +2           CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                +2           DERIVID   DATA 0ADH; Derivative Identification              
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   172

                +2           DEVICEID  DATA 0B5H; Device Identification                  
                +2           DPH       DATA 083H; Data Pointer High                      
                +2           DPL       DATA 082H; Data Pointer Low                       
                +2           EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                +2           EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                +2           EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                +2           EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                +2           EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                +2           EMI0CN    DATA 0E7H; External Memory Interface Control      
                +2           FLKEY     DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                +2           HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                +2           I2C0CN0   DATA 0BAH; I2C0 Control                           
                +2           I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                +2           I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                +2           I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                +2           I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                +2           I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                +2           I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                +2           I2C0STAT  DATA 0B9H; I2C0 Status                            
                +2           IE        DATA 0A8H; Interrupt Enable                       
                +2           IP        DATA 0B8H; Interrupt Priority                     
                +2           IPH       DATA 0F2H; Interrupt Priority High                
                +2           IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0        DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK    DATA 0FEH; Port 0 Mask                            
                +2           P0MAT     DATA 0FDH; Port 0 Match                           
                +2           P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP    DATA 0D4H; Port 0 Skip                            
                +2           P1        DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK    DATA 0EEH; Port 1 Mask                            
                +2           P1MAT     DATA 0EDH; Port 1 Match                           
                +2           P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP    DATA 0D5H; Port 1 Skip                            
                +2           P2        DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MASK    DATA 0FCH; Port 2 Mask                            
                +2           P2MAT     DATA 0FBH; Port 2 Match                           
                +2           P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                +2           P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                +2           P2SKIP    DATA 0CCH; Port 2 Skip                            
                +2           P3        DATA 0B0H; Port 3 Pin Latch                       
                +2           P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                +2           P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                +2           PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0   DATA 0D8H; PCA Control                            
                +2           PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD    DATA 0D9H; PCA Mode                               
                +2           PCA0POL   DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0     DATA 087H; Power Control                          
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   173

                +2           PCON1     DATA 09AH; Power Control 1                        
                +2           PFE0CN    DATA 0C1H; Prefetch Engine Control                
                +2           PRTDRV    DATA 0F6H; Port Drive Strength                    
                +2           PSCTL     DATA 08FH; Program Store Control                  
                +2           PSW       DATA 0D0H; Program Status Word                    
                +2           REF0CN    DATA 0D1H; Voltage Reference Control              
                +2           REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                +2           REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                +2           REVID     DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC    DATA 0EFH; Reset Source                           
                +2           SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                +2           SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                +2           SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                +2           SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                +2           SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                +2           SCON0     DATA 098H; UART0 Serial Port Control              
                +2           SCON1     DATA 0C8H; UART1 Serial Port Control              
                +2           SFRPAGE   DATA 0A7H; SFR Page                               
                +2           SFRPGCN   DATA 0CFH; SFR Page Control                       
                +2           SFRSTACK  DATA 0D7H; SFR Page Stack                         
                +2           SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                +2           SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                +2           SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                +2           SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                +2           SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                +2           SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SMOD1     DATA 093H; UART1 Mode                             
                +2           SP        DATA 081H; Stack Pointer                          
                +2           SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0   DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT   DATA 0A3H; SPI0 Data                              
                +2           SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                +2           SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                +2           SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                +2           TCON      DATA 088H; Timer 0/1 Control                      
                +2           TH0       DATA 08CH; Timer 0 High Byte                      
                +2           TH1       DATA 08DH; Timer 1 High Byte                      
                +2           TL0       DATA 08AH; Timer 0 Low Byte                       
                +2           TL1       DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD      DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                +2           TMR2H     DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0   DATA 091H; Timer 3 Control 0                      
                +2           TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                +2           TMR3H     DATA 095H; Timer 3 High Byte                      
                +2           TMR3L     DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                +2           TMR4CN0   DATA 098H; Timer 4 Control 0                      
                +2           TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                +2           TMR4H     DATA 0A5H; Timer 4 High Byte                      
                +2           TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                +2           TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                +2           TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                +2           UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                +2           UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                +2           UART1FCT  DATA 0FAH; UART1 FIFO Count                       
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   174

                +2           UART1LIN  DATA 09EH; UART1 LIN Configuration                
                +2           VDM0CN    DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN     DATA 097H; Watchdog Timer Control                 
                +2           XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                +2           TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   175

                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                +2           P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                +2           
                +2           ; P3 0xB0 (Port 3 Pin Latch)
                +2           P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                +2           P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   176

                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SCON1 0xC8 (UART1 Serial Port Control)
                +2           SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                +2           SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                +2           SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                +2           SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                +2           SCON1_REN  BIT SCON1.4 ; Receive Enable           
                +2           SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                +2           SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                +2           TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                +2           
                +2           ; TMR4CN0 0x98 (Timer 4 Control 0)
                +2           TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                +2           TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                +2           TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                +2           TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                +2           TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                +2           TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                +2           TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                +2           TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                +2           
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   177

                +2           ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                +2           UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                +2           UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                +2           UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                +2           UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                +2           UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                +2           UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                +2           UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                +2           UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +2           UART1_IRQn   EQU 17 ; UART1                     
                +2           I2C0_IRQn    EQU 18 ; I2C0 Slave                
                +2           TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; SFR Page Definitions
                +2           ;------------------------------------------------------------------------------
                +2           CRC0_PAGE       EQU 000H ; CRC0 Page       
                +2           LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                +2           PCA0_PAGE       EQU 000H ; PCA0 Page       
                +2           PG2_PAGE        EQU 010H ; Page2           
                +2           TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                +2           TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                +2           TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                +2           I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                +2           PG3_PAGE        EQU 020H ; Page3           
                +2           SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                +2           SPI0_PAGE       EQU 020H ; SPI0 Page       
                +2           UART0_PAGE      EQU 020H ; UART0 Page      
                +2           UART1_PAGE      EQU 020H ; UART1 Page      
                +1           
                +1           ENDIF
                +1           
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Uses internal calibrated oscillator set to 24/48Mhz
                +1           ;**** **** **** **** ****
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Constant definitions
                +1           ;**** **** **** **** ****
                +1           IF MCU_48MHZ == 0
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#I_L_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#I_L_05#        "
                +1           ELSEIF FETON_DELAY == 10
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   178

                +1           Eep_ESC_Layout:         DB      "#I_L_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#I_L_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#I_L_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#I_L_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#I_L_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#I_L_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#I_L_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#I_L_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#I_L_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (16 B
                             ytes)
                +1           
                +1           ELSE
                +1           
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#I_H_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#I_H_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#I_H_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#I_H_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#I_H_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#I_H_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#I_H_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#I_H_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#I_H_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#I_H_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#I_H_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (16 B
                             ytes)
                +1           ENDIF
                +1           
                +1           TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for whi
                             ch main motor power is limited at 80degC (low byte, assuming high byte is 1)
                +1           TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment for a
                             nother 10degC
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Bootloader definitions
                +1           ;**** **** **** **** ****
                +1           RTX_PORT                                EQU     P0              ; Receive/Transmit port
                +1           RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL            
                                          
                +1           RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL             
                                          
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   179

                +1           RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP                
                                          
                +1           RTX_PIN                         EQU     5               ; RTX pin
                +1           
                +1           SIGNATURE_001                   EQU     0E8h            ; Device signature
                +1           IF MCU_48MHZ == 0
                +1           SIGNATURE_002                   EQU     0B1h
                +1           ELSE
                +1           SIGNATURE_002                   EQU     0B2h
                +1           ENDIF
                +1           
                +1           ;*********************
                +1           ; PORT 0 definitions *
                +1           ;*********************  
                +1           ;                       EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           Rcp_In          EQU     5       ;i
                +1           ;                       EQU     4       ;i 
                +1           Mux_C           EQU     3       ;i
                +1           Mux_B           EQU     2       ;i
                +1           Mux_A           EQU     1       ;i
                +1           Comp_Com                EQU     0       ;i
                +1           
                +1           P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                +1           P0_INIT         EQU     0FFh
                +1           P0_PUSHPULL     EQU     0
                +1           P0_SKIP         EQU     0FFh
                +1           
                +1           Get_Rcp_Capture_Values MACRO
                +1                   anl     TCON, #0EFh                             ; Disable timer0
                +1                   mov     Temp1, TL0                              ; Get timer0 values
                +1                   mov     Temp2, TH0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Temp3, Timer0_X
                +1                   jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                +1                   inc     Temp3                                   ; If it is pending, then timer has 
                             already wrapped
                +1           ENDIF
                +1                   mov     TL0, #0                                 ; Reset timer0
                +1                   mov     TH0, #0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Timer0_X, #0
                +1           ENDIF
                +1                   orl     TCON, #10h                              ; Enable timer0 again
                +1           IF MCU_48MHZ == 1
                +1                   mov     A, Clock_Set_At_48MHz
                +1                   jnz     Get_Rcp_End
                +1                   clr     C
                +1                   mov     A, Temp1
                +1                   rlc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Temp2
                +1                   rlc     A
                +1                   mov     Temp2, A
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1           Get_Rcp_End:
                +1           ENDIF
                +1           ENDM
                +1           Decode_Dshot_2Msb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   180

                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp4                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp4
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL
                +1           ENDM
                +1           Decode_Dshot_2Lsb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp3                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL
                +1           ENDM
                +1           Initialize_PCA MACRO
                +1                   mov     PCA0CN0, #40h                           ; PCA enabled
                +1                   mov     PCA0MD, #08h                            ; PCA clock is system clock
                +1           IF FETON_DELAY == 0
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #00h                          ; Edge aligned pwm
                +1           ELSE
                +1           IF MCU_48MHZ == 0
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   181

                +1                   mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #03h                          ; Center aligned pwm
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_Polarity MACRO
                +1                   mov     PCA0POL, #02h                           ; Damping inverted, pwm noninverted
                +1           ENDM
                +1           Enable_Power_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, enab
                             le match, set pwm mode
                +1           ELSE
                +1                   mov     PCA0CPM0, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Enable_Damp_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM1, #00h                          ; Disable
                +1           ELSE
                +1                   mov     PCA0CPM1, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Set_Power_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL0, Power_Pwm_Reg_L
                +1                   mov     PCA0CPH0, Power_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Power_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Power_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL0, A
                +1                   mov     PCA0CPH0, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Set_Damp_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL1, Damp_Pwm_Reg_L
                +1                   mov     PCA0CPH1, Damp_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Damp_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Damp_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL1, A
                +1                   mov     PCA0CPH1, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Clear_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0DFh
                +1           ENDM
                +1           Clear_CCF_Interrupt MACRO
                +1                   anl     PCA0CN0, #0FEh
                +1           ENDM
                +1           Enable_COVF_Interrupt MACRO
                +1                   orl     PCA0PWM, #40h
                +1           ENDM
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   182

                +1           Enable_CCF_Interrupt MACRO
                +1                   orl     PCA0CPM0,#01h
                +1           ENDM
                +1           Disable_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0BFh
                +1           ENDM
                +1           Disable_CCF_Interrupt MACRO
                +1                   anl     PCA0CPM0,#0FEh
                +1           ENDM
                +1           
                +1           ;*********************
                +1           ; PORT 1 definitions *
                +1           ;*********************
                +1           ;                       EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           AcomFET         EQU     5       ;o
                +1           BcomFET         EQU     4       ;o
                +1           CcomFET         EQU     3       ;o
                +1           ApwmFET         EQU     2       ;o
                +1           BpwmFET         EQU     1       ;o
                +1           CpwmFET         EQU     0       ;o
                +1           
                +1           P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_INIT         EQU     00h             
                +1           P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_SKIP         EQU     3Fh
                +1           
                +1           ApwmFET_on MACRO
                +1                   setb    P1.ApwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           ApwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_on MACRO
                +1                   setb    P1.BpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.BpwmFET
                +1           ELSE
                +1                   clr     P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_on MACRO
                +1                   setb    P1.CpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.CcomFET
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   183

                +1           ENDIF
                +1           ENDM
                +1           All_pwmFETs_Off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1                   clr     P1.BpwmFET
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           
                +1           AcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.ApwmFET
                +1           ENDIF
                +1                   setb    P1.AcomFET
                +1           ENDM
                +1           AcomFET_off MACRO
                +1                   clr     P1.AcomFET
                +1           ENDM
                +1           BcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.BpwmFET
                +1           ENDIF
                +1                   setb    P1.BcomFET
                +1           ENDM
                +1           BcomFET_off MACRO
                +1                   clr     P1.BcomFET
                +1           ENDM
                +1           CcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.CpwmFET
                +1           ENDIF
                +1                   setb    P1.CcomFET
                +1           ENDM
                +1           CcomFET_off MACRO
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           All_comFETs_Off MACRO
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           
                +1           Set_Pwm_A MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1                   mov     P1SKIP, #3Bh
                +1           ELSE
                +1                   mov     P1SKIP, #1Bh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_B MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1                   mov     P1SKIP, #3Dh
                +1           ELSE
                +1                   mov     P1SKIP, #2Dh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_C MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   184

                +1                   mov     P1SKIP, #3Eh
                +1           ELSE
                +1                   mov     P1SKIP, #36h
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwms_Off MACRO
                +1                   mov     P1SKIP, #7Fh
                +1           ENDM
                +1           
                +1           Set_Comp_Phase_A MACRO
                +1                   mov     CMP0MX, #10h    ; Set comparator multiplexer to phase A
                +1           ENDM
                +1           Set_Comp_Phase_B MACRO
                +1                   mov     CMP0MX, #20h    ; Set comparator multiplexer to phase B
                +1           ENDM
                +1           Set_Comp_Phase_C MACRO
                +1                   mov     CMP0MX, #30h    ; Set comparator multiplexer to phase C
                +1           ENDM
                +1           Read_Comp_Out MACRO
                +1                   mov     A, CMP0CN0      ; Read comparator output
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 2 definitions *
                +1           ;*********************
                +1           DebugPin                EQU     0       ;o
                +1           
                +1           P2_PUSHPULL     EQU     (1 SHL DebugPin)
                +1           
                +1           
                +1           ;**********************
                +1           ; MCU specific macros *
                +1           ;**********************
                +1           Interrupt_Table_Definition MACRO
                +1           CSEG AT 0                               ; Code segment start
                +1                   jmp reset
                +1           CSEG AT 03h                     ; Int0 interrupt        
                +1                   jmp     int0_int        
                +1           IF MCU_48MHZ == 1
                +1           CSEG AT 0Bh                     ; Timer0 overflow interrupt
                +1                   jmp     t0_int
                +1           ENDIF
                +1           CSEG AT 13h                     ; Int1 interrupt
                +1                   jmp     int1_int
                +1           CSEG AT 1Bh                     ; Timer1 overflow interrupt
                +1                   jmp     t1_int
                +1           CSEG AT 2Bh                     ; Timer2 overflow interrupt
                +1                   jmp     t2_int  
                +1           CSEG AT 5Bh                     ; Pca interrupt
                +1                   jmp     pca_int
                +1           CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                +1                   jmp     t3_int  
                +1           ENDM
                +1           
                +1           Initialize_Xbar MACRO
                +1                   mov     XBR2, #40h      ; Xbar enabled                  
                +1                   mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                +1           ENDM
                +1           
                +1           Initialize_Comparator MACRO
                +1                   mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                +1                   mov     CMP0MD, #00h    ; Comparator response time 100ns
                +1           ENDM
                +1           Initialize_Adc MACRO
                +1                   mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bias
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   185

                +1           IF MCU_48MHZ == 0
                +1                   mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                +1           ELSE
                +1                   mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                +1           ENDIF
                +1                   mov     ADC0MX, #10h    ; Select temp sensor input
                +1                   mov     ADC0CN0, #80h   ; ADC enabled 
                +1                   mov     ADC0CN1, #01h   ; Common mode buffer enabled
                +1           ENDM
                +1           Start_Adc MACRO
                +1                   mov     ADC0CN0, #90h   ; ADC start
                +1           ENDM
                +1           Read_Adc_Result MACRO
                +1                   mov     Temp1, ADC0L
                +1                   mov     Temp2, ADC0H
                +1           ENDM
                +1           Stop_Adc MACRO
                +1           ENDM
                +1           Set_RPM_Out MACRO
                +1           ENDM
                +1           Clear_RPM_Out MACRO
                +1           ENDM
                +1           Set_MCU_Clk_24MHz MACRO
                +1                   mov     CLKSEL, #13h            ; Set clock to 24MHz
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     Clock_Set_At_48MHz, #0
                +1           ENDM
                +1           Set_MCU_Clk_48MHz MACRO
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     CLKSEL, #03h            ; Set clock to 48MHz
                +1                   mov     Clock_Set_At_48MHz, #1
                +1           ENDM
                +1           Set_LED_0 MACRO
                +1           ENDM
                +1           Clear_LED_0 MACRO
                +1           ENDM
                +1           Set_LED_1 MACRO
                +1           ENDM
                +1           Clear_LED_1 MACRO
                +1           ENDM
                +1           Set_LED_2 MACRO
                +1           ENDM
                +1           Clear_LED_2 MACRO
                +1           ENDM
                +1           Set_LED_3 MACRO
                +1           ENDM
                +1           Clear_LED_3 MACRO
                +1           ENDM
                             ENDIF
                   12015     
                   12016     IF ESCNO == J_
                             ;$include (J.inc) ; Select pinout J
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; BLHeli program for controlling brushless motors in helicopters and multirotors
                +1           ;
                +1           ; Copyright 2011, 2012 Steffen Skaug
                +1           ; This program is distributed under the terms of the GNU General Public License
                +1           ;
                +1           ; This file is part of BLHeli.
                +1           ;
                +1           ; BLHeli is free software: you can redistribute it and/or modify
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   186

                +1           ; it under the terms of the GNU General Public License as published by
                +1           ; the Free Software Foundation, either version 3 of the License, or
                +1           ; (at your option) any later version.
                +1           ;
                +1           ; BLHeli is distributed in the hope that it will be useful,
                +1           ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                +1           ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                +1           ; GNU General Public License for more details.
                +1           ;
                +1           ; You should have received a copy of the GNU General Public License
                +1           ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                +1           ;
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; Hardware definition file "J"
                +1           ; L2 L1 L0 RC CC MB MC MA    X  X  Cc Bc Ac Cp Bp Ap
                +1           ;
                +1           ;**** **** **** **** ****
                +1           
                +1           
                +1           
                +1           ;*********************
                +1           ; Device SiLabs EFM8BB1x/2x
                +1           ;*********************
                +1           IF MCU_48MHZ == 0
                +1           ;$include (SI_EFM8BB1_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB10F2G
                +2           ;  EFM8BB10F2I
                +2           ;  EFM8BB10F2Y
                +2           ;  EFM8BB10F4G
                +2           ;  EFM8BB10F4I
                +2           ;  EFM8BB10F4Y
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC      DATA 0E0H; Accumulator                            
                +2           ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF   DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   187

                +2           ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B        DATA 0F0H; B Register                             
                +2           CKCON0   DATA 08EH; Clock Control 0                        
                +2           CLKSEL   DATA 0A9H; Clock Select                           
                +2           CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0MD   DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                +2           CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN   DATA 0DDH; CRC0 Data Input                        
                +2           DERIVID  DATA 0ADH; Derivative Identification              
                +2           DEVICEID DATA 0B5H; Device Identification                  
                +2           DPH      DATA 083H; Data Pointer High                      
                +2           DPL      DATA 082H; Data Pointer Low                       
                +2           EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                +2           FLKEY    DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           IE       DATA 0A8H; Interrupt Enable                       
                +2           IP       DATA 0B8H; Interrupt Priority                     
                +2           IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0       DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK   DATA 0FEH; Port 0 Mask                            
                +2           P0MAT    DATA 0FDH; Port 0 Match                           
                +2           P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP   DATA 0D4H; Port 0 Skip                            
                +2           P1       DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK   DATA 0EEH; Port 1 Mask                            
                +2           P1MAT    DATA 0EDH; Port 1 Match                           
                +2           P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP   DATA 0D5H; Port 1 Skip                            
                +2           P2       DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                +2           PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0  DATA 0D8H; PCA Control                            
                +2           PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD   DATA 0D9H; PCA Mode                               
                +2           PCA0POL  DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0    DATA 087H; Power Control                          
                +2           PRTDRV   DATA 0F6H; Port Drive Strength                    
                +2           PSCTL    DATA 08FH; Program Store Control                  
                +2           PSW      DATA 0D0H; Program Status Word                    
                +2           REF0CN   DATA 0D1H; Voltage Reference Control              
                +2           REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   188

                +2           REVID    DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC   DATA 0EFH; Reset Source                           
                +2           SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                +2           SCON0    DATA 098H; UART0 Serial Port Control              
                +2           SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                +2           SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SP       DATA 081H; Stack Pointer                          
                +2           SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0  DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT  DATA 0A3H; SPI0 Data                              
                +2           TCON     DATA 088H; Timer 0/1 Control                      
                +2           TH0      DATA 08CH; Timer 0 High Byte                      
                +2           TH1      DATA 08DH; Timer 1 High Byte                      
                +2           TL0      DATA 08AH; Timer 0 Low Byte                       
                +2           TL1      DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD     DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2H    DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0  DATA 091H; Timer 3 Control 0                      
                +2           TMR3H    DATA 095H; Timer 3 High Byte                      
                +2           TMR3L    DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                +2           VDM0CN   DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN    DATA 097H; Watchdog Timer Control                 
                +2           XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   189

                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   190

                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   191

                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +1           
                +1           ELSE
                +1           ;$include (SI_EFM8BB2_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB21F16G_QFN20
                +2           ;  EFM8BB21F16G_QSOP24
                +2           ;  EFM8BB21F16I_QFN20
                +2           ;  EFM8BB21F16I_QSOP24
                +2           ;  EFM8BB22F16G_QFN28
                +2           ;  EFM8BB22F16I_QFN28
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC       DATA 0E0H; Accumulator                            
                +2           ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF    DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B         DATA 0F0H; B Register                             
                +2           CKCON0    DATA 08EH; Clock Control 0                        
                +2           CKCON1    DATA 0A6H; Clock Control 1
                +2           CLKSEL    DATA 0A9H; Clock Select                           
                +2           CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0CN1   DATA 099H; Comparator 0 Control 1
                +2           CMP0MD    DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                +2           CMP1MD    DATA 0ABH; Comparator 1 Mode                      
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   192

                +2           CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CN1   DATA 086H; CRC0 Control 1                         
                +2           CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN    DATA 0DDH; CRC0 Data Input                        
                +2           CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                +2           DERIVID   DATA 0ADH; Derivative Identification              
                +2           DEVICEID  DATA 0B5H; Device Identification                  
                +2           DPH       DATA 083H; Data Pointer High                      
                +2           DPL       DATA 082H; Data Pointer Low                       
                +2           EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                +2           EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                +2           EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                +2           EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                +2           EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                +2           EMI0CN    DATA 0E7H; External Memory Interface Control      
                +2           FLKEY     DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                +2           HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                +2           I2C0CN0   DATA 0BAH; I2C0 Control                           
                +2           I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                +2           I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                +2           I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                +2           I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                +2           I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                +2           I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                +2           I2C0STAT  DATA 0B9H; I2C0 Status                            
                +2           IE        DATA 0A8H; Interrupt Enable                       
                +2           IP        DATA 0B8H; Interrupt Priority                     
                +2           IPH       DATA 0F2H; Interrupt Priority High                
                +2           IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0        DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK    DATA 0FEH; Port 0 Mask                            
                +2           P0MAT     DATA 0FDH; Port 0 Match                           
                +2           P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP    DATA 0D4H; Port 0 Skip                            
                +2           P1        DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK    DATA 0EEH; Port 1 Mask                            
                +2           P1MAT     DATA 0EDH; Port 1 Match                           
                +2           P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP    DATA 0D5H; Port 1 Skip                            
                +2           P2        DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MASK    DATA 0FCH; Port 2 Mask                            
                +2           P2MAT     DATA 0FBH; Port 2 Match                           
                +2           P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                +2           P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                +2           P2SKIP    DATA 0CCH; Port 2 Skip                            
                +2           P3        DATA 0B0H; Port 3 Pin Latch                       
                +2           P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                +2           P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                +2           PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0   DATA 0D8H; PCA Control                            
                +2           PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   193

                +2           PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD    DATA 0D9H; PCA Mode                               
                +2           PCA0POL   DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0     DATA 087H; Power Control                          
                +2           PCON1     DATA 09AH; Power Control 1                        
                +2           PFE0CN    DATA 0C1H; Prefetch Engine Control                
                +2           PRTDRV    DATA 0F6H; Port Drive Strength                    
                +2           PSCTL     DATA 08FH; Program Store Control                  
                +2           PSW       DATA 0D0H; Program Status Word                    
                +2           REF0CN    DATA 0D1H; Voltage Reference Control              
                +2           REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                +2           REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                +2           REVID     DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC    DATA 0EFH; Reset Source                           
                +2           SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                +2           SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                +2           SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                +2           SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                +2           SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                +2           SCON0     DATA 098H; UART0 Serial Port Control              
                +2           SCON1     DATA 0C8H; UART1 Serial Port Control              
                +2           SFRPAGE   DATA 0A7H; SFR Page                               
                +2           SFRPGCN   DATA 0CFH; SFR Page Control                       
                +2           SFRSTACK  DATA 0D7H; SFR Page Stack                         
                +2           SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                +2           SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                +2           SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                +2           SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                +2           SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                +2           SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SMOD1     DATA 093H; UART1 Mode                             
                +2           SP        DATA 081H; Stack Pointer                          
                +2           SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0   DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT   DATA 0A3H; SPI0 Data                              
                +2           SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                +2           SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                +2           SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                +2           TCON      DATA 088H; Timer 0/1 Control                      
                +2           TH0       DATA 08CH; Timer 0 High Byte                      
                +2           TH1       DATA 08DH; Timer 1 High Byte                      
                +2           TL0       DATA 08AH; Timer 0 Low Byte                       
                +2           TL1       DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD      DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                +2           TMR2H     DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0   DATA 091H; Timer 3 Control 0                      
                +2           TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                +2           TMR3H     DATA 095H; Timer 3 High Byte                      
                +2           TMR3L     DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   194

                +2           TMR4CN0   DATA 098H; Timer 4 Control 0                      
                +2           TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                +2           TMR4H     DATA 0A5H; Timer 4 High Byte                      
                +2           TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                +2           TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                +2           TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                +2           UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                +2           UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                +2           UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                +2           UART1LIN  DATA 09EH; UART1 LIN Configuration                
                +2           VDM0CN    DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN     DATA 097H; Watchdog Timer Control                 
                +2           XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                +2           TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   195

                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                +2           P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                +2           
                +2           ; P3 0xB0 (Port 3 Pin Latch)
                +2           P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                +2           P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   196

                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SCON1 0xC8 (UART1 Serial Port Control)
                +2           SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                +2           SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                +2           SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                +2           SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                +2           SCON1_REN  BIT SCON1.4 ; Receive Enable           
                +2           SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                +2           SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                +2           TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                +2           
                +2           ; TMR4CN0 0x98 (Timer 4 Control 0)
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   197

                +2           TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                +2           TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                +2           TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                +2           TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                +2           TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                +2           TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                +2           TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                +2           TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                +2           
                +2           ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                +2           UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                +2           UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                +2           UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                +2           UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                +2           UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                +2           UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                +2           UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                +2           UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +2           UART1_IRQn   EQU 17 ; UART1                     
                +2           I2C0_IRQn    EQU 18 ; I2C0 Slave                
                +2           TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; SFR Page Definitions
                +2           ;------------------------------------------------------------------------------
                +2           CRC0_PAGE       EQU 000H ; CRC0 Page       
                +2           LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                +2           PCA0_PAGE       EQU 000H ; PCA0 Page       
                +2           PG2_PAGE        EQU 010H ; Page2           
                +2           TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                +2           TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                +2           TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                +2           I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                +2           PG3_PAGE        EQU 020H ; Page3           
                +2           SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                +2           SPI0_PAGE       EQU 020H ; SPI0 Page       
                +2           UART0_PAGE      EQU 020H ; UART0 Page      
                +2           UART1_PAGE      EQU 020H ; UART1 Page      
                +1           
                +1           ENDIF
                +1           
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Uses internal calibrated oscillator set to 24/48Mhz
                +1           ;**** **** **** **** ****
                +1           
                +1           ;**** **** **** **** ****
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   198

                +1           ; Constant definitions
                +1           ;**** **** **** **** ****
                +1           IF MCU_48MHZ == 0
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#J_L_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#J_L_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#J_L_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#J_L_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#J_L_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#J_L_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#J_L_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#J_L_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#J_L_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#J_L_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#J_L_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (16 B
                             ytes)
                +1           
                +1           ELSE
                +1           
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#J_H_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#J_H_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#J_H_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#J_H_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#J_H_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#J_H_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#J_H_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#J_H_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#J_H_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#J_H_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#J_H_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (16 B
                             ytes)
                +1           ENDIF
                +1           
                +1           TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for whi
                             ch main motor power is limited at 80degC (low byte, assuming high byte is 1)
                +1           TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment for a
                             nother 10degC
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   199

                +1           
                +1           ;**** **** **** **** ****
                +1           ; Bootloader definitions
                +1           ;**** **** **** **** ****
                +1           RTX_PORT                                EQU     P0              ; Receive/Transmit port
                +1           RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL            
                                          
                +1           RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL             
                                          
                +1           RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP                
                                          
                +1           RTX_PIN                         EQU     4               ; RTX pin
                +1           
                +1           SIGNATURE_001                   EQU     0E8h            ; Device signature
                +1           IF MCU_48MHZ == 0
                +1           SIGNATURE_002                   EQU     0B1h
                +1           ELSE
                +1           SIGNATURE_002                   EQU     0B2h
                +1           ENDIF
                +1           
                +1           ;*********************
                +1           ; PORT 0 definitions *
                +1           ;*********************  
                +1           LED_2           EQU     7       ;o
                +1           LED_1           EQU     6       ;o
                +1           LED_0           EQU     5       ;o
                +1           Rcp_In          EQU     4       ;i
                +1           Comp_Com                EQU     3       ;i
                +1           Mux_B           EQU     2       ;i
                +1           Mux_C           EQU     1       ;i
                +1           Mux_A           EQU     0       ;i
                +1           
                +1           P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                +1           P0_INIT         EQU     0FFh
                +1           P0_PUSHPULL     EQU     (1 SHL LED_0)+(1 SHL LED_1)+(1 SHL LED_2)
                +1           P0_SKIP         EQU     0FFh
                +1           
                +1           Get_Rcp_Capture_Values MACRO
                +1                   anl     TCON, #0EFh                             ; Disable timer0
                +1                   mov     Temp1, TL0                              ; Get timer0 values
                +1                   mov     Temp2, TH0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Temp3, Timer0_X
                +1                   jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                +1                   inc     Temp3                                   ; If it is pending, then timer has 
                             already wrapped
                +1           ENDIF
                +1                   mov     TL0, #0                                 ; Reset timer0
                +1                   mov     TH0, #0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Timer0_X, #0
                +1           ENDIF
                +1                   orl     TCON, #10h                              ; Enable timer0 again
                +1           IF MCU_48MHZ == 1
                +1                   mov     A, Clock_Set_At_48MHz
                +1                   jnz     Get_Rcp_End
                +1                   clr     C
                +1                   mov     A, Temp1
                +1                   rlc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Temp2
                +1                   rlc     A
                +1                   mov     Temp2, A
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   200

                +1           Get_Rcp_End:
                +1           ENDIF
                +1           ENDM
                +1           Decode_Dshot_2Msb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp4                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp4
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL
                +1           ENDM
                +1           Decode_Dshot_2Lsb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp3                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL
                +1           ENDM
                +1           Initialize_PCA MACRO
                +1                   mov     PCA0CN0, #40h                           ; PCA enabled
                +1                   mov     PCA0MD, #08h                            ; PCA clock is system clock
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   201

                +1           IF FETON_DELAY == 0
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #00h                          ; Edge aligned pwm
                +1           ELSE
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #03h                          ; Center aligned pwm
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_Polarity MACRO
                +1                   mov     PCA0POL, #02h                           ; Damping inverted, pwm noninverted
                +1           ENDM
                +1           Enable_Power_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, enab
                             le match, set pwm mode
                +1           ELSE
                +1                   mov     PCA0CPM0, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Enable_Damp_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM1, #00h                          ; Disable
                +1           ELSE
                +1                   mov     PCA0CPM1, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Set_Power_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL0, Power_Pwm_Reg_L
                +1                   mov     PCA0CPH0, Power_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Power_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Power_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL0, A
                +1                   mov     PCA0CPH0, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Set_Damp_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL1, Damp_Pwm_Reg_L
                +1                   mov     PCA0CPH1, Damp_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Damp_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Damp_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL1, A
                +1                   mov     PCA0CPH1, Temp1
                +1           ENDIF
                +1           ENDM            
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   202

                +1           Clear_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0DFh
                +1           ENDM
                +1           Clear_CCF_Interrupt MACRO
                +1                   anl     PCA0CN0, #0FEh
                +1           ENDM
                +1           Enable_COVF_Interrupt MACRO
                +1                   orl     PCA0PWM, #40h
                +1           ENDM
                +1           Enable_CCF_Interrupt MACRO
                +1                   orl     PCA0CPM0,#01h
                +1           ENDM
                +1           Disable_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0BFh
                +1           ENDM
                +1           Disable_CCF_Interrupt MACRO
                +1                   anl     PCA0CPM0,#0FEh
                +1           ENDM
                +1           
                +1           ;*********************
                +1           ; PORT 1 definitions *
                +1           ;*********************
                +1           ;                       EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           CcomFET         EQU     5       ;o
                +1           BcomFET         EQU     4       ;o
                +1           AcomFET         EQU     3       ;o
                +1           CpwmFET         EQU     2       ;o
                +1           BpwmFET         EQU     1       ;o
                +1           ApwmFET         EQU     0       ;o
                +1           
                +1           P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_INIT         EQU     00h             
                +1           P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_SKIP         EQU     3Fh
                +1           
                +1           ApwmFET_on MACRO
                +1                   setb    P1.ApwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           ApwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_on MACRO
                +1                   setb    P1.BpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.BpwmFET
                +1           ELSE
                +1                   clr     P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_on MACRO
                +1                   setb    P1.CpwmFET
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   203

                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           All_pwmFETs_Off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1                   clr     P1.BpwmFET
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           
                +1           AcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.ApwmFET
                +1           ENDIF
                +1                   setb    P1.AcomFET
                +1           ENDM
                +1           AcomFET_off MACRO
                +1                   clr     P1.AcomFET
                +1           ENDM
                +1           BcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.BpwmFET
                +1           ENDIF
                +1                   setb    P1.BcomFET
                +1           ENDM
                +1           BcomFET_off MACRO
                +1                   clr     P1.BcomFET
                +1           ENDM
                +1           CcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.CpwmFET
                +1           ENDIF
                +1                   setb    P1.CcomFET
                +1           ENDM
                +1           CcomFET_off MACRO
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           All_comFETs_Off MACRO
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           
                +1           Set_Pwm_A MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1                   mov     P1SKIP, #3Eh
                +1           ELSE
                +1                   mov     P1SKIP, #36h
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_B MACRO
                +1           IF FETON_DELAY == 0
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   204

                +1                   setb    P1.BcomFET
                +1                   mov     P1SKIP, #3Dh
                +1           ELSE
                +1                   mov     P1SKIP, #2Dh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_C MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1                   mov     P1SKIP, #3Bh
                +1           ELSE
                +1                   mov     P1SKIP, #1Bh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwms_Off MACRO
                +1                   mov     P1SKIP, #7Fh
                +1           ENDM
                +1           
                +1           Set_Comp_Phase_A MACRO
                +1                   mov     CMP0MX, #03h    ; Set comparator multiplexer to phase A
                +1           ENDM
                +1           Set_Comp_Phase_B MACRO
                +1                   mov     CMP0MX, #23h    ; Set comparator multiplexer to phase B
                +1           ENDM
                +1           Set_Comp_Phase_C MACRO
                +1                   mov     CMP0MX, #13h    ; Set comparator multiplexer to phase C
                +1           ENDM
                +1           Read_Comp_Out MACRO
                +1                   mov     A, CMP0CN0      ; Read comparator output
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 2 definitions *
                +1           ;*********************
                +1           DebugPin                EQU     0       ;o
                +1           
                +1           P2_PUSHPULL     EQU     (1 SHL DebugPin)
                +1           
                +1           
                +1           ;**********************
                +1           ; MCU specific macros *
                +1           ;**********************
                +1           Interrupt_Table_Definition MACRO
                +1           CSEG AT 0                               ; Code segment start
                +1                   jmp reset
                +1           CSEG AT 03h                     ; Int0 interrupt        
                +1                   jmp     int0_int        
                +1           IF MCU_48MHZ == 1
                +1           CSEG AT 0Bh                     ; Timer0 overflow interrupt
                +1                   jmp     t0_int
                +1           ENDIF
                +1           CSEG AT 13h                     ; Int1 interrupt
                +1                   jmp     int1_int
                +1           CSEG AT 1Bh                     ; Timer1 overflow interrupt
                +1                   jmp     t1_int
                +1           CSEG AT 2Bh                     ; Timer2 overflow interrupt
                +1                   jmp     t2_int  
                +1           CSEG AT 5Bh                     ; Pca interrupt
                +1                   jmp     pca_int
                +1           CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                +1                   jmp     t3_int  
                +1           ENDM
                +1           
                +1           Initialize_Xbar MACRO
                +1                   mov     XBR2, #40h      ; Xbar enabled                  
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   205

                +1                   mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                +1           ENDM
                +1           
                +1           Initialize_Comparator MACRO
                +1                   mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                +1                   mov     CMP0MD, #00h    ; Comparator response time 100ns
                +1           ENDM
                +1           Initialize_Adc MACRO
                +1                   mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bias
                +1           IF MCU_48MHZ == 0
                +1                   mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                +1           ELSE
                +1                   mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                +1           ENDIF
                +1                   mov     ADC0MX, #10h    ; Select temp sensor input
                +1                   mov     ADC0CN0, #80h   ; ADC enabled 
                +1                   mov     ADC0CN1, #01h   ; Common mode buffer enabled
                +1           ENDM
                +1           Start_Adc MACRO
                +1                   mov     ADC0CN0, #90h   ; ADC start
                +1           ENDM
                +1           Read_Adc_Result MACRO
                +1                   mov     Temp1, ADC0L
                +1                   mov     Temp2, ADC0H
                +1           ENDM
                +1           Stop_Adc MACRO
                +1           ENDM
                +1           Set_RPM_Out MACRO
                +1           ENDM
                +1           Clear_RPM_Out MACRO
                +1           ENDM
                +1           Set_MCU_Clk_24MHz MACRO
                +1                   mov     CLKSEL, #13h            ; Set clock to 24MHz
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     Clock_Set_At_48MHz, #0
                +1           ENDM
                +1           Set_MCU_Clk_48MHz MACRO
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     CLKSEL, #03h            ; Set clock to 48MHz
                +1                   mov     Clock_Set_At_48MHz, #1
                +1           ENDM
                +1           Set_LED_0 MACRO
                +1                   clr     P0.LED_0
                +1           ENDM
                +1           Clear_LED_0 MACRO
                +1                   setb    P0.LED_0
                +1           ENDM
                +1           Set_LED_1 MACRO
                +1                   clr     P0.LED_1
                +1           ENDM
                +1           Clear_LED_1 MACRO
                +1                   setb    P0.LED_1
                +1           ENDM
                +1           Set_LED_2 MACRO
                +1                   clr     P0.LED_2
                +1           ENDM
                +1           Clear_LED_2 MACRO
                +1                   setb    P0.LED_2
                +1           ENDM
                +1           Set_LED_3 MACRO
                +1           ENDM
                +1           Clear_LED_3 MACRO
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   206

                +1           ENDM
                             ENDIF
                   13333     
                   13334     IF ESCNO == K_
                   13335     ;$include (K.inc) ; Select pinout K
                +1 13336     ;**** **** **** **** ****
                +1 13337     ;
                +1 13338     ; BLHeli program for controlling brushless motors in helicopters and multirotors
                +1 13339     ;
                +1 13340     ; Copyright 2011, 2012 Steffen Skaug
                +1 13341     ; This program is distributed under the terms of the GNU General Public License
                +1 13342     ;
                +1 13343     ; This file is part of BLHeli.
                +1 13344     ;
                +1 13345     ; BLHeli is free software: you can redistribute it and/or modify
                +1 13346     ; it under the terms of the GNU General Public License as published by
                +1 13347     ; the Free Software Foundation, either version 3 of the License, or
                +1 13348     ; (at your option) any later version.
                +1 13349     ;
                +1 13350     ; BLHeli is distributed in the hope that it will be useful,
                +1 13351     ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                +1 13352     ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                +1 13353     ; GNU General Public License for more details.
                +1 13354     ;
                +1 13355     ; You should have received a copy of the GNU General Public License
                +1 13356     ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                +1 13357     ;
                +1 13358     ;**** **** **** **** ****
                +1 13359     ;
                +1 13360     ; Hardware definition file "K". Com fets are active low for H/L_N driver and EN_N/PWM driver
                +1 13361     ; X  X  MC X  MB CC MA RC    X  X  Ap Bp Cp Cc Bc Ac    Com fets inverted
                +1 13362     ;
                +1 13363     ;**** **** **** **** ****
                +1 13364     
                +1 13365     
                +1 13366     
                +1 13367     ;*********************
                +1 13368     ; Device SiLabs EFM8BB1x/2x
                +1 13369     ;*********************
                +1 13370     IF MCU_48MHZ == 0
                +1 13371     ;$include (SI_EFM8BB1_Defs.inc)
                +2 13372     ;------------------------------------------------------------------------------
                +2 13373     ; Copyright 2014 Silicon Laboratories, Inc.
                +2 13374     ; All rights reserved. This program and the accompanying materials
                +2 13375     ; are made available under the terms of the Silicon Laboratories End User
                +2 13376     ; License Agreement which accompanies this distribution, and is available at
                +2 13377     ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2 13378     ; Original content and implementation provided by Silicon Laboratories.
                +2 13379     ;------------------------------------------------------------------------------
                +2 13380     ;Supported Devices:
                +2 13381     ;  EFM8BB10F2G
                +2 13382     ;  EFM8BB10F2I
                +2 13383     ;  EFM8BB10F2Y
                +2 13384     ;  EFM8BB10F4G
                +2 13385     ;  EFM8BB10F4I
                +2 13386     ;  EFM8BB10F4Y
                +2 13387     ;  EFM8BB10F8G
                +2 13388     ;  EFM8BB10F8G
                +2 13389     ;  EFM8BB10F8G
                +2 13390     ;  EFM8BB10F8I
                +2 13391     ;  EFM8BB10F8I
                +2 13392     ;  EFM8BB10F8I
                +2 13393     ;  EFM8BB10F8Y
                +2 13394     ;  EFM8BB10F8Y
                +2 13395     ;  EFM8BB10F8Y
                +2 13396     
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   207

                +2 13397     ;-----------------------------------------------------------------------------
                +2 13398     ; Register Definitions
                +2 13399     ;-----------------------------------------------------------------------------
  00E0          +2 13400     ACC      DATA 0E0H; Accumulator                            
  00B3          +2 13401     ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
  00BC          +2 13402     ADC0CF   DATA 0BCH; ADC0 Configuration                     
  00E8          +2 13403     ADC0CN0  DATA 0E8H; ADC0 Control 0                         
  00B2          +2 13404     ADC0CN1  DATA 0B2H; ADC0 Control 1                         
  00C4          +2 13405     ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
  00C3          +2 13406     ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
  00BE          +2 13407     ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
  00BD          +2 13408     ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
  00C6          +2 13409     ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
  00C5          +2 13410     ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
  00BB          +2 13411     ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
  00DF          +2 13412     ADC0PWR  DATA 0DFH; ADC0 Power Control                     
  00B9          +2 13413     ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
  00F0          +2 13414     B        DATA 0F0H; B Register                             
  008E          +2 13415     CKCON0   DATA 08EH; Clock Control 0                        
  00A9          +2 13416     CLKSEL   DATA 0A9H; Clock Select                           
  009B          +2 13417     CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
  009D          +2 13418     CMP0MD   DATA 09DH; Comparator 0 Mode                      
  009F          +2 13419     CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
  00BF          +2 13420     CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
  00AB          +2 13421     CMP1MD   DATA 0ABH; Comparator 1 Mode                      
  00AA          +2 13422     CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
  00D2          +2 13423     CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
  00CE          +2 13424     CRC0CN0  DATA 0CEH; CRC0 Control 0                         
  00D3          +2 13425     CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
  00DE          +2 13426     CRC0DAT  DATA 0DEH; CRC0 Data Output                       
  00CF          +2 13427     CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
  00DD          +2 13428     CRC0IN   DATA 0DDH; CRC0 Data Input                        
  00AD          +2 13429     DERIVID  DATA 0ADH; Derivative Identification              
  00B5          +2 13430     DEVICEID DATA 0B5H; Device Identification                  
  0083          +2 13431     DPH      DATA 083H; Data Pointer High                      
  0082          +2 13432     DPL      DATA 082H; Data Pointer Low                       
  00E6          +2 13433     EIE1     DATA 0E6H; Extended Interrupt Enable 1            
  00F3          +2 13434     EIP1     DATA 0F3H; Extended Interrupt Priority 1          
  00B7          +2 13435     FLKEY    DATA 0B7H; Flash Lock and Key                     
  00C7          +2 13436     HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
  00A8          +2 13437     IE       DATA 0A8H; Interrupt Enable                       
  00B8          +2 13438     IP       DATA 0B8H; Interrupt Priority                     
  00E4          +2 13439     IT01CF   DATA 0E4H; INT0/INT1 Configuration                
  00B1          +2 13440     LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
  0080          +2 13441     P0       DATA 080H; Port 0 Pin Latch                       
  00FE          +2 13442     P0MASK   DATA 0FEH; Port 0 Mask                            
  00FD          +2 13443     P0MAT    DATA 0FDH; Port 0 Match                           
  00F1          +2 13444     P0MDIN   DATA 0F1H; Port 0 Input Mode                      
  00A4          +2 13445     P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
  00D4          +2 13446     P0SKIP   DATA 0D4H; Port 0 Skip                            
  0090          +2 13447     P1       DATA 090H; Port 1 Pin Latch                       
  00EE          +2 13448     P1MASK   DATA 0EEH; Port 1 Mask                            
  00ED          +2 13449     P1MAT    DATA 0EDH; Port 1 Match                           
  00F2          +2 13450     P1MDIN   DATA 0F2H; Port 1 Input Mode                      
  00A5          +2 13451     P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
  00D5          +2 13452     P1SKIP   DATA 0D5H; Port 1 Skip                            
  00A0          +2 13453     P2       DATA 0A0H; Port 2 Pin Latch                       
  00A6          +2 13454     P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
  009E          +2 13455     PCA0CENT DATA 09EH; PCA Center Alignment Enable            
  009C          +2 13456     PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
  00D8          +2 13457     PCA0CN0  DATA 0D8H; PCA Control                            
  00FC          +2 13458     PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
  00EA          +2 13459     PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
  00EC          +2 13460     PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
  00FB          +2 13461     PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
  00E9          +2 13462     PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   208

  00EB          +2 13463     PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
  00DA          +2 13464     PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
  00DB          +2 13465     PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
  00DC          +2 13466     PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
  00FA          +2 13467     PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
  00F9          +2 13468     PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
  00D9          +2 13469     PCA0MD   DATA 0D9H; PCA Mode                               
  0096          +2 13470     PCA0POL  DATA 096H; PCA Output Polarity                    
  00F7          +2 13471     PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
  0087          +2 13472     PCON0    DATA 087H; Power Control                          
  00F6          +2 13473     PRTDRV   DATA 0F6H; Port Drive Strength                    
  008F          +2 13474     PSCTL    DATA 08FH; Program Store Control                  
  00D0          +2 13475     PSW      DATA 0D0H; Program Status Word                    
  00D1          +2 13476     REF0CN   DATA 0D1H; Voltage Reference Control              
  00C9          +2 13477     REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
  00B6          +2 13478     REVID    DATA 0B6H; Revision Identifcation                 
  00EF          +2 13479     RSTSRC   DATA 0EFH; Reset Source                           
  0099          +2 13480     SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
  0098          +2 13481     SCON0    DATA 098H; UART0 Serial Port Control              
  00D6          +2 13482     SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
  00D7          +2 13483     SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
  00C1          +2 13484     SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
  00C0          +2 13485     SMB0CN0  DATA 0C0H; SMBus 0 Control                        
  00C2          +2 13486     SMB0DAT  DATA 0C2H; SMBus 0 Data                           
  00AC          +2 13487     SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
  0081          +2 13488     SP       DATA 081H; Stack Pointer                          
  00A1          +2 13489     SPI0CFG  DATA 0A1H; SPI0 Configuration                     
  00A2          +2 13490     SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
  00F8          +2 13491     SPI0CN0  DATA 0F8H; SPI0 Control                           
  00A3          +2 13492     SPI0DAT  DATA 0A3H; SPI0 Data                              
  0088          +2 13493     TCON     DATA 088H; Timer 0/1 Control                      
  008C          +2 13494     TH0      DATA 08CH; Timer 0 High Byte                      
  008D          +2 13495     TH1      DATA 08DH; Timer 1 High Byte                      
  008A          +2 13496     TL0      DATA 08AH; Timer 0 Low Byte                       
  008B          +2 13497     TL1      DATA 08BH; Timer 1 Low Byte                       
  0089          +2 13498     TMOD     DATA 089H; Timer 0/1 Mode                         
  00C8          +2 13499     TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
  00CD          +2 13500     TMR2H    DATA 0CDH; Timer 2 High Byte                      
  00CC          +2 13501     TMR2L    DATA 0CCH; Timer 2 Low Byte                       
  00CB          +2 13502     TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
  00CA          +2 13503     TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
  0091          +2 13504     TMR3CN0  DATA 091H; Timer 3 Control 0                      
  0095          +2 13505     TMR3H    DATA 095H; Timer 3 High Byte                      
  0094          +2 13506     TMR3L    DATA 094H; Timer 3 Low Byte                       
  0093          +2 13507     TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
  0092          +2 13508     TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
  00FF          +2 13509     VDM0CN   DATA 0FFH; Supply Monitor Control                 
  0097          +2 13510     WDTCN    DATA 097H; Watchdog Timer Control                 
  00E1          +2 13511     XBR0     DATA 0E1H; Port I/O Crossbar 0                    
  00E2          +2 13512     XBR1     DATA 0E2H; Port I/O Crossbar 1                    
  00E3          +2 13513     XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                +2 13514     
                +2 13515     ;------------------------------------------------------------------------------
                +2 13516     ; 16-bit Register Definitions (may not work on all compilers)
                +2 13517     ;------------------------------------------------------------------------------
  00C3          +2 13518     ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
  00BD          +2 13519     ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
  00C5          +2 13520     ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
  0082          +2 13521     DP      DATA 082H ; Data Pointer Low                     
  00FB          +2 13522     PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
  00E9          +2 13523     PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
  00EB          +2 13524     PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
  00F9          +2 13525     PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
  00CC          +2 13526     TMR2    DATA 0CCH ; Timer 2 Low Byte                     
  00CA          +2 13527     TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
  0094          +2 13528     TMR3    DATA 094H ; Timer 3 Low Byte                     
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   209

  0092          +2 13529     TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2 13530     
                +2 13531     ;------------------------------------------------------------------------------
                +2 13532     ; Indirect Register Definitions
                +2 13533     ;------------------------------------------------------------------------------
                +2 13534     
                +2 13535     ;------------------------------------------------------------------------------
                +2 13536     ; Bit Definitions
                +2 13537     ;------------------------------------------------------------------------------
                +2 13538     
                +2 13539     ; ACC 0xE0 (Accumulator)
  00E0          +2 13540     ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
  00E1          +2 13541     ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
  00E2          +2 13542     ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
  00E3          +2 13543     ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
  00E4          +2 13544     ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
  00E5          +2 13545     ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
  00E6          +2 13546     ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
  00E7          +2 13547     ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2 13548     
                +2 13549     ; ADC0CN0 0xE8 (ADC0 Control 0)
  00E8          +2 13550     ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
  00E9          +2 13551     ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
  00EA          +2 13552     ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
  00EB          +2 13553     ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
  00EC          +2 13554     ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
  00ED          +2 13555     ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
  00EE          +2 13556     ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
  00EF          +2 13557     ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2 13558     
                +2 13559     ; B 0xF0 (B Register)
  00F0          +2 13560     B_B0 BIT B.0 ; B Register Bit 0
  00F1          +2 13561     B_B1 BIT B.1 ; B Register Bit 1
  00F2          +2 13562     B_B2 BIT B.2 ; B Register Bit 2
  00F3          +2 13563     B_B3 BIT B.3 ; B Register Bit 3
  00F4          +2 13564     B_B4 BIT B.4 ; B Register Bit 4
  00F5          +2 13565     B_B5 BIT B.5 ; B Register Bit 5
  00F6          +2 13566     B_B6 BIT B.6 ; B Register Bit 6
  00F7          +2 13567     B_B7 BIT B.7 ; B Register Bit 7
                +2 13568     
                +2 13569     ; IE 0xA8 (Interrupt Enable)
  00A8          +2 13570     IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
  00A9          +2 13571     IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
  00AA          +2 13572     IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
  00AB          +2 13573     IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
  00AC          +2 13574     IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
  00AD          +2 13575     IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
  00AE          +2 13576     IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
  00AF          +2 13577     IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2 13578     
                +2 13579     ; IP 0xB8 (Interrupt Priority)
  00B8          +2 13580     IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
  00B9          +2 13581     IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
  00BA          +2 13582     IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
  00BB          +2 13583     IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
  00BC          +2 13584     IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
  00BD          +2 13585     IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
  00BE          +2 13586     IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                +2 13587     
                +2 13588     ; P0 0x80 (Port 0 Pin Latch)
  0080          +2 13589     P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
  0081          +2 13590     P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
  0082          +2 13591     P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
  0083          +2 13592     P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
  0084          +2 13593     P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
  0085          +2 13594     P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   210

  0086          +2 13595     P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
  0087          +2 13596     P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2 13597     
                +2 13598     ; P1 0x90 (Port 1 Pin Latch)
  0090          +2 13599     P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
  0091          +2 13600     P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
  0092          +2 13601     P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
  0093          +2 13602     P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
  0094          +2 13603     P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
  0095          +2 13604     P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
  0096          +2 13605     P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
  0097          +2 13606     P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2 13607     
                +2 13608     ; P2 0xA0 (Port 2 Pin Latch)
  00A0          +2 13609     P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
  00A1          +2 13610     P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2 13611     
                +2 13612     ; PCA0CN0 0xD8 (PCA Control)
  00D8          +2 13613     PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
  00D9          +2 13614     PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
  00DA          +2 13615     PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
  00DE          +2 13616     PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
  00DF          +2 13617     PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2 13618     
                +2 13619     ; PSW 0xD0 (Program Status Word)
  00D0          +2 13620     PSW_PARITY BIT PSW.0 ; Parity Flag               
  00D1          +2 13621     PSW_F1     BIT PSW.1 ; User Flag 1               
  00D2          +2 13622     PSW_OV     BIT PSW.2 ; Overflow Flag             
  00D3          +2 13623     PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
  00D4          +2 13624     PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
  00D5          +2 13625     PSW_F0     BIT PSW.5 ; User Flag 0               
  00D6          +2 13626     PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
  00D7          +2 13627     PSW_CY     BIT PSW.7 ; Carry Flag                
                +2 13628     
                +2 13629     ; SCON0 0x98 (UART0 Serial Port Control)
  0098          +2 13630     SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
  0099          +2 13631     SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
  009A          +2 13632     SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
  009B          +2 13633     SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
  009C          +2 13634     SCON0_REN   BIT SCON0.4 ; Receive Enable                     
  009D          +2 13635     SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
  009F          +2 13636     SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2 13637     
                +2 13638     ; SMB0CN0 0xC0 (SMBus 0 Control)
  00C0          +2 13639     SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
  00C1          +2 13640     SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
  00C2          +2 13641     SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
  00C3          +2 13642     SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
  00C4          +2 13643     SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
  00C5          +2 13644     SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
  00C6          +2 13645     SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
  00C7          +2 13646     SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2 13647     
                +2 13648     ; SPI0CN0 0xF8 (SPI0 Control)
  00F8          +2 13649     SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
  00F9          +2 13650     SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
  00FA          +2 13651     SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
  00FB          +2 13652     SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
  00FC          +2 13653     SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
  00FD          +2 13654     SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
  00FE          +2 13655     SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
  00FF          +2 13656     SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2 13657     
                +2 13658     ; TCON 0x88 (Timer 0/1 Control)
  0088          +2 13659     TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
  0089          +2 13660     TCON_IE0 BIT TCON.1 ; External Interrupt 0   
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   211

  008A          +2 13661     TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
  008B          +2 13662     TCON_IE1 BIT TCON.3 ; External Interrupt 1   
  008C          +2 13663     TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
  008D          +2 13664     TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
  008E          +2 13665     TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
  008F          +2 13666     TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2 13667     
                +2 13668     ; TMR2CN0 0xC8 (Timer 2 Control 0)
  00C8          +2 13669     TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
  00CA          +2 13670     TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
  00CB          +2 13671     TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
  00CC          +2 13672     TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
  00CD          +2 13673     TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
  00CE          +2 13674     TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
  00CF          +2 13675     TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                +2 13676     
                +2 13677     ;------------------------------------------------------------------------------
                +2 13678     ; Interrupt Definitions
                +2 13679     ;------------------------------------------------------------------------------
  0000          +2 13680     INT0_IRQn    EQU 0  ; External Interrupt 0      
  0001          +2 13681     TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
  0002          +2 13682     INT1_IRQn    EQU 2  ; External Interrupt 1      
  0003          +2 13683     TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
  0004          +2 13684     UART0_IRQn   EQU 4  ; UART0                     
  0005          +2 13685     TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
  0006          +2 13686     SPI0_IRQn    EQU 6  ; SPI0                      
  0007          +2 13687     SMBUS0_IRQn  EQU 7  ; SMBus 0                   
  0008          +2 13688     PMATCH_IRQn  EQU 8  ; Port Match                
  0009          +2 13689     ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
  000A          +2 13690     ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
  000B          +2 13691     PCA0_IRQn    EQU 11 ; PCA0                      
  000C          +2 13692     CMP0_IRQn    EQU 12 ; Comparator 0              
  000D          +2 13693     CMP1_IRQn    EQU 13 ; Comparator 1              
  000E          +2 13694     TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +1 13695     
                +1 13696     ELSE
                +1           ;$include (SI_EFM8BB2_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB21F16G_QFN20
                +2           ;  EFM8BB21F16G_QSOP24
                +2           ;  EFM8BB21F16I_QFN20
                +2           ;  EFM8BB21F16I_QSOP24
                +2           ;  EFM8BB22F16G_QFN28
                +2           ;  EFM8BB22F16I_QFN28
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC       DATA 0E0H; Accumulator                            
                +2           ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF    DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   212

                +2           ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B         DATA 0F0H; B Register                             
                +2           CKCON0    DATA 08EH; Clock Control 0                        
                +2           CKCON1    DATA 0A6H; Clock Control 1
                +2           CLKSEL    DATA 0A9H; Clock Select                           
                +2           CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0CN1   DATA 099H; Comparator 0 Control 1
                +2           CMP0MD    DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                +2           CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CN1   DATA 086H; CRC0 Control 1                         
                +2           CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN    DATA 0DDH; CRC0 Data Input                        
                +2           CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                +2           DERIVID   DATA 0ADH; Derivative Identification              
                +2           DEVICEID  DATA 0B5H; Device Identification                  
                +2           DPH       DATA 083H; Data Pointer High                      
                +2           DPL       DATA 082H; Data Pointer Low                       
                +2           EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                +2           EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                +2           EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                +2           EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                +2           EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                +2           EMI0CN    DATA 0E7H; External Memory Interface Control      
                +2           FLKEY     DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                +2           HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                +2           I2C0CN0   DATA 0BAH; I2C0 Control                           
                +2           I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                +2           I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                +2           I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                +2           I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                +2           I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                +2           I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                +2           I2C0STAT  DATA 0B9H; I2C0 Status                            
                +2           IE        DATA 0A8H; Interrupt Enable                       
                +2           IP        DATA 0B8H; Interrupt Priority                     
                +2           IPH       DATA 0F2H; Interrupt Priority High                
                +2           IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0        DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK    DATA 0FEH; Port 0 Mask                            
                +2           P0MAT     DATA 0FDH; Port 0 Match                           
                +2           P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP    DATA 0D4H; Port 0 Skip                            
                +2           P1        DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK    DATA 0EEH; Port 1 Mask                            
                +2           P1MAT     DATA 0EDH; Port 1 Match                           
                +2           P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP    DATA 0D5H; Port 1 Skip                            
                +2           P2        DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MASK    DATA 0FCH; Port 2 Mask                            
                +2           P2MAT     DATA 0FBH; Port 2 Match                           
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   213

                +2           P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                +2           P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                +2           P2SKIP    DATA 0CCH; Port 2 Skip                            
                +2           P3        DATA 0B0H; Port 3 Pin Latch                       
                +2           P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                +2           P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                +2           PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0   DATA 0D8H; PCA Control                            
                +2           PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD    DATA 0D9H; PCA Mode                               
                +2           PCA0POL   DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0     DATA 087H; Power Control                          
                +2           PCON1     DATA 09AH; Power Control 1                        
                +2           PFE0CN    DATA 0C1H; Prefetch Engine Control                
                +2           PRTDRV    DATA 0F6H; Port Drive Strength                    
                +2           PSCTL     DATA 08FH; Program Store Control                  
                +2           PSW       DATA 0D0H; Program Status Word                    
                +2           REF0CN    DATA 0D1H; Voltage Reference Control              
                +2           REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                +2           REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                +2           REVID     DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC    DATA 0EFH; Reset Source                           
                +2           SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                +2           SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                +2           SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                +2           SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                +2           SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                +2           SCON0     DATA 098H; UART0 Serial Port Control              
                +2           SCON1     DATA 0C8H; UART1 Serial Port Control              
                +2           SFRPAGE   DATA 0A7H; SFR Page                               
                +2           SFRPGCN   DATA 0CFH; SFR Page Control                       
                +2           SFRSTACK  DATA 0D7H; SFR Page Stack                         
                +2           SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                +2           SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                +2           SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                +2           SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                +2           SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                +2           SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SMOD1     DATA 093H; UART1 Mode                             
                +2           SP        DATA 081H; Stack Pointer                          
                +2           SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0   DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT   DATA 0A3H; SPI0 Data                              
                +2           SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                +2           SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                +2           SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                +2           TCON      DATA 088H; Timer 0/1 Control                      
                +2           TH0       DATA 08CH; Timer 0 High Byte                      
                +2           TH1       DATA 08DH; Timer 1 High Byte                      
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   214

                +2           TL0       DATA 08AH; Timer 0 Low Byte                       
                +2           TL1       DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD      DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                +2           TMR2H     DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0   DATA 091H; Timer 3 Control 0                      
                +2           TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                +2           TMR3H     DATA 095H; Timer 3 High Byte                      
                +2           TMR3L     DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                +2           TMR4CN0   DATA 098H; Timer 4 Control 0                      
                +2           TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                +2           TMR4H     DATA 0A5H; Timer 4 High Byte                      
                +2           TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                +2           TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                +2           TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                +2           UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                +2           UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                +2           UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                +2           UART1LIN  DATA 09EH; UART1 LIN Configuration                
                +2           VDM0CN    DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN     DATA 097H; Watchdog Timer Control                 
                +2           XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                +2           TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   215

                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                +2           P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   216

                +2           
                +2           ; P3 0xB0 (Port 3 Pin Latch)
                +2           P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                +2           P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SCON1 0xC8 (UART1 Serial Port Control)
                +2           SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                +2           SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                +2           SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                +2           SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                +2           SCON1_REN  BIT SCON1.4 ; Receive Enable           
                +2           SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                +2           SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   217

                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                +2           TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                +2           
                +2           ; TMR4CN0 0x98 (Timer 4 Control 0)
                +2           TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                +2           TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                +2           TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                +2           TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                +2           TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                +2           TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                +2           TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                +2           TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                +2           
                +2           ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                +2           UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                +2           UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                +2           UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                +2           UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                +2           UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                +2           UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                +2           UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                +2           UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +2           UART1_IRQn   EQU 17 ; UART1                     
                +2           I2C0_IRQn    EQU 18 ; I2C0 Slave                
                +2           TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; SFR Page Definitions
                +2           ;------------------------------------------------------------------------------
                +2           CRC0_PAGE       EQU 000H ; CRC0 Page       
                +2           LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                +2           PCA0_PAGE       EQU 000H ; PCA0 Page       
                +2           PG2_PAGE        EQU 010H ; Page2           
                +2           TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                +2           TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                +2           TIMER4_PAGE     EQU 010H ; Timer 4 Page    
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   218

                +2           I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                +2           PG3_PAGE        EQU 020H ; Page3           
                +2           SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                +2           SPI0_PAGE       EQU 020H ; SPI0 Page       
                +2           UART0_PAGE      EQU 020H ; UART0 Page      
                +2           UART1_PAGE      EQU 020H ; UART1 Page      
                +1           
                +1           ENDIF
                +1 14131     
                +1 14132     
                +1 14133     ;**** **** **** **** ****
                +1 14134     ; Uses internal calibrated oscillator set to 24/48Mhz
                +1 14135     ;**** **** **** **** ****
                +1 14136     
                +1 14137     ;**** **** **** **** ****
                +1 14138     ; Constant definitions
                +1 14139     ;**** **** **** **** ****
                +1 14140     IF MCU_48MHZ == 0
----            +1 14141     CSEG AT 1A40h
                +1 14142     IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#K_L_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#K_L_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#K_L_10#        "
                +1           ELSEIF FETON_DELAY == 15
1A40 234B5F4C   +1 14149     Eep_ESC_Layout:         DB      "#K_L_15#        "
1A44 5F313523                
1A48 20202020                
1A4C 20202020                
                +1 14150     ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#K_L_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#K_L_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#K_L_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#K_L_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#K_L_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#K_L_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#K_L_90#        "
                +1           ENDIF
----            +1 14165     CSEG AT 1A50h
1A50 23424C48   +1 14166     Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (16 B
                             ytes)
1A54 454C4924                
1A58 45464D38                
1A5C 42313023                
                +1 14167     
                +1 14168     ELSE
                +1           
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#K_H_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#K_H_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#K_H_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#K_H_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#K_H_20#        "
                +1           ELSEIF FETON_DELAY == 25
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   219

                +1           Eep_ESC_Layout:         DB      "#K_H_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#K_H_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#K_H_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#K_H_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#K_H_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#K_H_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (16 B
                             ytes)
                +1           ENDIF
                +1 14197     
  0031          +1 14198     TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for whi
                             ch main motor power is limited at 80degC (low byte, assuming high byte is 1)
  0009          +1 14199     TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment for a
                             nother 10degC
                +1 14200     
                +1 14201     ;**** **** **** **** ****
                +1 14202     ; Bootloader definitions
                +1 14203     ;**** **** **** **** ****
  0080          +1 14204     RTX_PORT                                EQU     P0              ; Receive/Transmit port
  00A4          +1 14205     RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL            
                                          
  00F1          +1 14206     RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL             
                                          
  00D4          +1 14207     RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP                
                                          
  0000          +1 14208     RTX_PIN                                 EQU     0               ; RTX pin
                +1 14209     
  00E8          +1 14210     SIGNATURE_001                   EQU     0E8h            ; Device signature
                +1 14211     IF MCU_48MHZ == 0
  00B1          +1 14212     SIGNATURE_002                   EQU     0B1h
                +1 14213     ELSE
                +1           SIGNATURE_002                   EQU     0B2h
                +1           ENDIF
                +1 14216     
                +1 14217     
                +1 14218     ;*********************
                +1 14219     ; PORT 0 definitions *
                +1 14220     ;*********************  
                +1 14221     ;                       EQU     7       ;i
                +1 14222     ;                       EQU     6       ;i
  0005          +1 14223     Mux_C           EQU     5       ;i
                +1 14224     ;                       EQU     4       ;i
  0003          +1 14225     Mux_B           EQU     3       ;i
  0002          +1 14226     Comp_Com        EQU     2       ;i
  0001          +1 14227     Mux_A           EQU     1       ;i
  0000          +1 14228     Rcp_In          EQU     0       ;i
                +1 14229     
  FFD1          +1 14230     P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
  00FF          +1 14231     P0_INIT         EQU     0FFh
  0000          +1 14232     P0_PUSHPULL     EQU     0
  00FF          +1 14233     P0_SKIP         EQU     0FFh
                +1 14234     
                +1 14235     Get_Rcp_Capture_Values MACRO
                +1 14236             anl     TCON, #0EFh                             ; Disable timer0
                +1 14237             mov     Temp1, TL0                              ; Get timer0 values
                +1 14238             mov     Temp2, TH0
                +1 14239     IF MCU_48MHZ == 1
                +1 14240             mov     Temp3, Timer0_X
                +1 14241             jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   220

                +1 14242             inc     Temp3                                   ; If it is pending, then timer has 
                             already wrapped
                +1 14243     ENDIF
                +1 14244             mov     TL0, #0                                 ; Reset timer0
                +1 14245             mov     TH0, #0
                +1 14246     IF MCU_48MHZ == 1
                +1 14247             mov     Timer0_X, #0
                +1 14248     ENDIF
                +1 14249             orl     TCON, #10h                              ; Enable timer0 again
                +1 14250     IF MCU_48MHZ == 1
                +1 14251             mov     A, Clock_Set_At_48MHz
                +1 14252             jnz     Get_Rcp_End
                +1 14253             clr     C
                +1 14254             mov     A, Temp1
                +1 14255             rlc     A
                +1 14256             mov     Temp1, A
                +1 14257             mov     A, Temp2
                +1 14258             rlc     A
                +1 14259             mov     Temp2, A
                +1 14260             mov     A, Temp3
                +1 14261             rlc     A
                +1 14262             mov     Temp3, A
                +1 14263     Get_Rcp_End:
                +1 14264     ENDIF
                +1 14265     ENDM
                +1 14266     Decode_Dshot_2Msb MACRO
                +1 14267             movx    A, @DPTR
                +1 14268             mov     Temp6, A
                +1 14269             clr     C
                +1 14270             subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1 14271             clr     C
                +1 14272             subb    A, Temp1
                +1 14273             jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                +1 14274     
                +1 14275             subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1 14276             mov     A, Temp4                                        ; Shift bit into data byte
                +1 14277             rlc     A
                +1 14278             mov     Temp4, A
                +1 14279             inc     DPL                                             ; Next bit
                +1 14280             movx    A, @DPTR
                +1 14281             mov     Temp5, A
                +1 14282             clr     C
                +1 14283             subb    A, Temp6
                +1 14284             clr     C
                +1 14285             subb    A, Temp1
                +1 14286             jc      t1_int_msb_fail
                +1 14287     
                +1 14288             subb    A, Temp1
                +1 14289             mov     A, Temp4
                +1 14290             rlc     A
                +1 14291             mov     Temp4, A
                +1 14292             inc     DPL
                +1 14293     ENDM
                +1 14294     Decode_Dshot_2Lsb MACRO
                +1 14295             movx    A, @DPTR
                +1 14296             mov     Temp6, A
                +1 14297             clr     C
                +1 14298             subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1 14299             clr     C
                +1 14300             subb    A, Temp1
                +1 14301             jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                +1 14302     
                +1 14303             subb    A, Temp1                                        ; Check if bit is zero or o
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   221

                             ne
                +1 14304             mov     A, Temp3                                        ; Shift bit into data byte
                +1 14305             rlc     A
                +1 14306             mov     Temp3, A
                +1 14307             inc     DPL                                             ; Next bit
                +1 14308             movx    A, @DPTR
                +1 14309             mov     Temp5, A
                +1 14310             clr     C
                +1 14311             subb    A, Temp6
                +1 14312             clr     C
                +1 14313             subb    A, Temp1
                +1 14314             jc      t1_int_lsb_fail
                +1 14315     
                +1 14316             subb    A, Temp1
                +1 14317             mov     A, Temp3
                +1 14318             rlc     A
                +1 14319             mov     Temp3, A
                +1 14320             inc     DPL
                +1 14321     ENDM
                +1 14322     Initialize_PCA MACRO
                +1 14323             mov     PCA0CN0, #40h                           ; PCA enabled
                +1 14324             mov     PCA0MD, #08h                            ; PCA clock is system clock
                +1 14325     IF FETON_DELAY == 0
                +1 14326     IF MCU_48MHZ == 0
                +1 14327             mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1 14328     ELSE
                +1 14329             mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                +1 14330     ENDIF
                +1 14331             mov     PCA0CENT, #00h                          ; Edge aligned pwm
                +1 14332     ELSE
                +1 14333     IF MCU_48MHZ == 0
                +1 14334             mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                +1 14335     ELSE
                +1 14336             mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1 14337     ENDIF
                +1 14338             mov     PCA0CENT, #03h                          ; Center aligned pwm
                +1 14339     ENDIF
                +1 14340     ENDM
                +1 14341     Set_Pwm_Polarity MACRO
                +1 14342             mov     PCA0POL, #00h                           ; Damping noninverted, pwm noninver
                             ted
                +1 14343     ENDM
                +1 14344     Enable_Power_Pwm_Module MACRO
                +1 14345     IF FETON_DELAY == 0
                +1 14346             mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, enab
                             le match, set pwm mode
                +1 14347     ELSE
                +1 14348             mov     PCA0CPM1, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1 14349     ENDIF
                +1 14350     ENDM
                +1 14351     Enable_Damp_Pwm_Module MACRO
                +1 14352     IF FETON_DELAY == 0
                +1 14353             mov     PCA0CPM1, #00h                          ; Disable
                +1 14354     ELSE
                +1 14355             mov     PCA0CPM0, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1 14356     ENDIF
                +1 14357     ENDM
                +1 14358     Set_Power_Pwm_Regs MACRO
                +1 14359     IF FETON_DELAY == 0
                +1 14360             mov     PCA0CPL0, Power_Pwm_Reg_L
                +1 14361             mov     PCA0CPH0, Power_Pwm_Reg_H
                +1 14362     ELSE
                +1 14363             clr     C
                +1 14364             mov     A, Power_Pwm_Reg_H
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   222

                +1 14365             rrc     A
                +1 14366             mov     Temp1, A
                +1 14367             mov     A, Power_Pwm_Reg_L
                +1 14368             rrc     A
                +1 14369             mov     PCA0CPL1, A
                +1 14370             mov     PCA0CPH1, Temp1
                +1 14371     ENDIF
                +1 14372     ENDM            
                +1 14373     Set_Damp_Pwm_Regs MACRO
                +1 14374     IF FETON_DELAY == 0
                +1 14375             mov     PCA0CPL1, Damp_Pwm_Reg_L
                +1 14376             mov     PCA0CPH1, Damp_Pwm_Reg_H
                +1 14377     ELSE
                +1 14378             clr     C
                +1 14379             mov     A, Damp_Pwm_Reg_H
                +1 14380             rrc     A
                +1 14381             mov     Temp1, A
                +1 14382             mov     A, Damp_Pwm_Reg_L
                +1 14383             rrc     A
                +1 14384             mov     PCA0CPL0, A
                +1 14385             mov     PCA0CPH0, Temp1
                +1 14386     ENDIF
                +1 14387     ENDM            
                +1 14388     Clear_COVF_Interrupt MACRO
                +1 14389             anl     PCA0PWM, #0DFh
                +1 14390     ENDM
                +1 14391     Clear_CCF_Interrupt MACRO       ; CCF interrupt is only used for FETON_DELAY == 0
                +1 14392             anl     PCA0CN0, #0FEh
                +1 14393     ENDM
                +1 14394     Enable_COVF_Interrupt MACRO
                +1 14395             orl     PCA0PWM, #40h
                +1 14396     ENDM
                +1 14397     Enable_CCF_Interrupt MACRO
                +1 14398             orl     PCA0CPM0,#01h
                +1 14399     ENDM
                +1 14400     Disable_COVF_Interrupt MACRO
                +1 14401             anl     PCA0PWM, #0BFh
                +1 14402     ENDM
                +1 14403     Disable_CCF_Interrupt MACRO
                +1 14404             anl     PCA0CPM0,#0FEh
                +1 14405     ENDM
                +1 14406     
                +1 14407     
                +1 14408     ;*********************
                +1 14409     ; PORT 1 definitions *
                +1 14410     ;*********************
                +1 14411     ;                       EQU     7       ;i
                +1 14412     ;                       EQU     6       ;i
  0005          +1 14413     ApwmFET         EQU     5       ;o
  0004          +1 14414     BpwmFET         EQU     4       ;o
  0003          +1 14415     CpwmFET         EQU     3       ;o
  0002          +1 14416     CcomFET         EQU     2       ;o
  0001          +1 14417     BcomFET         EQU     1       ;o
  0000          +1 14418     AcomFET         EQU     0       ;o
                +1 14419     
  003F          +1 14420     P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
  0007          +1 14421     P1_INIT         EQU     (1 SHL AcomFET)+(1 SHL BcomFET)+(1 SHL CcomFET)
  003F          +1 14422     P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
  003F          +1 14423     P1_SKIP         EQU     3Fh
                +1 14424     
                +1 14425     ApwmFET_on MACRO
                +1 14426             setb    P1.ApwmFET
                +1 14427     IF FETON_DELAY == 0
                +1 14428             clr     P1.AcomFET
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   223

                +1 14429     ENDIF
                +1 14430     ENDM
                +1 14431     ApwmFET_off MACRO
                +1 14432     IF FETON_DELAY != 0
                +1 14433             clr     P1.ApwmFET
                +1 14434     ELSE
                +1 14435             setb    P1.AcomFET
                +1 14436     ENDIF
                +1 14437     ENDM
                +1 14438     BpwmFET_on MACRO
                +1 14439             setb    P1.BpwmFET
                +1 14440     IF FETON_DELAY == 0
                +1 14441             clr     P1.BcomFET
                +1 14442     ENDIF
                +1 14443     ENDM
                +1 14444     BpwmFET_off MACRO
                +1 14445     IF FETON_DELAY != 0
                +1 14446             clr     P1.BpwmFET
                +1 14447     ELSE
                +1 14448             setb    P1.BcomFET
                +1 14449     ENDIF
                +1 14450     ENDM
                +1 14451     CpwmFET_on MACRO
                +1 14452             setb    P1.CpwmFET
                +1 14453     IF FETON_DELAY == 0
                +1 14454             clr     P1.CcomFET
                +1 14455     ENDIF
                +1 14456     ENDM
                +1 14457     CpwmFET_off MACRO
                +1 14458     IF FETON_DELAY != 0
                +1 14459             clr     P1.CpwmFET
                +1 14460     ELSE
                +1 14461             setb    P1.CcomFET
                +1 14462     ENDIF
                +1 14463     ENDM
                +1 14464     All_pwmFETs_Off MACRO
                +1 14465     IF FETON_DELAY != 0
                +1 14466             clr     P1.ApwmFET
                +1 14467             clr     P1.BpwmFET
                +1 14468             clr     P1.CpwmFET
                +1 14469     ELSE
                +1 14470             setb    P1.AcomFET
                +1 14471             setb    P1.BcomFET
                +1 14472             setb    P1.CcomFET
                +1 14473     ENDIF
                +1 14474     ENDM
                +1 14475     
                +1 14476     AcomFET_on MACRO
                +1 14477     IF FETON_DELAY == 0
                +1 14478             clr     P1.ApwmFET
                +1 14479     ENDIF
                +1 14480             clr     P1.AcomFET
                +1 14481     ENDM
                +1 14482     AcomFET_off MACRO
                +1 14483             setb    P1.AcomFET
                +1 14484     ENDM
                +1 14485     BcomFET_on MACRO
                +1 14486     IF FETON_DELAY == 0
                +1 14487             clr     P1.BpwmFET
                +1 14488     ENDIF
                +1 14489             clr     P1.BcomFET
                +1 14490     ENDM
                +1 14491     BcomFET_off MACRO
                +1 14492             setb    P1.BcomFET
                +1 14493     ENDM
                +1 14494     CcomFET_on MACRO
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   224

                +1 14495     IF FETON_DELAY == 0
                +1 14496             clr     P1.CpwmFET
                +1 14497     ENDIF
                +1 14498             clr     P1.CcomFET
                +1 14499     ENDM
                +1 14500     CcomFET_off MACRO
                +1 14501             setb    P1.CcomFET
                +1 14502     ENDM
                +1 14503     All_comFETs_Off MACRO
                +1 14504             setb    P1.AcomFET
                +1 14505             setb    P1.BcomFET
                +1 14506             setb    P1.CcomFET
                +1 14507     ENDM
                +1 14508     
                +1 14509     Set_Pwm_A MACRO
                +1 14510     IF FETON_DELAY == 0
                +1 14511             clr     P1.AcomFET
                +1 14512             mov     P1SKIP, #1Fh
                +1 14513     ELSE
                +1 14514             mov     P1SKIP, #1Eh
                +1 14515     ENDIF
                +1 14516     ENDM
                +1 14517     Set_Pwm_B MACRO
                +1 14518     IF FETON_DELAY == 0
                +1 14519             clr     P1.BcomFET
                +1 14520             mov     P1SKIP, #2Fh
                +1 14521     ELSE
                +1 14522             mov     P1SKIP, #2Dh
                +1 14523     ENDIF
                +1 14524     ENDM
                +1 14525     Set_Pwm_C MACRO
                +1 14526     IF FETON_DELAY == 0
                +1 14527             clr     P1.CcomFET
                +1 14528             mov     P1SKIP, #37h
                +1 14529     ELSE
                +1 14530             mov     P1SKIP, #33h
                +1 14531     ENDIF
                +1 14532     ENDM
                +1 14533     Set_Pwms_Off MACRO
                +1 14534             mov     P1SKIP, #3Fh
                +1 14535     ENDM
                +1 14536     
                +1 14537     Set_Comp_Phase_A MACRO
                +1 14538             mov     CMP0MX, #12h    ; Set comparator multiplexer to phase A
                +1 14539     ENDM
                +1 14540     Set_Comp_Phase_B MACRO
                +1 14541             mov     CMP0MX, #32h    ; Set comparator multiplexer to phase B
                +1 14542     ENDM
                +1 14543     Set_Comp_Phase_C MACRO
                +1 14544             mov     CMP0MX, #52h    ; Set comparator multiplexer to phase C
                +1 14545     ENDM
                +1 14546     Read_Comp_Out MACRO
                +1 14547             mov     A, CMP0CN0      ; Read comparator output
                +1 14548     ENDM
                +1 14549     
                +1 14550     
                +1 14551     ;*********************
                +1 14552     ; PORT 2 definitions *
                +1 14553     ;*********************
  0000          +1 14554     DebugPin                EQU     0       ;o
                +1 14555     
  0001          +1 14556     P2_PUSHPULL     EQU     (1 SHL DebugPin)
                +1 14557     
                +1 14558     
                +1 14559     ;**********************
                +1 14560     ; MCU specific macros *
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   225

                +1 14561     ;**********************
                +1 14562     Interrupt_Table_Definition MACRO
                +1 14563     CSEG AT 0                               ; Code segment start
                +1 14564             jmp reset
                +1 14565     CSEG AT 03h                     ; Int0 interrupt        
                +1 14566             jmp     int0_int        
                +1 14567     IF MCU_48MHZ == 1
                +1 14568     CSEG AT 0Bh                     ; Timer0 overflow interrupt
                +1 14569             jmp     t0_int
                +1 14570     ENDIF
                +1 14571     CSEG AT 13h                     ; Int1 interrupt
                +1 14572             jmp     int1_int
                +1 14573     CSEG AT 1Bh                     ; Timer1 overflow interrupt
                +1 14574             jmp     t1_int
                +1 14575     CSEG AT 2Bh                     ; Timer2 overflow interrupt
                +1 14576             jmp     t2_int  
                +1 14577     CSEG AT 5Bh                     ; Pca interrupt
                +1 14578             jmp     pca_int
                +1 14579     CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                +1 14580             jmp     t3_int  
                +1 14581     ENDM
                +1 14582     
                +1 14583     Initialize_Xbar MACRO
                +1 14584             mov     XBR2, #40h      ; Xbar enabled                  
                +1 14585             mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                +1 14586     ENDM
                +1 14587     
                +1 14588     Initialize_Comparator MACRO
                +1 14589             mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                +1 14590             mov     CMP0MD, #00h    ; Comparator response time 100ns
                +1 14591     ENDM
                +1 14592     Initialize_Adc MACRO
                +1 14593             mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bias
                +1 14594     IF MCU_48MHZ == 0
                +1 14595             mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                +1 14596     ELSE
                +1 14597             mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                +1 14598     ENDIF
                +1 14599             mov     ADC0MX, #10h    ; Select temp sensor input
                +1 14600             mov     ADC0CN0, #80h   ; ADC enabled 
                +1 14601             mov     ADC0CN1, #01h   ; Common mode buffer enabled
                +1 14602     ENDM
                +1 14603     Start_Adc MACRO
                +1 14604             mov     ADC0CN0, #90h   ; ADC start
                +1 14605     ENDM
                +1 14606     Read_Adc_Result MACRO
                +1 14607             mov     Temp1, ADC0L
                +1 14608             mov     Temp2, ADC0H
                +1 14609     ENDM
                +1 14610     Stop_Adc MACRO
                +1 14611     ENDM
                +1 14612     Set_RPM_Out MACRO
                +1 14613     ENDM
                +1 14614     Clear_RPM_Out MACRO
                +1 14615     ENDM
                +1 14616     Set_MCU_Clk_24MHz MACRO
                +1 14617             mov     CLKSEL, #13h            ; Set clock to 24MHz
                +1 14618             mov     SFRPAGE, #10h
                +1 14619             mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                +1 14620             mov     SFRPAGE, #00h
                +1 14621             mov     Clock_Set_At_48MHz, #0
                +1 14622     ENDM
                +1 14623     Set_MCU_Clk_48MHz MACRO
                +1 14624             mov     SFRPAGE, #10h
                +1 14625             mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                +1 14626             mov     SFRPAGE, #00h
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   226

                +1 14627             mov     CLKSEL, #03h            ; Set clock to 48MHz
                +1 14628             mov     Clock_Set_At_48MHz, #1
                +1 14629     ENDM
                +1 14630     Set_LED_0 MACRO
                +1 14631     ENDM
                +1 14632     Clear_LED_0 MACRO
                +1 14633     ENDM
                +1 14634     Set_LED_1 MACRO
                +1 14635     ENDM
                +1 14636     Clear_LED_1 MACRO
                +1 14637     ENDM
                +1 14638     Set_LED_2 MACRO
                +1 14639     ENDM
                +1 14640     Clear_LED_2 MACRO
                +1 14641     ENDM
                +1 14642     Set_LED_3 MACRO
                +1 14643     ENDM
                +1 14644     Clear_LED_3 MACRO
                +1 14645     ENDM
                   14646     ENDIF
                   14647     
                   14648     IF ESCNO == L_
                             ;$include (L.inc) ; Select pinout L
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; BLHeli program for controlling brushless motors in helicopters and multirotors
                +1           ;
                +1           ; Copyright 2011, 2012 Steffen Skaug
                +1           ; This program is distributed under the terms of the GNU General Public License
                +1           ;
                +1           ; This file is part of BLHeli.
                +1           ;
                +1           ; BLHeli is free software: you can redistribute it and/or modify
                +1           ; it under the terms of the GNU General Public License as published by
                +1           ; the Free Software Foundation, either version 3 of the License, or
                +1           ; (at your option) any later version.
                +1           ;
                +1           ; BLHeli is distributed in the hope that it will be useful,
                +1           ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                +1           ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                +1           ; GNU General Public License for more details.
                +1           ;
                +1           ; You should have received a copy of the GNU General Public License
                +1           ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                +1           ;
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; Hardware definition file "L"
                +1           ; X  X  RC X  CC MA MB MC    X  X  Ac Bc Cc Ap Bp Cp
                +1           ;
                +1           ;**** **** **** **** ****
                +1           
                +1           
                +1           
                +1           ;*********************
                +1           ; Device SiLabs EFM8BB1x/2x
                +1           ;*********************
                +1           IF MCU_48MHZ == 0
                +1           ;$include (SI_EFM8BB1_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   227

                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB10F2G
                +2           ;  EFM8BB10F2I
                +2           ;  EFM8BB10F2Y
                +2           ;  EFM8BB10F4G
                +2           ;  EFM8BB10F4I
                +2           ;  EFM8BB10F4Y
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC      DATA 0E0H; Accumulator                            
                +2           ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF   DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B        DATA 0F0H; B Register                             
                +2           CKCON0   DATA 08EH; Clock Control 0                        
                +2           CLKSEL   DATA 0A9H; Clock Select                           
                +2           CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0MD   DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                +2           CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN   DATA 0DDH; CRC0 Data Input                        
                +2           DERIVID  DATA 0ADH; Derivative Identification              
                +2           DEVICEID DATA 0B5H; Device Identification                  
                +2           DPH      DATA 083H; Data Pointer High                      
                +2           DPL      DATA 082H; Data Pointer Low                       
                +2           EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                +2           FLKEY    DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           IE       DATA 0A8H; Interrupt Enable                       
                +2           IP       DATA 0B8H; Interrupt Priority                     
                +2           IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0       DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK   DATA 0FEH; Port 0 Mask                            
                +2           P0MAT    DATA 0FDH; Port 0 Match                           
                +2           P0MDIN   DATA 0F1H; Port 0 Input Mode                      
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   228

                +2           P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP   DATA 0D4H; Port 0 Skip                            
                +2           P1       DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK   DATA 0EEH; Port 1 Mask                            
                +2           P1MAT    DATA 0EDH; Port 1 Match                           
                +2           P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP   DATA 0D5H; Port 1 Skip                            
                +2           P2       DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                +2           PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0  DATA 0D8H; PCA Control                            
                +2           PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD   DATA 0D9H; PCA Mode                               
                +2           PCA0POL  DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0    DATA 087H; Power Control                          
                +2           PRTDRV   DATA 0F6H; Port Drive Strength                    
                +2           PSCTL    DATA 08FH; Program Store Control                  
                +2           PSW      DATA 0D0H; Program Status Word                    
                +2           REF0CN   DATA 0D1H; Voltage Reference Control              
                +2           REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                +2           REVID    DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC   DATA 0EFH; Reset Source                           
                +2           SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                +2           SCON0    DATA 098H; UART0 Serial Port Control              
                +2           SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                +2           SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SP       DATA 081H; Stack Pointer                          
                +2           SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0  DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT  DATA 0A3H; SPI0 Data                              
                +2           TCON     DATA 088H; Timer 0/1 Control                      
                +2           TH0      DATA 08CH; Timer 0 High Byte                      
                +2           TH1      DATA 08DH; Timer 1 High Byte                      
                +2           TL0      DATA 08AH; Timer 0 Low Byte                       
                +2           TL1      DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD     DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2H    DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0  DATA 091H; Timer 3 Control 0                      
                +2           TMR3H    DATA 095H; Timer 3 High Byte                      
                +2           TMR3L    DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                +2           VDM0CN   DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN    DATA 097H; Watchdog Timer Control                 
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   229

                +2           XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   230

                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   231

                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +1           
                +1           ELSE
                +1           ;$include (SI_EFM8BB2_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB21F16G_QFN20
                +2           ;  EFM8BB21F16G_QSOP24
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   232

                +2           ;  EFM8BB21F16I_QFN20
                +2           ;  EFM8BB21F16I_QSOP24
                +2           ;  EFM8BB22F16G_QFN28
                +2           ;  EFM8BB22F16I_QFN28
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC       DATA 0E0H; Accumulator                            
                +2           ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF    DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B         DATA 0F0H; B Register                             
                +2           CKCON0    DATA 08EH; Clock Control 0                        
                +2           CKCON1    DATA 0A6H; Clock Control 1
                +2           CLKSEL    DATA 0A9H; Clock Select                           
                +2           CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0CN1   DATA 099H; Comparator 0 Control 1
                +2           CMP0MD    DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                +2           CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CN1   DATA 086H; CRC0 Control 1                         
                +2           CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN    DATA 0DDH; CRC0 Data Input                        
                +2           CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                +2           DERIVID   DATA 0ADH; Derivative Identification              
                +2           DEVICEID  DATA 0B5H; Device Identification                  
                +2           DPH       DATA 083H; Data Pointer High                      
                +2           DPL       DATA 082H; Data Pointer Low                       
                +2           EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                +2           EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                +2           EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                +2           EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                +2           EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                +2           EMI0CN    DATA 0E7H; External Memory Interface Control      
                +2           FLKEY     DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                +2           HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                +2           I2C0CN0   DATA 0BAH; I2C0 Control                           
                +2           I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                +2           I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                +2           I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                +2           I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                +2           I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                +2           I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                +2           I2C0STAT  DATA 0B9H; I2C0 Status                            
                +2           IE        DATA 0A8H; Interrupt Enable                       
                +2           IP        DATA 0B8H; Interrupt Priority                     
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   233

                +2           IPH       DATA 0F2H; Interrupt Priority High                
                +2           IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0        DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK    DATA 0FEH; Port 0 Mask                            
                +2           P0MAT     DATA 0FDH; Port 0 Match                           
                +2           P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP    DATA 0D4H; Port 0 Skip                            
                +2           P1        DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK    DATA 0EEH; Port 1 Mask                            
                +2           P1MAT     DATA 0EDH; Port 1 Match                           
                +2           P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP    DATA 0D5H; Port 1 Skip                            
                +2           P2        DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MASK    DATA 0FCH; Port 2 Mask                            
                +2           P2MAT     DATA 0FBH; Port 2 Match                           
                +2           P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                +2           P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                +2           P2SKIP    DATA 0CCH; Port 2 Skip                            
                +2           P3        DATA 0B0H; Port 3 Pin Latch                       
                +2           P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                +2           P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                +2           PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0   DATA 0D8H; PCA Control                            
                +2           PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD    DATA 0D9H; PCA Mode                               
                +2           PCA0POL   DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0     DATA 087H; Power Control                          
                +2           PCON1     DATA 09AH; Power Control 1                        
                +2           PFE0CN    DATA 0C1H; Prefetch Engine Control                
                +2           PRTDRV    DATA 0F6H; Port Drive Strength                    
                +2           PSCTL     DATA 08FH; Program Store Control                  
                +2           PSW       DATA 0D0H; Program Status Word                    
                +2           REF0CN    DATA 0D1H; Voltage Reference Control              
                +2           REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                +2           REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                +2           REVID     DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC    DATA 0EFH; Reset Source                           
                +2           SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                +2           SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                +2           SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                +2           SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                +2           SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                +2           SCON0     DATA 098H; UART0 Serial Port Control              
                +2           SCON1     DATA 0C8H; UART1 Serial Port Control              
                +2           SFRPAGE   DATA 0A7H; SFR Page                               
                +2           SFRPGCN   DATA 0CFH; SFR Page Control                       
                +2           SFRSTACK  DATA 0D7H; SFR Page Stack                         
                +2           SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0   DATA 0C0H; SMBus 0 Control                        
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   234

                +2           SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                +2           SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                +2           SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                +2           SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                +2           SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                +2           SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SMOD1     DATA 093H; UART1 Mode                             
                +2           SP        DATA 081H; Stack Pointer                          
                +2           SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0   DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT   DATA 0A3H; SPI0 Data                              
                +2           SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                +2           SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                +2           SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                +2           TCON      DATA 088H; Timer 0/1 Control                      
                +2           TH0       DATA 08CH; Timer 0 High Byte                      
                +2           TH1       DATA 08DH; Timer 1 High Byte                      
                +2           TL0       DATA 08AH; Timer 0 Low Byte                       
                +2           TL1       DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD      DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                +2           TMR2H     DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0   DATA 091H; Timer 3 Control 0                      
                +2           TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                +2           TMR3H     DATA 095H; Timer 3 High Byte                      
                +2           TMR3L     DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                +2           TMR4CN0   DATA 098H; Timer 4 Control 0                      
                +2           TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                +2           TMR4H     DATA 0A5H; Timer 4 High Byte                      
                +2           TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                +2           TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                +2           TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                +2           UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                +2           UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                +2           UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                +2           UART1LIN  DATA 09EH; UART1 LIN Configuration                
                +2           VDM0CN    DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN     DATA 097H; Watchdog Timer Control                 
                +2           XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           TMR4    DATA 0A4H ; Timer 4 Low Byte                     
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   235

                +2           TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   236

                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                +2           P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                +2           
                +2           ; P3 0xB0 (Port 3 Pin Latch)
                +2           P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                +2           P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SCON1 0xC8 (UART1 Serial Port Control)
                +2           SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                +2           SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                +2           SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                +2           SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                +2           SCON1_REN  BIT SCON1.4 ; Receive Enable           
                +2           SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                +2           SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   237

                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                +2           TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                +2           
                +2           ; TMR4CN0 0x98 (Timer 4 Control 0)
                +2           TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                +2           TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                +2           TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                +2           TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                +2           TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                +2           TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                +2           TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                +2           TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                +2           
                +2           ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                +2           UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                +2           UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                +2           UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                +2           UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                +2           UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                +2           UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                +2           UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                +2           UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   238

                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +2           UART1_IRQn   EQU 17 ; UART1                     
                +2           I2C0_IRQn    EQU 18 ; I2C0 Slave                
                +2           TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; SFR Page Definitions
                +2           ;------------------------------------------------------------------------------
                +2           CRC0_PAGE       EQU 000H ; CRC0 Page       
                +2           LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                +2           PCA0_PAGE       EQU 000H ; PCA0 Page       
                +2           PG2_PAGE        EQU 010H ; Page2           
                +2           TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                +2           TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                +2           TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                +2           I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                +2           PG3_PAGE        EQU 020H ; Page3           
                +2           SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                +2           SPI0_PAGE       EQU 020H ; SPI0 Page       
                +2           UART0_PAGE      EQU 020H ; UART0 Page      
                +2           UART1_PAGE      EQU 020H ; UART1 Page      
                +1           
                +1           ENDIF
                +1           
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Uses internal calibrated oscillator set to 24/48Mhz
                +1           ;**** **** **** **** ****
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Constant definitions
                +1           ;**** **** **** **** ****
                +1           IF MCU_48MHZ == 0
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#L_L_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#L_L_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#L_L_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#L_L_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#L_L_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#L_L_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#L_L_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#L_L_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#L_L_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#L_L_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#L_L_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (16 B
                             ytes)
                +1           
                +1           ELSE
                +1           
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   239

                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#L_H_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#L_H_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#L_H_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#L_H_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#L_H_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#L_H_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#L_H_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#L_H_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#L_H_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#L_H_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#L_H_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (16 B
                             ytes)
                +1           ENDIF
                +1           
                +1           TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for whi
                             ch main motor power is limited at 80degC (low byte, assuming high byte is 1)
                +1           TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment for a
                             nother 10degC
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Bootloader definitions
                +1           ;**** **** **** **** ****
                +1           RTX_PORT                                EQU     P0              ; Receive/Transmit port
                +1           RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL            
                                          
                +1           RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL             
                                          
                +1           RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP                
                                          
                +1           RTX_PIN                         EQU     5               ; RTX pin
                +1           
                +1           SIGNATURE_001                   EQU     0E8h            ; Device signature
                +1           IF MCU_48MHZ == 0
                +1           SIGNATURE_002                   EQU     0B1h
                +1           ELSE
                +1           SIGNATURE_002                   EQU     0B2h
                +1           ENDIF
                +1           
                +1           ;*********************
                +1           ; PORT 0 definitions *
                +1           ;*********************  
                +1           ;                       EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           Rcp_In          EQU     5       ;i
                +1           ;                       EQU     4       ;i 
                +1           Comp_Com                EQU     3       ;i
                +1           Mux_A           EQU     2       ;i
                +1           Mux_B           EQU     1       ;i
                +1           Mux_C           EQU     0       ;i
                +1           
                +1           P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   240

                +1           P0_INIT         EQU     0FFh
                +1           P0_PUSHPULL     EQU     0
                +1           P0_SKIP         EQU     0FFh
                +1           
                +1           Get_Rcp_Capture_Values MACRO
                +1                   anl     TCON, #0EFh                             ; Disable timer0
                +1                   mov     Temp1, TL0                              ; Get timer0 values
                +1                   mov     Temp2, TH0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Temp3, Timer0_X
                +1                   jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                +1                   inc     Temp3                                   ; If it is pending, then timer has 
                             already wrapped
                +1           ENDIF
                +1                   mov     TL0, #0                                 ; Reset timer0
                +1                   mov     TH0, #0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Timer0_X, #0
                +1           ENDIF
                +1                   orl     TCON, #10h                              ; Enable timer0 again
                +1           IF MCU_48MHZ == 1
                +1                   mov     A, Clock_Set_At_48MHz
                +1                   jnz     Get_Rcp_End
                +1                   clr     C
                +1                   mov     A, Temp1
                +1                   rlc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Temp2
                +1                   rlc     A
                +1                   mov     Temp2, A
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1           Get_Rcp_End:
                +1           ENDIF
                +1           ENDM
                +1           Decode_Dshot_2Msb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp4                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp4
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL
                +1           ENDM
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   241

                +1           Decode_Dshot_2Lsb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp3                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL
                +1           ENDM
                +1           Initialize_PCA MACRO
                +1                   mov     PCA0CN0, #40h                           ; PCA enabled
                +1                   mov     PCA0MD, #08h                            ; PCA clock is system clock
                +1           IF FETON_DELAY == 0
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #00h                          ; Edge aligned pwm
                +1           ELSE
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #03h                          ; Center aligned pwm
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_Polarity MACRO
                +1                   mov     PCA0POL, #02h                           ; Damping inverted, pwm noninverted
                +1           ENDM
                +1           Enable_Power_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, enab
                             le match, set pwm mode
                +1           ELSE
                +1                   mov     PCA0CPM0, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Enable_Damp_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM1, #00h                          ; Disable
                +1           ELSE
                +1                   mov     PCA0CPM1, #42h                          ; Enable comparator of module, set 
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   242

                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Set_Power_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL0, Power_Pwm_Reg_L
                +1                   mov     PCA0CPH0, Power_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Power_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Power_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL0, A
                +1                   mov     PCA0CPH0, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Set_Damp_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL1, Damp_Pwm_Reg_L
                +1                   mov     PCA0CPH1, Damp_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Damp_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Damp_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL1, A
                +1                   mov     PCA0CPH1, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Clear_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0DFh
                +1           ENDM
                +1           Clear_CCF_Interrupt MACRO
                +1                   anl     PCA0CN0, #0FEh
                +1           ENDM
                +1           Enable_COVF_Interrupt MACRO
                +1                   orl     PCA0PWM, #40h
                +1           ENDM
                +1           Enable_CCF_Interrupt MACRO
                +1                   orl     PCA0CPM0,#01h
                +1           ENDM
                +1           Disable_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0BFh
                +1           ENDM
                +1           Disable_CCF_Interrupt MACRO
                +1                   anl     PCA0CPM0,#0FEh
                +1           ENDM
                +1           
                +1           ;*********************
                +1           ; PORT 1 definitions *
                +1           ;*********************
                +1           ;                       EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           AcomFET         EQU     5       ;o
                +1           BcomFET         EQU     4       ;o
                +1           CcomFET         EQU     3       ;o
                +1           ApwmFET         EQU     2       ;o
                +1           BpwmFET         EQU     1       ;o
                +1           CpwmFET         EQU     0       ;o
                +1           
                +1           P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   243

                +1           P1_INIT         EQU     00h             
                +1           P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_SKIP         EQU     3Fh
                +1           
                +1           ApwmFET_on MACRO
                +1                   setb    P1.ApwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           ApwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_on MACRO
                +1                   setb    P1.BpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.BpwmFET
                +1           ELSE
                +1                   clr     P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_on MACRO
                +1                   setb    P1.CpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           All_pwmFETs_Off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1                   clr     P1.BpwmFET
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           
                +1           AcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.ApwmFET
                +1           ENDIF
                +1                   setb    P1.AcomFET
                +1           ENDM
                +1           AcomFET_off MACRO
                +1                   clr     P1.AcomFET
                +1           ENDM
                +1           BcomFET_on MACRO
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   244

                +1           IF FETON_DELAY == 0
                +1                   clr     P1.BpwmFET
                +1           ENDIF
                +1                   setb    P1.BcomFET
                +1           ENDM
                +1           BcomFET_off MACRO
                +1                   clr     P1.BcomFET
                +1           ENDM
                +1           CcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.CpwmFET
                +1           ENDIF
                +1                   setb    P1.CcomFET
                +1           ENDM
                +1           CcomFET_off MACRO
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           All_comFETs_Off MACRO
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           
                +1           Set_Pwm_A MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1                   mov     P1SKIP, #3Bh
                +1           ELSE
                +1                   mov     P1SKIP, #1Bh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_B MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1                   mov     P1SKIP, #3Dh
                +1           ELSE
                +1                   mov     P1SKIP, #2Dh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_C MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1                   mov     P1SKIP, #3Eh
                +1           ELSE
                +1                   mov     P1SKIP, #36h
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwms_Off MACRO
                +1                   mov     P1SKIP, #7Fh
                +1           ENDM
                +1           
                +1           Set_Comp_Phase_A MACRO
                +1                   mov     CMP0MX, #23h    ; Set comparator multiplexer to phase A
                +1           ENDM
                +1           Set_Comp_Phase_B MACRO
                +1                   mov     CMP0MX, #13h    ; Set comparator multiplexer to phase B
                +1           ENDM
                +1           Set_Comp_Phase_C MACRO
                +1                   mov     CMP0MX, #03h    ; Set comparator multiplexer to phase C
                +1           ENDM
                +1           Read_Comp_Out MACRO
                +1                   mov     A, CMP0CN0      ; Read comparator output
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   245

                +1           ; PORT 2 definitions *
                +1           ;*********************
                +1           DebugPin                EQU     0       ;o
                +1           
                +1           P2_PUSHPULL     EQU     (1 SHL DebugPin)
                +1           
                +1           
                +1           ;**********************
                +1           ; MCU specific macros *
                +1           ;**********************
                +1           Interrupt_Table_Definition MACRO
                +1           CSEG AT 0                               ; Code segment start
                +1                   jmp reset
                +1           CSEG AT 03h                     ; Int0 interrupt        
                +1                   jmp     int0_int        
                +1           IF MCU_48MHZ == 1
                +1           CSEG AT 0Bh                     ; Timer0 overflow interrupt
                +1                   jmp     t0_int
                +1           ENDIF
                +1           CSEG AT 13h                     ; Int1 interrupt
                +1                   jmp     int1_int
                +1           CSEG AT 1Bh                     ; Timer1 overflow interrupt
                +1                   jmp     t1_int
                +1           CSEG AT 2Bh                     ; Timer2 overflow interrupt
                +1                   jmp     t2_int  
                +1           CSEG AT 5Bh                     ; Pca interrupt
                +1                   jmp     pca_int
                +1           CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                +1                   jmp     t3_int  
                +1           ENDM
                +1           
                +1           Initialize_Xbar MACRO
                +1                   mov     XBR2, #40h      ; Xbar enabled                  
                +1                   mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                +1           ENDM
                +1           
                +1           Initialize_Comparator MACRO
                +1                   mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                +1                   mov     CMP0MD, #00h    ; Comparator response time 100ns
                +1           ENDM
                +1           Initialize_Adc MACRO
                +1                   mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bias
                +1           IF MCU_48MHZ == 0
                +1                   mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                +1           ELSE
                +1                   mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                +1           ENDIF
                +1                   mov     ADC0MX, #10h    ; Select temp sensor input
                +1                   mov     ADC0CN0, #80h   ; ADC enabled 
                +1                   mov     ADC0CN1, #01h   ; Common mode buffer enabled
                +1           ENDM
                +1           Start_Adc MACRO
                +1                   mov     ADC0CN0, #90h   ; ADC start
                +1           ENDM
                +1           Read_Adc_Result MACRO
                +1                   mov     Temp1, ADC0L
                +1                   mov     Temp2, ADC0H
                +1           ENDM
                +1           Stop_Adc MACRO
                +1           ENDM
                +1           Set_RPM_Out MACRO
                +1           ENDM
                +1           Clear_RPM_Out MACRO
                +1           ENDM
                +1           Set_MCU_Clk_24MHz MACRO
                +1                   mov     CLKSEL, #13h            ; Set clock to 24MHz
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   246

                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     Clock_Set_At_48MHz, #0
                +1           ENDM
                +1           Set_MCU_Clk_48MHz MACRO
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     CLKSEL, #03h            ; Set clock to 48MHz
                +1                   mov     Clock_Set_At_48MHz, #1
                +1           ENDM
                +1           Set_LED_0 MACRO
                +1           ENDM
                +1           Clear_LED_0 MACRO
                +1           ENDM
                +1           Set_LED_1 MACRO
                +1           ENDM
                +1           Clear_LED_1 MACRO
                +1           ENDM
                +1           Set_LED_2 MACRO
                +1           ENDM
                +1           Clear_LED_2 MACRO
                +1           ENDM
                +1           Set_LED_3 MACRO
                +1           ENDM
                +1           Clear_LED_3 MACRO
                +1           ENDM
                             ENDIF
                   15959     
                   15960     IF ESCNO == M_
                             ;$include (M.inc) ; Select pinout M
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; BLHeli program for controlling brushless motors in helicopters and multirotors
                +1           ;
                +1           ; Copyright 2011, 2012 Steffen Skaug
                +1           ; This program is distributed under the terms of the GNU General Public License
                +1           ;
                +1           ; This file is part of BLHeli.
                +1           ;
                +1           ; BLHeli is free software: you can redistribute it and/or modify
                +1           ; it under the terms of the GNU General Public License as published by
                +1           ; the Free Software Foundation, either version 3 of the License, or
                +1           ; (at your option) any later version.
                +1           ;
                +1           ; BLHeli is distributed in the hope that it will be useful,
                +1           ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                +1           ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                +1           ; GNU General Public License for more details.
                +1           ;
                +1           ; You should have received a copy of the GNU General Public License
                +1           ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                +1           ;
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; Hardware definition file "M".
                +1           ; MA MC CC MB RC L0 X  X     X  Cc Bc Ac Cp Bp Ap X     
                +1           ;
                +1           ;**** **** **** **** ****
                +1           
                +1           
                +1           
                +1           ;*********************
                +1           ; Device SiLabs EFM8BB1x/2x
                +1           ;*********************
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   247

                +1           IF MCU_48MHZ == 0
                +1           ;$include (SI_EFM8BB1_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB10F2G
                +2           ;  EFM8BB10F2I
                +2           ;  EFM8BB10F2Y
                +2           ;  EFM8BB10F4G
                +2           ;  EFM8BB10F4I
                +2           ;  EFM8BB10F4Y
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC      DATA 0E0H; Accumulator                            
                +2           ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF   DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B        DATA 0F0H; B Register                             
                +2           CKCON0   DATA 08EH; Clock Control 0                        
                +2           CLKSEL   DATA 0A9H; Clock Select                           
                +2           CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0MD   DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                +2           CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN   DATA 0DDH; CRC0 Data Input                        
                +2           DERIVID  DATA 0ADH; Derivative Identification              
                +2           DEVICEID DATA 0B5H; Device Identification                  
                +2           DPH      DATA 083H; Data Pointer High                      
                +2           DPL      DATA 082H; Data Pointer Low                       
                +2           EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                +2           FLKEY    DATA 0B7H; Flash Lock and Key                     
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   248

                +2           HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           IE       DATA 0A8H; Interrupt Enable                       
                +2           IP       DATA 0B8H; Interrupt Priority                     
                +2           IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0       DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK   DATA 0FEH; Port 0 Mask                            
                +2           P0MAT    DATA 0FDH; Port 0 Match                           
                +2           P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP   DATA 0D4H; Port 0 Skip                            
                +2           P1       DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK   DATA 0EEH; Port 1 Mask                            
                +2           P1MAT    DATA 0EDH; Port 1 Match                           
                +2           P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP   DATA 0D5H; Port 1 Skip                            
                +2           P2       DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                +2           PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0  DATA 0D8H; PCA Control                            
                +2           PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD   DATA 0D9H; PCA Mode                               
                +2           PCA0POL  DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0    DATA 087H; Power Control                          
                +2           PRTDRV   DATA 0F6H; Port Drive Strength                    
                +2           PSCTL    DATA 08FH; Program Store Control                  
                +2           PSW      DATA 0D0H; Program Status Word                    
                +2           REF0CN   DATA 0D1H; Voltage Reference Control              
                +2           REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                +2           REVID    DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC   DATA 0EFH; Reset Source                           
                +2           SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                +2           SCON0    DATA 098H; UART0 Serial Port Control              
                +2           SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                +2           SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SP       DATA 081H; Stack Pointer                          
                +2           SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0  DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT  DATA 0A3H; SPI0 Data                              
                +2           TCON     DATA 088H; Timer 0/1 Control                      
                +2           TH0      DATA 08CH; Timer 0 High Byte                      
                +2           TH1      DATA 08DH; Timer 1 High Byte                      
                +2           TL0      DATA 08AH; Timer 0 Low Byte                       
                +2           TL1      DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD     DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2H    DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L    DATA 0CCH; Timer 2 Low Byte                       
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   249

                +2           TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0  DATA 091H; Timer 3 Control 0                      
                +2           TMR3H    DATA 095H; Timer 3 High Byte                      
                +2           TMR3L    DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                +2           VDM0CN   DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN    DATA 097H; Watchdog Timer Control                 
                +2           XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   250

                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   251

                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +1           
                +1           ELSE
                +1           ;$include (SI_EFM8BB2_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   252

                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB21F16G_QFN20
                +2           ;  EFM8BB21F16G_QSOP24
                +2           ;  EFM8BB21F16I_QFN20
                +2           ;  EFM8BB21F16I_QSOP24
                +2           ;  EFM8BB22F16G_QFN28
                +2           ;  EFM8BB22F16I_QFN28
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC       DATA 0E0H; Accumulator                            
                +2           ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF    DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B         DATA 0F0H; B Register                             
                +2           CKCON0    DATA 08EH; Clock Control 0                        
                +2           CKCON1    DATA 0A6H; Clock Control 1
                +2           CLKSEL    DATA 0A9H; Clock Select                           
                +2           CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0CN1   DATA 099H; Comparator 0 Control 1
                +2           CMP0MD    DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                +2           CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CN1   DATA 086H; CRC0 Control 1                         
                +2           CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN    DATA 0DDH; CRC0 Data Input                        
                +2           CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                +2           DERIVID   DATA 0ADH; Derivative Identification              
                +2           DEVICEID  DATA 0B5H; Device Identification                  
                +2           DPH       DATA 083H; Data Pointer High                      
                +2           DPL       DATA 082H; Data Pointer Low                       
                +2           EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                +2           EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                +2           EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                +2           EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                +2           EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                +2           EMI0CN    DATA 0E7H; External Memory Interface Control      
                +2           FLKEY     DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                +2           HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                +2           I2C0CN0   DATA 0BAH; I2C0 Control                           
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   253

                +2           I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                +2           I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                +2           I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                +2           I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                +2           I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                +2           I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                +2           I2C0STAT  DATA 0B9H; I2C0 Status                            
                +2           IE        DATA 0A8H; Interrupt Enable                       
                +2           IP        DATA 0B8H; Interrupt Priority                     
                +2           IPH       DATA 0F2H; Interrupt Priority High                
                +2           IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0        DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK    DATA 0FEH; Port 0 Mask                            
                +2           P0MAT     DATA 0FDH; Port 0 Match                           
                +2           P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP    DATA 0D4H; Port 0 Skip                            
                +2           P1        DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK    DATA 0EEH; Port 1 Mask                            
                +2           P1MAT     DATA 0EDH; Port 1 Match                           
                +2           P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP    DATA 0D5H; Port 1 Skip                            
                +2           P2        DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MASK    DATA 0FCH; Port 2 Mask                            
                +2           P2MAT     DATA 0FBH; Port 2 Match                           
                +2           P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                +2           P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                +2           P2SKIP    DATA 0CCH; Port 2 Skip                            
                +2           P3        DATA 0B0H; Port 3 Pin Latch                       
                +2           P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                +2           P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                +2           PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0   DATA 0D8H; PCA Control                            
                +2           PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD    DATA 0D9H; PCA Mode                               
                +2           PCA0POL   DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0     DATA 087H; Power Control                          
                +2           PCON1     DATA 09AH; Power Control 1                        
                +2           PFE0CN    DATA 0C1H; Prefetch Engine Control                
                +2           PRTDRV    DATA 0F6H; Port Drive Strength                    
                +2           PSCTL     DATA 08FH; Program Store Control                  
                +2           PSW       DATA 0D0H; Program Status Word                    
                +2           REF0CN    DATA 0D1H; Voltage Reference Control              
                +2           REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                +2           REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                +2           REVID     DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC    DATA 0EFH; Reset Source                           
                +2           SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                +2           SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                +2           SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                +2           SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                +2           SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   254

                +2           SCON0     DATA 098H; UART0 Serial Port Control              
                +2           SCON1     DATA 0C8H; UART1 Serial Port Control              
                +2           SFRPAGE   DATA 0A7H; SFR Page                               
                +2           SFRPGCN   DATA 0CFH; SFR Page Control                       
                +2           SFRSTACK  DATA 0D7H; SFR Page Stack                         
                +2           SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                +2           SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                +2           SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                +2           SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                +2           SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                +2           SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SMOD1     DATA 093H; UART1 Mode                             
                +2           SP        DATA 081H; Stack Pointer                          
                +2           SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0   DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT   DATA 0A3H; SPI0 Data                              
                +2           SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                +2           SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                +2           SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                +2           TCON      DATA 088H; Timer 0/1 Control                      
                +2           TH0       DATA 08CH; Timer 0 High Byte                      
                +2           TH1       DATA 08DH; Timer 1 High Byte                      
                +2           TL0       DATA 08AH; Timer 0 Low Byte                       
                +2           TL1       DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD      DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                +2           TMR2H     DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0   DATA 091H; Timer 3 Control 0                      
                +2           TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                +2           TMR3H     DATA 095H; Timer 3 High Byte                      
                +2           TMR3L     DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                +2           TMR4CN0   DATA 098H; Timer 4 Control 0                      
                +2           TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                +2           TMR4H     DATA 0A5H; Timer 4 High Byte                      
                +2           TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                +2           TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                +2           TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                +2           UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                +2           UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                +2           UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                +2           UART1LIN  DATA 09EH; UART1 LIN Configuration                
                +2           VDM0CN    DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN     DATA 097H; Watchdog Timer Control                 
                +2           XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   255

                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                +2           TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   256

                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                +2           P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                +2           
                +2           ; P3 0xB0 (Port 3 Pin Latch)
                +2           P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                +2           P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SCON1 0xC8 (UART1 Serial Port Control)
                +2           SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                +2           SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                +2           SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                +2           SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                +2           SCON1_REN  BIT SCON1.4 ; Receive Enable           
                +2           SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                +2           SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   257

                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                +2           TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                +2           
                +2           ; TMR4CN0 0x98 (Timer 4 Control 0)
                +2           TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                +2           TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                +2           TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                +2           TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                +2           TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                +2           TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                +2           TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                +2           TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                +2           
                +2           ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                +2           UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                +2           UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                +2           UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                +2           UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                +2           UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                +2           UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                +2           UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                +2           UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   258

                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +2           UART1_IRQn   EQU 17 ; UART1                     
                +2           I2C0_IRQn    EQU 18 ; I2C0 Slave                
                +2           TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; SFR Page Definitions
                +2           ;------------------------------------------------------------------------------
                +2           CRC0_PAGE       EQU 000H ; CRC0 Page       
                +2           LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                +2           PCA0_PAGE       EQU 000H ; PCA0 Page       
                +2           PG2_PAGE        EQU 010H ; Page2           
                +2           TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                +2           TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                +2           TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                +2           I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                +2           PG3_PAGE        EQU 020H ; Page3           
                +2           SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                +2           SPI0_PAGE       EQU 020H ; SPI0 Page       
                +2           UART0_PAGE      EQU 020H ; UART0 Page      
                +2           UART1_PAGE      EQU 020H ; UART1 Page      
                +1           
                +1           ENDIF
                +1           
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Uses internal calibrated oscillator set to 24/48Mhz
                +1           ;**** **** **** **** ****
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Constant definitions
                +1           ;**** **** **** **** ****
                +1           IF MCU_48MHZ == 0
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#M_L_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#M_L_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#M_L_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#M_L_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#M_L_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#M_L_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#M_L_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#M_L_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#M_L_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#M_L_70#        "
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   259

                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#M_L_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (16 B
                             ytes)
                +1           
                +1           ELSE
                +1           
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#M_H_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#M_H_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#M_H_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#M_H_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#M_H_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#M_H_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#M_H_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#M_H_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#M_H_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#M_H_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#M_H_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (16 B
                             ytes)
                +1           ENDIF
                +1           
                +1           TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for whi
                             ch main motor power is limited at 80degC (low byte, assuming high byte is 1)
                +1           TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment for a
                             nother 10degC
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Bootloader definitions
                +1           ;**** **** **** **** ****
                +1           RTX_PORT                                EQU     P0              ; Receive/Transmit port
                +1           RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL            
                                          
                +1           RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL             
                                          
                +1           RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP                
                                          
                +1           RTX_PIN                         EQU     3               ; RTX pin
                +1           
                +1           SIGNATURE_001                   EQU     0E8h            ; Device signature
                +1           IF MCU_48MHZ == 0
                +1           SIGNATURE_002                   EQU     0B1h
                +1           ELSE
                +1           SIGNATURE_002                   EQU     0B2h
                +1           ENDIF
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 0 definitions *
                +1           ;*********************  
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   260

                +1           Mux_A           EQU     7       ;i
                +1           Mux_C           EQU     6       ;i
                +1           Comp_Com        EQU     5       ;i
                +1           Mux_B           EQU     4       ;i
                +1           Rcp_In          EQU     3       ;i
                +1           LED_0           EQU     2       ;i
                +1           ;                       EQU     1       ;i
                +1           ;                       EQU     0       ;i
                +1           
                +1           P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                +1           P0_INIT         EQU     NOT(1 SHL LED_0)
                +1           P0_PUSHPULL     EQU     (1 SHL LED_0)
                +1           P0_SKIP         EQU     0FFh
                +1           
                +1           Get_Rcp_Capture_Values MACRO
                +1                   anl     TCON, #0EFh                             ; Disable timer0
                +1                   mov     Temp1, TL0                              ; Get timer0 values
                +1                   mov     Temp2, TH0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Temp3, Timer0_X
                +1                   jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                +1                   inc     Temp3                                   ; If it is pending, then timer has 
                             already wrapped
                +1           ENDIF
                +1                   mov     TL0, #0                                 ; Reset timer0
                +1                   mov     TH0, #0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Timer0_X, #0
                +1           ENDIF
                +1                   orl     TCON, #10h                              ; Enable timer0 again
                +1           IF MCU_48MHZ == 1
                +1                   mov     A, Clock_Set_At_48MHz
                +1                   jnz     Get_Rcp_End
                +1                   clr     C
                +1                   mov     A, Temp1
                +1                   rlc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Temp2
                +1                   rlc     A
                +1                   mov     Temp2, A
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1           Get_Rcp_End:
                +1           ENDIF
                +1           ENDM
                +1           Decode_Dshot_2Msb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp4                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   261

                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp4
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL
                +1           ENDM
                +1           Decode_Dshot_2Lsb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp3                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL
                +1           ENDM
                +1           Initialize_PCA MACRO
                +1                   mov     PCA0CN0, #40h                           ; PCA enabled
                +1                   mov     PCA0MD, #08h                            ; PCA clock is system clock
                +1           IF FETON_DELAY == 0
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #00h                          ; Edge aligned pwm
                +1           ELSE
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #03h                          ; Center aligned pwm
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_Polarity MACRO
                +1                   mov     PCA0POL, #02h                           ; Damping inverted, pwm noninverted
                +1           ENDM
                +1           Enable_Power_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, enab
                             le match, set pwm mode
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   262

                +1           ELSE
                +1                   mov     PCA0CPM0, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Enable_Damp_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM1, #00h                          ; Disable
                +1           ELSE
                +1                   mov     PCA0CPM1, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Set_Power_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL0, Power_Pwm_Reg_L
                +1                   mov     PCA0CPH0, Power_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Power_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Power_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL0, A
                +1                   mov     PCA0CPH0, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Set_Damp_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL1, Damp_Pwm_Reg_L
                +1                   mov     PCA0CPH1, Damp_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Damp_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Damp_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL1, A
                +1                   mov     PCA0CPH1, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Clear_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0DFh
                +1           ENDM
                +1           Clear_CCF_Interrupt MACRO
                +1                   anl     PCA0CN0, #0FEh
                +1           ENDM
                +1           Enable_COVF_Interrupt MACRO
                +1                   orl     PCA0PWM, #40h
                +1           ENDM
                +1           Enable_CCF_Interrupt MACRO
                +1                   orl     PCA0CPM0,#01h
                +1           ENDM
                +1           Disable_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0BFh
                +1           ENDM
                +1           Disable_CCF_Interrupt MACRO
                +1                   anl     PCA0CPM0,#0FEh
                +1           ENDM
                +1           
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 1 definitions *
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   263

                +1           ;*********************
                +1           ;                       EQU     7       ;i
                +1           CcomFET         EQU     6       ;o
                +1           BcomFET         EQU     5       ;o
                +1           AcomFET         EQU     4       ;o
                +1           CpwmFET         EQU     3       ;i
                +1           BpwmFET         EQU     2       ;o 
                +1           ApwmFET         EQU     1       ;o
                +1           ;                       EQU     0       ;o
                +1           
                +1           P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_INIT         EQU     00h             
                +1           P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_SKIP         EQU     7Fh
                +1           
                +1           ApwmFET_on MACRO
                +1                   setb    P1.ApwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           ApwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_on MACRO
                +1                   setb    P1.BpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.BpwmFET
                +1           ELSE
                +1                   clr     P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_on MACRO
                +1                   setb    P1.CpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           All_pwmFETs_Off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1                   clr     P1.BpwmFET
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDIF
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   264

                +1           ENDM
                +1           
                +1           AcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.ApwmFET
                +1           ENDIF
                +1                   setb    P1.AcomFET
                +1           ENDM
                +1           AcomFET_off MACRO
                +1                   clr     P1.AcomFET
                +1           ENDM
                +1           BcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.BpwmFET
                +1           ENDIF
                +1                   setb    P1.BcomFET
                +1           ENDM
                +1           BcomFET_off MACRO
                +1                   clr     P1.BcomFET
                +1           ENDM
                +1           CcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.CpwmFET
                +1           ENDIF
                +1                   setb    P1.CcomFET
                +1           ENDM
                +1           CcomFET_off MACRO
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           All_comFETs_Off MACRO
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           
                +1           Set_Pwm_A MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1                   mov     P1SKIP, #7Dh
                +1           ELSE
                +1                   mov     P1SKIP, #6Dh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_B MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1                   mov     P1SKIP, #7Bh
                +1           ELSE
                +1                   mov     P1SKIP, #5Bh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_C MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1                   mov     P1SKIP, #77h
                +1           ELSE
                +1                   mov     P1SKIP, #37h
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwms_Off MACRO
                +1                   mov     P1SKIP, #7Fh
                +1           ENDM
                +1           
                +1           Set_Comp_Phase_A MACRO
                +1                   mov     CMP0MX, #75h    ; Set comparator multiplexer to phase A
                +1           ENDM
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   265

                +1           Set_Comp_Phase_B MACRO
                +1                   mov     CMP0MX, #45h    ; Set comparator multiplexer to phase B
                +1           ENDM
                +1           Set_Comp_Phase_C MACRO
                +1                   mov     CMP0MX, #65h    ; Set comparator multiplexer to phase C
                +1           ENDM
                +1           Read_Comp_Out MACRO
                +1                   mov     A, CMP0CN0      ; Read comparator output
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 2 definitions *
                +1           ;*********************
                +1           DebugPin                EQU     0       ;o
                +1           
                +1           P2_PUSHPULL     EQU     (1 SHL DebugPin)
                +1           
                +1           
                +1           ;**********************
                +1           ; MCU specific macros *
                +1           ;**********************
                +1           Interrupt_Table_Definition MACRO
                +1           CSEG AT 0                               ; Code segment start
                +1                   jmp reset
                +1           CSEG AT 03h                     ; Int0 interrupt        
                +1                   jmp     int0_int        
                +1           IF MCU_48MHZ == 1
                +1           CSEG AT 0Bh                     ; Timer0 overflow interrupt
                +1                   jmp     t0_int
                +1           ENDIF
                +1           CSEG AT 13h                     ; Int1 interrupt
                +1                   jmp     int1_int
                +1           CSEG AT 1Bh                     ; Timer1 overflow interrupt
                +1                   jmp     t1_int
                +1           CSEG AT 2Bh                     ; Timer2 overflow interrupt
                +1                   jmp     t2_int  
                +1           CSEG AT 5Bh                     ; Pca interrupt
                +1                   jmp     pca_int
                +1           CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                +1                   jmp     t3_int  
                +1           ENDM
                +1           
                +1           Initialize_Xbar MACRO
                +1                   mov     XBR2, #40h      ; Xbar enabled                  
                +1                   mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                +1           ENDM
                +1           
                +1           Initialize_Comparator MACRO
                +1                   mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                +1                   mov     CMP0MD, #00h    ; Comparator response time 100ns
                +1           ENDM
                +1           Initialize_Adc MACRO
                +1                   mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bias
                +1           IF MCU_48MHZ == 0
                +1                   mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                +1           ELSE
                +1                   mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                +1           ENDIF
                +1                   mov     ADC0MX, #10h    ; Select temp sensor input
                +1                   mov     ADC0CN0, #80h   ; ADC enabled 
                +1                   mov     ADC0CN1, #01h   ; Common mode buffer enabled
                +1           ENDM
                +1           Start_Adc MACRO
                +1                   mov     ADC0CN0, #90h   ; ADC start
                +1           ENDM
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   266

                +1           Read_Adc_Result MACRO
                +1                   mov     Temp1, ADC0L
                +1                   mov     Temp2, ADC0H
                +1           ENDM
                +1           Stop_Adc MACRO
                +1           ENDM
                +1           Set_RPM_Out MACRO
                +1           ENDM
                +1           Clear_RPM_Out MACRO
                +1           ENDM
                +1           Set_MCU_Clk_24MHz MACRO
                +1                   mov     CLKSEL, #13h            ; Set clock to 24MHz
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     Clock_Set_At_48MHz, #0
                +1           ENDM
                +1           Set_MCU_Clk_48MHz MACRO
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     CLKSEL, #03h            ; Set clock to 48MHz
                +1                   mov     Clock_Set_At_48MHz, #1
                +1           ENDM
                +1           Set_LED_0 MACRO
                +1                   setb    P0.LED_0
                +1           ENDM
                +1           Clear_LED_0 MACRO
                +1                clr        P0.LED_0
                +1           ENDM
                +1           Set_LED_1 MACRO
                +1           ENDM
                +1           Clear_LED_1 MACRO
                +1           ENDM
                +1           Set_LED_2 MACRO
                +1           ENDM
                +1           Clear_LED_2 MACRO
                +1           ENDM
                +1           Set_LED_3 MACRO
                +1           ENDM
                +1           Clear_LED_3 MACRO
                +1           ENDM
                             ENDIF
                   17276     
                   17277     IF ESCNO == N_
                             ;$include (N.inc) ; Select pinout N
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; BLHeli program for controlling brushless motors in helicopters and multirotors
                +1           ;
                +1           ; Copyright 2011, 2012 Steffen Skaug
                +1           ; This program is distributed under the terms of the GNU General Public License
                +1           ;
                +1           ; This file is part of BLHeli.
                +1           ;
                +1           ; BLHeli is free software: you can redistribute it and/or modify
                +1           ; it under the terms of the GNU General Public License as published by
                +1           ; the Free Software Foundation, either version 3 of the License, or
                +1           ; (at your option) any later version.
                +1           ;
                +1           ; BLHeli is distributed in the hope that it will be useful,
                +1           ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                +1           ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                +1           ; GNU General Public License for more details.
                +1           ;
                +1           ; You should have received a copy of the GNU General Public License
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   267

                +1           ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                +1           ;
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; Hardware definition file "N"
                +1           ; X  X  RC X  MC MB MA CC    X  X  Cp Cc Bp Bc Ap Ac
                +1           ;
                +1           ;**** **** **** **** ****
                +1           
                +1           
                +1           
                +1           ;*********************
                +1           ; Device SiLabs EFM8BB1x/2x
                +1           ;*********************
                +1           IF MCU_48MHZ == 0
                +1           ;$include (SI_EFM8BB1_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB10F2G
                +2           ;  EFM8BB10F2I
                +2           ;  EFM8BB10F2Y
                +2           ;  EFM8BB10F4G
                +2           ;  EFM8BB10F4I
                +2           ;  EFM8BB10F4Y
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC      DATA 0E0H; Accumulator                            
                +2           ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF   DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B        DATA 0F0H; B Register                             
                +2           CKCON0   DATA 08EH; Clock Control 0                        
                +2           CLKSEL   DATA 0A9H; Clock Select                           
                +2           CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0MD   DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1MD   DATA 0ABH; Comparator 1 Mode                      
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   268

                +2           CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                +2           CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN   DATA 0DDH; CRC0 Data Input                        
                +2           DERIVID  DATA 0ADH; Derivative Identification              
                +2           DEVICEID DATA 0B5H; Device Identification                  
                +2           DPH      DATA 083H; Data Pointer High                      
                +2           DPL      DATA 082H; Data Pointer Low                       
                +2           EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                +2           FLKEY    DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           IE       DATA 0A8H; Interrupt Enable                       
                +2           IP       DATA 0B8H; Interrupt Priority                     
                +2           IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0       DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK   DATA 0FEH; Port 0 Mask                            
                +2           P0MAT    DATA 0FDH; Port 0 Match                           
                +2           P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP   DATA 0D4H; Port 0 Skip                            
                +2           P1       DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK   DATA 0EEH; Port 1 Mask                            
                +2           P1MAT    DATA 0EDH; Port 1 Match                           
                +2           P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP   DATA 0D5H; Port 1 Skip                            
                +2           P2       DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                +2           PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0  DATA 0D8H; PCA Control                            
                +2           PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD   DATA 0D9H; PCA Mode                               
                +2           PCA0POL  DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0    DATA 087H; Power Control                          
                +2           PRTDRV   DATA 0F6H; Port Drive Strength                    
                +2           PSCTL    DATA 08FH; Program Store Control                  
                +2           PSW      DATA 0D0H; Program Status Word                    
                +2           REF0CN   DATA 0D1H; Voltage Reference Control              
                +2           REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                +2           REVID    DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC   DATA 0EFH; Reset Source                           
                +2           SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                +2           SCON0    DATA 098H; UART0 Serial Port Control              
                +2           SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                +2           SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   269

                +2           SP       DATA 081H; Stack Pointer                          
                +2           SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0  DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT  DATA 0A3H; SPI0 Data                              
                +2           TCON     DATA 088H; Timer 0/1 Control                      
                +2           TH0      DATA 08CH; Timer 0 High Byte                      
                +2           TH1      DATA 08DH; Timer 1 High Byte                      
                +2           TL0      DATA 08AH; Timer 0 Low Byte                       
                +2           TL1      DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD     DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2H    DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0  DATA 091H; Timer 3 Control 0                      
                +2           TMR3H    DATA 095H; Timer 3 High Byte                      
                +2           TMR3L    DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                +2           VDM0CN   DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN    DATA 097H; Watchdog Timer Control                 
                +2           XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   270

                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   271

                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   272

                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +1           
                +1           ELSE
                +1           ;$include (SI_EFM8BB2_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB21F16G_QFN20
                +2           ;  EFM8BB21F16G_QSOP24
                +2           ;  EFM8BB21F16I_QFN20
                +2           ;  EFM8BB21F16I_QSOP24
                +2           ;  EFM8BB22F16G_QFN28
                +2           ;  EFM8BB22F16I_QFN28
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC       DATA 0E0H; Accumulator                            
                +2           ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF    DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B         DATA 0F0H; B Register                             
                +2           CKCON0    DATA 08EH; Clock Control 0                        
                +2           CKCON1    DATA 0A6H; Clock Control 1
                +2           CLKSEL    DATA 0A9H; Clock Select                           
                +2           CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0CN1   DATA 099H; Comparator 0 Control 1
                +2           CMP0MD    DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                +2           CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CN1   DATA 086H; CRC0 Control 1                         
                +2           CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN    DATA 0DDH; CRC0 Data Input                        
                +2           CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                +2           DERIVID   DATA 0ADH; Derivative Identification              
                +2           DEVICEID  DATA 0B5H; Device Identification                  
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   273

                +2           DPH       DATA 083H; Data Pointer High                      
                +2           DPL       DATA 082H; Data Pointer Low                       
                +2           EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                +2           EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                +2           EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                +2           EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                +2           EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                +2           EMI0CN    DATA 0E7H; External Memory Interface Control      
                +2           FLKEY     DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                +2           HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                +2           I2C0CN0   DATA 0BAH; I2C0 Control                           
                +2           I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                +2           I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                +2           I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                +2           I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                +2           I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                +2           I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                +2           I2C0STAT  DATA 0B9H; I2C0 Status                            
                +2           IE        DATA 0A8H; Interrupt Enable                       
                +2           IP        DATA 0B8H; Interrupt Priority                     
                +2           IPH       DATA 0F2H; Interrupt Priority High                
                +2           IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0        DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK    DATA 0FEH; Port 0 Mask                            
                +2           P0MAT     DATA 0FDH; Port 0 Match                           
                +2           P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP    DATA 0D4H; Port 0 Skip                            
                +2           P1        DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK    DATA 0EEH; Port 1 Mask                            
                +2           P1MAT     DATA 0EDH; Port 1 Match                           
                +2           P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP    DATA 0D5H; Port 1 Skip                            
                +2           P2        DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MASK    DATA 0FCH; Port 2 Mask                            
                +2           P2MAT     DATA 0FBH; Port 2 Match                           
                +2           P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                +2           P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                +2           P2SKIP    DATA 0CCH; Port 2 Skip                            
                +2           P3        DATA 0B0H; Port 3 Pin Latch                       
                +2           P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                +2           P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                +2           PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0   DATA 0D8H; PCA Control                            
                +2           PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD    DATA 0D9H; PCA Mode                               
                +2           PCA0POL   DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0     DATA 087H; Power Control                          
                +2           PCON1     DATA 09AH; Power Control 1                        
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   274

                +2           PFE0CN    DATA 0C1H; Prefetch Engine Control                
                +2           PRTDRV    DATA 0F6H; Port Drive Strength                    
                +2           PSCTL     DATA 08FH; Program Store Control                  
                +2           PSW       DATA 0D0H; Program Status Word                    
                +2           REF0CN    DATA 0D1H; Voltage Reference Control              
                +2           REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                +2           REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                +2           REVID     DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC    DATA 0EFH; Reset Source                           
                +2           SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                +2           SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                +2           SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                +2           SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                +2           SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                +2           SCON0     DATA 098H; UART0 Serial Port Control              
                +2           SCON1     DATA 0C8H; UART1 Serial Port Control              
                +2           SFRPAGE   DATA 0A7H; SFR Page                               
                +2           SFRPGCN   DATA 0CFH; SFR Page Control                       
                +2           SFRSTACK  DATA 0D7H; SFR Page Stack                         
                +2           SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                +2           SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                +2           SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                +2           SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                +2           SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                +2           SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SMOD1     DATA 093H; UART1 Mode                             
                +2           SP        DATA 081H; Stack Pointer                          
                +2           SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0   DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT   DATA 0A3H; SPI0 Data                              
                +2           SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                +2           SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                +2           SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                +2           TCON      DATA 088H; Timer 0/1 Control                      
                +2           TH0       DATA 08CH; Timer 0 High Byte                      
                +2           TH1       DATA 08DH; Timer 1 High Byte                      
                +2           TL0       DATA 08AH; Timer 0 Low Byte                       
                +2           TL1       DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD      DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                +2           TMR2H     DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0   DATA 091H; Timer 3 Control 0                      
                +2           TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                +2           TMR3H     DATA 095H; Timer 3 High Byte                      
                +2           TMR3L     DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                +2           TMR4CN0   DATA 098H; Timer 4 Control 0                      
                +2           TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                +2           TMR4H     DATA 0A5H; Timer 4 High Byte                      
                +2           TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                +2           TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                +2           TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                +2           UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                +2           UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                +2           UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                +2           UART1LIN  DATA 09EH; UART1 LIN Configuration                
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   275

                +2           VDM0CN    DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN     DATA 097H; Watchdog Timer Control                 
                +2           XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                +2           TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   276

                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                +2           P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                +2           
                +2           ; P3 0xB0 (Port 3 Pin Latch)
                +2           P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                +2           P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   277

                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SCON1 0xC8 (UART1 Serial Port Control)
                +2           SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                +2           SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                +2           SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                +2           SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                +2           SCON1_REN  BIT SCON1.4 ; Receive Enable           
                +2           SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                +2           SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                +2           TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                +2           
                +2           ; TMR4CN0 0x98 (Timer 4 Control 0)
                +2           TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                +2           TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                +2           TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                +2           TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                +2           TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                +2           TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                +2           TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                +2           TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                +2           
                +2           ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   278

                +2           UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                +2           UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                +2           UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                +2           UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                +2           UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                +2           UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                +2           UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                +2           UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +2           UART1_IRQn   EQU 17 ; UART1                     
                +2           I2C0_IRQn    EQU 18 ; I2C0 Slave                
                +2           TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; SFR Page Definitions
                +2           ;------------------------------------------------------------------------------
                +2           CRC0_PAGE       EQU 000H ; CRC0 Page       
                +2           LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                +2           PCA0_PAGE       EQU 000H ; PCA0 Page       
                +2           PG2_PAGE        EQU 010H ; Page2           
                +2           TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                +2           TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                +2           TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                +2           I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                +2           PG3_PAGE        EQU 020H ; Page3           
                +2           SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                +2           SPI0_PAGE       EQU 020H ; SPI0 Page       
                +2           UART0_PAGE      EQU 020H ; UART0 Page      
                +2           UART1_PAGE      EQU 020H ; UART1 Page      
                +1           
                +1           ENDIF
                +1           
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Uses internal calibrated oscillator set to 24/48Mhz
                +1           ;**** **** **** **** ****
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Constant definitions
                +1           ;**** **** **** **** ****
                +1           IF MCU_48MHZ == 0
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#N_L_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#N_L_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#N_L_10#        "
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   279

                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#N_L_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#N_L_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#N_L_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#N_L_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#N_L_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#N_L_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#N_L_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#N_L_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (16 B
                             ytes)
                +1           
                +1           ELSE
                +1           
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#N_H_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#N_H_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#N_H_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#N_H_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#N_H_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#N_H_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#N_H_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#N_H_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#N_H_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#N_H_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#N_H_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (16 B
                             ytes)
                +1           ENDIF
                +1           
                +1           TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for whi
                             ch main motor power is limited at 80degC (low byte, assuming high byte is 1)
                +1           TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment for a
                             nother 10degC
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Bootloader definitions
                +1           ;**** **** **** **** ****
                +1           RTX_PORT                                EQU     P0              ; Receive/Transmit port
                +1           RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL            
                                          
                +1           RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL             
                                          
                +1           RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP                
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   280

                                          
                +1           RTX_PIN                         EQU     5               ; RTX pin
                +1           
                +1           SIGNATURE_001                   EQU     0E8h            ; Device signature
                +1           IF MCU_48MHZ == 0
                +1           SIGNATURE_002                   EQU     0B1h
                +1           ELSE
                +1           SIGNATURE_002                   EQU     0B2h
                +1           ENDIF
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 0 definitions *
                +1           ;*********************  
                +1           ;                       EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           Rcp_In          EQU     5       ;i
                +1           ;                       EQU     4       ;i 
                +1           Mux_C           EQU     3       ;i
                +1           Mux_B           EQU     2       ;i
                +1           Mux_A           EQU     1       ;i
                +1           Comp_Com                EQU     0       ;i
                +1           
                +1           P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                +1           P0_INIT         EQU     0FFh
                +1           P0_PUSHPULL     EQU     0
                +1           P0_SKIP         EQU     0FFh
                +1           
                +1           Get_Rcp_Capture_Values MACRO
                +1                   anl     TCON, #0EFh                             ; Disable timer0
                +1                   mov     Temp1, TL0                              ; Get timer0 values
                +1                   mov     Temp2, TH0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Temp3, Timer0_X
                +1                   jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                +1                   inc     Temp3                                   ; If it is pending, then timer has 
                             already wrapped
                +1           ENDIF
                +1                   mov     TL0, #0                                 ; Reset timer0
                +1                   mov     TH0, #0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Timer0_X, #0
                +1           ENDIF
                +1                   orl     TCON, #10h                              ; Enable timer0 again
                +1           IF MCU_48MHZ == 1
                +1                   mov     A, Clock_Set_At_48MHz
                +1                   jnz     Get_Rcp_End
                +1                   clr     C
                +1                   mov     A, Temp1
                +1                   rlc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Temp2
                +1                   rlc     A
                +1                   mov     Temp2, A
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1           Get_Rcp_End:
                +1           ENDIF
                +1           ENDM
                +1           Decode_Dshot_2Msb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   281

                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp4                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp4
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL
                +1           ENDM
                +1           Decode_Dshot_2Lsb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp3                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL
                +1           ENDM
                +1           Initialize_PCA MACRO
                +1                   mov     PCA0CN0, #40h                           ; PCA enabled
                +1                   mov     PCA0MD, #08h                            ; PCA clock is system clock
                +1           IF FETON_DELAY == 0
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #00h                          ; Edge aligned pwm
                +1           ELSE
                +1           IF MCU_48MHZ == 0
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   282

                +1                   mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #03h                          ; Center aligned pwm
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_Polarity MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0POL, #00h                           ; Pwm noninverted
                +1           ELSE
                +1                   mov     PCA0POL, #01h                           ; Damping inverted, pwm noninverted
                +1           ENDIF
                +1           ENDM
                +1           Enable_Power_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, enab
                             le match, set pwm mode
                +1           ELSE
                +1                   mov     PCA0CPM1, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Enable_Damp_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM1, #00h                          ; Disable
                +1           ELSE
                +1                   mov     PCA0CPM0, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Set_Power_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL0, Power_Pwm_Reg_L
                +1                   mov     PCA0CPH0, Power_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Power_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Power_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL1, A
                +1                   mov     PCA0CPH1, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Set_Damp_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL1, Damp_Pwm_Reg_L
                +1                   mov     PCA0CPH1, Damp_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Damp_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Damp_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL0, A
                +1                   mov     PCA0CPH0, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Clear_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0DFh
                +1           ENDM
                +1           Clear_CCF_Interrupt MACRO       ; CCF interrupt is only used for FETON_DELAY == 0
                +1                   anl     PCA0CN0, #0FEh
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   283

                +1           ENDM
                +1           Enable_COVF_Interrupt MACRO
                +1                   orl     PCA0PWM, #40h
                +1           ENDM
                +1           Enable_CCF_Interrupt MACRO
                +1                   orl     PCA0CPM0,#01h
                +1           ENDM
                +1           Disable_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0BFh
                +1           ENDM
                +1           Disable_CCF_Interrupt MACRO
                +1                   anl     PCA0CPM0,#0FEh
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 1 definitions *
                +1           ;*********************
                +1           ;                       EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           CpwmFET         EQU     5       ;o
                +1           CcomFET         EQU     4       ;o
                +1           BpwmFET         EQU     3       ;o
                +1           BcomFET         EQU     2       ;o
                +1           ApwmFET         EQU     1       ;o
                +1           AcomFET         EQU     0       ;o
                +1           
                +1           P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_INIT         EQU     00h             
                +1           P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_SKIP         EQU     3Fh
                +1           
                +1           ApwmFET_on MACRO
                +1                   setb    P1.ApwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           ApwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_on MACRO
                +1                   setb    P1.BpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.BpwmFET
                +1           ELSE
                +1                   clr     P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_on MACRO
                +1                   setb    P1.CpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1           ENDIF
                +1           ENDM
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   284

                +1           CpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           All_pwmFETs_Off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1                   clr     P1.BpwmFET
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           
                +1           AcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.ApwmFET
                +1           ENDIF
                +1                   setb    P1.AcomFET
                +1           ENDM
                +1           AcomFET_off MACRO
                +1                   clr     P1.AcomFET
                +1           ENDM
                +1           BcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.BpwmFET
                +1           ENDIF
                +1                   setb    P1.BcomFET
                +1           ENDM
                +1           BcomFET_off MACRO
                +1                   clr     P1.BcomFET
                +1           ENDM
                +1           CcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.CpwmFET
                +1           ENDIF
                +1                   setb    P1.CcomFET
                +1           ENDM
                +1           CcomFET_off MACRO
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           All_comFETs_Off MACRO
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           
                +1           Set_Pwm_A MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1                   mov     P1SKIP, #3Dh
                +1           ELSE
                +1                   mov     P1SKIP, #3Ch
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_B MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1                   mov     P1SKIP, #37h
                +1           ELSE
                +1                   mov     P1SKIP, #33h
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   285

                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_C MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1                   mov     P1SKIP, #1Fh
                +1           ELSE
                +1                   mov     P1SKIP, #0Fh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwms_Off MACRO
                +1                   mov     P1SKIP, #3Fh
                +1           ENDM
                +1           
                +1           Set_Comp_Phase_A MACRO
                +1                   mov     CMP0MX, #10h    ; Set comparator multiplexer to phase A
                +1           ENDM
                +1           Set_Comp_Phase_B MACRO
                +1                   mov     CMP0MX, #20h    ; Set comparator multiplexer to phase B
                +1           ENDM
                +1           Set_Comp_Phase_C MACRO
                +1                   mov     CMP0MX, #30h    ; Set comparator multiplexer to phase C
                +1           ENDM
                +1           Read_Comp_Out MACRO
                +1                   mov     A, CMP0CN0      ; Read comparator output
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 2 definitions *
                +1           ;*********************
                +1           DebugPin                EQU     0       ;o
                +1           
                +1           P2_PUSHPULL     EQU     (1 SHL DebugPin)
                +1           
                +1           
                +1           ;**********************
                +1           ; MCU specific macros *
                +1           ;**********************
                +1           Interrupt_Table_Definition MACRO
                +1           CSEG AT 0                               ; Code segment start
                +1                   jmp reset
                +1           CSEG AT 03h                     ; Int0 interrupt        
                +1                   jmp     int0_int        
                +1           IF MCU_48MHZ == 1
                +1           CSEG AT 0Bh                     ; Timer0 overflow interrupt
                +1                   jmp     t0_int
                +1           ENDIF
                +1           CSEG AT 13h                     ; Int1 interrupt
                +1                   jmp     int1_int
                +1           CSEG AT 1Bh                     ; Timer1 overflow interrupt
                +1                   jmp     t1_int
                +1           CSEG AT 2Bh                     ; Timer2 overflow interrupt
                +1                   jmp     t2_int  
                +1           CSEG AT 5Bh                     ; Pca interrupt
                +1                   jmp     pca_int
                +1           CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                +1                   jmp     t3_int  
                +1           ENDM
                +1           
                +1           Initialize_Xbar MACRO
                +1                   mov     XBR2, #40h      ; Xbar enabled                  
                +1                   mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                +1           ENDM
                +1           
                +1           Initialize_Comparator MACRO
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   286

                +1                   mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                +1                   mov     CMP0MD, #00h    ; Comparator response time 100ns
                +1           ENDM
                +1           Initialize_Adc MACRO
                +1                   mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bias
                +1           IF MCU_48MHZ == 0
                +1                   mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                +1           ELSE
                +1                   mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                +1           ENDIF
                +1                   mov     ADC0MX, #10h    ; Select temp sensor input
                +1                   mov     ADC0CN0, #80h   ; ADC enabled 
                +1                   mov     ADC0CN1, #01h   ; Common mode buffer enabled
                +1           ENDM
                +1           Start_Adc MACRO
                +1                   mov     ADC0CN0, #90h   ; ADC start
                +1           ENDM
                +1           Read_Adc_Result MACRO
                +1                   mov     Temp1, ADC0L
                +1                   mov     Temp2, ADC0H
                +1           ENDM
                +1           Stop_Adc MACRO
                +1           ENDM
                +1           Set_RPM_Out MACRO
                +1           ENDM
                +1           Clear_RPM_Out MACRO
                +1           ENDM
                +1           Set_MCU_Clk_24MHz MACRO
                +1                   mov     CLKSEL, #13h            ; Set clock to 24MHz
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     Clock_Set_At_48MHz, #0
                +1           ENDM
                +1           Set_MCU_Clk_48MHz MACRO
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     CLKSEL, #03h            ; Set clock to 48MHz
                +1                   mov     Clock_Set_At_48MHz, #1
                +1           ENDM
                +1           Set_LED_0 MACRO
                +1           ENDM
                +1           Clear_LED_0 MACRO
                +1           ENDM
                +1           Set_LED_1 MACRO
                +1           ENDM
                +1           Clear_LED_1 MACRO
                +1           ENDM
                +1           Set_LED_2 MACRO
                +1           ENDM
                +1           Clear_LED_2 MACRO
                +1           ENDM
                +1           Set_LED_3 MACRO
                +1           ENDM
                +1           Clear_LED_3 MACRO
                +1           ENDM
                             ENDIF
                   18594     
                   18595     IF ESCNO == O_
                             ;$include (O.inc) ; Select pinout O
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; BLHeli program for controlling brushless motors in helicopters and multirotors
                +1           ;
                +1           ; Copyright 2011, 2012 Steffen Skaug
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   287

                +1           ; This program is distributed under the terms of the GNU General Public License
                +1           ;
                +1           ; This file is part of BLHeli.
                +1           ;
                +1           ; BLHeli is free software: you can redistribute it and/or modify
                +1           ; it under the terms of the GNU General Public License as published by
                +1           ; the Free Software Foundation, either version 3 of the License, or
                +1           ; (at your option) any later version.
                +1           ;
                +1           ; BLHeli is distributed in the hope that it will be useful,
                +1           ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                +1           ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                +1           ; GNU General Public License for more details.
                +1           ;
                +1           ; You should have received a copy of the GNU General Public License
                +1           ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                +1           ;
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; Hardware definition file "O". Com fets are active low for H/L_N driver and EN_N/PWM drive
                             r. Low side pwm and 1S flag set
                +1           ; X  X  RC X  CC MA MC MB    X  X  Cc Cp Bc Bp Ac Ap
                +1           ;
                +1           ;**** **** **** **** ****
                +1           
                +1           
                +1           
                +1           ;*********************
                +1           ; Device SiLabs EFM8BB1x/2x
                +1           ;*********************
                +1           IF MCU_48MHZ == 0
                +1           ;$include (SI_EFM8BB1_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB10F2G
                +2           ;  EFM8BB10F2I
                +2           ;  EFM8BB10F2Y
                +2           ;  EFM8BB10F4G
                +2           ;  EFM8BB10F4I
                +2           ;  EFM8BB10F4Y
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC      DATA 0E0H; Accumulator                            
                +2           ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF   DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   288

                +2           ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B        DATA 0F0H; B Register                             
                +2           CKCON0   DATA 08EH; Clock Control 0                        
                +2           CLKSEL   DATA 0A9H; Clock Select                           
                +2           CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0MD   DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                +2           CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN   DATA 0DDH; CRC0 Data Input                        
                +2           DERIVID  DATA 0ADH; Derivative Identification              
                +2           DEVICEID DATA 0B5H; Device Identification                  
                +2           DPH      DATA 083H; Data Pointer High                      
                +2           DPL      DATA 082H; Data Pointer Low                       
                +2           EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                +2           FLKEY    DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           IE       DATA 0A8H; Interrupt Enable                       
                +2           IP       DATA 0B8H; Interrupt Priority                     
                +2           IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0       DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK   DATA 0FEH; Port 0 Mask                            
                +2           P0MAT    DATA 0FDH; Port 0 Match                           
                +2           P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP   DATA 0D4H; Port 0 Skip                            
                +2           P1       DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK   DATA 0EEH; Port 1 Mask                            
                +2           P1MAT    DATA 0EDH; Port 1 Match                           
                +2           P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP   DATA 0D5H; Port 1 Skip                            
                +2           P2       DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                +2           PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0  DATA 0D8H; PCA Control                            
                +2           PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD   DATA 0D9H; PCA Mode                               
                +2           PCA0POL  DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   289

                +2           PCON0    DATA 087H; Power Control                          
                +2           PRTDRV   DATA 0F6H; Port Drive Strength                    
                +2           PSCTL    DATA 08FH; Program Store Control                  
                +2           PSW      DATA 0D0H; Program Status Word                    
                +2           REF0CN   DATA 0D1H; Voltage Reference Control              
                +2           REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                +2           REVID    DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC   DATA 0EFH; Reset Source                           
                +2           SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                +2           SCON0    DATA 098H; UART0 Serial Port Control              
                +2           SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                +2           SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SP       DATA 081H; Stack Pointer                          
                +2           SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0  DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT  DATA 0A3H; SPI0 Data                              
                +2           TCON     DATA 088H; Timer 0/1 Control                      
                +2           TH0      DATA 08CH; Timer 0 High Byte                      
                +2           TH1      DATA 08DH; Timer 1 High Byte                      
                +2           TL0      DATA 08AH; Timer 0 Low Byte                       
                +2           TL1      DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD     DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2H    DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0  DATA 091H; Timer 3 Control 0                      
                +2           TMR3H    DATA 095H; Timer 3 High Byte                      
                +2           TMR3L    DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                +2           VDM0CN   DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN    DATA 097H; Watchdog Timer Control                 
                +2           XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   290

                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   291

                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   292

                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +1           
                +1           ELSE
                +1           ;$include (SI_EFM8BB2_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB21F16G_QFN20
                +2           ;  EFM8BB21F16G_QSOP24
                +2           ;  EFM8BB21F16I_QFN20
                +2           ;  EFM8BB21F16I_QSOP24
                +2           ;  EFM8BB22F16G_QFN28
                +2           ;  EFM8BB22F16I_QFN28
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC       DATA 0E0H; Accumulator                            
                +2           ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF    DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B         DATA 0F0H; B Register                             
                +2           CKCON0    DATA 08EH; Clock Control 0                        
                +2           CKCON1    DATA 0A6H; Clock Control 1
                +2           CLKSEL    DATA 0A9H; Clock Select                           
                +2           CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   293

                +2           CMP0CN1   DATA 099H; Comparator 0 Control 1
                +2           CMP0MD    DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                +2           CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CN1   DATA 086H; CRC0 Control 1                         
                +2           CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN    DATA 0DDH; CRC0 Data Input                        
                +2           CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                +2           DERIVID   DATA 0ADH; Derivative Identification              
                +2           DEVICEID  DATA 0B5H; Device Identification                  
                +2           DPH       DATA 083H; Data Pointer High                      
                +2           DPL       DATA 082H; Data Pointer Low                       
                +2           EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                +2           EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                +2           EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                +2           EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                +2           EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                +2           EMI0CN    DATA 0E7H; External Memory Interface Control      
                +2           FLKEY     DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                +2           HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                +2           I2C0CN0   DATA 0BAH; I2C0 Control                           
                +2           I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                +2           I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                +2           I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                +2           I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                +2           I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                +2           I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                +2           I2C0STAT  DATA 0B9H; I2C0 Status                            
                +2           IE        DATA 0A8H; Interrupt Enable                       
                +2           IP        DATA 0B8H; Interrupt Priority                     
                +2           IPH       DATA 0F2H; Interrupt Priority High                
                +2           IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0        DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK    DATA 0FEH; Port 0 Mask                            
                +2           P0MAT     DATA 0FDH; Port 0 Match                           
                +2           P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP    DATA 0D4H; Port 0 Skip                            
                +2           P1        DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK    DATA 0EEH; Port 1 Mask                            
                +2           P1MAT     DATA 0EDH; Port 1 Match                           
                +2           P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP    DATA 0D5H; Port 1 Skip                            
                +2           P2        DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MASK    DATA 0FCH; Port 2 Mask                            
                +2           P2MAT     DATA 0FBH; Port 2 Match                           
                +2           P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                +2           P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                +2           P2SKIP    DATA 0CCH; Port 2 Skip                            
                +2           P3        DATA 0B0H; Port 3 Pin Latch                       
                +2           P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                +2           P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                +2           PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0   DATA 0D8H; PCA Control                            
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   294

                +2           PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD    DATA 0D9H; PCA Mode                               
                +2           PCA0POL   DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0     DATA 087H; Power Control                          
                +2           PCON1     DATA 09AH; Power Control 1                        
                +2           PFE0CN    DATA 0C1H; Prefetch Engine Control                
                +2           PRTDRV    DATA 0F6H; Port Drive Strength                    
                +2           PSCTL     DATA 08FH; Program Store Control                  
                +2           PSW       DATA 0D0H; Program Status Word                    
                +2           REF0CN    DATA 0D1H; Voltage Reference Control              
                +2           REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                +2           REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                +2           REVID     DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC    DATA 0EFH; Reset Source                           
                +2           SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                +2           SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                +2           SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                +2           SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                +2           SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                +2           SCON0     DATA 098H; UART0 Serial Port Control              
                +2           SCON1     DATA 0C8H; UART1 Serial Port Control              
                +2           SFRPAGE   DATA 0A7H; SFR Page                               
                +2           SFRPGCN   DATA 0CFH; SFR Page Control                       
                +2           SFRSTACK  DATA 0D7H; SFR Page Stack                         
                +2           SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                +2           SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                +2           SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                +2           SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                +2           SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                +2           SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SMOD1     DATA 093H; UART1 Mode                             
                +2           SP        DATA 081H; Stack Pointer                          
                +2           SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0   DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT   DATA 0A3H; SPI0 Data                              
                +2           SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                +2           SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                +2           SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                +2           TCON      DATA 088H; Timer 0/1 Control                      
                +2           TH0       DATA 08CH; Timer 0 High Byte                      
                +2           TH1       DATA 08DH; Timer 1 High Byte                      
                +2           TL0       DATA 08AH; Timer 0 Low Byte                       
                +2           TL1       DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD      DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                +2           TMR2H     DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   295

                +2           TMR3CN0   DATA 091H; Timer 3 Control 0                      
                +2           TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                +2           TMR3H     DATA 095H; Timer 3 High Byte                      
                +2           TMR3L     DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                +2           TMR4CN0   DATA 098H; Timer 4 Control 0                      
                +2           TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                +2           TMR4H     DATA 0A5H; Timer 4 High Byte                      
                +2           TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                +2           TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                +2           TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                +2           UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                +2           UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                +2           UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                +2           UART1LIN  DATA 09EH; UART1 LIN Configuration                
                +2           VDM0CN    DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN     DATA 097H; Watchdog Timer Control                 
                +2           XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                +2           TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   296

                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                +2           P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                +2           
                +2           ; P3 0xB0 (Port 3 Pin Latch)
                +2           P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                +2           P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   297

                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SCON1 0xC8 (UART1 Serial Port Control)
                +2           SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                +2           SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                +2           SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                +2           SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                +2           SCON1_REN  BIT SCON1.4 ; Receive Enable           
                +2           SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                +2           SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                +2           TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   298

                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                +2           
                +2           ; TMR4CN0 0x98 (Timer 4 Control 0)
                +2           TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                +2           TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                +2           TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                +2           TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                +2           TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                +2           TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                +2           TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                +2           TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                +2           
                +2           ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                +2           UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                +2           UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                +2           UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                +2           UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                +2           UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                +2           UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                +2           UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                +2           UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +2           UART1_IRQn   EQU 17 ; UART1                     
                +2           I2C0_IRQn    EQU 18 ; I2C0 Slave                
                +2           TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; SFR Page Definitions
                +2           ;------------------------------------------------------------------------------
                +2           CRC0_PAGE       EQU 000H ; CRC0 Page       
                +2           LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                +2           PCA0_PAGE       EQU 000H ; PCA0 Page       
                +2           PG2_PAGE        EQU 010H ; Page2           
                +2           TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                +2           TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                +2           TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                +2           I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                +2           PG3_PAGE        EQU 020H ; Page3           
                +2           SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                +2           SPI0_PAGE       EQU 020H ; SPI0 Page       
                +2           UART0_PAGE      EQU 020H ; UART0 Page      
                +2           UART1_PAGE      EQU 020H ; UART1 Page      
                +1           
                +1           ENDIF
                +1           
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   299

                +1           
                +1           ;**** **** **** **** ****
                +1           ; Uses internal calibrated oscillator set to 24/48Mhz
                +1           ;**** **** **** **** ****
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Constant definitions
                +1           ;**** **** **** **** ****
                +1           IF MCU_48MHZ == 0
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#O_L_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#O_L_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#O_L_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#O_L_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#O_L_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#O_L_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#O_L_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#O_L_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#O_L_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#O_L_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#O_L_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (16 B
                             ytes)
                +1           
                +1           ELSE
                +1           
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#O_H_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#O_H_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#O_H_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#O_H_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#O_H_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#O_H_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#O_H_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#O_H_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#O_H_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#O_H_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#O_H_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (16 B
                             ytes)
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   300

                +1           ENDIF
                +1           
                +1           TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for whi
                             ch main motor power is limited at 80degC (low byte, assuming high byte is 1)
                +1           TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment for a
                             nother 10degC
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Bootloader definitions
                +1           ;**** **** **** **** ****
                +1           RTX_PORT                                EQU     P0              ; Receive/Transmit port
                +1           RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL            
                                          
                +1           RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL             
                                          
                +1           RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP                
                                          
                +1           RTX_PIN                         EQU     5               ; RTX pin
                +1           
                +1           SIGNATURE_001                   EQU     0E8h            ; Device signature
                +1           IF MCU_48MHZ == 0
                +1           SIGNATURE_002                   EQU     0B1h
                +1           ELSE
                +1           SIGNATURE_002                   EQU     0B2h
                +1           ENDIF
                +1           
                +1           ;*********************
                +1           ; PORT 0 definitions *
                +1           ;*********************  
                +1           ;                       EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           Rcp_In          EQU     5       ;i
                +1           ;                       EQU     4       ;i 
                +1           Comp_Com                EQU     3       ;i
                +1           Mux_A           EQU     2       ;i
                +1           Mux_C           EQU     1       ;i
                +1           Mux_B           EQU     0       ;i
                +1           
                +1           P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                +1           P0_INIT         EQU     0FFh
                +1           P0_PUSHPULL     EQU     0
                +1           P0_SKIP         EQU     0FFh
                +1           
                +1           Get_Rcp_Capture_Values MACRO
                +1                   anl     TCON, #0EFh                             ; Disable timer0
                +1                   mov     Temp1, TL0                              ; Get timer0 values
                +1                   mov     Temp2, TH0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Temp3, Timer0_X
                +1                   jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                +1                   inc     Temp3                                   ; If it is pending, then timer has 
                             already wrapped
                +1           ENDIF
                +1                   mov     TL0, #0                                 ; Reset timer0
                +1                   mov     TH0, #0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Timer0_X, #0
                +1           ENDIF
                +1                   orl     TCON, #10h                              ; Enable timer0 again
                +1           IF MCU_48MHZ == 1
                +1                   mov     A, Clock_Set_At_48MHz
                +1                   jnz     Get_Rcp_End
                +1                   clr     C
                +1                   mov     A, Temp1
                +1                   rlc     A
                +1                   mov     Temp1, A
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   301

                +1                   mov     A, Temp2
                +1                   rlc     A
                +1                   mov     Temp2, A
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1           Get_Rcp_End:
                +1           ENDIF
                +1           ENDM
                +1           Decode_Dshot_2Msb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp4                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp4
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL
                +1           ENDM
                +1           Decode_Dshot_2Lsb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp3                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp3
                +1                   rlc     A
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   302

                +1                   mov     Temp3, A
                +1                   inc     DPL
                +1           ENDM
                +1           Initialize_PCA MACRO
                +1                   mov     PCA0CN0, #40h                           ; PCA enabled
                +1                   mov     PCA0MD, #08h                            ; PCA clock is system clock
                +1           IF FETON_DELAY == 0
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #00h                          ; Edge aligned pwm
                +1           ELSE
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #03h                          ; Center aligned pwm
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_Polarity MACRO
                +1                   mov     PCA0POL, #00h                           ; Damping noninverted, pwm noninver
                             ted
                +1           ENDM
                +1           Enable_Power_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, enab
                             le match, set pwm mode
                +1           ELSE
                +1                   mov     PCA0CPM0, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Enable_Damp_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM1, #00h                          ; Disable
                +1           ELSE
                +1                   mov     PCA0CPM1, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Set_Power_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL0, Power_Pwm_Reg_L
                +1                   mov     PCA0CPH0, Power_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Power_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Power_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL0, A
                +1                   mov     PCA0CPH0, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Set_Damp_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL1, Damp_Pwm_Reg_L
                +1                   mov     PCA0CPH1, Damp_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Damp_Pwm_Reg_H
                +1                   rrc     A
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   303

                +1                   mov     Temp1, A
                +1                   mov     A, Damp_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL1, A
                +1                   mov     PCA0CPH1, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Clear_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0DFh
                +1           ENDM
                +1           Clear_CCF_Interrupt MACRO
                +1                   anl     PCA0CN0, #0FEh
                +1           ENDM
                +1           Enable_COVF_Interrupt MACRO
                +1                   orl     PCA0PWM, #40h
                +1           ENDM
                +1           Enable_CCF_Interrupt MACRO
                +1                   orl     PCA0CPM0,#01h
                +1           ENDM
                +1           Disable_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0BFh
                +1           ENDM
                +1           Disable_CCF_Interrupt MACRO
                +1                   anl     PCA0CPM0,#0FEh
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 1 definitions *
                +1           ;*********************
                +1           ;                       EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           CcomFET         EQU     5       ;o
                +1           CpwmFET         EQU     4       ;o
                +1           BcomFET         EQU     3       ;o
                +1           BpwmFET         EQU     2       ;o
                +1           AcomFET         EQU     1       ;o
                +1           ApwmFET         EQU     0       ;o
                +1           
                +1           P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_INIT         EQU     (1 SHL AcomFET)+(1 SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_SKIP         EQU     3Fh
                +1           
                +1           ApwmFET_on MACRO
                +1                   setb    P1.ApwmFET
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           ApwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1           ELSE
                +1                   setb    P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_on MACRO
                +1                   setb    P1.BpwmFET
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_off MACRO
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   304

                +1           IF FETON_DELAY != 0
                +1                   clr     P1.BpwmFET
                +1           ELSE
                +1                   setb    P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_on MACRO
                +1                   setb    P1.CpwmFET
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   setb    P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           All_pwmFETs_Off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1                   clr     P1.BpwmFET
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   setb    P1.AcomFET
                +1                   setb    P1.BcomFET
                +1                   setb    P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           
                +1           AcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.ApwmFET
                +1           ENDIF
                +1                   clr     P1.AcomFET
                +1           ENDM
                +1           AcomFET_off MACRO
                +1                   setb    P1.AcomFET
                +1           ENDM
                +1           BcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.BpwmFET
                +1           ENDIF
                +1                   clr     P1.BcomFET
                +1           ENDM
                +1           BcomFET_off MACRO
                +1                   setb    P1.BcomFET
                +1           ENDM
                +1           CcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.CpwmFET
                +1           ENDIF
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           CcomFET_off MACRO
                +1                   setb    P1.CcomFET
                +1           ENDM
                +1           All_comFETs_Off MACRO
                +1                   setb    P1.AcomFET
                +1                   setb    P1.BcomFET
                +1                   setb    P1.CcomFET
                +1           ENDM
                +1           
                +1           Set_Pwm_A MACRO
                +1           IF FETON_DELAY == 0
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   305

                +1                   clr     P1.AcomFET
                +1                   mov     P1SKIP, #3Eh
                +1           ELSE
                +1                   mov     P1SKIP, #3Ch
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_B MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.BcomFET
                +1                   mov     P1SKIP, #3Bh
                +1           ELSE
                +1                   mov     P1SKIP, #33h
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_C MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.CcomFET
                +1                   mov     P1SKIP, #2Fh
                +1           ELSE
                +1                   mov     P1SKIP, #0Fh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwms_Off MACRO
                +1                   mov     P1SKIP, #3Fh
                +1           ENDM
                +1           
                +1           Set_Comp_Phase_A MACRO
                +1                   mov     CMP0MX, #23h    ; Set comparator multiplexer to phase A
                +1           ENDM
                +1           Set_Comp_Phase_B MACRO
                +1                   mov     CMP0MX, #03h    ; Set comparator multiplexer to phase B
                +1           ENDM
                +1           Set_Comp_Phase_C MACRO
                +1                   mov     CMP0MX, #13h    ; Set comparator multiplexer to phase C
                +1           ENDM
                +1           Read_Comp_Out MACRO
                +1                   mov     A, CMP0CN0      ; Read comparator output
                +1                   cpl A
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 2 definitions *
                +1           ;*********************
                +1           DebugPin                EQU     0       ;o
                +1           
                +1           P2_PUSHPULL     EQU     (1 SHL DebugPin)
                +1           
                +1           
                +1           ;**********************
                +1           ; MCU specific macros *
                +1           ;**********************
                +1           Interrupt_Table_Definition MACRO
                +1           CSEG AT 0                               ; Code segment start
                +1                   jmp reset
                +1           CSEG AT 03h                     ; Int0 interrupt        
                +1                   jmp     int0_int        
                +1           IF MCU_48MHZ == 1
                +1           CSEG AT 0Bh                     ; Timer0 overflow interrupt
                +1                   jmp     t0_int
                +1           ENDIF
                +1           CSEG AT 13h                     ; Int1 interrupt
                +1                   jmp     int1_int
                +1           CSEG AT 1Bh                     ; Timer1 overflow interrupt
                +1                   jmp     t1_int
                +1           CSEG AT 2Bh                     ; Timer2 overflow interrupt
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   306

                +1                   jmp     t2_int  
                +1           CSEG AT 5Bh                     ; Pca interrupt
                +1                   jmp     pca_int
                +1           CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                +1                   jmp     t3_int  
                +1           ENDM
                +1           
                +1           Initialize_Xbar MACRO
                +1                   mov     XBR2, #40h      ; Xbar enabled                  
                +1                   mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                +1           ENDM
                +1           
                +1           Initialize_Comparator MACRO
                +1                   mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                +1                   mov     CMP0MD, #00h    ; Comparator response time 100ns
                +1           ENDM
                +1           Initialize_Adc MACRO
                +1                   mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bias
                +1           IF MCU_48MHZ == 0
                +1                   mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                +1           ELSE
                +1                   mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                +1           ENDIF
                +1                   mov     ADC0MX, #10h    ; Select temp sensor input
                +1                   mov     ADC0CN0, #80h   ; ADC enabled 
                +1                   mov     ADC0CN1, #01h   ; Common mode buffer enabled
                +1           ENDM
                +1           Start_Adc MACRO
                +1                   mov     ADC0CN0, #90h   ; ADC start
                +1           ENDM
                +1           Read_Adc_Result MACRO
                +1                   mov     Temp1, ADC0L
                +1                   mov     Temp2, ADC0H
                +1           ENDM
                +1           Stop_Adc MACRO
                +1           ENDM
                +1           Set_RPM_Out MACRO
                +1           ENDM
                +1           Clear_RPM_Out MACRO
                +1           ENDM
                +1           Set_MCU_Clk_24MHz MACRO
                +1                   mov     CLKSEL, #13h            ; Set clock to 24MHz
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     Clock_Set_At_48MHz, #0
                +1           ENDM
                +1           Set_MCU_Clk_48MHz MACRO
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     CLKSEL, #03h            ; Set clock to 48MHz
                +1                   mov     Clock_Set_At_48MHz, #1
                +1           ENDM
                +1           Set_LED_0 MACRO
                +1           ENDM
                +1           Clear_LED_0 MACRO
                +1           ENDM
                +1           Set_LED_1 MACRO
                +1           ENDM
                +1           Clear_LED_1 MACRO
                +1           ENDM
                +1           Set_LED_2 MACRO
                +1           ENDM
                +1           Clear_LED_2 MACRO
                +1           ENDM
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   307

                +1           Set_LED_3 MACRO
                +1           ENDM
                +1           Clear_LED_3 MACRO
                +1           ENDM
                             ENDIF
                   19908     
                   19909     IF ESCNO == P_
                             ;$include (P.inc) ; Select pinout P
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; BLHeli program for controlling brushless motors in helicopters and multirotors
                +1           ;
                +1           ; Copyright 2011, 2012 Steffen Skaug
                +1           ; This program is distributed under the terms of the GNU General Public License
                +1           ;
                +1           ; This file is part of BLHeli.
                +1           ;
                +1           ; BLHeli is free software: you can redistribute it and/or modify
                +1           ; it under the terms of the GNU General Public License as published by
                +1           ; the Free Software Foundation, either version 3 of the License, or
                +1           ; (at your option) any later version.
                +1           ;
                +1           ; BLHeli is distributed in the hope that it will be useful,
                +1           ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                +1           ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                +1           ; GNU General Public License for more details.
                +1           ;
                +1           ; You should have received a copy of the GNU General Public License
                +1           ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                +1           ;
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; Hardware definition file "P".
                +1           ; X  X  RC MA CC MB MC X     X  Cc Bc Ac Cp Bp Ap X    
                +1           ;
                +1           ;**** **** **** **** ****
                +1           
                +1           
                +1           
                +1           ;*********************
                +1           ; Device SiLabs EFM8BB1x/2x
                +1           ;*********************
                +1           IF MCU_48MHZ == 0
                +1           ;$include (SI_EFM8BB1_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB10F2G
                +2           ;  EFM8BB10F2I
                +2           ;  EFM8BB10F2Y
                +2           ;  EFM8BB10F4G
                +2           ;  EFM8BB10F4I
                +2           ;  EFM8BB10F4Y
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8Y
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   308

                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC      DATA 0E0H; Accumulator                            
                +2           ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF   DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B        DATA 0F0H; B Register                             
                +2           CKCON0   DATA 08EH; Clock Control 0                        
                +2           CLKSEL   DATA 0A9H; Clock Select                           
                +2           CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0MD   DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                +2           CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN   DATA 0DDH; CRC0 Data Input                        
                +2           DERIVID  DATA 0ADH; Derivative Identification              
                +2           DEVICEID DATA 0B5H; Device Identification                  
                +2           DPH      DATA 083H; Data Pointer High                      
                +2           DPL      DATA 082H; Data Pointer Low                       
                +2           EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                +2           FLKEY    DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           IE       DATA 0A8H; Interrupt Enable                       
                +2           IP       DATA 0B8H; Interrupt Priority                     
                +2           IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0       DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK   DATA 0FEH; Port 0 Mask                            
                +2           P0MAT    DATA 0FDH; Port 0 Match                           
                +2           P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP   DATA 0D4H; Port 0 Skip                            
                +2           P1       DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK   DATA 0EEH; Port 1 Mask                            
                +2           P1MAT    DATA 0EDH; Port 1 Match                           
                +2           P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP   DATA 0D5H; Port 1 Skip                            
                +2           P2       DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                +2           PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0  DATA 0D8H; PCA Control                            
                +2           PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   309

                +2           PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD   DATA 0D9H; PCA Mode                               
                +2           PCA0POL  DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0    DATA 087H; Power Control                          
                +2           PRTDRV   DATA 0F6H; Port Drive Strength                    
                +2           PSCTL    DATA 08FH; Program Store Control                  
                +2           PSW      DATA 0D0H; Program Status Word                    
                +2           REF0CN   DATA 0D1H; Voltage Reference Control              
                +2           REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                +2           REVID    DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC   DATA 0EFH; Reset Source                           
                +2           SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                +2           SCON0    DATA 098H; UART0 Serial Port Control              
                +2           SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                +2           SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SP       DATA 081H; Stack Pointer                          
                +2           SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0  DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT  DATA 0A3H; SPI0 Data                              
                +2           TCON     DATA 088H; Timer 0/1 Control                      
                +2           TH0      DATA 08CH; Timer 0 High Byte                      
                +2           TH1      DATA 08DH; Timer 1 High Byte                      
                +2           TL0      DATA 08AH; Timer 0 Low Byte                       
                +2           TL1      DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD     DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2H    DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0  DATA 091H; Timer 3 Control 0                      
                +2           TMR3H    DATA 095H; Timer 3 High Byte                      
                +2           TMR3L    DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                +2           VDM0CN   DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN    DATA 097H; Watchdog Timer Control                 
                +2           XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   310

                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   311

                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   312

                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +1           
                +1           ELSE
                +1           ;$include (SI_EFM8BB2_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB21F16G_QFN20
                +2           ;  EFM8BB21F16G_QSOP24
                +2           ;  EFM8BB21F16I_QFN20
                +2           ;  EFM8BB21F16I_QSOP24
                +2           ;  EFM8BB22F16G_QFN28
                +2           ;  EFM8BB22F16I_QFN28
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC       DATA 0E0H; Accumulator                            
                +2           ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF    DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   313

                +2           ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B         DATA 0F0H; B Register                             
                +2           CKCON0    DATA 08EH; Clock Control 0                        
                +2           CKCON1    DATA 0A6H; Clock Control 1
                +2           CLKSEL    DATA 0A9H; Clock Select                           
                +2           CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0CN1   DATA 099H; Comparator 0 Control 1
                +2           CMP0MD    DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                +2           CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CN1   DATA 086H; CRC0 Control 1                         
                +2           CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN    DATA 0DDH; CRC0 Data Input                        
                +2           CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                +2           DERIVID   DATA 0ADH; Derivative Identification              
                +2           DEVICEID  DATA 0B5H; Device Identification                  
                +2           DPH       DATA 083H; Data Pointer High                      
                +2           DPL       DATA 082H; Data Pointer Low                       
                +2           EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                +2           EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                +2           EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                +2           EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                +2           EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                +2           EMI0CN    DATA 0E7H; External Memory Interface Control      
                +2           FLKEY     DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                +2           HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                +2           I2C0CN0   DATA 0BAH; I2C0 Control                           
                +2           I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                +2           I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                +2           I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                +2           I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                +2           I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                +2           I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                +2           I2C0STAT  DATA 0B9H; I2C0 Status                            
                +2           IE        DATA 0A8H; Interrupt Enable                       
                +2           IP        DATA 0B8H; Interrupt Priority                     
                +2           IPH       DATA 0F2H; Interrupt Priority High                
                +2           IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0        DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK    DATA 0FEH; Port 0 Mask                            
                +2           P0MAT     DATA 0FDH; Port 0 Match                           
                +2           P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP    DATA 0D4H; Port 0 Skip                            
                +2           P1        DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK    DATA 0EEH; Port 1 Mask                            
                +2           P1MAT     DATA 0EDH; Port 1 Match                           
                +2           P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP    DATA 0D5H; Port 1 Skip                            
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   314

                +2           P2        DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MASK    DATA 0FCH; Port 2 Mask                            
                +2           P2MAT     DATA 0FBH; Port 2 Match                           
                +2           P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                +2           P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                +2           P2SKIP    DATA 0CCH; Port 2 Skip                            
                +2           P3        DATA 0B0H; Port 3 Pin Latch                       
                +2           P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                +2           P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                +2           PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0   DATA 0D8H; PCA Control                            
                +2           PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD    DATA 0D9H; PCA Mode                               
                +2           PCA0POL   DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0     DATA 087H; Power Control                          
                +2           PCON1     DATA 09AH; Power Control 1                        
                +2           PFE0CN    DATA 0C1H; Prefetch Engine Control                
                +2           PRTDRV    DATA 0F6H; Port Drive Strength                    
                +2           PSCTL     DATA 08FH; Program Store Control                  
                +2           PSW       DATA 0D0H; Program Status Word                    
                +2           REF0CN    DATA 0D1H; Voltage Reference Control              
                +2           REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                +2           REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                +2           REVID     DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC    DATA 0EFH; Reset Source                           
                +2           SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                +2           SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                +2           SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                +2           SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                +2           SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                +2           SCON0     DATA 098H; UART0 Serial Port Control              
                +2           SCON1     DATA 0C8H; UART1 Serial Port Control              
                +2           SFRPAGE   DATA 0A7H; SFR Page                               
                +2           SFRPGCN   DATA 0CFH; SFR Page Control                       
                +2           SFRSTACK  DATA 0D7H; SFR Page Stack                         
                +2           SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                +2           SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                +2           SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                +2           SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                +2           SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                +2           SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SMOD1     DATA 093H; UART1 Mode                             
                +2           SP        DATA 081H; Stack Pointer                          
                +2           SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0   DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT   DATA 0A3H; SPI0 Data                              
                +2           SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                +2           SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                +2           SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   315

                +2           TCON      DATA 088H; Timer 0/1 Control                      
                +2           TH0       DATA 08CH; Timer 0 High Byte                      
                +2           TH1       DATA 08DH; Timer 1 High Byte                      
                +2           TL0       DATA 08AH; Timer 0 Low Byte                       
                +2           TL1       DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD      DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                +2           TMR2H     DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0   DATA 091H; Timer 3 Control 0                      
                +2           TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                +2           TMR3H     DATA 095H; Timer 3 High Byte                      
                +2           TMR3L     DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                +2           TMR4CN0   DATA 098H; Timer 4 Control 0                      
                +2           TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                +2           TMR4H     DATA 0A5H; Timer 4 High Byte                      
                +2           TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                +2           TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                +2           TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                +2           UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                +2           UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                +2           UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                +2           UART1LIN  DATA 09EH; UART1 LIN Configuration                
                +2           VDM0CN    DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN     DATA 097H; Watchdog Timer Control                 
                +2           XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                +2           TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   316

                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   317

                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                +2           P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                +2           
                +2           ; P3 0xB0 (Port 3 Pin Latch)
                +2           P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                +2           P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SCON1 0xC8 (UART1 Serial Port Control)
                +2           SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                +2           SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                +2           SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                +2           SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                +2           SCON1_REN  BIT SCON1.4 ; Receive Enable           
                +2           SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                +2           SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   318

                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                +2           TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                +2           
                +2           ; TMR4CN0 0x98 (Timer 4 Control 0)
                +2           TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                +2           TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                +2           TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                +2           TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                +2           TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                +2           TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                +2           TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                +2           TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                +2           
                +2           ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                +2           UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                +2           UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                +2           UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                +2           UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                +2           UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                +2           UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                +2           UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                +2           UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +2           UART1_IRQn   EQU 17 ; UART1                     
                +2           I2C0_IRQn    EQU 18 ; I2C0 Slave                
                +2           TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; SFR Page Definitions
                +2           ;------------------------------------------------------------------------------
                +2           CRC0_PAGE       EQU 000H ; CRC0 Page       
                +2           LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                +2           PCA0_PAGE       EQU 000H ; PCA0 Page       
                +2           PG2_PAGE        EQU 010H ; Page2           
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   319

                +2           TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                +2           TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                +2           TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                +2           I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                +2           PG3_PAGE        EQU 020H ; Page3           
                +2           SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                +2           SPI0_PAGE       EQU 020H ; SPI0 Page       
                +2           UART0_PAGE      EQU 020H ; UART0 Page      
                +2           UART1_PAGE      EQU 020H ; UART1 Page      
                +1           
                +1           ENDIF
                +1           
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Uses internal calibrated oscillator set to 24/48Mhz
                +1           ;**** **** **** **** ****
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Constant definitions
                +1           ;**** **** **** **** ****
                +1           IF MCU_48MHZ == 0
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#P_L_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#P_L_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#P_L_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#P_L_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#P_L_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#P_L_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#P_L_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#P_L_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#P_L_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#P_L_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#P_L_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (16 B
                             ytes)
                +1           
                +1           ELSE
                +1           
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#P_H_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#P_H_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#P_H_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#P_H_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#P_H_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#P_H_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#P_H_30#        "
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   320

                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#P_H_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#P_H_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#P_H_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#P_H_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (16 B
                             ytes)
                +1           ENDIF
                +1           
                +1           TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for whi
                             ch main motor power is limited at 80degC (low byte, assuming high byte is 1)
                +1           TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment for a
                             nother 10degC
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Bootloader definitions
                +1           ;**** **** **** **** ****
                +1           RTX_PORT                                EQU     P0              ; Receive/Transmit port
                +1           RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL            
                                          
                +1           RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL             
                                          
                +1           RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP                
                                          
                +1           RTX_PIN                         EQU     5               ; RTX pin
                +1           
                +1           SIGNATURE_001                   EQU     0E8h            ; Device signature
                +1           IF MCU_48MHZ == 0
                +1           SIGNATURE_002                   EQU     0B1h
                +1           ELSE
                +1           SIGNATURE_002                   EQU     0B2h
                +1           ENDIF
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 0 definitions *
                +1           ;*********************  
                +1           ;                       EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           Rcp_In          EQU     5       ;i
                +1           Mux_A           EQU     4       ;i
                +1           Comp_Com                EQU     3       ;i
                +1           Mux_B           EQU     2       ;i
                +1           Mux_C           EQU     1       ;i
                +1           ;                       EQU     0       ;i
                +1           
                +1           P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                +1           P0_INIT         EQU     0FFh
                +1           P0_PUSHPULL     EQU     0
                +1           P0_SKIP         EQU     0FFh
                +1           
                +1           Get_Rcp_Capture_Values MACRO
                +1                   anl     TCON, #0EFh                             ; Disable timer0
                +1                   mov     Temp1, TL0                              ; Get timer0 values
                +1                   mov     Temp2, TH0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Temp3, Timer0_X
                +1                   jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                +1                   inc     Temp3                                   ; If it is pending, then timer has 
                             already wrapped
                +1           ENDIF
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   321

                +1                   mov     TL0, #0                                 ; Reset timer0
                +1                   mov     TH0, #0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Timer0_X, #0
                +1           ENDIF
                +1                   orl     TCON, #10h                              ; Enable timer0 again
                +1           IF MCU_48MHZ == 1
                +1                   mov     A, Clock_Set_At_48MHz
                +1                   jnz     Get_Rcp_End
                +1                   clr     C
                +1                   mov     A, Temp1
                +1                   rlc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Temp2
                +1                   rlc     A
                +1                   mov     Temp2, A
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1           Get_Rcp_End:
                +1           ENDIF
                +1           ENDM
                +1           Decode_Dshot_2Msb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp4                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp4
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL
                +1           ENDM
                +1           Decode_Dshot_2Lsb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp3                                        ; Shift bit into data byte
                +1                   rlc     A
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   322

                +1                   mov     Temp3, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL
                +1           ENDM
                +1           Initialize_PCA MACRO
                +1                   mov     PCA0CN0, #40h                           ; PCA enabled
                +1                   mov     PCA0MD, #08h                            ; PCA clock is system clock
                +1           IF FETON_DELAY == 0
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #00h                          ; Edge aligned pwm
                +1           ELSE
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #03h                          ; Center aligned pwm
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_Polarity MACRO
                +1                   mov     PCA0POL, #02h                           ; Damping inverted, pwm noninverted
                +1           ENDM
                +1           Enable_Power_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, enab
                             le match, set pwm mode
                +1           ELSE
                +1                   mov     PCA0CPM0, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Enable_Damp_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM1, #00h                          ; Disable
                +1           ELSE
                +1                   mov     PCA0CPM1, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Set_Power_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL0, Power_Pwm_Reg_L
                +1                   mov     PCA0CPH0, Power_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Power_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Power_Pwm_Reg_L
                +1                   rrc     A
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   323

                +1                   mov     PCA0CPL0, A
                +1                   mov     PCA0CPH0, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Set_Damp_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL1, Damp_Pwm_Reg_L
                +1                   mov     PCA0CPH1, Damp_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Damp_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Damp_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL1, A
                +1                   mov     PCA0CPH1, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Clear_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0DFh
                +1           ENDM
                +1           Clear_CCF_Interrupt MACRO
                +1                   anl     PCA0CN0, #0FEh
                +1           ENDM
                +1           Enable_COVF_Interrupt MACRO
                +1                   orl     PCA0PWM, #40h
                +1           ENDM
                +1           Enable_CCF_Interrupt MACRO
                +1                   orl     PCA0CPM0,#01h
                +1           ENDM
                +1           Disable_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0BFh
                +1           ENDM
                +1           Disable_CCF_Interrupt MACRO
                +1                   anl     PCA0CPM0,#0FEh
                +1           ENDM
                +1           
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 1 definitions *
                +1           ;*********************
                +1           ;                       EQU     7       ;i
                +1           CcomFET         EQU     6       ;o
                +1           BcomFET         EQU     5       ;o
                +1           AcomFET         EQU     4       ;o
                +1           CpwmFET         EQU     3       ;i
                +1           BpwmFET         EQU     2       ;o 
                +1           ApwmFET         EQU     1       ;o
                +1           ;                       EQU     0       ;o
                +1           
                +1           P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_INIT         EQU     00h             
                +1           P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_SKIP         EQU     7Fh
                +1           
                +1           ApwmFET_on MACRO
                +1                   setb    P1.ApwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           ApwmFET_off MACRO
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   324

                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_on MACRO
                +1                   setb    P1.BpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.BpwmFET
                +1           ELSE
                +1                   clr     P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_on MACRO
                +1                   setb    P1.CpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           All_pwmFETs_Off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1                   clr     P1.BpwmFET
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           
                +1           AcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.ApwmFET
                +1           ENDIF
                +1                   setb    P1.AcomFET
                +1           ENDM
                +1           AcomFET_off MACRO
                +1                   clr     P1.AcomFET
                +1           ENDM
                +1           BcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.BpwmFET
                +1           ENDIF
                +1                   setb    P1.BcomFET
                +1           ENDM
                +1           BcomFET_off MACRO
                +1                   clr     P1.BcomFET
                +1           ENDM
                +1           CcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.CpwmFET
                +1           ENDIF
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   325

                +1                   setb    P1.CcomFET
                +1           ENDM
                +1           CcomFET_off MACRO
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           All_comFETs_Off MACRO
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           
                +1           Set_Pwm_A MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1                   mov     P1SKIP, #7Dh
                +1           ELSE
                +1                   mov     P1SKIP, #6Dh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_B MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1                   mov     P1SKIP, #7Bh
                +1           ELSE
                +1                   mov     P1SKIP, #5Bh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_C MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1                   mov     P1SKIP, #77h
                +1           ELSE
                +1                   mov     P1SKIP, #37h
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwms_Off MACRO
                +1                   mov     P1SKIP, #7Fh
                +1           ENDM
                +1           
                +1           Set_Comp_Phase_A MACRO
                +1                   mov     CMP0MX, #43h    ; Set comparator multiplexer to phase A
                +1           ENDM
                +1           Set_Comp_Phase_B MACRO
                +1                   mov     CMP0MX, #23h    ; Set comparator multiplexer to phase B
                +1           ENDM
                +1           Set_Comp_Phase_C MACRO
                +1                   mov     CMP0MX, #13h    ; Set comparator multiplexer to phase C
                +1           ENDM
                +1           Read_Comp_Out MACRO
                +1                   mov     A, CMP0CN0      ; Read comparator output
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 2 definitions *
                +1           ;*********************
                +1           DebugPin                EQU     0       ;o
                +1           
                +1           P2_PUSHPULL     EQU     (1 SHL DebugPin)
                +1           
                +1           
                +1           ;**********************
                +1           ; MCU specific macros *
                +1           ;**********************
                +1           Interrupt_Table_Definition MACRO
                +1           CSEG AT 0                               ; Code segment start
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   326

                +1                   jmp reset
                +1           CSEG AT 03h                     ; Int0 interrupt        
                +1                   jmp     int0_int        
                +1           IF MCU_48MHZ == 1
                +1           CSEG AT 0Bh                     ; Timer0 overflow interrupt
                +1                   jmp     t0_int
                +1           ENDIF
                +1           CSEG AT 13h                     ; Int1 interrupt
                +1                   jmp     int1_int
                +1           CSEG AT 1Bh                     ; Timer1 overflow interrupt
                +1                   jmp     t1_int
                +1           CSEG AT 2Bh                     ; Timer2 overflow interrupt
                +1                   jmp     t2_int  
                +1           CSEG AT 5Bh                     ; Pca interrupt
                +1                   jmp     pca_int
                +1           CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                +1                   jmp     t3_int  
                +1           ENDM
                +1           
                +1           Initialize_Xbar MACRO
                +1                   mov     XBR2, #40h      ; Xbar enabled                  
                +1                   mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                +1           ENDM
                +1           
                +1           Initialize_Comparator MACRO
                +1                   mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                +1                   mov     CMP0MD, #00h    ; Comparator response time 100ns
                +1           ENDM
                +1           Initialize_Adc MACRO
                +1                   mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bias
                +1           IF MCU_48MHZ == 0
                +1                   mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                +1           ELSE
                +1                   mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                +1           ENDIF
                +1                   mov     ADC0MX, #10h    ; Select temp sensor input
                +1                   mov     ADC0CN0, #80h   ; ADC enabled 
                +1                   mov     ADC0CN1, #01h   ; Common mode buffer enabled
                +1           ENDM
                +1           Start_Adc MACRO
                +1                   mov     ADC0CN0, #90h   ; ADC start
                +1           ENDM
                +1           Read_Adc_Result MACRO
                +1                   mov     Temp1, ADC0L
                +1                   mov     Temp2, ADC0H
                +1           ENDM
                +1           Stop_Adc MACRO
                +1           ENDM
                +1           Set_RPM_Out MACRO
                +1           ENDM
                +1           Clear_RPM_Out MACRO
                +1           ENDM
                +1           Set_MCU_Clk_24MHz MACRO
                +1                   mov     CLKSEL, #13h            ; Set clock to 24MHz
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     Clock_Set_At_48MHz, #0
                +1           ENDM
                +1           Set_MCU_Clk_48MHz MACRO
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     CLKSEL, #03h            ; Set clock to 48MHz
                +1                   mov     Clock_Set_At_48MHz, #1
                +1           ENDM
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   327

                +1           Set_LED_0 MACRO
                +1           ENDM
                +1           Clear_LED_0 MACRO
                +1           ENDM
                +1           Set_LED_1 MACRO
                +1           ENDM
                +1           Clear_LED_1 MACRO
                +1           ENDM
                +1           Set_LED_2 MACRO
                +1           ENDM
                +1           Clear_LED_2 MACRO
                +1           ENDM
                +1           Set_LED_3 MACRO
                +1           ENDM
                +1           Clear_LED_3 MACRO
                +1           ENDM
                             ENDIF
                   21223     
                   21224     IF ESCNO == Q_
                             ;$include (Q.inc) ; Select pinout Q
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; BLHeli program for controlling brushless motors in helicopters and multirotors
                +1           ;
                +1           ; Copyright 2011, 2012 Steffen Skaug
                +1           ; This program is distributed under the terms of the GNU General Public License
                +1           ;
                +1           ; This file is part of BLHeli.
                +1           ;
                +1           ; BLHeli is free software: you can redistribute it and/or modify
                +1           ; it under the terms of the GNU General Public License as published by
                +1           ; the Free Software Foundation, either version 3 of the License, or
                +1           ; (at your option) any later version.
                +1           ;
                +1           ; BLHeli is distributed in the hope that it will be useful,
                +1           ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                +1           ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                +1           ; GNU General Public License for more details.
                +1           ;
                +1           ; You should have received a copy of the GNU General Public License
                +1           ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                +1           ;
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; Hardware definition file "Q"
                +1           ; Cp Bp Ap L1 L0 X  RC X     X  MA MB MC CC Cc Bc Ac
                +1           ;
                +1           ;**** **** **** **** ****
                +1           
                +1           
                +1           
                +1           ;*********************
                +1           ; Device SiLabs EFM8BB1x/2x
                +1           ;*********************
                +1           IF MCU_48MHZ == 0
                +1           ;$include (SI_EFM8BB1_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB10F2G
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   328

                +2           ;  EFM8BB10F2I
                +2           ;  EFM8BB10F2Y
                +2           ;  EFM8BB10F4G
                +2           ;  EFM8BB10F4I
                +2           ;  EFM8BB10F4Y
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC      DATA 0E0H; Accumulator                            
                +2           ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF   DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B        DATA 0F0H; B Register                             
                +2           CKCON0   DATA 08EH; Clock Control 0                        
                +2           CLKSEL   DATA 0A9H; Clock Select                           
                +2           CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0MD   DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                +2           CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN   DATA 0DDH; CRC0 Data Input                        
                +2           DERIVID  DATA 0ADH; Derivative Identification              
                +2           DEVICEID DATA 0B5H; Device Identification                  
                +2           DPH      DATA 083H; Data Pointer High                      
                +2           DPL      DATA 082H; Data Pointer Low                       
                +2           EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                +2           FLKEY    DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           IE       DATA 0A8H; Interrupt Enable                       
                +2           IP       DATA 0B8H; Interrupt Priority                     
                +2           IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0       DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK   DATA 0FEH; Port 0 Mask                            
                +2           P0MAT    DATA 0FDH; Port 0 Match                           
                +2           P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP   DATA 0D4H; Port 0 Skip                            
                +2           P1       DATA 090H; Port 1 Pin Latch                       
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   329

                +2           P1MASK   DATA 0EEH; Port 1 Mask                            
                +2           P1MAT    DATA 0EDH; Port 1 Match                           
                +2           P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP   DATA 0D5H; Port 1 Skip                            
                +2           P2       DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                +2           PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0  DATA 0D8H; PCA Control                            
                +2           PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD   DATA 0D9H; PCA Mode                               
                +2           PCA0POL  DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0    DATA 087H; Power Control                          
                +2           PRTDRV   DATA 0F6H; Port Drive Strength                    
                +2           PSCTL    DATA 08FH; Program Store Control                  
                +2           PSW      DATA 0D0H; Program Status Word                    
                +2           REF0CN   DATA 0D1H; Voltage Reference Control              
                +2           REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                +2           REVID    DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC   DATA 0EFH; Reset Source                           
                +2           SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                +2           SCON0    DATA 098H; UART0 Serial Port Control              
                +2           SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                +2           SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SP       DATA 081H; Stack Pointer                          
                +2           SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0  DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT  DATA 0A3H; SPI0 Data                              
                +2           TCON     DATA 088H; Timer 0/1 Control                      
                +2           TH0      DATA 08CH; Timer 0 High Byte                      
                +2           TH1      DATA 08DH; Timer 1 High Byte                      
                +2           TL0      DATA 08AH; Timer 0 Low Byte                       
                +2           TL1      DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD     DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2H    DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0  DATA 091H; Timer 3 Control 0                      
                +2           TMR3H    DATA 095H; Timer 3 High Byte                      
                +2           TMR3L    DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                +2           VDM0CN   DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN    DATA 097H; Watchdog Timer Control                 
                +2           XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2     DATA 0E3H; Port I/O Crossbar 2                    
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   330

                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   331

                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   332

                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +1           
                +1           ELSE
                +1           ;$include (SI_EFM8BB2_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB21F16G_QFN20
                +2           ;  EFM8BB21F16G_QSOP24
                +2           ;  EFM8BB21F16I_QFN20
                +2           ;  EFM8BB21F16I_QSOP24
                +2           ;  EFM8BB22F16G_QFN28
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   333

                +2           ;  EFM8BB22F16I_QFN28
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC       DATA 0E0H; Accumulator                            
                +2           ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF    DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B         DATA 0F0H; B Register                             
                +2           CKCON0    DATA 08EH; Clock Control 0                        
                +2           CKCON1    DATA 0A6H; Clock Control 1
                +2           CLKSEL    DATA 0A9H; Clock Select                           
                +2           CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0CN1   DATA 099H; Comparator 0 Control 1
                +2           CMP0MD    DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                +2           CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CN1   DATA 086H; CRC0 Control 1                         
                +2           CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN    DATA 0DDH; CRC0 Data Input                        
                +2           CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                +2           DERIVID   DATA 0ADH; Derivative Identification              
                +2           DEVICEID  DATA 0B5H; Device Identification                  
                +2           DPH       DATA 083H; Data Pointer High                      
                +2           DPL       DATA 082H; Data Pointer Low                       
                +2           EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                +2           EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                +2           EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                +2           EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                +2           EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                +2           EMI0CN    DATA 0E7H; External Memory Interface Control      
                +2           FLKEY     DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                +2           HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                +2           I2C0CN0   DATA 0BAH; I2C0 Control                           
                +2           I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                +2           I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                +2           I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                +2           I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                +2           I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                +2           I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                +2           I2C0STAT  DATA 0B9H; I2C0 Status                            
                +2           IE        DATA 0A8H; Interrupt Enable                       
                +2           IP        DATA 0B8H; Interrupt Priority                     
                +2           IPH       DATA 0F2H; Interrupt Priority High                
                +2           IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   334

                +2           P0        DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK    DATA 0FEH; Port 0 Mask                            
                +2           P0MAT     DATA 0FDH; Port 0 Match                           
                +2           P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP    DATA 0D4H; Port 0 Skip                            
                +2           P1        DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK    DATA 0EEH; Port 1 Mask                            
                +2           P1MAT     DATA 0EDH; Port 1 Match                           
                +2           P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP    DATA 0D5H; Port 1 Skip                            
                +2           P2        DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MASK    DATA 0FCH; Port 2 Mask                            
                +2           P2MAT     DATA 0FBH; Port 2 Match                           
                +2           P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                +2           P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                +2           P2SKIP    DATA 0CCH; Port 2 Skip                            
                +2           P3        DATA 0B0H; Port 3 Pin Latch                       
                +2           P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                +2           P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                +2           PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0   DATA 0D8H; PCA Control                            
                +2           PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD    DATA 0D9H; PCA Mode                               
                +2           PCA0POL   DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0     DATA 087H; Power Control                          
                +2           PCON1     DATA 09AH; Power Control 1                        
                +2           PFE0CN    DATA 0C1H; Prefetch Engine Control                
                +2           PRTDRV    DATA 0F6H; Port Drive Strength                    
                +2           PSCTL     DATA 08FH; Program Store Control                  
                +2           PSW       DATA 0D0H; Program Status Word                    
                +2           REF0CN    DATA 0D1H; Voltage Reference Control              
                +2           REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                +2           REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                +2           REVID     DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC    DATA 0EFH; Reset Source                           
                +2           SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                +2           SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                +2           SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                +2           SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                +2           SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                +2           SCON0     DATA 098H; UART0 Serial Port Control              
                +2           SCON1     DATA 0C8H; UART1 Serial Port Control              
                +2           SFRPAGE   DATA 0A7H; SFR Page                               
                +2           SFRPGCN   DATA 0CFH; SFR Page Control                       
                +2           SFRSTACK  DATA 0D7H; SFR Page Stack                         
                +2           SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                +2           SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                +2           SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   335

                +2           SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                +2           SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                +2           SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SMOD1     DATA 093H; UART1 Mode                             
                +2           SP        DATA 081H; Stack Pointer                          
                +2           SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0   DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT   DATA 0A3H; SPI0 Data                              
                +2           SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                +2           SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                +2           SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                +2           TCON      DATA 088H; Timer 0/1 Control                      
                +2           TH0       DATA 08CH; Timer 0 High Byte                      
                +2           TH1       DATA 08DH; Timer 1 High Byte                      
                +2           TL0       DATA 08AH; Timer 0 Low Byte                       
                +2           TL1       DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD      DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                +2           TMR2H     DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0   DATA 091H; Timer 3 Control 0                      
                +2           TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                +2           TMR3H     DATA 095H; Timer 3 High Byte                      
                +2           TMR3L     DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                +2           TMR4CN0   DATA 098H; Timer 4 Control 0                      
                +2           TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                +2           TMR4H     DATA 0A5H; Timer 4 High Byte                      
                +2           TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                +2           TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                +2           TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                +2           UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                +2           UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                +2           UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                +2           UART1LIN  DATA 09EH; UART1 LIN Configuration                
                +2           VDM0CN    DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN     DATA 097H; Watchdog Timer Control                 
                +2           XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                +2           TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   336

                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   337

                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                +2           P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                +2           
                +2           ; P3 0xB0 (Port 3 Pin Latch)
                +2           P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                +2           P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SCON1 0xC8 (UART1 Serial Port Control)
                +2           SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                +2           SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                +2           SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                +2           SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                +2           SCON1_REN  BIT SCON1.4 ; Receive Enable           
                +2           SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                +2           SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   338

                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                +2           TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                +2           
                +2           ; TMR4CN0 0x98 (Timer 4 Control 0)
                +2           TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                +2           TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                +2           TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                +2           TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                +2           TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                +2           TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                +2           TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                +2           TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                +2           
                +2           ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                +2           UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                +2           UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                +2           UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                +2           UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                +2           UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                +2           UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                +2           UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                +2           UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   339

                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +2           UART1_IRQn   EQU 17 ; UART1                     
                +2           I2C0_IRQn    EQU 18 ; I2C0 Slave                
                +2           TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; SFR Page Definitions
                +2           ;------------------------------------------------------------------------------
                +2           CRC0_PAGE       EQU 000H ; CRC0 Page       
                +2           LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                +2           PCA0_PAGE       EQU 000H ; PCA0 Page       
                +2           PG2_PAGE        EQU 010H ; Page2           
                +2           TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                +2           TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                +2           TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                +2           I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                +2           PG3_PAGE        EQU 020H ; Page3           
                +2           SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                +2           SPI0_PAGE       EQU 020H ; SPI0 Page       
                +2           UART0_PAGE      EQU 020H ; UART0 Page      
                +2           UART1_PAGE      EQU 020H ; UART1 Page      
                +1           
                +1           ENDIF
                +1           
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Uses internal calibrated oscillator set to 24/48Mhz
                +1           ;**** **** **** **** ****
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Constant definitions
                +1           ;**** **** **** **** ****
                +1           IF MCU_48MHZ == 0
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#Q_L_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#Q_L_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#Q_L_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#Q_L_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#Q_L_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#Q_L_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#Q_L_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#Q_L_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#Q_L_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#Q_L_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#Q_L_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (16 B
                             ytes)
                +1           
                +1           ELSE
                +1           
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#Q_H_00#        "      ; ESC layout tag
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   340

                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#Q_H_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#Q_H_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#Q_H_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#Q_H_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#Q_H_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#Q_H_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#Q_H_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#Q_H_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#Q_H_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#Q_H_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (16 B
                             ytes)
                +1           ENDIF
                +1           
                +1           TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for whi
                             ch main motor power is limited at 80degC (low byte, assuming high byte is 1)
                +1           TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment for a
                             nother 10degC
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Bootloader definitions
                +1           ;**** **** **** **** ****
                +1           RTX_PORT                                EQU     P0              ; Receive/Transmit port
                +1           RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL            
                                          
                +1           RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL             
                                          
                +1           RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP                
                                          
                +1           RTX_PIN                         EQU     1               ; RTX pin
                +1           
                +1           SIGNATURE_001                   EQU     0E8h            ; Device signature
                +1           IF MCU_48MHZ == 0
                +1           SIGNATURE_002                   EQU     0B1h
                +1           ELSE
                +1           SIGNATURE_002                   EQU     0B2h
                +1           ENDIF
                +1           
                +1           ;*********************
                +1           ; PORT 0 definitions *
                +1           ;*********************  
                +1           CpwmFET         EQU     7       ;o
                +1           BpwmFET         EQU     6       ;o
                +1           ApwmFET         EQU     5       ;o
                +1           LED_1           EQU     4       ;i
                +1           LED_0           EQU     3       ;i
                +1           ;                       EQU     2       ;i
                +1           Rcp_In          EQU     1       ;i
                +1           ;                       EQU     0       ;i
                +1           
                +1           P0_DIGITAL      EQU     0FFh
                +1           P0_INIT         EQU     (1 SHL Rcp_In)
                +1           P0_PUSHPULL     EQU     (1 SHL LED_0)+(1 SHL LED_1)+(1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL 
                             CpwmFET)
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   341

                +1           P0_SKIP         EQU     0FFh
                +1           
                +1           Get_Rcp_Capture_Values MACRO
                +1                   anl     TCON, #0EFh                             ; Disable timer0
                +1                   mov     Temp1, TL0                              ; Get timer0 values
                +1                   mov     Temp2, TH0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Temp3, Timer0_X
                +1                   jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                +1                   inc     Temp3                                   ; If it is pending, then timer has 
                             already wrapped
                +1           ENDIF
                +1                   mov     TL0, #0                                 ; Reset timer0
                +1                   mov     TH0, #0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Timer0_X, #0
                +1           ENDIF
                +1                   orl     TCON, #10h                              ; Enable timer0 again
                +1           IF MCU_48MHZ == 1
                +1                   mov     A, Clock_Set_At_48MHz
                +1                   jnz     Get_Rcp_End
                +1                   clr     C
                +1                   mov     A, Temp1
                +1                   rlc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Temp2
                +1                   rlc     A
                +1                   mov     Temp2, A
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1           Get_Rcp_End:
                +1           ENDIF
                +1           ENDM
                +1           Decode_Dshot_2Msb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp4                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp4
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL
                +1           ENDM
                +1           Decode_Dshot_2Lsb MACRO
                +1                   movx    A, @DPTR
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   342

                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp3                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL
                +1           ENDM
                +1           Initialize_PCA MACRO
                +1                   mov     PCA0CN0, #40h                           ; PCA enabled
                +1                   mov     PCA0MD, #08h                            ; PCA clock is system clock
                +1           IF FETON_DELAY == 0
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #00h                          ; Edge aligned pwm
                +1           ELSE
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #03h                          ; Center aligned pwm
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_Polarity MACRO
                +1                   mov     PCA0POL, #02h                           ; Damping inverted, pwm noninverted
                +1           ENDM
                +1           Enable_Power_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, enab
                             le match, set pwm mode
                +1           ELSE
                +1                   mov     PCA0CPM0, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Enable_Damp_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM1, #00h                          ; Disable
                +1           ELSE
                +1                   mov     PCA0CPM1, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   343

                +1           ENDM
                +1           Set_Power_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL0, Power_Pwm_Reg_L
                +1                   mov     PCA0CPH0, Power_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Power_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Power_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL0, A
                +1                   mov     PCA0CPH0, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Set_Damp_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL1, Damp_Pwm_Reg_L
                +1                   mov     PCA0CPH1, Damp_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Damp_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Damp_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL1, A
                +1                   mov     PCA0CPH1, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Clear_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0DFh
                +1           ENDM
                +1           Clear_CCF_Interrupt MACRO
                +1                   anl     PCA0CN0, #0FEh
                +1           ENDM
                +1           Enable_COVF_Interrupt MACRO
                +1                   orl     PCA0PWM, #40h
                +1           ENDM
                +1           Enable_CCF_Interrupt MACRO
                +1                   orl     PCA0CPM0,#01h
                +1           ENDM
                +1           Disable_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0BFh
                +1           ENDM
                +1           Disable_CCF_Interrupt MACRO
                +1                   anl     PCA0CPM0,#0FEh
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 1 definitions *
                +1           ;*********************
                +1           ;                       EQU     7       ;i
                +1           Mux_A           EQU     6       ;i
                +1           Mux_B           EQU     5       ;i
                +1           Mux_C           EQU     4       ;i
                +1           Comp_Com                EQU     3       ;o
                +1           CcomFET         EQU     2       ;o
                +1           BcomFET         EQU     1       ;o
                +1           AcomFET         EQU     0       ;o
                +1           
                +1           P1_DIGITAL      EQU     (1 SHL AcomFET)+(1 SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_INIT         EQU     00h             
                +1           P1_PUSHPULL     EQU     (1 SHL AcomFET)+(1 SHL BcomFET)+(1 SHL CcomFET)
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   344

                +1           P1_SKIP         EQU     07h
                +1           
                +1           ApwmFET_on MACRO
                +1                   setb    P0.ApwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           ApwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P0.ApwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_on MACRO
                +1                   setb    P0.BpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P0.BpwmFET
                +1           ELSE
                +1                   clr     P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_on MACRO
                +1                   setb    P0.CpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P0.CpwmFET
                +1           ELSE
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           All_pwmFETs_Off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P0.ApwmFET
                +1                   clr     P0.BpwmFET
                +1                   clr     P0.CpwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           
                +1           AcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P0.ApwmFET
                +1           ENDIF
                +1                   setb    P1.AcomFET
                +1           ENDM
                +1           AcomFET_off MACRO
                +1                   clr     P1.AcomFET
                +1           ENDM
                +1           BcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P0.BpwmFET
                +1           ENDIF
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   345

                +1                   setb    P1.BcomFET
                +1           ENDM
                +1           BcomFET_off MACRO
                +1                   clr     P1.BcomFET
                +1           ENDM
                +1           CcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P0.CpwmFET
                +1           ENDIF
                +1                   setb    P1.CcomFET
                +1           ENDM
                +1           CcomFET_off MACRO
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           All_comFETs_Off MACRO
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           
                +1           Set_Pwm_A MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1                   mov     P0SKIP, #0DFh
                +1                   mov     P1SKIP, #07h
                +1           ELSE
                +1                   mov     P0SKIP, #0DFh
                +1                   mov     P1SKIP, #06h
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_B MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1                   mov     P0SKIP, #0BFh
                +1                   mov     P1SKIP, #07h
                +1           ELSE
                +1                   mov     P0SKIP, #0BFh
                +1                   mov     P1SKIP, #05h
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_C MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1                   mov     P0SKIP, #07Fh
                +1                   mov     P1SKIP, #07h
                +1           ELSE
                +1                   mov     P0SKIP, #07Fh
                +1                   mov     P1SKIP, #03h
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwms_Off MACRO
                +1                   mov     P0SKIP, #0FFh
                +1                   mov     P1SKIP, #07h
                +1           ENDM
                +1           
                +1           Set_Comp_Phase_A MACRO
                +1                   mov     CMP1MX, #63h    ; Set comparator multiplexer to phase A
                +1           ENDM
                +1           Set_Comp_Phase_B MACRO
                +1                   mov     CMP1MX, #53h    ; Set comparator multiplexer to phase B
                +1           ENDM
                +1           Set_Comp_Phase_C MACRO
                +1                   mov     CMP1MX, #43h    ; Set comparator multiplexer to phase C
                +1           ENDM
                +1           Read_Comp_Out MACRO
                +1                   mov     A, CMP1CN0      ; Read comparator output
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   346

                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 2 definitions *
                +1           ;*********************
                +1           DebugPin                EQU     0       ;o
                +1           
                +1           P2_PUSHPULL     EQU     (1 SHL DebugPin)
                +1           
                +1           
                +1           ;**********************
                +1           ; MCU specific macros *
                +1           ;**********************
                +1           Interrupt_Table_Definition MACRO
                +1           CSEG AT 0                               ; Code segment start
                +1                   jmp reset
                +1           CSEG AT 03h                     ; Int0 interrupt        
                +1                   jmp     int0_int        
                +1           IF MCU_48MHZ == 1
                +1           CSEG AT 0Bh                     ; Timer0 overflow interrupt
                +1                   jmp     t0_int
                +1           ENDIF
                +1           CSEG AT 13h                     ; Int1 interrupt
                +1                   jmp     int1_int
                +1           CSEG AT 1Bh                     ; Timer1 overflow interrupt
                +1                   jmp     t1_int
                +1           CSEG AT 2Bh                     ; Timer2 overflow interrupt
                +1                   jmp     t2_int  
                +1           CSEG AT 5Bh                     ; Pca interrupt
                +1                   jmp     pca_int
                +1           CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                +1                   jmp     t3_int  
                +1           ENDM
                +1           
                +1           Initialize_Xbar MACRO
                +1                   mov     XBR2, #40h      ; Xbar enabled                  
                +1                   mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                +1           ENDM
                +1           
                +1           Initialize_Comparator MACRO
                +1                   mov     CMP1CN0, #80h   ; Comparator enabled, no hysteresis
                +1                   mov     CMP1MD, #00h    ; Comparator response time 100ns
                +1           ENDM
                +1           Initialize_Adc MACRO
                +1                   mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bias
                +1           IF MCU_48MHZ == 0
                +1                   mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                +1           ELSE
                +1                   mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                +1           ENDIF
                +1                   mov     ADC0MX, #10h    ; Select temp sensor input
                +1                   mov     ADC0CN0, #80h   ; ADC enabled 
                +1                   mov     ADC0CN1, #01h   ; Common mode buffer enabled
                +1           ENDM
                +1           Start_Adc MACRO
                +1                   mov     ADC0CN0, #90h   ; ADC start
                +1           ENDM
                +1           Read_Adc_Result MACRO
                +1                   mov     Temp1, ADC0L
                +1                   mov     Temp2, ADC0H
                +1           ENDM
                +1           Stop_Adc MACRO
                +1           ENDM
                +1           Set_RPM_Out MACRO
                +1           ENDM
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   347

                +1           Clear_RPM_Out MACRO
                +1           ENDM
                +1           Set_MCU_Clk_24MHz MACRO
                +1                   mov     CLKSEL, #13h            ; Set clock to 24MHz
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     Clock_Set_At_48MHz, #0
                +1           ENDM
                +1           Set_MCU_Clk_48MHz MACRO
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     CLKSEL, #03h            ; Set clock to 48MHz
                +1                   mov     Clock_Set_At_48MHz, #1
                +1           ENDM
                +1           Set_LED_0 MACRO
                +1                   setb    P0.LED_0
                +1           ENDM
                +1           Clear_LED_0 MACRO
                +1                   clr     P0.LED_0
                +1           ENDM
                +1           Set_LED_1 MACRO
                +1                   setb    P0.LED_1
                +1           ENDM
                +1           Clear_LED_1 MACRO
                +1                   clr     P0.LED_1
                +1           ENDM
                +1           Set_LED_2 MACRO
                +1           ENDM
                +1           Clear_LED_2 MACRO
                +1           ENDM
                +1           Set_LED_3 MACRO
                +1           ENDM
                +1           Clear_LED_3 MACRO
                +1           ENDM
                             ENDIF
                   22547     
                   22548     IF ESCNO == R_
                             ;$include (R.inc) ; Select pinout R
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; BLHeli program for controlling brushless motors in helicopters and multirotors
                +1           ;
                +1           ; Copyright 2011, 2012 Steffen Skaug
                +1           ; This program is distributed under the terms of the GNU General Public License
                +1           ;
                +1           ; This file is part of BLHeli.
                +1           ;
                +1           ; BLHeli is free software: you can redistribute it and/or modify
                +1           ; it under the terms of the GNU General Public License as published by
                +1           ; the Free Software Foundation, either version 3 of the License, or
                +1           ; (at your option) any later version.
                +1           ;
                +1           ; BLHeli is distributed in the hope that it will be useful,
                +1           ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                +1           ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                +1           ; GNU General Public License for more details.
                +1           ;
                +1           ; You should have received a copy of the GNU General Public License
                +1           ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                +1           ;
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; Hardware definition file "R".
                +1           ; X  X  RC X  MC MB MA CC    X  X  Ac Bc Cc Ap Bp Cp
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   348

                +1           ;
                +1           ;**** **** **** **** ****
                +1           
                +1           
                +1           
                +1           ;*********************
                +1           ; Device SiLabs EFM8BB1x/2x
                +1           ;*********************
                +1           IF MCU_48MHZ == 0
                +1           ;$include (SI_EFM8BB1_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB10F2G
                +2           ;  EFM8BB10F2I
                +2           ;  EFM8BB10F2Y
                +2           ;  EFM8BB10F4G
                +2           ;  EFM8BB10F4I
                +2           ;  EFM8BB10F4Y
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC      DATA 0E0H; Accumulator                            
                +2           ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF   DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B        DATA 0F0H; B Register                             
                +2           CKCON0   DATA 08EH; Clock Control 0                        
                +2           CLKSEL   DATA 0A9H; Clock Select                           
                +2           CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0MD   DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                +2           CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   349

                +2           CRC0IN   DATA 0DDH; CRC0 Data Input                        
                +2           DERIVID  DATA 0ADH; Derivative Identification              
                +2           DEVICEID DATA 0B5H; Device Identification                  
                +2           DPH      DATA 083H; Data Pointer High                      
                +2           DPL      DATA 082H; Data Pointer Low                       
                +2           EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                +2           FLKEY    DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           IE       DATA 0A8H; Interrupt Enable                       
                +2           IP       DATA 0B8H; Interrupt Priority                     
                +2           IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0       DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK   DATA 0FEH; Port 0 Mask                            
                +2           P0MAT    DATA 0FDH; Port 0 Match                           
                +2           P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP   DATA 0D4H; Port 0 Skip                            
                +2           P1       DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK   DATA 0EEH; Port 1 Mask                            
                +2           P1MAT    DATA 0EDH; Port 1 Match                           
                +2           P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP   DATA 0D5H; Port 1 Skip                            
                +2           P2       DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                +2           PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0  DATA 0D8H; PCA Control                            
                +2           PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD   DATA 0D9H; PCA Mode                               
                +2           PCA0POL  DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0    DATA 087H; Power Control                          
                +2           PRTDRV   DATA 0F6H; Port Drive Strength                    
                +2           PSCTL    DATA 08FH; Program Store Control                  
                +2           PSW      DATA 0D0H; Program Status Word                    
                +2           REF0CN   DATA 0D1H; Voltage Reference Control              
                +2           REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                +2           REVID    DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC   DATA 0EFH; Reset Source                           
                +2           SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                +2           SCON0    DATA 098H; UART0 Serial Port Control              
                +2           SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                +2           SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SP       DATA 081H; Stack Pointer                          
                +2           SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0  DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT  DATA 0A3H; SPI0 Data                              
                +2           TCON     DATA 088H; Timer 0/1 Control                      
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   350

                +2           TH0      DATA 08CH; Timer 0 High Byte                      
                +2           TH1      DATA 08DH; Timer 1 High Byte                      
                +2           TL0      DATA 08AH; Timer 0 Low Byte                       
                +2           TL1      DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD     DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2H    DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0  DATA 091H; Timer 3 Control 0                      
                +2           TMR3H    DATA 095H; Timer 3 High Byte                      
                +2           TMR3L    DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                +2           VDM0CN   DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN    DATA 097H; Watchdog Timer Control                 
                +2           XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   351

                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   352

                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   353

                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +1           
                +1           ELSE
                +1           ;$include (SI_EFM8BB2_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB21F16G_QFN20
                +2           ;  EFM8BB21F16G_QSOP24
                +2           ;  EFM8BB21F16I_QFN20
                +2           ;  EFM8BB21F16I_QSOP24
                +2           ;  EFM8BB22F16G_QFN28
                +2           ;  EFM8BB22F16I_QFN28
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC       DATA 0E0H; Accumulator                            
                +2           ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF    DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B         DATA 0F0H; B Register                             
                +2           CKCON0    DATA 08EH; Clock Control 0                        
                +2           CKCON1    DATA 0A6H; Clock Control 1
                +2           CLKSEL    DATA 0A9H; Clock Select                           
                +2           CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0CN1   DATA 099H; Comparator 0 Control 1
                +2           CMP0MD    DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                +2           CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CN1   DATA 086H; CRC0 Control 1                         
                +2           CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN    DATA 0DDH; CRC0 Data Input                        
                +2           CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                +2           DERIVID   DATA 0ADH; Derivative Identification              
                +2           DEVICEID  DATA 0B5H; Device Identification                  
                +2           DPH       DATA 083H; Data Pointer High                      
                +2           DPL       DATA 082H; Data Pointer Low                       
                +2           EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                +2           EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                +2           EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   354

                +2           EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                +2           EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                +2           EMI0CN    DATA 0E7H; External Memory Interface Control      
                +2           FLKEY     DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                +2           HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                +2           I2C0CN0   DATA 0BAH; I2C0 Control                           
                +2           I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                +2           I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                +2           I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                +2           I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                +2           I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                +2           I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                +2           I2C0STAT  DATA 0B9H; I2C0 Status                            
                +2           IE        DATA 0A8H; Interrupt Enable                       
                +2           IP        DATA 0B8H; Interrupt Priority                     
                +2           IPH       DATA 0F2H; Interrupt Priority High                
                +2           IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0        DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK    DATA 0FEH; Port 0 Mask                            
                +2           P0MAT     DATA 0FDH; Port 0 Match                           
                +2           P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP    DATA 0D4H; Port 0 Skip                            
                +2           P1        DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK    DATA 0EEH; Port 1 Mask                            
                +2           P1MAT     DATA 0EDH; Port 1 Match                           
                +2           P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP    DATA 0D5H; Port 1 Skip                            
                +2           P2        DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MASK    DATA 0FCH; Port 2 Mask                            
                +2           P2MAT     DATA 0FBH; Port 2 Match                           
                +2           P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                +2           P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                +2           P2SKIP    DATA 0CCH; Port 2 Skip                            
                +2           P3        DATA 0B0H; Port 3 Pin Latch                       
                +2           P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                +2           P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                +2           PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0   DATA 0D8H; PCA Control                            
                +2           PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD    DATA 0D9H; PCA Mode                               
                +2           PCA0POL   DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0     DATA 087H; Power Control                          
                +2           PCON1     DATA 09AH; Power Control 1                        
                +2           PFE0CN    DATA 0C1H; Prefetch Engine Control                
                +2           PRTDRV    DATA 0F6H; Port Drive Strength                    
                +2           PSCTL     DATA 08FH; Program Store Control                  
                +2           PSW       DATA 0D0H; Program Status Word                    
                +2           REF0CN    DATA 0D1H; Voltage Reference Control              
                +2           REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   355

                +2           REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                +2           REVID     DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC    DATA 0EFH; Reset Source                           
                +2           SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                +2           SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                +2           SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                +2           SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                +2           SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                +2           SCON0     DATA 098H; UART0 Serial Port Control              
                +2           SCON1     DATA 0C8H; UART1 Serial Port Control              
                +2           SFRPAGE   DATA 0A7H; SFR Page                               
                +2           SFRPGCN   DATA 0CFH; SFR Page Control                       
                +2           SFRSTACK  DATA 0D7H; SFR Page Stack                         
                +2           SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                +2           SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                +2           SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                +2           SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                +2           SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                +2           SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SMOD1     DATA 093H; UART1 Mode                             
                +2           SP        DATA 081H; Stack Pointer                          
                +2           SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0   DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT   DATA 0A3H; SPI0 Data                              
                +2           SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                +2           SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                +2           SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                +2           TCON      DATA 088H; Timer 0/1 Control                      
                +2           TH0       DATA 08CH; Timer 0 High Byte                      
                +2           TH1       DATA 08DH; Timer 1 High Byte                      
                +2           TL0       DATA 08AH; Timer 0 Low Byte                       
                +2           TL1       DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD      DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                +2           TMR2H     DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0   DATA 091H; Timer 3 Control 0                      
                +2           TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                +2           TMR3H     DATA 095H; Timer 3 High Byte                      
                +2           TMR3L     DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                +2           TMR4CN0   DATA 098H; Timer 4 Control 0                      
                +2           TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                +2           TMR4H     DATA 0A5H; Timer 4 High Byte                      
                +2           TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                +2           TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                +2           TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                +2           UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                +2           UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                +2           UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                +2           UART1LIN  DATA 09EH; UART1 LIN Configuration                
                +2           VDM0CN    DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN     DATA 097H; Watchdog Timer Control                 
                +2           XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                +2           
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   356

                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                +2           TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   357

                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                +2           P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                +2           
                +2           ; P3 0xB0 (Port 3 Pin Latch)
                +2           P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                +2           P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   358

                +2           ; SCON1 0xC8 (UART1 Serial Port Control)
                +2           SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                +2           SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                +2           SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                +2           SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                +2           SCON1_REN  BIT SCON1.4 ; Receive Enable           
                +2           SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                +2           SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                +2           TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                +2           
                +2           ; TMR4CN0 0x98 (Timer 4 Control 0)
                +2           TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                +2           TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                +2           TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                +2           TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                +2           TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                +2           TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                +2           TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                +2           TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                +2           
                +2           ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                +2           UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                +2           UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                +2           UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                +2           UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                +2           UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                +2           UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   359

                +2           UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                +2           UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +2           UART1_IRQn   EQU 17 ; UART1                     
                +2           I2C0_IRQn    EQU 18 ; I2C0 Slave                
                +2           TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; SFR Page Definitions
                +2           ;------------------------------------------------------------------------------
                +2           CRC0_PAGE       EQU 000H ; CRC0 Page       
                +2           LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                +2           PCA0_PAGE       EQU 000H ; PCA0 Page       
                +2           PG2_PAGE        EQU 010H ; Page2           
                +2           TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                +2           TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                +2           TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                +2           I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                +2           PG3_PAGE        EQU 020H ; Page3           
                +2           SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                +2           SPI0_PAGE       EQU 020H ; SPI0 Page       
                +2           UART0_PAGE      EQU 020H ; UART0 Page      
                +2           UART1_PAGE      EQU 020H ; UART1 Page      
                +1           
                +1           ENDIF
                +1           
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Uses internal calibrated oscillator set to 24/48Mhz
                +1           ;**** **** **** **** ****
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Constant definitions
                +1           ;**** **** **** **** ****
                +1           IF MCU_48MHZ == 0
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#R_L_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#R_L_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#R_L_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#R_L_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#R_L_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#R_L_25#        "
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   360

                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#R_L_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#R_L_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#R_L_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#R_L_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#R_L_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (16 B
                             ytes)
                +1           
                +1           ELSE
                +1           
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#R_H_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#R_H_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#R_H_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#R_H_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#R_H_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#R_H_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#R_H_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#R_H_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#R_H_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#R_H_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#R_H_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (16 B
                             ytes)
                +1           ENDIF
                +1           
                +1           TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for whi
                             ch main motor power is limited at 80degC (low byte, assuming high byte is 1)
                +1           TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment for a
                             nother 10degC
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Bootloader definitions
                +1           ;**** **** **** **** ****
                +1           RTX_PORT                                EQU     P0              ; Receive/Transmit port
                +1           RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL            
                                          
                +1           RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL             
                                          
                +1           RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP                
                                          
                +1           RTX_PIN                         EQU     5               ; RTX pin
                +1           
                +1           SIGNATURE_001                   EQU     0E8h            ; Device signature
                +1           IF MCU_48MHZ == 0
                +1           SIGNATURE_002                   EQU     0B1h
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   361

                +1           ELSE
                +1           SIGNATURE_002                   EQU     0B2h
                +1           ENDIF
                +1           
                +1           ;*********************
                +1           ; PORT 0 definitions *
                +1           ;*********************  
                +1           ;                       EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           Rcp_In          EQU     5       ;i
                +1           ;                       EQU     4       ;i 
                +1           Mux_C           EQU     3       ;i
                +1           Mux_B           EQU     2       ;i
                +1           Mux_A           EQU     1       ;i
                +1           Comp_Com                EQU     0       ;i
                +1           
                +1           P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                +1           P0_INIT         EQU     0FFh
                +1           P0_PUSHPULL     EQU     0
                +1           P0_SKIP         EQU     0FFh
                +1           
                +1           Get_Rcp_Capture_Values MACRO
                +1                   anl     TCON, #0EFh                             ; Disable timer0
                +1                   mov     Temp1, TL0                              ; Get timer0 values
                +1                   mov     Temp2, TH0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Temp3, Timer0_X
                +1                   jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                +1                   inc     Temp3                                   ; If it is pending, then timer has 
                             already wrapped
                +1           ENDIF
                +1                   mov     TL0, #0                                 ; Reset timer0
                +1                   mov     TH0, #0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Timer0_X, #0
                +1           ENDIF
                +1                   orl     TCON, #10h                              ; Enable timer0 again
                +1           IF MCU_48MHZ == 1
                +1                   mov     A, Clock_Set_At_48MHz
                +1                   jnz     Get_Rcp_End
                +1                   clr     C
                +1                   mov     A, Temp1
                +1                   rlc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Temp2
                +1                   rlc     A
                +1                   mov     Temp2, A
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1           Get_Rcp_End:
                +1           ENDIF
                +1           ENDM
                +1           Decode_Dshot_2Msb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp4                                        ; Shift bit into data byte
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   362

                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp4
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL
                +1           ENDM
                +1           Decode_Dshot_2Lsb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp3                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL
                +1           ENDM
                +1           Initialize_PCA MACRO
                +1                   mov     PCA0CN0, #40h                           ; PCA enabled
                +1                   mov     PCA0MD, #08h                            ; PCA clock is system clock
                +1           IF FETON_DELAY == 0
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #00h                          ; Edge aligned pwm
                +1           ELSE
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #03h                          ; Center aligned pwm
                +1           ENDIF
                +1           ENDM
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   363

                +1           Set_Pwm_Polarity MACRO
                +1                   mov     PCA0POL, #02h                           ; Damping inverted, pwm noninverted
                +1           ENDM
                +1           Enable_Power_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, enab
                             le match, set pwm mode
                +1           ELSE
                +1                   mov     PCA0CPM0, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Enable_Damp_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM1, #00h                          ; Disable
                +1           ELSE
                +1                   mov     PCA0CPM1, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Set_Power_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL0, Power_Pwm_Reg_L
                +1                   mov     PCA0CPH0, Power_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Power_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Power_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL0, A
                +1                   mov     PCA0CPH0, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Set_Damp_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL1, Damp_Pwm_Reg_L
                +1                   mov     PCA0CPH1, Damp_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Damp_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Damp_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL1, A
                +1                   mov     PCA0CPH1, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Clear_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0DFh
                +1           ENDM
                +1           Clear_CCF_Interrupt MACRO       ; CCF interrupt is only used for FETON_DELAY == 0
                +1                   anl     PCA0CN0, #0FEh
                +1           ENDM
                +1           Enable_COVF_Interrupt MACRO
                +1                   orl     PCA0PWM, #40h
                +1           ENDM
                +1           Enable_CCF_Interrupt MACRO
                +1                   orl     PCA0CPM0,#01h
                +1           ENDM
                +1           Disable_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0BFh
                +1           ENDM
                +1           Disable_CCF_Interrupt MACRO
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   364

                +1                   anl     PCA0CPM0,#0FEh
                +1           ENDM
                +1           
                +1           ;*********************
                +1           ; PORT 1 definitions *
                +1           ;*********************
                +1           ;                       EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           AcomFET         EQU     5       ;o
                +1           BcomFET         EQU     4       ;o
                +1           CcomFET         EQU     3       ;o
                +1           ApwmFET         EQU     2       ;o
                +1           BpwmFET         EQU     1       ;o
                +1           CpwmFET         EQU     0       ;o
                +1           
                +1           P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_INIT         EQU     00h             
                +1           P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_SKIP         EQU     3Fh
                +1           
                +1           ApwmFET_on MACRO
                +1                   setb    P1.ApwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           ApwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_on MACRO
                +1                   setb    P1.BpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.BpwmFET
                +1           ELSE
                +1                   clr     P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_on MACRO
                +1                   setb    P1.CpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           All_pwmFETs_Off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1                   clr     P1.BpwmFET
                +1                   clr     P1.CpwmFET
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   365

                +1           ELSE
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           
                +1           AcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.ApwmFET
                +1           ENDIF
                +1                   setb    P1.AcomFET
                +1           ENDM
                +1           AcomFET_off MACRO
                +1                   clr     P1.AcomFET
                +1           ENDM
                +1           BcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.BpwmFET
                +1           ENDIF
                +1                   setb    P1.BcomFET
                +1           ENDM
                +1           BcomFET_off MACRO
                +1                   clr     P1.BcomFET
                +1           ENDM
                +1           CcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.CpwmFET
                +1           ENDIF
                +1                   setb    P1.CcomFET
                +1           ENDM
                +1           CcomFET_off MACRO
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           All_comFETs_Off MACRO
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           
                +1           Set_Pwm_A MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1                   mov     P1SKIP, #3Bh
                +1           ELSE
                +1                   mov     P1SKIP, #1Bh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_B MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1                   mov     P1SKIP, #3Dh
                +1           ELSE
                +1                   mov     P1SKIP, #2Dh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_C MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1                   mov     P1SKIP, #3Eh
                +1           ELSE
                +1                   mov     P1SKIP, #36h
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwms_Off MACRO
                +1                   mov     P1SKIP, #3Fh
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   366

                +1           ENDM
                +1           
                +1           Set_Comp_Phase_A MACRO
                +1                   mov     CMP0MX, #10h    ; Set comparator multiplexer to phase A
                +1           ENDM
                +1           Set_Comp_Phase_B MACRO
                +1                   mov     CMP0MX, #20h    ; Set comparator multiplexer to phase B
                +1           ENDM
                +1           Set_Comp_Phase_C MACRO
                +1                   mov     CMP0MX, #30h    ; Set comparator multiplexer to phase C
                +1           ENDM
                +1           Read_Comp_Out MACRO
                +1                   mov     A, CMP0CN0      ; Read comparator output
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 2 definitions *
                +1           ;*********************
                +1           DebugPin                EQU     0       ;o
                +1           
                +1           P2_PUSHPULL     EQU     (1 SHL DebugPin)
                +1           
                +1           
                +1           ;**********************
                +1           ; MCU specific macros *
                +1           ;**********************
                +1           Interrupt_Table_Definition MACRO
                +1           CSEG AT 0                               ; Code segment start
                +1                   jmp reset
                +1           CSEG AT 03h                     ; Int0 interrupt        
                +1                   jmp     int0_int        
                +1           IF MCU_48MHZ == 1
                +1           CSEG AT 0Bh                     ; Timer0 overflow interrupt
                +1                   jmp     t0_int
                +1           ENDIF
                +1           CSEG AT 13h                     ; Int1 interrupt
                +1                   jmp     int1_int
                +1           CSEG AT 1Bh                     ; Timer1 overflow interrupt
                +1                   jmp     t1_int
                +1           CSEG AT 2Bh                     ; Timer2 overflow interrupt
                +1                   jmp     t2_int  
                +1           CSEG AT 5Bh                     ; Pca interrupt
                +1                   jmp     pca_int
                +1           CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                +1                   jmp     t3_int  
                +1           ENDM
                +1           
                +1           Initialize_Xbar MACRO
                +1                   mov     XBR2, #40h      ; Xbar enabled                  
                +1                   mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                +1           ENDM
                +1           
                +1           Initialize_Comparator MACRO
                +1                   mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                +1                   mov     CMP0MD, #00h    ; Comparator response time 100ns
                +1           ENDM
                +1           Initialize_Adc MACRO
                +1                   mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bias
                +1           IF MCU_48MHZ == 0
                +1                   mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                +1           ELSE
                +1                   mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                +1           ENDIF
                +1                   mov     ADC0MX, #10h    ; Select temp sensor input
                +1                   mov     ADC0CN0, #80h   ; ADC enabled 
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   367

                +1                   mov     ADC0CN1, #01h   ; Common mode buffer enabled
                +1           ENDM
                +1           Start_Adc MACRO
                +1                   mov     ADC0CN0, #90h   ; ADC start
                +1           ENDM
                +1           Read_Adc_Result MACRO
                +1                   mov     Temp1, ADC0L
                +1                   mov     Temp2, ADC0H
                +1           ENDM
                +1           Stop_Adc MACRO
                +1           ENDM
                +1           Set_RPM_Out MACRO
                +1           ENDM
                +1           Clear_RPM_Out MACRO
                +1           ENDM
                +1           Set_MCU_Clk_24MHz MACRO
                +1                   mov     CLKSEL, #13h            ; Set clock to 24MHz
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     Clock_Set_At_48MHz, #0
                +1           ENDM
                +1           Set_MCU_Clk_48MHz MACRO
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     CLKSEL, #03h            ; Set clock to 48MHz
                +1                   mov     Clock_Set_At_48MHz, #1
                +1           ENDM
                +1           Set_LED_0 MACRO
                +1           ENDM
                +1           Clear_LED_0 MACRO
                +1           ENDM
                +1           Set_LED_1 MACRO
                +1           ENDM
                +1           Clear_LED_1 MACRO
                +1           ENDM
                +1           Set_LED_2 MACRO
                +1           ENDM
                +1           Clear_LED_2 MACRO
                +1           ENDM
                +1           Set_LED_3 MACRO
                +1           ENDM
                +1           Clear_LED_3 MACRO
                +1           ENDM
                             ENDIF
                   23859     
                   23860     IF ESCNO == S_
                             ;$include (S.inc) ; Select pinout S
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; BLHeli program for controlling brushless motors in helicopters and multirotors
                +1           ;
                +1           ; Copyright 2011, 2012 Steffen Skaug
                +1           ; This program is distributed under the terms of the GNU General Public License
                +1           ;
                +1           ; This file is part of BLHeli.
                +1           ;
                +1           ; BLHeli is free software: you can redistribute it and/or modify
                +1           ; it under the terms of the GNU General Public License as published by
                +1           ; the Free Software Foundation, either version 3 of the License, or
                +1           ; (at your option) any later version.
                +1           ;
                +1           ; BLHeli is distributed in the hope that it will be useful,
                +1           ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                +1           ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   368

                +1           ; GNU General Public License for more details.
                +1           ;
                +1           ; You should have received a copy of the GNU General Public License
                +1           ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                +1           ;
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; Hardware definition file "S". like "O" but Com fets are active high, Pwm fets are active 
                             low
                +1           ; X  X  RC X  CC MA MC MB    X  X  Cc Cp Bc Bp Ac Ap
                +1           ;
                +1           ;**** **** **** **** ****
                +1           
                +1           
                +1           
                +1           ;*********************
                +1           ; Device SiLabs EFM8BB1x/2x
                +1           ;*********************
                +1           IF MCU_48MHZ == 0
                +1           ;$include (SI_EFM8BB1_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB10F2G
                +2           ;  EFM8BB10F2I
                +2           ;  EFM8BB10F2Y
                +2           ;  EFM8BB10F4G
                +2           ;  EFM8BB10F4I
                +2           ;  EFM8BB10F4Y
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC      DATA 0E0H; Accumulator                            
                +2           ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF   DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B        DATA 0F0H; B Register                             
                +2           CKCON0   DATA 08EH; Clock Control 0                        
                +2           CLKSEL   DATA 0A9H; Clock Select                           
                +2           CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   369

                +2           CMP0MD   DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                +2           CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN   DATA 0DDH; CRC0 Data Input                        
                +2           DERIVID  DATA 0ADH; Derivative Identification              
                +2           DEVICEID DATA 0B5H; Device Identification                  
                +2           DPH      DATA 083H; Data Pointer High                      
                +2           DPL      DATA 082H; Data Pointer Low                       
                +2           EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                +2           FLKEY    DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           IE       DATA 0A8H; Interrupt Enable                       
                +2           IP       DATA 0B8H; Interrupt Priority                     
                +2           IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0       DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK   DATA 0FEH; Port 0 Mask                            
                +2           P0MAT    DATA 0FDH; Port 0 Match                           
                +2           P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP   DATA 0D4H; Port 0 Skip                            
                +2           P1       DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK   DATA 0EEH; Port 1 Mask                            
                +2           P1MAT    DATA 0EDH; Port 1 Match                           
                +2           P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP   DATA 0D5H; Port 1 Skip                            
                +2           P2       DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                +2           PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0  DATA 0D8H; PCA Control                            
                +2           PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD   DATA 0D9H; PCA Mode                               
                +2           PCA0POL  DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0    DATA 087H; Power Control                          
                +2           PRTDRV   DATA 0F6H; Port Drive Strength                    
                +2           PSCTL    DATA 08FH; Program Store Control                  
                +2           PSW      DATA 0D0H; Program Status Word                    
                +2           REF0CN   DATA 0D1H; Voltage Reference Control              
                +2           REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                +2           REVID    DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC   DATA 0EFH; Reset Source                           
                +2           SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                +2           SCON0    DATA 098H; UART0 Serial Port Control              
                +2           SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   370

                +2           SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                +2           SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SP       DATA 081H; Stack Pointer                          
                +2           SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0  DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT  DATA 0A3H; SPI0 Data                              
                +2           TCON     DATA 088H; Timer 0/1 Control                      
                +2           TH0      DATA 08CH; Timer 0 High Byte                      
                +2           TH1      DATA 08DH; Timer 1 High Byte                      
                +2           TL0      DATA 08AH; Timer 0 Low Byte                       
                +2           TL1      DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD     DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2H    DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0  DATA 091H; Timer 3 Control 0                      
                +2           TMR3H    DATA 095H; Timer 3 High Byte                      
                +2           TMR3L    DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                +2           VDM0CN   DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN    DATA 097H; Watchdog Timer Control                 
                +2           XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   371

                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   372

                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   373

                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +1           
                +1           ELSE
                +1           ;$include (SI_EFM8BB2_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB21F16G_QFN20
                +2           ;  EFM8BB21F16G_QSOP24
                +2           ;  EFM8BB21F16I_QFN20
                +2           ;  EFM8BB21F16I_QSOP24
                +2           ;  EFM8BB22F16G_QFN28
                +2           ;  EFM8BB22F16I_QFN28
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC       DATA 0E0H; Accumulator                            
                +2           ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF    DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B         DATA 0F0H; B Register                             
                +2           CKCON0    DATA 08EH; Clock Control 0                        
                +2           CKCON1    DATA 0A6H; Clock Control 1
                +2           CLKSEL    DATA 0A9H; Clock Select                           
                +2           CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0CN1   DATA 099H; Comparator 0 Control 1
                +2           CMP0MD    DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                +2           CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CN1   DATA 086H; CRC0 Control 1                         
                +2           CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   374

                +2           CRC0IN    DATA 0DDH; CRC0 Data Input                        
                +2           CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                +2           DERIVID   DATA 0ADH; Derivative Identification              
                +2           DEVICEID  DATA 0B5H; Device Identification                  
                +2           DPH       DATA 083H; Data Pointer High                      
                +2           DPL       DATA 082H; Data Pointer Low                       
                +2           EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                +2           EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                +2           EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                +2           EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                +2           EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                +2           EMI0CN    DATA 0E7H; External Memory Interface Control      
                +2           FLKEY     DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                +2           HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                +2           I2C0CN0   DATA 0BAH; I2C0 Control                           
                +2           I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                +2           I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                +2           I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                +2           I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                +2           I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                +2           I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                +2           I2C0STAT  DATA 0B9H; I2C0 Status                            
                +2           IE        DATA 0A8H; Interrupt Enable                       
                +2           IP        DATA 0B8H; Interrupt Priority                     
                +2           IPH       DATA 0F2H; Interrupt Priority High                
                +2           IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0        DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK    DATA 0FEH; Port 0 Mask                            
                +2           P0MAT     DATA 0FDH; Port 0 Match                           
                +2           P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP    DATA 0D4H; Port 0 Skip                            
                +2           P1        DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK    DATA 0EEH; Port 1 Mask                            
                +2           P1MAT     DATA 0EDH; Port 1 Match                           
                +2           P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP    DATA 0D5H; Port 1 Skip                            
                +2           P2        DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MASK    DATA 0FCH; Port 2 Mask                            
                +2           P2MAT     DATA 0FBH; Port 2 Match                           
                +2           P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                +2           P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                +2           P2SKIP    DATA 0CCH; Port 2 Skip                            
                +2           P3        DATA 0B0H; Port 3 Pin Latch                       
                +2           P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                +2           P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                +2           PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0   DATA 0D8H; PCA Control                            
                +2           PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD    DATA 0D9H; PCA Mode                               
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   375

                +2           PCA0POL   DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0     DATA 087H; Power Control                          
                +2           PCON1     DATA 09AH; Power Control 1                        
                +2           PFE0CN    DATA 0C1H; Prefetch Engine Control                
                +2           PRTDRV    DATA 0F6H; Port Drive Strength                    
                +2           PSCTL     DATA 08FH; Program Store Control                  
                +2           PSW       DATA 0D0H; Program Status Word                    
                +2           REF0CN    DATA 0D1H; Voltage Reference Control              
                +2           REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                +2           REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                +2           REVID     DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC    DATA 0EFH; Reset Source                           
                +2           SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                +2           SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                +2           SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                +2           SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                +2           SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                +2           SCON0     DATA 098H; UART0 Serial Port Control              
                +2           SCON1     DATA 0C8H; UART1 Serial Port Control              
                +2           SFRPAGE   DATA 0A7H; SFR Page                               
                +2           SFRPGCN   DATA 0CFH; SFR Page Control                       
                +2           SFRSTACK  DATA 0D7H; SFR Page Stack                         
                +2           SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                +2           SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                +2           SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                +2           SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                +2           SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                +2           SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SMOD1     DATA 093H; UART1 Mode                             
                +2           SP        DATA 081H; Stack Pointer                          
                +2           SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0   DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT   DATA 0A3H; SPI0 Data                              
                +2           SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                +2           SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                +2           SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                +2           TCON      DATA 088H; Timer 0/1 Control                      
                +2           TH0       DATA 08CH; Timer 0 High Byte                      
                +2           TH1       DATA 08DH; Timer 1 High Byte                      
                +2           TL0       DATA 08AH; Timer 0 Low Byte                       
                +2           TL1       DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD      DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                +2           TMR2H     DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0   DATA 091H; Timer 3 Control 0                      
                +2           TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                +2           TMR3H     DATA 095H; Timer 3 High Byte                      
                +2           TMR3L     DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                +2           TMR4CN0   DATA 098H; Timer 4 Control 0                      
                +2           TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                +2           TMR4H     DATA 0A5H; Timer 4 High Byte                      
                +2           TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                +2           TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                +2           TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   376

                +2           UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                +2           UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                +2           UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                +2           UART1LIN  DATA 09EH; UART1 LIN Configuration                
                +2           VDM0CN    DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN     DATA 097H; Watchdog Timer Control                 
                +2           XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                +2           TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   377

                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                +2           P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                +2           
                +2           ; P3 0xB0 (Port 3 Pin Latch)
                +2           P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                +2           P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   378

                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SCON1 0xC8 (UART1 Serial Port Control)
                +2           SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                +2           SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                +2           SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                +2           SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                +2           SCON1_REN  BIT SCON1.4 ; Receive Enable           
                +2           SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                +2           SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                +2           TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                +2           
                +2           ; TMR4CN0 0x98 (Timer 4 Control 0)
                +2           TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                +2           TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                +2           TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                +2           TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                +2           TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                +2           TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   379

                +2           TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                +2           TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                +2           
                +2           ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                +2           UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                +2           UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                +2           UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                +2           UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                +2           UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                +2           UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                +2           UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                +2           UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +2           UART1_IRQn   EQU 17 ; UART1                     
                +2           I2C0_IRQn    EQU 18 ; I2C0 Slave                
                +2           TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; SFR Page Definitions
                +2           ;------------------------------------------------------------------------------
                +2           CRC0_PAGE       EQU 000H ; CRC0 Page       
                +2           LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                +2           PCA0_PAGE       EQU 000H ; PCA0 Page       
                +2           PG2_PAGE        EQU 010H ; Page2           
                +2           TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                +2           TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                +2           TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                +2           I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                +2           PG3_PAGE        EQU 020H ; Page3           
                +2           SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                +2           SPI0_PAGE       EQU 020H ; SPI0 Page       
                +2           UART0_PAGE      EQU 020H ; UART0 Page      
                +2           UART1_PAGE      EQU 020H ; UART1 Page      
                +1           
                +1           ENDIF
                +1           
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Uses internal calibrated oscillator set to 24/48Mhz
                +1           ;**** **** **** **** ****
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Constant definitions
                +1           ;**** **** **** **** ****
                +1           IF MCU_48MHZ == 0
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#S_L_00#        "      ; ESC layout tag
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   380

                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#S_L_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#S_L_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#S_L_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#S_L_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#S_L_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#S_L_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#S_L_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#S_L_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#S_L_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#S_L_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (16 B
                             ytes)
                +1           
                +1           ELSE
                +1           
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#S_H_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#S_H_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#S_H_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#S_H_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#S_H_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#S_H_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#S_H_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#S_H_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#S_H_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#S_H_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#S_H_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (16 B
                             ytes)
                +1           ENDIF
                +1           
                +1           TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for whi
                             ch main motor power is limited at 80degC (low byte, assuming high byte is 1)
                +1           TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment for a
                             nother 10degC
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Bootloader definitions
                +1           ;**** **** **** **** ****
                +1           RTX_PORT                                EQU     P0              ; Receive/Transmit port
                +1           RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL            
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   381

                                          
                +1           RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL             
                                          
                +1           RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP                
                                          
                +1           RTX_PIN                         EQU     5               ; RTX pin
                +1           
                +1           SIGNATURE_001                   EQU     0E8h            ; Device signature
                +1           IF MCU_48MHZ == 0
                +1           SIGNATURE_002                   EQU     0B1h
                +1           ELSE
                +1           SIGNATURE_002                   EQU     0B2h
                +1           ENDIF
                +1           
                +1           ;*********************
                +1           ; PORT 0 definitions *
                +1           ;*********************  
                +1           ;                       EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           Rcp_In          EQU     5       ;i
                +1           ;                       EQU     4       ;i 
                +1           Comp_Com                EQU     3       ;i
                +1           Mux_A           EQU     2       ;i
                +1           Mux_C           EQU     1       ;i
                +1           Mux_B           EQU     0       ;i
                +1           
                +1           P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                +1           P0_INIT         EQU     0FFh
                +1           P0_PUSHPULL     EQU     0
                +1           P0_SKIP         EQU     0FFh
                +1           
                +1           Get_Rcp_Capture_Values MACRO
                +1                   anl     TCON, #0EFh                             ; Disable timer0
                +1                   mov     Temp1, TL0                              ; Get timer0 values
                +1                   mov     Temp2, TH0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Temp3, Timer0_X
                +1                   jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                +1                   inc     Temp3                                   ; If it is pending, then timer has 
                             already wrapped
                +1           ENDIF
                +1                   mov     TL0, #0                                 ; Reset timer0
                +1                   mov     TH0, #0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Timer0_X, #0
                +1           ENDIF
                +1                   orl     TCON, #10h                              ; Enable timer0 again
                +1           IF MCU_48MHZ == 1
                +1                   mov     A, Clock_Set_At_48MHz
                +1                   jnz     Get_Rcp_End
                +1                   clr     C
                +1                   mov     A, Temp1
                +1                   rlc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Temp2
                +1                   rlc     A
                +1                   mov     Temp2, A
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1           Get_Rcp_End:
                +1           ENDIF
                +1           ENDM
                +1           Decode_Dshot_2Msb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   382

                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp4                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp4
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL
                +1           ENDM
                +1           Decode_Dshot_2Lsb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp3                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL
                +1           ENDM
                +1           Initialize_PCA MACRO
                +1                   mov     PCA0CN0, #40h                           ; PCA enabled
                +1                   mov     PCA0MD, #08h                            ; PCA clock is system clock
                +1           IF FETON_DELAY == 0
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                +1           ENDIF
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   383

                +1                   mov     PCA0CENT, #00h                          ; Edge aligned pwm
                +1           ELSE
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #03h                          ; Center aligned pwm
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_Polarity MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0POL, #00h                           ; Pwm noninverted
                +1           ELSE
                +1                   mov     PCA0POL, #01h                           ; Damping inverted, pwm noninverted
                +1           ENDIF
                +1           ENDM
                +1           Enable_Power_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, enab
                             le match, set pwm mode
                +1           ELSE
                +1                   mov     PCA0CPM1, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Enable_Damp_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM1, #00h                          ; Disable
                +1           ELSE
                +1                   mov     PCA0CPM0, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Set_Power_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL0, Power_Pwm_Reg_L
                +1                   mov     PCA0CPH0, Power_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Power_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Power_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL1, A
                +1                   mov     PCA0CPH1, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Set_Damp_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL1, Damp_Pwm_Reg_L
                +1                   mov     PCA0CPH1, Damp_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Damp_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Damp_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL0, A
                +1                   mov     PCA0CPH0, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Clear_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0DFh
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   384

                +1           ENDM
                +1           Clear_CCF_Interrupt MACRO
                +1                   anl     PCA0CN0, #0FEh
                +1           ENDM
                +1           Enable_COVF_Interrupt MACRO
                +1                   orl     PCA0PWM, #40h
                +1           ENDM
                +1           Enable_CCF_Interrupt MACRO
                +1                   orl     PCA0CPM0,#01h
                +1           ENDM
                +1           Disable_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0BFh
                +1           ENDM
                +1           Disable_CCF_Interrupt MACRO
                +1                   anl     PCA0CPM0,#0FEh
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 1 definitions *
                +1           ;*********************
                +1           ;                       EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           CpwmFET         EQU     5       ;o
                +1           CcomFET         EQU     4       ;o
                +1           BpwmFET         EQU     3       ;o
                +1           BcomFET         EQU     2       ;o
                +1           ApwmFET         EQU     1       ;o
                +1           AcomFET         EQU     0       ;o
                +1           
                +1           P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_INIT         EQU     (0 SHL AcomFET)+(0 SHL BcomFET)+(0 SHL CcomFET)
                +1           P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_SKIP         EQU     3Fh
                +1           
                +1           ApwmFET_on MACRO
                +1                   setb    P1.ApwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           ApwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_on MACRO
                +1                   setb    P1.BpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.BpwmFET
                +1           ELSE
                +1                   clr     P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_on MACRO
                +1                   setb    P1.CpwmFET
                +1           IF FETON_DELAY == 0
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   385

                +1                   setb    P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           All_pwmFETs_Off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1                   clr     P1.BpwmFET
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           
                +1           AcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.ApwmFET
                +1           ENDIF
                +1                   setb    P1.AcomFET
                +1           ENDM
                +1           AcomFET_off MACRO
                +1                   clr     P1.AcomFET
                +1           ENDM
                +1           BcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.BpwmFET
                +1           ENDIF
                +1                   setb    P1.BcomFET
                +1           ENDM
                +1           BcomFET_off MACRO
                +1                   clr     P1.BcomFET
                +1           ENDM
                +1           CcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.CpwmFET
                +1           ENDIF
                +1                   setb    P1.CcomFET
                +1           ENDM
                +1           CcomFET_off MACRO
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           All_comFETs_Off MACRO
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           
                +1           Set_Pwm_A MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1                   mov     P1SKIP, #3Dh
                +1           ELSE
                +1                   mov     P1SKIP, #3Ch
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_B MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   386

                +1                   mov     P1SKIP, #37h
                +1           ELSE
                +1                   mov     P1SKIP, #33h
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_C MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1                   mov     P1SKIP, #1Fh
                +1           ELSE
                +1                   mov     P1SKIP, #0Fh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwms_Off MACRO
                +1                   mov     P1SKIP, #3Fh
                +1           ENDM
                +1           
                +1           Set_Comp_Phase_A MACRO
                +1                   mov     CMP0MX, #23h    ; Set comparator multiplexer to phase A
                +1           ENDM
                +1           Set_Comp_Phase_B MACRO
                +1                   mov     CMP0MX, #03h    ; Set comparator multiplexer to phase B
                +1           ENDM
                +1           Set_Comp_Phase_C MACRO
                +1                   mov     CMP0MX, #13h    ; Set comparator multiplexer to phase C
                +1           ENDM
                +1           Read_Comp_Out MACRO
                +1                   mov     A, CMP0CN0      ; Read comparator output
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 2 definitions *
                +1           ;*********************
                +1           DebugPin                EQU     0       ;o
                +1           
                +1           P2_PUSHPULL     EQU     (1 SHL DebugPin)
                +1           
                +1           
                +1           ;**********************
                +1           ; MCU specific macros *
                +1           ;**********************
                +1           Interrupt_Table_Definition MACRO
                +1           CSEG AT 0                               ; Code segment start
                +1                   jmp reset
                +1           CSEG AT 03h                     ; Int0 interrupt        
                +1                   jmp     int0_int        
                +1           IF MCU_48MHZ == 1
                +1           CSEG AT 0Bh                     ; Timer0 overflow interrupt
                +1                   jmp     t0_int
                +1           ENDIF
                +1           CSEG AT 13h                     ; Int1 interrupt
                +1                   jmp     int1_int
                +1           CSEG AT 1Bh                     ; Timer1 overflow interrupt
                +1                   jmp     t1_int
                +1           CSEG AT 2Bh                     ; Timer2 overflow interrupt
                +1                   jmp     t2_int  
                +1           CSEG AT 5Bh                     ; Pca interrupt
                +1                   jmp     pca_int
                +1           CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                +1                   jmp     t3_int  
                +1           ENDM
                +1           
                +1           Initialize_Xbar MACRO
                +1                   mov     XBR2, #40h      ; Xbar enabled                  
                +1                   mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   387

                +1           ENDM
                +1           
                +1           Initialize_Comparator MACRO
                +1                   mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                +1                   mov     CMP0MD, #00h    ; Comparator response time 100ns
                +1           ENDM
                +1           Initialize_Adc MACRO
                +1                   mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bias
                +1           IF MCU_48MHZ == 0
                +1                   mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                +1           ELSE
                +1                   mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                +1           ENDIF
                +1                   mov     ADC0MX, #10h    ; Select temp sensor input
                +1                   mov     ADC0CN0, #80h   ; ADC enabled 
                +1                   mov     ADC0CN1, #01h   ; Common mode buffer enabled
                +1           ENDM
                +1           Start_Adc MACRO
                +1                   mov     ADC0CN0, #90h   ; ADC start
                +1           ENDM
                +1           Read_Adc_Result MACRO
                +1                   mov     Temp1, ADC0L
                +1                   mov     Temp2, ADC0H
                +1           ENDM
                +1           Stop_Adc MACRO
                +1           ENDM
                +1           Set_RPM_Out MACRO
                +1           ENDM
                +1           Clear_RPM_Out MACRO
                +1           ENDM
                +1           Set_MCU_Clk_24MHz MACRO
                +1                   mov     CLKSEL, #13h            ; Set clock to 24MHz
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     Clock_Set_At_48MHz, #0
                +1           ENDM
                +1           Set_MCU_Clk_48MHz MACRO
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     CLKSEL, #03h            ; Set clock to 48MHz
                +1                   mov     Clock_Set_At_48MHz, #1
                +1           ENDM
                +1           Set_LED_0 MACRO
                +1           ENDM
                +1           Clear_LED_0 MACRO
                +1           ENDM
                +1           Set_LED_1 MACRO
                +1           ENDM
                +1           Clear_LED_1 MACRO
                +1           ENDM
                +1           Set_LED_2 MACRO
                +1           ENDM
                +1           Clear_LED_2 MACRO
                +1           ENDM
                +1           Set_LED_3 MACRO
                +1           ENDM
                +1           Clear_LED_3 MACRO
                +1           ENDM
                             ENDIF
                   25176     
                   25177     IF ESCNO == T_
                             ;$include (T.inc) ; Select pinout T
                +1           ;**** **** **** **** ****
                +1           ;
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   388

                +1           ; BLHeli program for controlling brushless motors in helicopters and multirotors
                +1           ;
                +1           ; Copyright 2011, 2012 Steffen Skaug
                +1           ; This program is distributed under the terms of the GNU General Public License
                +1           ;
                +1           ; This file is part of BLHeli.
                +1           ;
                +1           ; BLHeli is free software: you can redistribute it and/or modify
                +1           ; it under the terms of the GNU General Public License as published by
                +1           ; the Free Software Foundation, either version 3 of the License, or
                +1           ; (at your option) any later version.
                +1           ;
                +1           ; BLHeli is distributed in the hope that it will be useful,
                +1           ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                +1           ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                +1           ; GNU General Public License for more details.
                +1           ;
                +1           ; You should have received a copy of the GNU General Public License
                +1           ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                +1           ;
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; Hardware definition file "T".
                +1           ; RC X  MA X  MB CC MC X     X  X  Cp Bp Ap Ac Bc Cc
                +1           ;
                +1           ;**** **** **** **** ****
                +1           
                +1           
                +1           
                +1           ;*********************
                +1           ; Device SiLabs EFM8BB1x/2x
                +1           ;*********************
                +1           IF MCU_48MHZ == 0
                +1           ;$include (SI_EFM8BB1_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB10F2G
                +2           ;  EFM8BB10F2I
                +2           ;  EFM8BB10F2Y
                +2           ;  EFM8BB10F4G
                +2           ;  EFM8BB10F4I
                +2           ;  EFM8BB10F4Y
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC      DATA 0E0H; Accumulator                            
                +2           ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF   DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0  DATA 0E8H; ADC0 Control 0                         
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   389

                +2           ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B        DATA 0F0H; B Register                             
                +2           CKCON0   DATA 08EH; Clock Control 0                        
                +2           CLKSEL   DATA 0A9H; Clock Select                           
                +2           CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0MD   DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                +2           CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN   DATA 0DDH; CRC0 Data Input                        
                +2           DERIVID  DATA 0ADH; Derivative Identification              
                +2           DEVICEID DATA 0B5H; Device Identification                  
                +2           DPH      DATA 083H; Data Pointer High                      
                +2           DPL      DATA 082H; Data Pointer Low                       
                +2           EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                +2           FLKEY    DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           IE       DATA 0A8H; Interrupt Enable                       
                +2           IP       DATA 0B8H; Interrupt Priority                     
                +2           IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0       DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK   DATA 0FEH; Port 0 Mask                            
                +2           P0MAT    DATA 0FDH; Port 0 Match                           
                +2           P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP   DATA 0D4H; Port 0 Skip                            
                +2           P1       DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK   DATA 0EEH; Port 1 Mask                            
                +2           P1MAT    DATA 0EDH; Port 1 Match                           
                +2           P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP   DATA 0D5H; Port 1 Skip                            
                +2           P2       DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                +2           PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0  DATA 0D8H; PCA Control                            
                +2           PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD   DATA 0D9H; PCA Mode                               
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   390

                +2           PCA0POL  DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0    DATA 087H; Power Control                          
                +2           PRTDRV   DATA 0F6H; Port Drive Strength                    
                +2           PSCTL    DATA 08FH; Program Store Control                  
                +2           PSW      DATA 0D0H; Program Status Word                    
                +2           REF0CN   DATA 0D1H; Voltage Reference Control              
                +2           REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                +2           REVID    DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC   DATA 0EFH; Reset Source                           
                +2           SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                +2           SCON0    DATA 098H; UART0 Serial Port Control              
                +2           SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                +2           SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SP       DATA 081H; Stack Pointer                          
                +2           SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0  DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT  DATA 0A3H; SPI0 Data                              
                +2           TCON     DATA 088H; Timer 0/1 Control                      
                +2           TH0      DATA 08CH; Timer 0 High Byte                      
                +2           TH1      DATA 08DH; Timer 1 High Byte                      
                +2           TL0      DATA 08AH; Timer 0 Low Byte                       
                +2           TL1      DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD     DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2H    DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0  DATA 091H; Timer 3 Control 0                      
                +2           TMR3H    DATA 095H; Timer 3 High Byte                      
                +2           TMR3L    DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                +2           VDM0CN   DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN    DATA 097H; Watchdog Timer Control                 
                +2           XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   391

                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   392

                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   393

                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +1           
                +1           ELSE
                +1           ;$include (SI_EFM8BB2_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB21F16G_QFN20
                +2           ;  EFM8BB21F16G_QSOP24
                +2           ;  EFM8BB21F16I_QFN20
                +2           ;  EFM8BB21F16I_QSOP24
                +2           ;  EFM8BB22F16G_QFN28
                +2           ;  EFM8BB22F16I_QFN28
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC       DATA 0E0H; Accumulator                            
                +2           ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF    DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B         DATA 0F0H; B Register                             
                +2           CKCON0    DATA 08EH; Clock Control 0                        
                +2           CKCON1    DATA 0A6H; Clock Control 1
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   394

                +2           CLKSEL    DATA 0A9H; Clock Select                           
                +2           CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0CN1   DATA 099H; Comparator 0 Control 1
                +2           CMP0MD    DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                +2           CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CN1   DATA 086H; CRC0 Control 1                         
                +2           CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN    DATA 0DDH; CRC0 Data Input                        
                +2           CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                +2           DERIVID   DATA 0ADH; Derivative Identification              
                +2           DEVICEID  DATA 0B5H; Device Identification                  
                +2           DPH       DATA 083H; Data Pointer High                      
                +2           DPL       DATA 082H; Data Pointer Low                       
                +2           EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                +2           EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                +2           EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                +2           EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                +2           EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                +2           EMI0CN    DATA 0E7H; External Memory Interface Control      
                +2           FLKEY     DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                +2           HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                +2           I2C0CN0   DATA 0BAH; I2C0 Control                           
                +2           I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                +2           I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                +2           I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                +2           I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                +2           I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                +2           I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                +2           I2C0STAT  DATA 0B9H; I2C0 Status                            
                +2           IE        DATA 0A8H; Interrupt Enable                       
                +2           IP        DATA 0B8H; Interrupt Priority                     
                +2           IPH       DATA 0F2H; Interrupt Priority High                
                +2           IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0        DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK    DATA 0FEH; Port 0 Mask                            
                +2           P0MAT     DATA 0FDH; Port 0 Match                           
                +2           P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP    DATA 0D4H; Port 0 Skip                            
                +2           P1        DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK    DATA 0EEH; Port 1 Mask                            
                +2           P1MAT     DATA 0EDH; Port 1 Match                           
                +2           P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP    DATA 0D5H; Port 1 Skip                            
                +2           P2        DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MASK    DATA 0FCH; Port 2 Mask                            
                +2           P2MAT     DATA 0FBH; Port 2 Match                           
                +2           P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                +2           P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                +2           P2SKIP    DATA 0CCH; Port 2 Skip                            
                +2           P3        DATA 0B0H; Port 3 Pin Latch                       
                +2           P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                +2           P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                +2           PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   395

                +2           PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0   DATA 0D8H; PCA Control                            
                +2           PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD    DATA 0D9H; PCA Mode                               
                +2           PCA0POL   DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0     DATA 087H; Power Control                          
                +2           PCON1     DATA 09AH; Power Control 1                        
                +2           PFE0CN    DATA 0C1H; Prefetch Engine Control                
                +2           PRTDRV    DATA 0F6H; Port Drive Strength                    
                +2           PSCTL     DATA 08FH; Program Store Control                  
                +2           PSW       DATA 0D0H; Program Status Word                    
                +2           REF0CN    DATA 0D1H; Voltage Reference Control              
                +2           REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                +2           REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                +2           REVID     DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC    DATA 0EFH; Reset Source                           
                +2           SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                +2           SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                +2           SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                +2           SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                +2           SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                +2           SCON0     DATA 098H; UART0 Serial Port Control              
                +2           SCON1     DATA 0C8H; UART1 Serial Port Control              
                +2           SFRPAGE   DATA 0A7H; SFR Page                               
                +2           SFRPGCN   DATA 0CFH; SFR Page Control                       
                +2           SFRSTACK  DATA 0D7H; SFR Page Stack                         
                +2           SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                +2           SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                +2           SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                +2           SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                +2           SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                +2           SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SMOD1     DATA 093H; UART1 Mode                             
                +2           SP        DATA 081H; Stack Pointer                          
                +2           SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0   DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT   DATA 0A3H; SPI0 Data                              
                +2           SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                +2           SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                +2           SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                +2           TCON      DATA 088H; Timer 0/1 Control                      
                +2           TH0       DATA 08CH; Timer 0 High Byte                      
                +2           TH1       DATA 08DH; Timer 1 High Byte                      
                +2           TL0       DATA 08AH; Timer 0 Low Byte                       
                +2           TL1       DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD      DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                +2           TMR2H     DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L     DATA 0CCH; Timer 2 Low Byte                       
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   396

                +2           TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0   DATA 091H; Timer 3 Control 0                      
                +2           TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                +2           TMR3H     DATA 095H; Timer 3 High Byte                      
                +2           TMR3L     DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                +2           TMR4CN0   DATA 098H; Timer 4 Control 0                      
                +2           TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                +2           TMR4H     DATA 0A5H; Timer 4 High Byte                      
                +2           TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                +2           TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                +2           TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                +2           UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                +2           UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                +2           UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                +2           UART1LIN  DATA 09EH; UART1 LIN Configuration                
                +2           VDM0CN    DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN     DATA 097H; Watchdog Timer Control                 
                +2           XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                +2           TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   397

                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                +2           P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                +2           
                +2           ; P3 0xB0 (Port 3 Pin Latch)
                +2           P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                +2           P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   398

                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SCON1 0xC8 (UART1 Serial Port Control)
                +2           SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                +2           SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                +2           SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                +2           SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                +2           SCON1_REN  BIT SCON1.4 ; Receive Enable           
                +2           SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                +2           SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                +2           TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   399

                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                +2           
                +2           ; TMR4CN0 0x98 (Timer 4 Control 0)
                +2           TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                +2           TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                +2           TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                +2           TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                +2           TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                +2           TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                +2           TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                +2           TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                +2           
                +2           ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                +2           UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                +2           UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                +2           UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                +2           UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                +2           UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                +2           UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                +2           UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                +2           UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +2           UART1_IRQn   EQU 17 ; UART1                     
                +2           I2C0_IRQn    EQU 18 ; I2C0 Slave                
                +2           TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; SFR Page Definitions
                +2           ;------------------------------------------------------------------------------
                +2           CRC0_PAGE       EQU 000H ; CRC0 Page       
                +2           LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                +2           PCA0_PAGE       EQU 000H ; PCA0 Page       
                +2           PG2_PAGE        EQU 010H ; Page2           
                +2           TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                +2           TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                +2           TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                +2           I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                +2           PG3_PAGE        EQU 020H ; Page3           
                +2           SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                +2           SPI0_PAGE       EQU 020H ; SPI0 Page       
                +2           UART0_PAGE      EQU 020H ; UART0 Page      
                +2           UART1_PAGE      EQU 020H ; UART1 Page      
                +1           
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   400

                +1           ENDIF
                +1           
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Uses internal calibrated oscillator set to 24/48Mhz
                +1           ;**** **** **** **** ****
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Constant definitions
                +1           ;**** **** **** **** ****
                +1           IF MCU_48MHZ == 0
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#T_L_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#T_L_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#T_L_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#T_L_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#T_L_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#T_L_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#T_L_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#T_L_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#T_L_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#T_L_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#T_L_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (16 B
                             ytes)
                +1           
                +1           ELSE
                +1           
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#T_H_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#T_H_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#T_H_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#T_H_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#T_H_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#T_H_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#T_H_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#T_H_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#T_H_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#T_H_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#T_H_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   401

                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (16 B
                             ytes)
                +1           ENDIF
                +1           
                +1           TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for whi
                             ch main motor power is limited at 80degC (low byte, assuming high byte is 1)
                +1           TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment for a
                             nother 10degC
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Bootloader definitions
                +1           ;**** **** **** **** ****
                +1           RTX_PORT                                EQU     P0              ; Receive/Transmit port
                +1           RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL            
                                          
                +1           RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL             
                                          
                +1           RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP                
                                          
                +1           RTX_PIN                         EQU     7               ; RTX pin
                +1           
                +1           SIGNATURE_001                   EQU     0E8h            ; Device signature
                +1           IF MCU_48MHZ == 0
                +1           SIGNATURE_002                   EQU     0B1h
                +1           ELSE
                +1           SIGNATURE_002                   EQU     0B2h
                +1           ENDIF
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 0 definitions *
                +1           ;*********************  
                +1           Rcp_In          EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           Mux_A           EQU     5       ;i
                +1           ;                       EQU     4       ;i 
                +1           Mux_B           EQU     3       ;i
                +1           Comp_Com                EQU     2       ;i
                +1           Mux_C           EQU     1       ;i
                +1           ;                       EQU     0       ;i
                +1           
                +1           P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                +1           P0_INIT         EQU     0FFh
                +1           P0_PUSHPULL     EQU     0
                +1           P0_SKIP         EQU     0FFh
                +1           
                +1           Get_Rcp_Capture_Values MACRO
                +1                   anl     TCON, #0EFh                             ; Disable timer0
                +1                   mov     Temp1, TL0                              ; Get timer0 values
                +1                   mov     Temp2, TH0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Temp3, Timer0_X
                +1                   jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                +1                   inc     Temp3                                   ; If it is pending, then timer has 
                             already wrapped
                +1           ENDIF
                +1                   mov     TL0, #0                                 ; Reset timer0
                +1                   mov     TH0, #0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Timer0_X, #0
                +1           ENDIF
                +1                   orl     TCON, #10h                              ; Enable timer0 again
                +1           IF MCU_48MHZ == 1
                +1                   mov     A, Clock_Set_At_48MHz
                +1                   jnz     Get_Rcp_End
                +1                   clr     C
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   402

                +1                   mov     A, Temp1
                +1                   rlc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Temp2
                +1                   rlc     A
                +1                   mov     Temp2, A
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1           Get_Rcp_End:
                +1           ENDIF
                +1           ENDM
                +1           Decode_Dshot_2Msb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp4                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp4
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL
                +1           ENDM
                +1           Decode_Dshot_2Lsb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp3                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail
                +1           
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   403

                +1                   subb    A, Temp1
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL
                +1           ENDM
                +1           Initialize_PCA MACRO
                +1                   mov     PCA0CN0, #40h                           ; PCA enabled
                +1                   mov     PCA0MD, #08h                            ; PCA clock is system clock
                +1           IF FETON_DELAY == 0
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #00h                          ; Edge aligned pwm
                +1           ELSE
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #03h                          ; Center aligned pwm
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_Polarity MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0POL, #00h                           ; Pwm noninverted
                +1           ELSE
                +1                   mov     PCA0POL, #01h                           ; Damping inverted, pwm noninverted
                +1           ENDIF
                +1           ENDM
                +1           Enable_Power_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, enab
                             le match, set pwm mode
                +1           ELSE
                +1                   mov     PCA0CPM1, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Enable_Damp_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM1, #00h                          ; Disable
                +1           ELSE
                +1                   mov     PCA0CPM0, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Set_Power_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL0, Power_Pwm_Reg_L
                +1                   mov     PCA0CPH0, Power_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Power_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Power_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL1, A
                +1                   mov     PCA0CPH1, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Set_Damp_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   404

                +1                   mov     PCA0CPL1, Damp_Pwm_Reg_L
                +1                   mov     PCA0CPH1, Damp_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Damp_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Damp_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL0, A
                +1                   mov     PCA0CPH0, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Clear_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0DFh
                +1           ENDM
                +1           Clear_CCF_Interrupt MACRO       ; CCF interrupt is only used for FETON_DELAY == 0
                +1                   anl     PCA0CN0, #0FEh
                +1           ENDM
                +1           Enable_COVF_Interrupt MACRO
                +1                   orl     PCA0PWM, #40h
                +1           ENDM
                +1           Enable_CCF_Interrupt MACRO
                +1                   orl     PCA0CPM0,#01h
                +1           ENDM
                +1           Disable_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0BFh
                +1           ENDM
                +1           Disable_CCF_Interrupt MACRO
                +1                   anl     PCA0CPM0,#0FEh
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 1 definitions *
                +1           ;*********************
                +1           ;                       EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           CpwmFET         EQU     5       ;o
                +1           BpwmFET         EQU     4       ;o
                +1           ApwmFET         EQU     3       ;o
                +1           AcomFET         EQU     2       ;o 
                +1           BcomFET         EQU     1       ;o
                +1           CcomFET         EQU     0       ;o
                +1           
                +1           P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_INIT         EQU     00h             
                +1           P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_SKIP         EQU     3Fh
                +1           
                +1           ApwmFET_on MACRO
                +1                   setb    P1.ApwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           ApwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_on MACRO
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   405

                +1                   setb    P1.BpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.BpwmFET
                +1           ELSE
                +1                   clr     P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_on MACRO
                +1                   setb    P1.CpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           All_pwmFETs_Off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1                   clr     P1.BpwmFET
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           
                +1           AcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.ApwmFET
                +1           ENDIF
                +1                   setb    P1.AcomFET
                +1           ENDM
                +1           AcomFET_off MACRO
                +1                   clr     P1.AcomFET
                +1           ENDM
                +1           BcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.BpwmFET
                +1           ENDIF
                +1                   setb    P1.BcomFET
                +1           ENDM
                +1           BcomFET_off MACRO
                +1                   clr     P1.BcomFET
                +1           ENDM
                +1           CcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.CpwmFET
                +1           ENDIF
                +1                   setb    P1.CcomFET
                +1           ENDM
                +1           CcomFET_off MACRO
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           All_comFETs_Off MACRO
                +1                   clr     P1.AcomFET
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   406

                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           
                +1           Set_Pwm_A MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1                   mov     P1SKIP, #37h
                +1           ELSE
                +1                   mov     P1SKIP, #33h
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_B MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1                   mov     P1SKIP, #2Fh
                +1           ELSE
                +1                   mov     P1SKIP, #2Dh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_C MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1                   mov     P1SKIP, #1Fh
                +1           ELSE
                +1                   mov     P1SKIP, #1Eh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwms_Off MACRO
                +1                   mov     P1SKIP, #3Fh
                +1           ENDM
                +1           
                +1           Set_Comp_Phase_A MACRO
                +1                   mov     CMP0MX, #52h    ; Set comparator multiplexer to phase A
                +1           ENDM
                +1           Set_Comp_Phase_B MACRO
                +1                   mov     CMP0MX, #32h    ; Set comparator multiplexer to phase B
                +1           ENDM
                +1           Set_Comp_Phase_C MACRO
                +1                   mov     CMP0MX, #12h    ; Set comparator multiplexer to phase C
                +1           ENDM
                +1           Read_Comp_Out MACRO
                +1                   mov     A, CMP0CN0      ; Read comparator output
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 2 definitions *
                +1           ;*********************
                +1           DebugPin                EQU     0       ;o
                +1           
                +1           P2_PUSHPULL     EQU     (1 SHL DebugPin)
                +1           
                +1           
                +1           ;**********************
                +1           ; MCU specific macros *
                +1           ;**********************
                +1           Interrupt_Table_Definition MACRO
                +1           CSEG AT 0                               ; Code segment start
                +1                   jmp reset
                +1           CSEG AT 03h                     ; Int0 interrupt        
                +1                   jmp     int0_int        
                +1           IF MCU_48MHZ == 1
                +1           CSEG AT 0Bh                     ; Timer0 overflow interrupt
                +1                   jmp     t0_int
                +1           ENDIF
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   407

                +1           CSEG AT 13h                     ; Int1 interrupt
                +1                   jmp     int1_int
                +1           CSEG AT 1Bh                     ; Timer1 overflow interrupt
                +1                   jmp     t1_int
                +1           CSEG AT 2Bh                     ; Timer2 overflow interrupt
                +1                   jmp     t2_int  
                +1           CSEG AT 5Bh                     ; Pca interrupt
                +1                   jmp     pca_int
                +1           CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                +1                   jmp     t3_int  
                +1           ENDM
                +1           
                +1           Initialize_Xbar MACRO
                +1                   mov     XBR2, #40h      ; Xbar enabled                  
                +1                   mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                +1           ENDM
                +1           
                +1           Initialize_Comparator MACRO
                +1                   mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                +1                   mov     CMP0MD, #00h    ; Comparator response time 100ns
                +1           ENDM
                +1           Initialize_Adc MACRO
                +1                   mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bias
                +1           IF MCU_48MHZ == 0
                +1                   mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                +1           ELSE
                +1                   mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                +1           ENDIF
                +1                   mov     ADC0MX, #10h    ; Select temp sensor input
                +1                   mov     ADC0CN0, #80h   ; ADC enabled 
                +1                   mov     ADC0CN1, #01h   ; Common mode buffer enabled
                +1           ENDM
                +1           Start_Adc MACRO
                +1                   mov     ADC0CN0, #90h   ; ADC start
                +1           ENDM
                +1           Read_Adc_Result MACRO
                +1                   mov     Temp1, ADC0L
                +1                   mov     Temp2, ADC0H
                +1           ENDM
                +1           Stop_Adc MACRO
                +1           ENDM
                +1           Set_RPM_Out MACRO
                +1           ENDM
                +1           Clear_RPM_Out MACRO
                +1           ENDM
                +1           Set_MCU_Clk_24MHz MACRO
                +1                   mov     CLKSEL, #13h            ; Set clock to 24MHz
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     Clock_Set_At_48MHz, #0
                +1           ENDM
                +1           Set_MCU_Clk_48MHz MACRO
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     CLKSEL, #03h            ; Set clock to 48MHz
                +1                   mov     Clock_Set_At_48MHz, #1
                +1           ENDM
                +1           Set_LED_0 MACRO
                +1           ENDM
                +1           Clear_LED_0 MACRO
                +1           ENDM
                +1           Set_LED_1 MACRO
                +1           ENDM
                +1           Clear_LED_1 MACRO
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   408

                +1           ENDM
                +1           Set_LED_2 MACRO
                +1           ENDM
                +1           Clear_LED_2 MACRO
                +1           ENDM
                +1           Set_LED_3 MACRO
                +1           ENDM
                +1           Clear_LED_3 MACRO
                +1           ENDM
                             ENDIF
                   26494     
                   26495     IF ESCNO == U_
                             ;$include (U.inc) ; Select pinout U
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; BLHeli program for controlling brushless motors in helicopters and multirotors
                +1           ;
                +1           ; Copyright 2011, 2012 Steffen Skaug
                +1           ; This program is distributed under the terms of the GNU General Public License
                +1           ;
                +1           ; This file is part of BLHeli.
                +1           ;
                +1           ; BLHeli is free software: you can redistribute it and/or modify
                +1           ; it under the terms of the GNU General Public License as published by
                +1           ; the Free Software Foundation, either version 3 of the License, or
                +1           ; (at your option) any later version.
                +1           ;
                +1           ; BLHeli is distributed in the hope that it will be useful,
                +1           ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                +1           ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                +1           ; GNU General Public License for more details.
                +1           ;
                +1           ; You should have received a copy of the GNU General Public License
                +1           ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                +1           ;
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; Hardware definition file "U".
                +1           ; MA MC CC MB RC L0 L1 L2     X  Cc Bc Ac Cp Bp Ap X     
                +1           ;
                +1           ;**** **** **** **** ****
                +1           
                +1           
                +1           
                +1           ;*********************
                +1           ; Device SiLabs EFM8BB1x/2x
                +1           ;*********************
                +1           IF MCU_48MHZ == 0
                +1           ;$include (SI_EFM8BB1_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB10F2G
                +2           ;  EFM8BB10F2I
                +2           ;  EFM8BB10F2Y
                +2           ;  EFM8BB10F4G
                +2           ;  EFM8BB10F4I
                +2           ;  EFM8BB10F4Y
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   409

                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC      DATA 0E0H; Accumulator                            
                +2           ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF   DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B        DATA 0F0H; B Register                             
                +2           CKCON0   DATA 08EH; Clock Control 0                        
                +2           CLKSEL   DATA 0A9H; Clock Select                           
                +2           CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0MD   DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                +2           CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN   DATA 0DDH; CRC0 Data Input                        
                +2           DERIVID  DATA 0ADH; Derivative Identification              
                +2           DEVICEID DATA 0B5H; Device Identification                  
                +2           DPH      DATA 083H; Data Pointer High                      
                +2           DPL      DATA 082H; Data Pointer Low                       
                +2           EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                +2           FLKEY    DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           IE       DATA 0A8H; Interrupt Enable                       
                +2           IP       DATA 0B8H; Interrupt Priority                     
                +2           IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0       DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK   DATA 0FEH; Port 0 Mask                            
                +2           P0MAT    DATA 0FDH; Port 0 Match                           
                +2           P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP   DATA 0D4H; Port 0 Skip                            
                +2           P1       DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK   DATA 0EEH; Port 1 Mask                            
                +2           P1MAT    DATA 0EDH; Port 1 Match                           
                +2           P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP   DATA 0D5H; Port 1 Skip                            
                +2           P2       DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   410

                +2           PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0  DATA 0D8H; PCA Control                            
                +2           PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD   DATA 0D9H; PCA Mode                               
                +2           PCA0POL  DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0    DATA 087H; Power Control                          
                +2           PRTDRV   DATA 0F6H; Port Drive Strength                    
                +2           PSCTL    DATA 08FH; Program Store Control                  
                +2           PSW      DATA 0D0H; Program Status Word                    
                +2           REF0CN   DATA 0D1H; Voltage Reference Control              
                +2           REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                +2           REVID    DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC   DATA 0EFH; Reset Source                           
                +2           SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                +2           SCON0    DATA 098H; UART0 Serial Port Control              
                +2           SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                +2           SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SP       DATA 081H; Stack Pointer                          
                +2           SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0  DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT  DATA 0A3H; SPI0 Data                              
                +2           TCON     DATA 088H; Timer 0/1 Control                      
                +2           TH0      DATA 08CH; Timer 0 High Byte                      
                +2           TH1      DATA 08DH; Timer 1 High Byte                      
                +2           TL0      DATA 08AH; Timer 0 Low Byte                       
                +2           TL1      DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD     DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2H    DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0  DATA 091H; Timer 3 Control 0                      
                +2           TMR3H    DATA 095H; Timer 3 High Byte                      
                +2           TMR3L    DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                +2           VDM0CN   DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN    DATA 097H; Watchdog Timer Control                 
                +2           XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   411

                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   412

                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   413

                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +1           
                +1           ELSE
                +1           ;$include (SI_EFM8BB2_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB21F16G_QFN20
                +2           ;  EFM8BB21F16G_QSOP24
                +2           ;  EFM8BB21F16I_QFN20
                +2           ;  EFM8BB21F16I_QSOP24
                +2           ;  EFM8BB22F16G_QFN28
                +2           ;  EFM8BB22F16I_QFN28
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC       DATA 0E0H; Accumulator                            
                +2           ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   414

                +2           ADC0CF    DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B         DATA 0F0H; B Register                             
                +2           CKCON0    DATA 08EH; Clock Control 0                        
                +2           CKCON1    DATA 0A6H; Clock Control 1
                +2           CLKSEL    DATA 0A9H; Clock Select                           
                +2           CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0CN1   DATA 099H; Comparator 0 Control 1
                +2           CMP0MD    DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                +2           CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CN1   DATA 086H; CRC0 Control 1                         
                +2           CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN    DATA 0DDH; CRC0 Data Input                        
                +2           CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                +2           DERIVID   DATA 0ADH; Derivative Identification              
                +2           DEVICEID  DATA 0B5H; Device Identification                  
                +2           DPH       DATA 083H; Data Pointer High                      
                +2           DPL       DATA 082H; Data Pointer Low                       
                +2           EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                +2           EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                +2           EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                +2           EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                +2           EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                +2           EMI0CN    DATA 0E7H; External Memory Interface Control      
                +2           FLKEY     DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                +2           HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                +2           I2C0CN0   DATA 0BAH; I2C0 Control                           
                +2           I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                +2           I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                +2           I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                +2           I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                +2           I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                +2           I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                +2           I2C0STAT  DATA 0B9H; I2C0 Status                            
                +2           IE        DATA 0A8H; Interrupt Enable                       
                +2           IP        DATA 0B8H; Interrupt Priority                     
                +2           IPH       DATA 0F2H; Interrupt Priority High                
                +2           IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0        DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK    DATA 0FEH; Port 0 Mask                            
                +2           P0MAT     DATA 0FDH; Port 0 Match                           
                +2           P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP    DATA 0D4H; Port 0 Skip                            
                +2           P1        DATA 090H; Port 1 Pin Latch                       
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   415

                +2           P1MASK    DATA 0EEH; Port 1 Mask                            
                +2           P1MAT     DATA 0EDH; Port 1 Match                           
                +2           P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP    DATA 0D5H; Port 1 Skip                            
                +2           P2        DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MASK    DATA 0FCH; Port 2 Mask                            
                +2           P2MAT     DATA 0FBH; Port 2 Match                           
                +2           P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                +2           P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                +2           P2SKIP    DATA 0CCH; Port 2 Skip                            
                +2           P3        DATA 0B0H; Port 3 Pin Latch                       
                +2           P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                +2           P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                +2           PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0   DATA 0D8H; PCA Control                            
                +2           PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD    DATA 0D9H; PCA Mode                               
                +2           PCA0POL   DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0     DATA 087H; Power Control                          
                +2           PCON1     DATA 09AH; Power Control 1                        
                +2           PFE0CN    DATA 0C1H; Prefetch Engine Control                
                +2           PRTDRV    DATA 0F6H; Port Drive Strength                    
                +2           PSCTL     DATA 08FH; Program Store Control                  
                +2           PSW       DATA 0D0H; Program Status Word                    
                +2           REF0CN    DATA 0D1H; Voltage Reference Control              
                +2           REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                +2           REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                +2           REVID     DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC    DATA 0EFH; Reset Source                           
                +2           SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                +2           SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                +2           SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                +2           SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                +2           SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                +2           SCON0     DATA 098H; UART0 Serial Port Control              
                +2           SCON1     DATA 0C8H; UART1 Serial Port Control              
                +2           SFRPAGE   DATA 0A7H; SFR Page                               
                +2           SFRPGCN   DATA 0CFH; SFR Page Control                       
                +2           SFRSTACK  DATA 0D7H; SFR Page Stack                         
                +2           SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                +2           SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                +2           SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                +2           SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                +2           SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                +2           SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SMOD1     DATA 093H; UART1 Mode                             
                +2           SP        DATA 081H; Stack Pointer                          
                +2           SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   416

                +2           SPI0CN0   DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT   DATA 0A3H; SPI0 Data                              
                +2           SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                +2           SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                +2           SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                +2           TCON      DATA 088H; Timer 0/1 Control                      
                +2           TH0       DATA 08CH; Timer 0 High Byte                      
                +2           TH1       DATA 08DH; Timer 1 High Byte                      
                +2           TL0       DATA 08AH; Timer 0 Low Byte                       
                +2           TL1       DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD      DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                +2           TMR2H     DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0   DATA 091H; Timer 3 Control 0                      
                +2           TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                +2           TMR3H     DATA 095H; Timer 3 High Byte                      
                +2           TMR3L     DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                +2           TMR4CN0   DATA 098H; Timer 4 Control 0                      
                +2           TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                +2           TMR4H     DATA 0A5H; Timer 4 High Byte                      
                +2           TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                +2           TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                +2           TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                +2           UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                +2           UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                +2           UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                +2           UART1LIN  DATA 09EH; UART1 LIN Configuration                
                +2           VDM0CN    DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN     DATA 097H; Watchdog Timer Control                 
                +2           XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                +2           TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   417

                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   418

                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                +2           P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                +2           
                +2           ; P3 0xB0 (Port 3 Pin Latch)
                +2           P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                +2           P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SCON1 0xC8 (UART1 Serial Port Control)
                +2           SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                +2           SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                +2           SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                +2           SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                +2           SCON1_REN  BIT SCON1.4 ; Receive Enable           
                +2           SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                +2           SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   419

                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                +2           TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                +2           
                +2           ; TMR4CN0 0x98 (Timer 4 Control 0)
                +2           TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                +2           TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                +2           TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                +2           TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                +2           TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                +2           TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                +2           TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                +2           TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                +2           
                +2           ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                +2           UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                +2           UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                +2           UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                +2           UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                +2           UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                +2           UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                +2           UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                +2           UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +2           UART1_IRQn   EQU 17 ; UART1                     
                +2           I2C0_IRQn    EQU 18 ; I2C0 Slave                
                +2           TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; SFR Page Definitions
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   420

                +2           ;------------------------------------------------------------------------------
                +2           CRC0_PAGE       EQU 000H ; CRC0 Page       
                +2           LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                +2           PCA0_PAGE       EQU 000H ; PCA0 Page       
                +2           PG2_PAGE        EQU 010H ; Page2           
                +2           TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                +2           TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                +2           TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                +2           I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                +2           PG3_PAGE        EQU 020H ; Page3           
                +2           SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                +2           SPI0_PAGE       EQU 020H ; SPI0 Page       
                +2           UART0_PAGE      EQU 020H ; UART0 Page      
                +2           UART1_PAGE      EQU 020H ; UART1 Page      
                +1           
                +1           ENDIF
                +1           
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Uses internal calibrated oscillator set to 24/48Mhz
                +1           ;**** **** **** **** ****
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Constant definitions
                +1           ;**** **** **** **** ****
                +1           IF MCU_48MHZ == 0
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#U_L_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#U_L_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#U_L_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#U_L_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#U_L_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#U_L_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#U_L_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#U_L_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#U_L_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#U_L_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#U_L_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (16 B
                             ytes)
                +1           
                +1           ELSE
                +1           
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#U_H_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#U_H_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#U_H_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#U_H_15#        "
                +1           ELSEIF FETON_DELAY == 20
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   421

                +1           Eep_ESC_Layout:         DB      "#U_H_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#U_H_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#U_H_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#U_H_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#U_H_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#U_H_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#U_H_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (16 B
                             ytes)
                +1           ENDIF
                +1           
                +1           TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for whi
                             ch main motor power is limited at 80degC (low byte, assuming high byte is 1)
                +1           TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment for a
                             nother 10degC
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Bootloader definitions
                +1           ;**** **** **** **** ****
                +1           RTX_PORT                                EQU     P0              ; Receive/Transmit port
                +1           RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL            
                                          
                +1           RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL             
                                          
                +1           RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP                
                                          
                +1           RTX_PIN                         EQU     3               ; RTX pin
                +1           
                +1           SIGNATURE_001                   EQU     0E8h            ; Device signature
                +1           IF MCU_48MHZ == 0
                +1           SIGNATURE_002                   EQU     0B1h
                +1           ELSE
                +1           SIGNATURE_002                   EQU     0B2h
                +1           ENDIF
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 0 definitions *
                +1           ;*********************  
                +1           Mux_A           EQU     7       ;i
                +1           Mux_C           EQU     6       ;i
                +1           Comp_Com        EQU     5       ;i
                +1           Mux_B           EQU     4       ;i
                +1           Rcp_In          EQU     3       ;i
                +1           LED_0           EQU     2       ;i
                +1           LED_1           EQU     1       ;i
                +1           LED_2           EQU     0       ;i
                +1           
                +1           P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                +1           P0_INIT         EQU     0FFh
                +1           P0_PUSHPULL     EQU     (1 SHL LED_0)+(1 SHL LED_1)+(1 SHL LED_2)
                +1           P0_SKIP         EQU     0FFh
                +1           
                +1           Get_Rcp_Capture_Values MACRO
                +1                   anl     TCON, #0EFh                             ; Disable timer0
                +1                   mov     Temp1, TL0                              ; Get timer0 values
                +1                   mov     Temp2, TH0
                +1           IF MCU_48MHZ == 1
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   422

                +1                   mov     Temp3, Timer0_X
                +1                   jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                +1                   inc     Temp3                                   ; If it is pending, then timer has 
                             already wrapped
                +1           ENDIF
                +1                   mov     TL0, #0                                 ; Reset timer0
                +1                   mov     TH0, #0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Timer0_X, #0
                +1           ENDIF
                +1                   orl     TCON, #10h                              ; Enable timer0 again
                +1           IF MCU_48MHZ == 1
                +1                   mov     A, Clock_Set_At_48MHz
                +1                   jnz     Get_Rcp_End
                +1                   clr     C
                +1                   mov     A, Temp1
                +1                   rlc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Temp2
                +1                   rlc     A
                +1                   mov     Temp2, A
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1           Get_Rcp_End:
                +1           ENDIF
                +1           ENDM
                +1           Decode_Dshot_2Msb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp4                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp4
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL
                +1           ENDM
                +1           Decode_Dshot_2Lsb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   423

                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp3                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL
                +1           ENDM
                +1           Initialize_PCA MACRO
                +1                   mov     PCA0CN0, #40h                           ; PCA enabled
                +1                   mov     PCA0MD, #08h                            ; PCA clock is system clock
                +1           IF FETON_DELAY == 0
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #00h                          ; Edge aligned pwm
                +1           ELSE
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #03h                          ; Center aligned pwm
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_Polarity MACRO
                +1                   mov     PCA0POL, #02h                           ; Damping inverted, pwm noninverted
                +1           ENDM
                +1           Enable_Power_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, enab
                             le match, set pwm mode
                +1           ELSE
                +1                   mov     PCA0CPM0, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Enable_Damp_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM1, #00h                          ; Disable
                +1           ELSE
                +1                   mov     PCA0CPM1, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Set_Power_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL0, Power_Pwm_Reg_L
                +1                   mov     PCA0CPH0, Power_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   424

                +1                   mov     A, Power_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Power_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL0, A
                +1                   mov     PCA0CPH0, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Set_Damp_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL1, Damp_Pwm_Reg_L
                +1                   mov     PCA0CPH1, Damp_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Damp_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Damp_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL1, A
                +1                   mov     PCA0CPH1, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Clear_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0DFh
                +1           ENDM
                +1           Clear_CCF_Interrupt MACRO
                +1                   anl     PCA0CN0, #0FEh
                +1           ENDM
                +1           Enable_COVF_Interrupt MACRO
                +1                   orl     PCA0PWM, #40h
                +1           ENDM
                +1           Enable_CCF_Interrupt MACRO
                +1                   orl     PCA0CPM0,#01h
                +1           ENDM
                +1           Disable_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0BFh
                +1           ENDM
                +1           Disable_CCF_Interrupt MACRO
                +1                   anl     PCA0CPM0,#0FEh
                +1           ENDM
                +1           
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 1 definitions *
                +1           ;*********************
                +1           ;                       EQU     7       ;i
                +1           CcomFET         EQU     6       ;o
                +1           BcomFET         EQU     5       ;o
                +1           AcomFET         EQU     4       ;o
                +1           CpwmFET         EQU     3       ;i
                +1           BpwmFET         EQU     2       ;o 
                +1           ApwmFET         EQU     1       ;o
                +1           ;                       EQU     0       ;o
                +1           
                +1           P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_INIT         EQU     00h             
                +1           P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_SKIP         EQU     7Fh
                +1           
                +1           ApwmFET_on MACRO
                +1                   setb    P1.ApwmFET
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   425

                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           ApwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_on MACRO
                +1                   setb    P1.BpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.BpwmFET
                +1           ELSE
                +1                   clr     P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_on MACRO
                +1                   setb    P1.CpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           All_pwmFETs_Off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1                   clr     P1.BpwmFET
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           
                +1           AcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.ApwmFET
                +1           ENDIF
                +1                   setb    P1.AcomFET
                +1           ENDM
                +1           AcomFET_off MACRO
                +1                   clr     P1.AcomFET
                +1           ENDM
                +1           BcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.BpwmFET
                +1           ENDIF
                +1                   setb    P1.BcomFET
                +1           ENDM
                +1           BcomFET_off MACRO
                +1                   clr     P1.BcomFET
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   426

                +1           ENDM
                +1           CcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.CpwmFET
                +1           ENDIF
                +1                   setb    P1.CcomFET
                +1           ENDM
                +1           CcomFET_off MACRO
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           All_comFETs_Off MACRO
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           
                +1           Set_Pwm_A MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1                   mov     P1SKIP, #7Dh
                +1           ELSE
                +1                   mov     P1SKIP, #6Dh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_B MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1                   mov     P1SKIP, #7Bh
                +1           ELSE
                +1                   mov     P1SKIP, #5Bh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_C MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1                   mov     P1SKIP, #77h
                +1           ELSE
                +1                   mov     P1SKIP, #37h
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwms_Off MACRO
                +1                   mov     P1SKIP, #7Fh
                +1           ENDM
                +1           
                +1           Set_Comp_Phase_A MACRO
                +1                   mov     CMP0MX, #75h    ; Set comparator multiplexer to phase A
                +1           ENDM
                +1           Set_Comp_Phase_B MACRO
                +1                   mov     CMP0MX, #45h    ; Set comparator multiplexer to phase B
                +1           ENDM
                +1           Set_Comp_Phase_C MACRO
                +1                   mov     CMP0MX, #65h    ; Set comparator multiplexer to phase C
                +1           ENDM
                +1           Read_Comp_Out MACRO
                +1                   mov     A, CMP0CN0      ; Read comparator output
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 2 definitions *
                +1           ;*********************
                +1           DebugPin                EQU     0       ;o
                +1           
                +1           P2_PUSHPULL     EQU     (1 SHL DebugPin)
                +1           
                +1           
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   427

                +1           ;**********************
                +1           ; MCU specific macros *
                +1           ;**********************
                +1           Interrupt_Table_Definition MACRO
                +1           CSEG AT 0                               ; Code segment start
                +1                   jmp reset
                +1           CSEG AT 03h                     ; Int0 interrupt        
                +1                   jmp     int0_int        
                +1           IF MCU_48MHZ == 1
                +1           CSEG AT 0Bh                     ; Timer0 overflow interrupt
                +1                   jmp     t0_int
                +1           ENDIF
                +1           CSEG AT 13h                     ; Int1 interrupt
                +1                   jmp     int1_int
                +1           CSEG AT 1Bh                     ; Timer1 overflow interrupt
                +1                   jmp     t1_int
                +1           CSEG AT 2Bh                     ; Timer2 overflow interrupt
                +1                   jmp     t2_int  
                +1           CSEG AT 5Bh                     ; Pca interrupt
                +1                   jmp     pca_int
                +1           CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                +1                   jmp     t3_int  
                +1           ENDM
                +1           
                +1           Initialize_Xbar MACRO
                +1                   mov     XBR2, #40h      ; Xbar enabled                  
                +1                   mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                +1           ENDM
                +1           
                +1           Initialize_Comparator MACRO
                +1                   mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                +1                   mov     CMP0MD, #00h    ; Comparator response time 100ns
                +1           ENDM
                +1           Initialize_Adc MACRO
                +1                   mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bias
                +1           IF MCU_48MHZ == 0
                +1                   mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                +1           ELSE
                +1                   mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                +1           ENDIF
                +1                   mov     ADC0MX, #10h    ; Select temp sensor input
                +1                   mov     ADC0CN0, #80h   ; ADC enabled 
                +1                   mov     ADC0CN1, #01h   ; Common mode buffer enabled
                +1           ENDM
                +1           Start_Adc MACRO
                +1                   mov     ADC0CN0, #90h   ; ADC start
                +1           ENDM
                +1           Read_Adc_Result MACRO
                +1                   mov     Temp1, ADC0L
                +1                   mov     Temp2, ADC0H
                +1           ENDM
                +1           Stop_Adc MACRO
                +1           ENDM
                +1           Set_RPM_Out MACRO
                +1           ENDM
                +1           Clear_RPM_Out MACRO
                +1           ENDM
                +1           Set_MCU_Clk_24MHz MACRO
                +1                   mov     CLKSEL, #13h            ; Set clock to 24MHz
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     Clock_Set_At_48MHz, #0
                +1           ENDM
                +1           Set_MCU_Clk_48MHz MACRO
                +1                   mov     SFRPAGE, #10h
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   428

                +1                   mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     CLKSEL, #03h            ; Set clock to 48MHz
                +1                   mov     Clock_Set_At_48MHz, #1
                +1           ENDM
                +1           Set_LED_0 MACRO
                +1                   clr     P0.LED_0
                +1           ENDM
                +1           Clear_LED_0 MACRO
                +1                   setb    P0.LED_0
                +1           ENDM
                +1           Set_LED_1 MACRO
                +1                   clr     P0.LED_1
                +1           ENDM
                +1           Clear_LED_1 MACRO
                +1                   setb    P0.LED_1
                +1           ENDM
                +1           Set_LED_2 MACRO
                +1                   clr     P0.LED_2
                +1           ENDM
                +1           Clear_LED_2 MACRO
                +1                   setb    P0.LED_2
                +1           ENDM
                +1           Set_LED_3 MACRO
                +1           ENDM
                +1           Clear_LED_3 MACRO
                +1           ENDM
                +1           
                             ENDIF
                   27816     
                   27817     IF ESCNO == V_
                             ;$include (V.inc) ; Select pinout V
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; BLHeli program for controlling brushless motors in helicopters and multirotors
                +1           ;
                +1           ; Copyright 2011, 2012 Steffen Skaug
                +1           ; This program is distributed under the terms of the GNU General Public License
                +1           ;
                +1           ; This file is part of BLHeli.
                +1           ;
                +1           ; BLHeli is free software: you can redistribute it and/or modify
                +1           ; it under the terms of the GNU General Public License as published by
                +1           ; the Free Software Foundation, either version 3 of the License, or
                +1           ; (at your option) any later version.
                +1           ;
                +1           ; BLHeli is distributed in the hope that it will be useful,
                +1           ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                +1           ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                +1           ; GNU General Public License for more details.
                +1           ;
                +1           ; You should have received a copy of the GNU General Public License
                +1           ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                +1           ;
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; Hardware definition file "V"
                +1           ; Cc X  RC X  MC CC MB MA    X  Ap Ac Bp X  X  Bc Cp
                +1           ;
                +1           ;**** **** **** **** ****
                +1           
                +1           
                +1           
                +1           ;*********************
                +1           ; Device SiLabs EFM8BB1x/2x
                +1           ;*********************
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   429

                +1           IF MCU_48MHZ == 0
                +1           ;$include (SI_EFM8BB1_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB10F2G
                +2           ;  EFM8BB10F2I
                +2           ;  EFM8BB10F2Y
                +2           ;  EFM8BB10F4G
                +2           ;  EFM8BB10F4I
                +2           ;  EFM8BB10F4Y
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC      DATA 0E0H; Accumulator                            
                +2           ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF   DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B        DATA 0F0H; B Register                             
                +2           CKCON0   DATA 08EH; Clock Control 0                        
                +2           CLKSEL   DATA 0A9H; Clock Select                           
                +2           CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0MD   DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                +2           CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN   DATA 0DDH; CRC0 Data Input                        
                +2           DERIVID  DATA 0ADH; Derivative Identification              
                +2           DEVICEID DATA 0B5H; Device Identification                  
                +2           DPH      DATA 083H; Data Pointer High                      
                +2           DPL      DATA 082H; Data Pointer Low                       
                +2           EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                +2           FLKEY    DATA 0B7H; Flash Lock and Key                     
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   430

                +2           HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           IE       DATA 0A8H; Interrupt Enable                       
                +2           IP       DATA 0B8H; Interrupt Priority                     
                +2           IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0       DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK   DATA 0FEH; Port 0 Mask                            
                +2           P0MAT    DATA 0FDH; Port 0 Match                           
                +2           P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP   DATA 0D4H; Port 0 Skip                            
                +2           P1       DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK   DATA 0EEH; Port 1 Mask                            
                +2           P1MAT    DATA 0EDH; Port 1 Match                           
                +2           P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP   DATA 0D5H; Port 1 Skip                            
                +2           P2       DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                +2           PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0  DATA 0D8H; PCA Control                            
                +2           PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD   DATA 0D9H; PCA Mode                               
                +2           PCA0POL  DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0    DATA 087H; Power Control                          
                +2           PRTDRV   DATA 0F6H; Port Drive Strength                    
                +2           PSCTL    DATA 08FH; Program Store Control                  
                +2           PSW      DATA 0D0H; Program Status Word                    
                +2           REF0CN   DATA 0D1H; Voltage Reference Control              
                +2           REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                +2           REVID    DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC   DATA 0EFH; Reset Source                           
                +2           SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                +2           SCON0    DATA 098H; UART0 Serial Port Control              
                +2           SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                +2           SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SP       DATA 081H; Stack Pointer                          
                +2           SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0  DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT  DATA 0A3H; SPI0 Data                              
                +2           TCON     DATA 088H; Timer 0/1 Control                      
                +2           TH0      DATA 08CH; Timer 0 High Byte                      
                +2           TH1      DATA 08DH; Timer 1 High Byte                      
                +2           TL0      DATA 08AH; Timer 0 Low Byte                       
                +2           TL1      DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD     DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2H    DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L    DATA 0CCH; Timer 2 Low Byte                       
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   431

                +2           TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0  DATA 091H; Timer 3 Control 0                      
                +2           TMR3H    DATA 095H; Timer 3 High Byte                      
                +2           TMR3L    DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                +2           VDM0CN   DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN    DATA 097H; Watchdog Timer Control                 
                +2           XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   432

                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   433

                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +1           
                +1           ELSE
                +1           ;$include (SI_EFM8BB2_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   434

                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB21F16G_QFN20
                +2           ;  EFM8BB21F16G_QSOP24
                +2           ;  EFM8BB21F16I_QFN20
                +2           ;  EFM8BB21F16I_QSOP24
                +2           ;  EFM8BB22F16G_QFN28
                +2           ;  EFM8BB22F16I_QFN28
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC       DATA 0E0H; Accumulator                            
                +2           ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF    DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B         DATA 0F0H; B Register                             
                +2           CKCON0    DATA 08EH; Clock Control 0                        
                +2           CKCON1    DATA 0A6H; Clock Control 1
                +2           CLKSEL    DATA 0A9H; Clock Select                           
                +2           CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0CN1   DATA 099H; Comparator 0 Control 1
                +2           CMP0MD    DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                +2           CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CN1   DATA 086H; CRC0 Control 1                         
                +2           CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN    DATA 0DDH; CRC0 Data Input                        
                +2           CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                +2           DERIVID   DATA 0ADH; Derivative Identification              
                +2           DEVICEID  DATA 0B5H; Device Identification                  
                +2           DPH       DATA 083H; Data Pointer High                      
                +2           DPL       DATA 082H; Data Pointer Low                       
                +2           EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                +2           EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                +2           EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                +2           EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                +2           EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                +2           EMI0CN    DATA 0E7H; External Memory Interface Control      
                +2           FLKEY     DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                +2           HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                +2           I2C0CN0   DATA 0BAH; I2C0 Control                           
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   435

                +2           I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                +2           I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                +2           I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                +2           I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                +2           I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                +2           I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                +2           I2C0STAT  DATA 0B9H; I2C0 Status                            
                +2           IE        DATA 0A8H; Interrupt Enable                       
                +2           IP        DATA 0B8H; Interrupt Priority                     
                +2           IPH       DATA 0F2H; Interrupt Priority High                
                +2           IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0        DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK    DATA 0FEH; Port 0 Mask                            
                +2           P0MAT     DATA 0FDH; Port 0 Match                           
                +2           P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP    DATA 0D4H; Port 0 Skip                            
                +2           P1        DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK    DATA 0EEH; Port 1 Mask                            
                +2           P1MAT     DATA 0EDH; Port 1 Match                           
                +2           P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP    DATA 0D5H; Port 1 Skip                            
                +2           P2        DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MASK    DATA 0FCH; Port 2 Mask                            
                +2           P2MAT     DATA 0FBH; Port 2 Match                           
                +2           P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                +2           P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                +2           P2SKIP    DATA 0CCH; Port 2 Skip                            
                +2           P3        DATA 0B0H; Port 3 Pin Latch                       
                +2           P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                +2           P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                +2           PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0   DATA 0D8H; PCA Control                            
                +2           PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD    DATA 0D9H; PCA Mode                               
                +2           PCA0POL   DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0     DATA 087H; Power Control                          
                +2           PCON1     DATA 09AH; Power Control 1                        
                +2           PFE0CN    DATA 0C1H; Prefetch Engine Control                
                +2           PRTDRV    DATA 0F6H; Port Drive Strength                    
                +2           PSCTL     DATA 08FH; Program Store Control                  
                +2           PSW       DATA 0D0H; Program Status Word                    
                +2           REF0CN    DATA 0D1H; Voltage Reference Control              
                +2           REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                +2           REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                +2           REVID     DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC    DATA 0EFH; Reset Source                           
                +2           SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                +2           SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                +2           SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                +2           SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                +2           SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   436

                +2           SCON0     DATA 098H; UART0 Serial Port Control              
                +2           SCON1     DATA 0C8H; UART1 Serial Port Control              
                +2           SFRPAGE   DATA 0A7H; SFR Page                               
                +2           SFRPGCN   DATA 0CFH; SFR Page Control                       
                +2           SFRSTACK  DATA 0D7H; SFR Page Stack                         
                +2           SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                +2           SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                +2           SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                +2           SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                +2           SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                +2           SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SMOD1     DATA 093H; UART1 Mode                             
                +2           SP        DATA 081H; Stack Pointer                          
                +2           SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0   DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT   DATA 0A3H; SPI0 Data                              
                +2           SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                +2           SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                +2           SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                +2           TCON      DATA 088H; Timer 0/1 Control                      
                +2           TH0       DATA 08CH; Timer 0 High Byte                      
                +2           TH1       DATA 08DH; Timer 1 High Byte                      
                +2           TL0       DATA 08AH; Timer 0 Low Byte                       
                +2           TL1       DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD      DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                +2           TMR2H     DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0   DATA 091H; Timer 3 Control 0                      
                +2           TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                +2           TMR3H     DATA 095H; Timer 3 High Byte                      
                +2           TMR3L     DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                +2           TMR4CN0   DATA 098H; Timer 4 Control 0                      
                +2           TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                +2           TMR4H     DATA 0A5H; Timer 4 High Byte                      
                +2           TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                +2           TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                +2           TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                +2           UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                +2           UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                +2           UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                +2           UART1LIN  DATA 09EH; UART1 LIN Configuration                
                +2           VDM0CN    DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN     DATA 097H; Watchdog Timer Control                 
                +2           XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   437

                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                +2           TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   438

                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                +2           P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                +2           
                +2           ; P3 0xB0 (Port 3 Pin Latch)
                +2           P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                +2           P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SCON1 0xC8 (UART1 Serial Port Control)
                +2           SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                +2           SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                +2           SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                +2           SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                +2           SCON1_REN  BIT SCON1.4 ; Receive Enable           
                +2           SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                +2           SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   439

                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                +2           TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                +2           
                +2           ; TMR4CN0 0x98 (Timer 4 Control 0)
                +2           TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                +2           TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                +2           TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                +2           TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                +2           TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                +2           TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                +2           TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                +2           TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                +2           
                +2           ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                +2           UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                +2           UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                +2           UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                +2           UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                +2           UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                +2           UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                +2           UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                +2           UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   440

                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +2           UART1_IRQn   EQU 17 ; UART1                     
                +2           I2C0_IRQn    EQU 18 ; I2C0 Slave                
                +2           TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; SFR Page Definitions
                +2           ;------------------------------------------------------------------------------
                +2           CRC0_PAGE       EQU 000H ; CRC0 Page       
                +2           LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                +2           PCA0_PAGE       EQU 000H ; PCA0 Page       
                +2           PG2_PAGE        EQU 010H ; Page2           
                +2           TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                +2           TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                +2           TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                +2           I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                +2           PG3_PAGE        EQU 020H ; Page3           
                +2           SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                +2           SPI0_PAGE       EQU 020H ; SPI0 Page       
                +2           UART0_PAGE      EQU 020H ; UART0 Page      
                +2           UART1_PAGE      EQU 020H ; UART1 Page      
                +1           
                +1           ENDIF
                +1           
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Uses internal calibrated oscillator set to 24/48Mhz
                +1           ;**** **** **** **** ****
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Constant definitions
                +1           ;**** **** **** **** ****
                +1           IF MCU_48MHZ == 0
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#V_L_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#V_L_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#V_L_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#V_L_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#V_L_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#V_L_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#V_L_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#V_L_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#V_L_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#V_L_70#        "
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   441

                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#V_L_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (16 B
                             ytes)
                +1           
                +1           ELSE
                +1           
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#V_H_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#V_H_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#V_H_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#V_H_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#V_H_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#V_H_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#V_H_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#V_H_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#V_H_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#V_H_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#V_H_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (16 B
                             ytes)
                +1           ENDIF
                +1           
                +1           TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for whi
                             ch main motor power is limited at 80degC (low byte, assuming high byte is 1)
                +1           TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment for a
                             nother 10degC
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Bootloader definitions
                +1           ;**** **** **** **** ****
                +1           RTX_PORT                                EQU     P0              ; Receive/Transmit port
                +1           RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL            
                                          
                +1           RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL             
                                          
                +1           RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP                
                                          
                +1           RTX_PIN                         EQU     5               ; RTX pin
                +1           
                +1           SIGNATURE_001                   EQU     0E8h            ; Device signature
                +1           IF MCU_48MHZ == 0
                +1           SIGNATURE_002                   EQU     0B1h
                +1           ELSE
                +1           SIGNATURE_002                   EQU     0B2h
                +1           ENDIF
                +1           
                +1           ;*********************
                +1           ; PORT 0 definitions *
                +1           ;*********************  
                +1           CcomFET         EQU     7       ;o
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   442

                +1           ;                       EQU     6       ;i
                +1           Rcp_In          EQU     5       ;i
                +1           ;                       EQU     4       ;i 
                +1           Mux_C           EQU     3       ;i
                +1           Comp_Com        EQU     2       ;i
                +1           Mux_B           EQU     1       ;i
                +1           Mux_A           EQU     0       ;i
                +1           
                +1           P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                +1           P0_INIT         EQU     NOT(1 SHL CcomFET)
                +1           P0_PUSHPULL     EQU     (1 SHL CcomFET)
                +1           P0_SKIP         EQU     0FFh
                +1           
                +1           Get_Rcp_Capture_Values MACRO
                +1                   anl     TCON, #0EFh                             ; Disable timer0
                +1                   mov     Temp1, TL0                              ; Get timer0 values
                +1                   mov     Temp2, TH0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Temp3, Timer0_X
                +1                   jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                +1                   inc     Temp3                                   ; If it is pending, then timer has 
                             already wrapped
                +1           ENDIF
                +1                   mov     TL0, #0                                 ; Reset timer0
                +1                   mov     TH0, #0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Timer0_X, #0
                +1           ENDIF
                +1                   orl     TCON, #10h                              ; Enable timer0 again
                +1           IF MCU_48MHZ == 1
                +1                   mov     A, Clock_Set_At_48MHz
                +1                   jnz     Get_Rcp_End
                +1                   clr     C
                +1                   mov     A, Temp1
                +1                   rlc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Temp2
                +1                   rlc     A
                +1                   mov     Temp2, A
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1           Get_Rcp_End:
                +1           ENDIF
                +1           ENDM
                +1           Decode_Dshot_2Msb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp4                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   443

                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp4
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL
                +1           ENDM
                +1           Decode_Dshot_2Lsb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp3                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL
                +1           ENDM
                +1           Initialize_PCA MACRO
                +1                   mov     PCA0CN0, #40h                           ; PCA enabled
                +1                   mov     PCA0MD, #08h                            ; PCA clock is system clock
                +1           IF FETON_DELAY == 0
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #00h                          ; Edge aligned pwm
                +1           ELSE
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #03h                          ; Center aligned pwm
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_Polarity MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0POL, #00h                           ; Pwm noninverted
                +1           ELSE
                +1                   mov     PCA0POL, #01h                           ; Damping inverted, pwm noninverted
                +1           ENDIF
                +1                   ENDM
                +1           Enable_Power_Pwm_Module MACRO
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   444

                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, enab
                             le match, set pwm mode
                +1           ELSE
                +1                   mov     PCA0CPM1, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Enable_Damp_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM1, #00h                          ; Disable
                +1           ELSE
                +1                   mov     PCA0CPM0, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Set_Power_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL0, Power_Pwm_Reg_L
                +1                   mov     PCA0CPH0, Power_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Power_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Power_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL1, A
                +1                   mov     PCA0CPH1, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Set_Damp_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL1, Damp_Pwm_Reg_L
                +1                   mov     PCA0CPH1, Damp_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Damp_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Damp_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL0, A
                +1                   mov     PCA0CPH0, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Clear_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0DFh
                +1           ENDM
                +1           Clear_CCF_Interrupt MACRO
                +1                   anl     PCA0CN0, #0FEh
                +1           ENDM
                +1           Enable_COVF_Interrupt MACRO
                +1                   orl     PCA0PWM, #40h
                +1           ENDM
                +1           Enable_CCF_Interrupt MACRO
                +1                   orl     PCA0CPM0,#01h
                +1           ENDM
                +1           Disable_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0BFh
                +1           ENDM
                +1           Disable_CCF_Interrupt MACRO
                +1                   anl     PCA0CPM0,#0FEh
                +1           ENDM
                +1           
                +1           
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   445

                +1           ;*********************
                +1           ; PORT 1 definitions *
                +1           ;*********************
                +1           ;                       EQU     7       ;i
                +1           ApwmFET         EQU     6       ;i
                +1           AcomFET         EQU     5       ;i
                +1           BpwmFET         EQU     4       ;o
                +1           ;               EQU     3       ;o
                +1           ;               EQU     2       ;o
                +1           BcomFET         EQU     1       ;o
                +1           CpwmFET         EQU     0       ;o
                +1           
                +1           P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)
                +1           P1_INIT         EQU     00h             
                +1           P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)
                +1           P1_SKIP         EQU     7Fh
                +1           
                +1           ApwmFET_on MACRO
                +1                   setb    P1.ApwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           ApwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_on MACRO
                +1                   setb    P1.BpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.BpwmFET
                +1           ELSE
                +1                   clr     P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_on MACRO
                +1                   setb    P1.CpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P0.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P0.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           All_pwmFETs_Off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1                   clr     P1.BpwmFET
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   446

                +1                   clr     P0.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           
                +1           AcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.ApwmFET
                +1           ENDIF
                +1                   setb P1.AcomFET
                +1           ENDM
                +1           AcomFET_off MACRO
                +1                   clr     P1.AcomFET
                +1           ENDM
                +1           BcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.BpwmFET
                +1           ENDIF
                +1                   setb    P1.BcomFET
                +1           ENDM
                +1           BcomFET_off MACRO
                +1                   clr     P1.BcomFET
                +1           ENDM
                +1           CcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.CpwmFET
                +1           ENDIF
                +1                   setb    P0.CcomFET
                +1           ENDM
                +1           CcomFET_off MACRO
                +1                   clr     P0.CcomFET
                +1           ENDM
                +1           All_comFETs_Off MACRO
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P0.CcomFET
                +1           ENDM
                +1           
                +1           Set_Pwm_A MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1                   mov     P0SKIP, #0FFh
                +1                   mov     P1SKIP, #3Fh
                +1           ELSE
                +1                   mov     P0SKIP, #0FFh
                +1                   mov     P1SKIP, #1Fh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_B MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1                   mov     P0SKIP, #0FFh
                +1                   mov     P1SKIP, #6Fh
                +1           ELSE
                +1                   mov     P0SKIP, #0FFh
                +1                   mov     P1SKIP, #6Dh
                +1           endif
                +1           ENDM
                +1           Set_Pwm_C MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P0.CcomFET
                +1                   mov     P0SKIP, #0FFh
                +1                   mov     P1SKIP, #7Fh
                +1           ELSE
                +1                   mov     P0SKIP, #7Fh
                +1                   mov     P1SKIP, #7Eh
                +1           endif
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   447

                +1           ENDM
                +1           Set_Pwms_Off MACRO
                +1                   mov     P0SKIP, #0FFh
                +1                   mov     P1SKIP, #7Fh
                +1           ENDM
                +1           
                +1           Set_Comp_Phase_A MACRO
                +1                   mov     CMP0MX, #02h    ; Set comparator multiplexer to phase A
                +1           ENDM
                +1           Set_Comp_Phase_B MACRO
                +1                   mov     CMP0MX, #12h    ; Set comparator multiplexer to phase B
                +1           ENDM
                +1           Set_Comp_Phase_C MACRO
                +1                   mov     CMP0MX, #32h    ; Set comparator multiplexer to phase C
                +1           ENDM
                +1           Read_Comp_Out MACRO
                +1                   mov     A, CMP0CN0      ; Read comparator output
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 2 definitions *
                +1           ;*********************
                +1           DebugPin                EQU     0       ;o
                +1           
                +1           P2_PUSHPULL     EQU     (1 SHL DebugPin)
                +1           
                +1           
                +1           ;**********************
                +1           ; MCU specific macros *
                +1           ;**********************
                +1           Interrupt_Table_Definition MACRO
                +1           CSEG AT 0                               ; Code segment start
                +1                   jmp reset
                +1           CSEG AT 03h                     ; Int0 interrupt        
                +1                   jmp     int0_int        
                +1           IF MCU_48MHZ == 1
                +1           CSEG AT 0Bh                     ; Timer0 overflow interrupt
                +1                   jmp     t0_int
                +1           ENDIF
                +1           CSEG AT 13h                     ; Int1 interrupt
                +1                   jmp     int1_int
                +1           CSEG AT 1Bh                     ; Timer1 overflow interrupt
                +1                   jmp     t1_int
                +1           CSEG AT 2Bh                     ; Timer2 overflow interrupt
                +1                   jmp     t2_int  
                +1           CSEG AT 5Bh                     ; Pca interrupt
                +1                   jmp     pca_int
                +1           CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                +1                   jmp     t3_int  
                +1           ENDM
                +1           
                +1           Initialize_Xbar MACRO
                +1                   mov     XBR2, #40h      ; Xbar enabled                  
                +1                   mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                +1           ENDM
                +1           
                +1           Initialize_Comparator MACRO
                +1                   mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                +1                   mov     CMP0MD, #00h    ; Comparator response time 100ns
                +1           ENDM
                +1           Initialize_Adc MACRO
                +1                   mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bias
                +1           IF MCU_48MHZ == 0
                +1                   mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                +1           ELSE
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   448

                +1                   mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                +1           ENDIF
                +1                   mov     ADC0MX, #10h    ; Select temp sensor input
                +1                   mov     ADC0CN0, #80h   ; ADC enabled 
                +1                   mov     ADC0CN1, #01h   ; Common mode buffer enabled
                +1           ENDM
                +1           Start_Adc MACRO
                +1                   mov     ADC0CN0, #90h   ; ADC start
                +1           ENDM
                +1           Read_Adc_Result MACRO
                +1                   mov     Temp1, ADC0L
                +1                   mov     Temp2, ADC0H
                +1           ENDM
                +1           Stop_Adc MACRO
                +1           ENDM
                +1           Set_RPM_Out MACRO
                +1           ENDM
                +1           Clear_RPM_Out MACRO
                +1           ENDM
                +1           Set_MCU_Clk_24MHz MACRO
                +1                   mov     CLKSEL, #13h            ; Set clock to 24MHz
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     Clock_Set_At_48MHz, #0
                +1           ENDM
                +1           Set_MCU_Clk_48MHz MACRO
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     CLKSEL, #03h            ; Set clock to 48MHz
                +1                   mov     Clock_Set_At_48MHz, #1
                +1           ENDM
                +1           Set_LED_0 MACRO
                +1           ENDM
                +1           Clear_LED_0 MACRO
                +1           ENDM
                +1           Set_LED_1 MACRO
                +1           ENDM
                +1           Clear_LED_1 MACRO
                +1           ENDM
                +1           Set_LED_2 MACRO
                +1           ENDM
                +1           Clear_LED_2 MACRO
                +1           ENDM
                +1           Set_LED_3 MACRO
                +1           ENDM
                +1           Clear_LED_3 MACRO
                +1           ENDM
                             ENDIF
                   29140     
                   29141     IF ESCNO == W_
                             ;$include (W.inc) ; Select pinout W
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; BLHeli program for controlling brushless motors in helicopters and multirotors
                +1           ;
                +1           ; Copyright 2011, 2012 Steffen Skaug
                +1           ; This program is distributed under the terms of the GNU General Public License
                +1           ;
                +1           ; This file is part of BLHeli.
                +1           ;
                +1           ; BLHeli is free software: you can redistribute it and/or modify
                +1           ; it under the terms of the GNU General Public License as published by
                +1           ; the Free Software Foundation, either version 3 of the License, or
                +1           ; (at your option) any later version.
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   449

                +1           ;
                +1           ; BLHeli is distributed in the hope that it will be useful,
                +1           ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                +1           ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                +1           ; GNU General Public License for more details.
                +1           ;
                +1           ; You should have received a copy of the GNU General Public License
                +1           ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                +1           ;
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; Hardware definition file "W". This is for tristate input style FET driver chips
                +1           ; RC MC MB X CC MA X X     X  Ap Bp Cp X X X X
                +1           ;
                +1           ;**** **** **** **** ****
                +1           
                +1           
                +1           
                +1           ;*********************
                +1           ; Device SiLabs EFM8BB1x/2x
                +1           ;*********************
                +1           IF MCU_48MHZ == 0
                +1           ;$include (SI_EFM8BB1_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB10F2G
                +2           ;  EFM8BB10F2I
                +2           ;  EFM8BB10F2Y
                +2           ;  EFM8BB10F4G
                +2           ;  EFM8BB10F4I
                +2           ;  EFM8BB10F4Y
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC      DATA 0E0H; Accumulator                            
                +2           ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF   DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B        DATA 0F0H; B Register                             
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   450

                +2           CKCON0   DATA 08EH; Clock Control 0                        
                +2           CLKSEL   DATA 0A9H; Clock Select                           
                +2           CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0MD   DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                +2           CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN   DATA 0DDH; CRC0 Data Input                        
                +2           DERIVID  DATA 0ADH; Derivative Identification              
                +2           DEVICEID DATA 0B5H; Device Identification                  
                +2           DPH      DATA 083H; Data Pointer High                      
                +2           DPL      DATA 082H; Data Pointer Low                       
                +2           EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                +2           FLKEY    DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           IE       DATA 0A8H; Interrupt Enable                       
                +2           IP       DATA 0B8H; Interrupt Priority                     
                +2           IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0       DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK   DATA 0FEH; Port 0 Mask                            
                +2           P0MAT    DATA 0FDH; Port 0 Match                           
                +2           P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP   DATA 0D4H; Port 0 Skip                            
                +2           P1       DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK   DATA 0EEH; Port 1 Mask                            
                +2           P1MAT    DATA 0EDH; Port 1 Match                           
                +2           P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP   DATA 0D5H; Port 1 Skip                            
                +2           P2       DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                +2           PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0  DATA 0D8H; PCA Control                            
                +2           PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD   DATA 0D9H; PCA Mode                               
                +2           PCA0POL  DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0    DATA 087H; Power Control                          
                +2           PRTDRV   DATA 0F6H; Port Drive Strength                    
                +2           PSCTL    DATA 08FH; Program Store Control                  
                +2           PSW      DATA 0D0H; Program Status Word                    
                +2           REF0CN   DATA 0D1H; Voltage Reference Control              
                +2           REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                +2           REVID    DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC   DATA 0EFH; Reset Source                           
                +2           SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   451

                +2           SCON0    DATA 098H; UART0 Serial Port Control              
                +2           SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                +2           SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SP       DATA 081H; Stack Pointer                          
                +2           SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0  DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT  DATA 0A3H; SPI0 Data                              
                +2           TCON     DATA 088H; Timer 0/1 Control                      
                +2           TH0      DATA 08CH; Timer 0 High Byte                      
                +2           TH1      DATA 08DH; Timer 1 High Byte                      
                +2           TL0      DATA 08AH; Timer 0 Low Byte                       
                +2           TL1      DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD     DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2H    DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0  DATA 091H; Timer 3 Control 0                      
                +2           TMR3H    DATA 095H; Timer 3 High Byte                      
                +2           TMR3L    DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                +2           VDM0CN   DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN    DATA 097H; Watchdog Timer Control                 
                +2           XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   452

                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   453

                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   454

                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +1           
                +1           ELSE
                +1           ;$include (SI_EFM8BB2_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB21F16G_QFN20
                +2           ;  EFM8BB21F16G_QSOP24
                +2           ;  EFM8BB21F16I_QFN20
                +2           ;  EFM8BB21F16I_QSOP24
                +2           ;  EFM8BB22F16G_QFN28
                +2           ;  EFM8BB22F16I_QFN28
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC       DATA 0E0H; Accumulator                            
                +2           ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF    DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B         DATA 0F0H; B Register                             
                +2           CKCON0    DATA 08EH; Clock Control 0                        
                +2           CKCON1    DATA 0A6H; Clock Control 1
                +2           CLKSEL    DATA 0A9H; Clock Select                           
                +2           CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0CN1   DATA 099H; Comparator 0 Control 1
                +2           CMP0MD    DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                +2           CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CN1   DATA 086H; CRC0 Control 1                         
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   455

                +2           CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN    DATA 0DDH; CRC0 Data Input                        
                +2           CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                +2           DERIVID   DATA 0ADH; Derivative Identification              
                +2           DEVICEID  DATA 0B5H; Device Identification                  
                +2           DPH       DATA 083H; Data Pointer High                      
                +2           DPL       DATA 082H; Data Pointer Low                       
                +2           EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                +2           EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                +2           EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                +2           EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                +2           EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                +2           EMI0CN    DATA 0E7H; External Memory Interface Control      
                +2           FLKEY     DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                +2           HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                +2           I2C0CN0   DATA 0BAH; I2C0 Control                           
                +2           I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                +2           I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                +2           I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                +2           I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                +2           I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                +2           I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                +2           I2C0STAT  DATA 0B9H; I2C0 Status                            
                +2           IE        DATA 0A8H; Interrupt Enable                       
                +2           IP        DATA 0B8H; Interrupt Priority                     
                +2           IPH       DATA 0F2H; Interrupt Priority High                
                +2           IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0        DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK    DATA 0FEH; Port 0 Mask                            
                +2           P0MAT     DATA 0FDH; Port 0 Match                           
                +2           P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP    DATA 0D4H; Port 0 Skip                            
                +2           P1        DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK    DATA 0EEH; Port 1 Mask                            
                +2           P1MAT     DATA 0EDH; Port 1 Match                           
                +2           P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP    DATA 0D5H; Port 1 Skip                            
                +2           P2        DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MASK    DATA 0FCH; Port 2 Mask                            
                +2           P2MAT     DATA 0FBH; Port 2 Match                           
                +2           P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                +2           P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                +2           P2SKIP    DATA 0CCH; Port 2 Skip                            
                +2           P3        DATA 0B0H; Port 3 Pin Latch                       
                +2           P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                +2           P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                +2           PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0   DATA 0D8H; PCA Control                            
                +2           PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   456

                +2           PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD    DATA 0D9H; PCA Mode                               
                +2           PCA0POL   DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0     DATA 087H; Power Control                          
                +2           PCON1     DATA 09AH; Power Control 1                        
                +2           PFE0CN    DATA 0C1H; Prefetch Engine Control                
                +2           PRTDRV    DATA 0F6H; Port Drive Strength                    
                +2           PSCTL     DATA 08FH; Program Store Control                  
                +2           PSW       DATA 0D0H; Program Status Word                    
                +2           REF0CN    DATA 0D1H; Voltage Reference Control              
                +2           REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                +2           REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                +2           REVID     DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC    DATA 0EFH; Reset Source                           
                +2           SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                +2           SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                +2           SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                +2           SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                +2           SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                +2           SCON0     DATA 098H; UART0 Serial Port Control              
                +2           SCON1     DATA 0C8H; UART1 Serial Port Control              
                +2           SFRPAGE   DATA 0A7H; SFR Page                               
                +2           SFRPGCN   DATA 0CFH; SFR Page Control                       
                +2           SFRSTACK  DATA 0D7H; SFR Page Stack                         
                +2           SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                +2           SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                +2           SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                +2           SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                +2           SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                +2           SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SMOD1     DATA 093H; UART1 Mode                             
                +2           SP        DATA 081H; Stack Pointer                          
                +2           SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0   DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT   DATA 0A3H; SPI0 Data                              
                +2           SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                +2           SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                +2           SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                +2           TCON      DATA 088H; Timer 0/1 Control                      
                +2           TH0       DATA 08CH; Timer 0 High Byte                      
                +2           TH1       DATA 08DH; Timer 1 High Byte                      
                +2           TL0       DATA 08AH; Timer 0 Low Byte                       
                +2           TL1       DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD      DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                +2           TMR2H     DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0   DATA 091H; Timer 3 Control 0                      
                +2           TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                +2           TMR3H     DATA 095H; Timer 3 High Byte                      
                +2           TMR3L     DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                +2           TMR4CN0   DATA 098H; Timer 4 Control 0                      
                +2           TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                +2           TMR4H     DATA 0A5H; Timer 4 High Byte                      
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   457

                +2           TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                +2           TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                +2           TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                +2           UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                +2           UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                +2           UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                +2           UART1LIN  DATA 09EH; UART1 LIN Configuration                
                +2           VDM0CN    DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN     DATA 097H; Watchdog Timer Control                 
                +2           XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                +2           TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   458

                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                +2           P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                +2           
                +2           ; P3 0xB0 (Port 3 Pin Latch)
                +2           P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                +2           P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   459

                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SCON1 0xC8 (UART1 Serial Port Control)
                +2           SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                +2           SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                +2           SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                +2           SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                +2           SCON1_REN  BIT SCON1.4 ; Receive Enable           
                +2           SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                +2           SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                +2           TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                +2           
                +2           ; TMR4CN0 0x98 (Timer 4 Control 0)
                +2           TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                +2           TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                +2           TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   460

                +2           TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                +2           TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                +2           TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                +2           TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                +2           TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                +2           
                +2           ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                +2           UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                +2           UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                +2           UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                +2           UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                +2           UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                +2           UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                +2           UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                +2           UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +2           UART1_IRQn   EQU 17 ; UART1                     
                +2           I2C0_IRQn    EQU 18 ; I2C0 Slave                
                +2           TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; SFR Page Definitions
                +2           ;------------------------------------------------------------------------------
                +2           CRC0_PAGE       EQU 000H ; CRC0 Page       
                +2           LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                +2           PCA0_PAGE       EQU 000H ; PCA0 Page       
                +2           PG2_PAGE        EQU 010H ; Page2           
                +2           TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                +2           TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                +2           TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                +2           I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                +2           PG3_PAGE        EQU 020H ; Page3           
                +2           SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                +2           SPI0_PAGE       EQU 020H ; SPI0 Page       
                +2           UART0_PAGE      EQU 020H ; UART0 Page      
                +2           UART1_PAGE      EQU 020H ; UART1 Page      
                +1           
                +1           ENDIF
                +1           
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Uses internal calibrated oscillator set to 24/48Mhz
                +1           ;**** **** **** **** ****
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Constant definitions
                +1           ;**** **** **** **** ****
                +1           IF MCU_48MHZ == 0
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   461

                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#W_L_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#W_L_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#W_L_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#W_L_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#W_L_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#W_L_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#W_L_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#W_L_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#W_L_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#W_L_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#W_L_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (16 B
                             ytes)
                +1           
                +1           ELSE
                +1           
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#W_H_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#W_H_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#W_H_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#W_H_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#W_H_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#W_H_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#W_H_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#W_H_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#W_H_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#W_H_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#W_H_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (16 B
                             ytes)
                +1           ENDIF
                +1           
                +1           TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for whi
                             ch main motor power is limited at 80degC (low byte, assuming high byte is 1)
                +1           TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment for a
                             nother 10degC
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Bootloader definitions
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   462

                +1           ;**** **** **** **** ****
                +1           RTX_PORT                                EQU     P0              ; Receive/Transmit port
                +1           RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL            
                                          
                +1           RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL             
                                          
                +1           RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP                
                                          
                +1           RTX_PIN                         EQU     7               ; RTX pin
                +1           
                +1           SIGNATURE_001                   EQU     0E8h            ; Device signature
                +1           IF MCU_48MHZ == 0
                +1           SIGNATURE_002                   EQU     0B1h
                +1           ELSE
                +1           SIGNATURE_002                   EQU     0B2h
                +1           ENDIF
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 0 definitions *
                +1           ;*********************  
                +1           Rcp_In          EQU     7       ;i
                +1           Mux_C           EQU     6       ;i
                +1           Mux_B           EQU     5       ;i
                +1           ;               EQU     4       ;i
                +1           Comp_Com        EQU     3       ;i
                +1           Mux_A           EQU     2       ;i
                +1           ;               EQU     1       ;i
                +1           ;               EQU     0       ;i
                +1           
                +1           P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                +1           P0_INIT         EQU     0FFh
                +1           P0_PUSHPULL     EQU     0
                +1           P0_SKIP         EQU     0FFh
                +1           
                +1           
                +1           Get_Rcp_Capture_Values MACRO
                +1                   anl     TCON, #0EFh                             ; Disable timer0
                +1                   mov     Temp1, TL0                              ; Get timer0 values
                +1                   mov     Temp2, TH0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Temp3, Timer0_X
                +1                   jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                +1                   inc     Temp3                                   ; If it is pending, then timer has 
                             already wrapped
                +1           ENDIF
                +1                   mov     TL0, #0                                 ; Reset timer0
                +1                   mov     TH0, #0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Timer0_X, #0
                +1           ENDIF
                +1                   orl     TCON, #10h                              ; Enable timer0 again
                +1           IF MCU_48MHZ == 1
                +1                   mov     A, Clock_Set_At_48MHz
                +1                   jnz     Get_Rcp_End
                +1                   clr     C
                +1                   mov     A, Temp1
                +1                   rlc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Temp2
                +1                   rlc     A
                +1                   mov     Temp2, A
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1           Get_Rcp_End:
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   463

                +1           ENDIF
                +1           ENDM
                +1           Decode_Dshot_2Msb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp4                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp4
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL
                +1           ENDM
                +1           Decode_Dshot_2Lsb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp3                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL
                +1           ENDM
                +1           Initialize_PCA MACRO
                +1                   mov     PCA0CN0, #40h                           ; PCA enabled
                +1                   mov     PCA0MD, #08h                            ; PCA clock is system clock
                +1           IF FETON_DELAY == 0
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   464

                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #00h                          ; Edge aligned pwm
                +1           ELSE
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #03h                          ; Center aligned pwm
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_Polarity MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0POL, #00h                           ; Pwm noninverted
                +1           ELSE
                +1                   mov     PCA0POL, #01h                           ; Damping inverted, pwm noninverted
                +1           ENDIF
                +1           ENDM
                +1           Enable_Power_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, enab
                             le match, set pwm mode
                +1           ELSE
                +1                   mov     PCA0CPM1, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Enable_Damp_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM1, #00h                          ; Disable
                +1           ELSE
                +1                   mov     PCA0CPM0, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Set_Power_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL0, Power_Pwm_Reg_L
                +1                   mov     PCA0CPH0, Power_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Power_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Power_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL1, A
                +1                   mov     PCA0CPH1, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Set_Damp_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL1, Damp_Pwm_Reg_L
                +1                   mov     PCA0CPH1, Damp_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Damp_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Damp_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL0, A
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   465

                +1                   mov     PCA0CPH0, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Clear_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0DFh
                +1           ENDM
                +1           Clear_CCF_Interrupt MACRO       ; CCF interrupt is only used for FETON_DELAY == 0
                +1                   anl     PCA0CN0, #0FEh
                +1           ENDM
                +1           Enable_COVF_Interrupt MACRO
                +1                   orl     PCA0PWM, #40h
                +1           ENDM
                +1           Enable_CCF_Interrupt MACRO
                +1                   orl     PCA0CPM0,#01h
                +1           ENDM
                +1           Disable_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0BFh
                +1           ENDM
                +1           Disable_CCF_Interrupt MACRO
                +1                   anl     PCA0CPM0,#0FEh
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 1 definitions *
                +1           ;*********************
                +1           ;               EQU     7       ;i
                +1           ApwmFET         EQU     6       ;o
                +1           BpwmFET         EQU     5       ;o
                +1           CpwmFET         EQU     4       ;o
                +1           ;               EQU     3       ;i
                +1           ;               EQU     2       ;i
                +1           ;               EQU     1       ;i
                +1           ;               EQU     0       ;i
                +1           ; pwm outputs start as analog in -> floating
                +1           ; this ensures all mosfet drivers start with floating outputs
                +1           P1_DIGITAL      EQU     NOT((1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET))
                +1           P1_INIT         EQU     00h
                +1           P1_PUSHPULL     EQU     ((1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET))
                +1           ;
                +1           P1_SKIP         EQU     0FFh
                +1           
                +1           
                +1           ApwmFET_on MACRO
                +1                   setb     P1.ApwmFET             ; set pin to high
                +1                   orl P1MDIN, #(1 SHL ApwmFET)    ; enable pin driver
                +1           ENDM
                +1           ApwmFET_off MACRO
                +1                   anl P1MDIN, #(NOT(1 SHL ApwmFET))       ; analog in -> pullup, driver and digital i
                             n is disable = floating
                +1           ENDM
                +1           BpwmFET_on MACRO
                +1                   setb P1.BpwmFET         ; set pin to high
                +1                   orl P1MDIN, #(1 SHL BpwmFET)    ; enable pin driver
                +1           ENDM
                +1           BpwmFET_off MACRO
                +1                   anl P1MDIN, #(NOT(1 SHL BpwmFET))       ; analog in -> pullup, driver and digital i
                             n is disable = floating
                +1           ENDM
                +1           CpwmFET_on MACRO
                +1                   setb     P1.CpwmFET             ; set pin to high
                +1                   orl P1MDIN, #(1 SHL CpwmFET)    ; enable pin driver
                +1           ENDM
                +1           CpwmFET_off MACRO
                +1                   anl P1MDIN, #(NOT(1 SHL CpwmFET))       ; analog in -> pullup, driver and digital i
                             n is disable = floating
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   466

                +1           ENDM
                +1           All_pwmFETs_Off MACRO
                +1                   anl P1MDIN, #(NOT((1 SHL ApwmFET) + (1 SHL BpwmFET) + (1 SHL CpwmFET))) ; analog in
                              -> pullup, driver and digital in is disable = floating
                +1           ENDM
                +1           
                +1           AcomFET_on MACRO
                +1                   clr P1.ApwmFET                  ; set pin to low
                +1                   orl P1MDIN, #(1 SHL ApwmFET)    ; enable pin driver
                +1           ENDM
                +1           AcomFET_off MACRO
                +1                   anl P1MDIN, #(NOT(1 SHL ApwmFET))       ; analog in -> pullup, driver and digital i
                             n is disable = floating
                +1           ENDM
                +1           BcomFET_on MACRO
                +1                   clr P1.BpwmFET                  ; set pin to low
                +1                   orl P1MDIN, #(1 SHL BpwmFET)    ; enable pin driver
                +1           ENDM
                +1           BcomFET_off MACRO
                +1                   anl P1MDIN, #(NOT(1 SHL BpwmFET))       ; analog in -> pullup, driver and digital i
                             n is disable = floating
                +1           ENDM
                +1           CcomFET_on MACRO
                +1                   clr P1.CpwmFET                  ; set pin to low
                +1                   orl P1MDIN, #(1 SHL CpwmFET)    ; enable pin driver
                +1           ENDM
                +1           CcomFET_off MACRO
                +1                   anl P1MDIN, #(NOT(1 SHL CpwmFET))       ; analog in -> pullup, driver and digital i
                             n is disable = floating
                +1           ENDM
                +1           All_comFETs_Off MACRO
                +1                   anl P1MDIN, #(NOT((1 SHL ApwmFET) + (1 SHL BpwmFET) + (1 SHL CpwmFET))) ; analog in
                              -> pullup, driver and digital in is disable = floating
                +1           ENDM
                +1           Set_Pwm_A MACRO
                +1                   mov     P1SKIP, #(NOT(1 SHL ApwmFET));
                +1                   orl     P1MDIN, #(1 SHL ApwmFET)        ; enable pin driver
                +1           ENDM
                +1           Set_Pwm_B MACRO
                +1                   mov     P1SKIP, #(NOT(1 SHL BpwmFET));
                +1                   orl     P1MDIN, #(1 SHL BpwmFET)        ; enable pin driver
                +1           ENDM
                +1           Set_Pwm_C MACRO
                +1                   mov     P1SKIP, #(NOT(1 SHL CpwmFET));
                +1                   orl     P1MDIN, #(1 SHL CpwmFET)        ; enable pin driver
                +1           ENDM
                +1           Set_Pwms_Off MACRO
                +1                   mov     P1SKIP, #P1_SKIP;
                +1           ENDM
                +1           
                +1           
                +1           
                +1           Set_Comp_Phase_A MACRO
                +1                   mov     CMP0MX, #((Mux_A) SHL 4)+((Comp_Com) SHL 0);
                +1           ENDM
                +1           Set_Comp_Phase_B MACRO
                +1                   mov     CMP0MX, #((Mux_B) SHL 4)+((Comp_Com) SHL 0);
                +1           ENDM
                +1           Set_Comp_Phase_C MACRO
                +1                   mov     CMP0MX, #((Mux_C) SHL 4)+((Comp_Com) SHL 0);
                +1           ENDM
                +1           Read_Comp_Out MACRO
                +1                   mov     A, CMP0CN0      ; Read comparator output
                +1           ENDM
                +1           
                +1           
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   467

                +1           
                +1           ;*********************
                +1           ; PORT 2 definitions *
                +1           ;*********************
                +1           DebugPin                EQU     0       ;o
                +1           
                +1           P2_PUSHPULL     EQU     (1 SHL DebugPin)
                +1           
                +1           
                +1           ;**********************
                +1           ; MCU specific macros *
                +1           ;**********************
                +1           Interrupt_Table_Definition MACRO
                +1           CSEG AT 0                               ; Code segment start
                +1                   jmp reset
                +1           CSEG AT 03h                     ; Int0 interrupt        
                +1                   jmp     int0_int        
                +1           IF MCU_48MHZ == 1
                +1           CSEG AT 0Bh                     ; Timer0 overflow interrupt
                +1                   jmp     t0_int
                +1           ENDIF
                +1           CSEG AT 13h                     ; Int1 interrupt
                +1                   jmp     int1_int
                +1           CSEG AT 1Bh                     ; Timer1 overflow interrupt
                +1                   jmp     t1_int
                +1           CSEG AT 2Bh                     ; Timer2 overflow interrupt
                +1                   jmp     t2_int  
                +1           CSEG AT 5Bh                     ; Pca interrupt
                +1                   jmp     pca_int
                +1           CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                +1                   jmp     t3_int  
                +1           ENDM
                +1           
                +1           Initialize_Xbar MACRO
                +1                   mov     XBR2, #40h      ; Xbar enabled                  
                +1                   mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                +1           ENDM
                +1           
                +1           Initialize_Comparator MACRO
                +1                   mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                +1                   mov     CMP0MD, #00h    ; Comparator response time 100ns
                +1           ENDM
                +1           Initialize_Adc MACRO
                +1                   mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bias
                +1           IF MCU_48MHZ == 0
                +1                   mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                +1           ELSE
                +1                   mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                +1           ENDIF
                +1                   mov     ADC0MX, #10h    ; Select temp sensor input
                +1                   mov     ADC0CN0, #80h   ; ADC enabled 
                +1                   mov     ADC0CN1, #01h   ; Common mode buffer enabled
                +1           ENDM
                +1           Start_Adc MACRO
                +1                   mov     ADC0CN0, #90h   ; ADC start
                +1           ENDM
                +1           Read_Adc_Result MACRO
                +1                   mov     Temp1, ADC0L
                +1                   mov     Temp2, ADC0H
                +1           ENDM
                +1           Stop_Adc MACRO
                +1           ENDM
                +1           Set_RPM_Out MACRO
                +1           ENDM
                +1           Clear_RPM_Out MACRO
                +1           ENDM
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   468

                +1           Set_MCU_Clk_24MHz MACRO
                +1                   mov     CLKSEL, #13h            ; Set clock to 24MHz
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     Clock_Set_At_48MHz, #0
                +1           ENDM
                +1           Set_MCU_Clk_48MHz MACRO
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     CLKSEL, #03h            ; Set clock to 48MHz
                +1                   mov     Clock_Set_At_48MHz, #1
                +1           ENDM
                +1           Set_LED_0 MACRO
                +1           ENDM
                +1           Clear_LED_0 MACRO
                +1           ENDM
                +1           Set_LED_1 MACRO
                +1           ENDM
                +1           Clear_LED_1 MACRO
                +1           ENDM
                +1           Set_LED_2 MACRO
                +1           ENDM
                +1           Clear_LED_2 MACRO
                +1           ENDM
                +1           Set_LED_3 MACRO
                +1           ENDM
                +1           Clear_LED_3 MACRO
                +1           ENDM
                             ENDIF
                   30418     
                   30419     
                   30420     ;**** **** **** **** ****
                   30421     ; Programming defaults
                   30422     ;
  0009             30423     DEFAULT_PGM_STARTUP_PWR                         EQU 9   ; 1=0.031 2=0.047 3=0.063 4=0.094 5
                             =0.125 6=0.188       7=0.25  8=0.38  9=0.50  10=0.75 11=1.00 12=1.25 13=1.50
  0003             30424     DEFAULT_PGM_COMM_TIMING                         EQU 3   ; 1=Low                 2=MediumLow
                                  3=Medium                4=MediumHigh    5=High
  0002             30425     DEFAULT_PGM_DEMAG_COMP                          EQU 2   ; 1=Disabled    2=Low           3=H
                             igh
  0001             30426     DEFAULT_PGM_DIRECTION                           EQU 1   ; 1=Normal      2=Reversed      3=B
                             idir         4=Bidir rev
  0028             30427     DEFAULT_PGM_BEEP_STRENGTH                       EQU 40  ; Beep strength
  0050             30428     DEFAULT_PGM_BEACON_STRENGTH                     EQU 80  ; Beacon strength
  0004             30429     DEFAULT_PGM_BEACON_DELAY                        EQU 4   ; 1=1m          2=2m               
                                  3=5m                    4=10m           5=Infinite
                   30430     
                   30431     ; COMMON
  0001             30432     DEFAULT_PGM_ENABLE_TX_PROGRAM           EQU 1   ; 1=Enabled     0=Disabled
  0025             30433     DEFAULT_PGM_MIN_THROTTLE                        EQU 37  ; 4*37+1000=1148
  00D0             30434     DEFAULT_PGM_MAX_THROTTLE                        EQU 208 ; 4*208+1000=1832
  007A             30435     DEFAULT_PGM_CENTER_THROTTLE                     EQU 122 ; 4*122+1000=1488 (used in bidirect
                             ional mode)
  0007             30436     DEFAULT_PGM_ENABLE_TEMP_PROT            EQU 7   ; 0=Disabled    1=80C   2=90C   3=100C  4=1
                             10C  5=120C  6=130C  7=140C
  0001             30437     DEFAULT_PGM_ENABLE_POWER_PROT           EQU 1   ; 1=Enabled     0=Disabled
  0000             30438     DEFAULT_PGM_BRAKE_ON_STOP                       EQU 0   ; 1=Enabled     0=Disabled
  0000             30439     DEFAULT_PGM_LED_CONTROL                         EQU 0   ; Byte for LED control. 2bits per L
                             ED, 0=Off, 1=On
                   30440     
                   30441     ;**** **** **** **** ****
                   30442     ; Temporary register definitions
  REG              30443     Temp1           EQU     R0
  REG              30444     Temp2           EQU     R1
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   469

  REG              30445     Temp3           EQU     R2
  REG              30446     Temp4           EQU     R3
  REG              30447     Temp5           EQU     R4
  REG              30448     Temp6           EQU     R5
  REG              30449     Temp7           EQU     R6
  REG              30450     Temp8           EQU     R7
                   30451     
                   30452     ;**** **** **** **** ****
                   30453     ; Register definitions
----               30454     DSEG AT 20h                                     ; Variables segment 
                   30455     
0020               30456     Bit_Access:                             DS      1               ; MUST BE AT THIS ADDRESS. 
                             Variable at bit accessible address (for non interrupt routines)
0021               30457     Bit_Access_Int:                 DS      1               ; Variable at bit accessible addres
                             s (for interrupts)
                   30458     
0022               30459     Rcp_Outside_Range_Cnt:          DS      1               ; RC pulse outside range counter (i
                             ncrementing) 
0023               30460     Rcp_Timeout_Cntd:                       DS      1               ; RC pulse timeout counter 
                             (decrementing) 
                   30461     
                   30462     
0024               30463     Flags0:                                 DS      1       ; State flags. Reset upon init_start
  0000             30464     T3_PENDING                              EQU     0               ; Timer 3 pending flag
  0001             30465     DEMAG_DETECTED                  EQU     1               ; Set when excessive demag time is 
                             detected
  0002             30466     COMP_TIMED_OUT                  EQU     2               ; Set when comparator reading timed
                              out
                   30467     ;                                               EQU     3
                   30468     ;                                               EQU     4
                   30469     ;                                               EQU     5       
                   30470     ;                                               EQU     6       
                   30471     ;                                               EQU     7       
                   30472     
                   30473     
0025               30474     Flags1:                                 DS      1       ; State flags. Reset upon init_star
                             t 
  0000             30475     STARTUP_PHASE                   EQU     0               ; Set when in startup phase
  0001             30476     INITIAL_RUN_PHASE               EQU             1               ; Set when in initial run p
                             hase, before synchronized run is achieved
  0002             30477     MOTOR_STARTED                   EQU     2               ; Set when motor is started
  0003             30478     DIR_CHANGE_BRAKE                EQU     3               ; Set when braking before direction
                              change
  0004             30479     HIGH_RPM                                EQU     4               ; Set when motor rpm is hig
                             h (Comm_Period4x_H less than 2)
                   30480     ;                                               EQU     5
                   30481     ;                                               EQU     6       
                   30482     ;                                               EQU     7       
                   30483     
0026               30484     Flags2:                                 DS      1               ; State flags. NOT reset up
                             on init_start
  0000             30485     RCP_UPDATED                             EQU     0               ; New RC pulse length value
                              available
  0001             30486     RCP_ONESHOT125                  EQU     1               ; RC pulse input is OneShot125 (125
                             -250us)
  0002             30487     RCP_ONESHOT42                   EQU     2               ; RC pulse input is OneShot42 (41.6
                             7-83us)
  0003             30488     RCP_MULTISHOT                   EQU     3               ; RC pulse input is Multishot (5-25
                             us)
  0004             30489     RCP_DSHOT                               EQU     4               ; RC pulse input is digital
                              shot
  0005             30490     RCP_DIR_REV                             EQU     5               ; RC pulse direction in bid
                             irectional mode
  0006             30491     RCP_FULL_RANGE                  EQU     6               ; When set full input signal range 
                             is used (1000-2000us) and stored calibration values are ignored
                   30492     ;                                               EQU     7       
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   470

                   30493     
0027               30494     Flags3:                                 DS      1               ; State flags. NOT reset up
                             on init_start
  0000             30495     PGM_DIR_REV                             EQU     0               ; Programmed direction. 0=n
                             ormal, 1=reversed
  0001             30496     PGM_BIDIR_REV                   EQU     1               ; Programmed bidirectional directio
                             n. 0=normal, 1=reversed
  0002             30497     PGM_BIDIR                               EQU     2               ; Programmed bidirectional 
                             operation. 0=normal, 1=bidirectional
                   30498     ;                                               EQU     3
                   30499     ;                                               EQU     4       
                   30500     ;                                               EQU     5       
                   30501     ;                                               EQU     6       
                   30502     ;                                               EQU     7       
                   30503     
                   30504     
                   30505     ;**** **** **** **** ****
                   30506     ; RAM definitions
----               30507     DSEG AT 30h                                             ; Ram data segment, direct addressi
                             ng
0030               30508     Initial_Arm:                            DS      1               ; Variable that is set duri
                             ng the first arm sequence after power on
                   30509     
0031               30510     Min_Throttle_L:                 DS      1               ; Minimum throttle scaled (lo byte)
0032               30511     Min_Throttle_H:                 DS      1               ; Minimum throttle scaled (hi byte)
0033               30512     Center_Throttle_L:                      DS      1               ; Center throttle scaled (l
                             o byte)
0034               30513     Center_Throttle_H:                      DS      1               ; Center throttle scaled (h
                             i byte)
0035               30514     Max_Throttle_L:                 DS      1               ; Maximum throttle scaled (lo byte)
0036               30515     Max_Throttle_H:                 DS      1               ; Maximum throttle scaled (hi byte)
                   30516     
0037               30517     Power_On_Wait_Cnt_L:            DS      1               ; Power on wait counter (lo byte)
0038               30518     Power_On_Wait_Cnt_H:            DS      1               ; Power on wait counter (hi byte)
                   30519     
0039               30520     Startup_Cnt:                            DS      1               ; Startup phase commutation
                             s counter (incrementing)
003A               30521     Startup_Zc_Timeout_Cntd:                DS      1               ; Startup zero cross timeou
                             t counter (decrementing)
003B               30522     Initial_Run_Rot_Cntd:           DS      1               ; Initial run rotations counter (de
                             crementing)
003C               30523     Stall_Cnt:                              DS      1               ; Counts start/run attempts
                              that resulted in stall. Reset upon a proper stop
003D               30524     Demag_Detected_Metric:          DS      1               ; Metric used to gauge demag event 
                             frequency
003E               30525     Demag_Pwr_Off_Thresh:           DS      1               ; Metric threshold above which powe
                             r is cut
003F               30526     Low_Rpm_Pwr_Slope:                      DS      1               ; Sets the slope of power i
                             ncrease for low rpms
                   30527     
0040               30528     Timer0_X:                                       DS      1               ; Timer 0 extended 
                             byte
0041               30529     Timer2_X:                                       DS      1               ; Timer 2 extended 
                             byte
0042               30530     Prev_Comm_L:                            DS      1               ; Previous commutation time
                             r 3 timestamp (lo byte)
0043               30531     Prev_Comm_H:                            DS      1               ; Previous commutation time
                             r 3 timestamp (hi byte)
0044               30532     Prev_Comm_X:                            DS      1               ; Previous commutation time
                             r 3 timestamp (ext byte)
0045               30533     Prev_Prev_Comm_L:                       DS      1               ; Pre-previous commutation 
                             timer 3 timestamp (lo byte)
0046               30534     Prev_Prev_Comm_H:                       DS      1               ; Pre-previous commutation 
                             timer 3 timestamp (hi byte)
0047               30535     Comm_Period4x_L:                        DS      1               ; Timer 3 counts between th
                             e last 4 commutations (lo byte)
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   471

0048               30536     Comm_Period4x_H:                        DS      1               ; Timer 3 counts between th
                             e last 4 commutations (hi byte)
0049               30537     Comparator_Read_Cnt:            DS      1               ; Number of comparator reads done
                   30538     
004A               30539     Wt_Adv_Start_L:                 DS      1               ; Timer 3 start point for commutati
                             on advance timing (lo byte)
004B               30540     Wt_Adv_Start_H:                 DS      1               ; Timer 3 start point for commutati
                             on advance timing (hi byte)
004C               30541     Wt_Zc_Scan_Start_L:                     DS      1               ; Timer 3 start point from 
                             commutation to zero cross scan (lo byte)
004D               30542     Wt_Zc_Scan_Start_H:                     DS      1               ; Timer 3 start point from 
                             commutation to zero cross scan (hi byte)
004E               30543     Wt_Zc_Tout_Start_L:                     DS      1               ; Timer 3 start point for z
                             ero cross scan timeout (lo byte)
004F               30544     Wt_Zc_Tout_Start_H:                     DS      1               ; Timer 3 start point for z
                             ero cross scan timeout (hi byte)
0050               30545     Wt_Comm_Start_L:                        DS      1               ; Timer 3 start point from 
                             zero cross to commutation (lo byte)
0051               30546     Wt_Comm_Start_H:                        DS      1               ; Timer 3 start point from 
                             zero cross to commutation (hi byte)
                   30547     
0052               30548     Dshot_Cmd:                              DS      1               ; Dshot command
0053               30549     Dshot_Cmd_Cnt:                          DS      1               ; Dshot command count
                   30550     
0054               30551     New_Rcp:                                        DS      1               ; New RC pulse valu
                             e in pca counts
0055               30552     Rcp_Stop_Cnt:                           DS      1               ; Counter for RC pulses bel
                             ow stop value
                   30553     
0056               30554     Power_Pwm_Reg_L:                        DS      1               ; Power pwm register settin
                             g (lo byte)
0057               30555     Power_Pwm_Reg_H:                        DS      1               ; Power pwm register settin
                             g (hi byte). 0x3F is minimum power
0058               30556     Damp_Pwm_Reg_L:                 DS      1               ; Damping pwm register setting (lo 
                             byte)
0059               30557     Damp_Pwm_Reg_H:                 DS      1               ; Damping pwm register setting (hi 
                             byte)
005A               30558     Current_Power_Pwm_Reg_H:                DS      1               ; Current power pwm registe
                             r setting that is loaded in the PCA register (hi byte)
                   30559     
005B               30560     Pwm_Limit:                              DS      1               ; Maximum allowed pwm 
005C               30561     Pwm_Limit_By_Rpm:                       DS      1               ; Maximum allowed pwm for l
                             ow or high rpms
005D               30562     Pwm_Limit_Beg:                          DS      1               ; Initial pwm limit
                   30563     
005E               30564     Adc_Conversion_Cnt:                     DS      1               ; Adc conversion counter
                   30565     
005F               30566     Current_Average_Temp:           DS      1               ; Current average temperature (lo b
                             yte ADC reading, assuming hi byte is 1)
                   30567     
0060               30568     Throttle_Gain:                          DS      1               ; Gain to be applied to RCP
                              value
0061               30569     Throttle_Gain_M:                        DS      1               ; Gain to be applied to RCP
                              value (multiplier 0=1x, 1=2x, 2=4x etc))
0062               30570     Throttle_Gain_BD_Rev:           DS      1               ; Gain to be applied to RCP value f
                             or reverse direction in bidirectional mode
0063               30571     Throttle_Gain_BD_Rev_M:         DS      1               ; Gain to be applied to RCP value f
                             or reverse direction in bidirectional mode (multiplier 0=1x, 1=2x, 2=4x etc)
0064               30572     Beep_Strength:                          DS      1               ; Strength of beeps
                   30573     
0065               30574     Skip_T2_Int:                            DS      1               ; Set for 48MHz MCUs when t
                             imer 2 interrupt shall be ignored
0066               30575     Clock_Set_At_48MHz:                     DS      1               ; Variable set if 48MHz MCU
                             s run at 48MHz
                   30576     
0067               30577     Flash_Key_1:                            DS      1               ; Flash key one
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   472

0068               30578     Flash_Key_2:                            DS      1               ; Flash key two
                   30579     
0069               30580     Temp_Prot_Limit:                        DS      1               ; Temperature protection li
                             mit
                   30581     
006A               30582     DShot_Pwm_Thr:                          DS      1               ; DShot pulse width thresho
                             ld value
006B               30583     DShot_Timer_Preset:                     DS      1               ; DShot timer preset for fr
                             ame sync detection
006C               30584     DShot_Frame_Start_L:            DS      1               ; DShot frame start timestamp (lo b
                             yte)
006D               30585     DShot_Frame_Start_H:            DS      1               ; DShot frame start timestamp (hi b
                             yte)
006E               30586     DShot_Frame_Length_Thr:         DS      1               ; DShot frame length criteria (in u
                             nits of 4 timer 2 ticks)
                   30587     
                   30588     ; Indirect addressing data segment. The variables below must be in this sequence
----               30589     ISEG AT 080h                                    
0080               30590     _Pgm_Gov_P_Gain:                        DS      1               ; Programmed governor P gain
0081               30591     _Pgm_Gov_I_Gain:                        DS      1               ; Programmed governor I gain
0082               30592     _Pgm_Gov_Mode:                          DS      1               ; Programmed governor mode
0083               30593     _Pgm_Low_Voltage_Lim:           DS      1               ; Programmed low voltage limit
0084               30594     _Pgm_Motor_Gain:                        DS      1               ; Programmed motor gain
0085               30595     _Pgm_Motor_Idle:                        DS      1               ; Programmed motor idle spe
                             ed
0086               30596     Pgm_Startup_Pwr:                        DS      1               ; Programmed startup power
0087               30597     _Pgm_Pwm_Freq:                          DS      1               ; Programmed pwm frequency
0088               30598     Pgm_Direction:                          DS      1               ; Programmed rotation direc
                             tion
0089               30599     Pgm_Input_Pol:                          DS      1               ; Programmed input pwm pola
                             rity
008A               30600     Initialized_L_Dummy:            DS      1               ; Place holder
008B               30601     Initialized_H_Dummy:            DS      1               ; Place holder
008C               30602     Pgm_Enable_TX_Program:          DS      1               ; Programmed enable/disable value f
                             or TX programming
008D               30603     _Pgm_Main_Rearm_Start:          DS      1               ; Programmed enable/disable re-armi
                             ng main every start 
008E               30604     _Pgm_Gov_Setup_Target:          DS      1               ; Programmed main governor setup ta
                             rget
008F               30605     _Pgm_Startup_Rpm:                       DS      1               ; Programmed startup rpm (u
                             nused - place holder)
0090               30606     _Pgm_Startup_Accel:                     DS      1               ; Programmed startup accele
                             ration (unused - place holder)
0091               30607     _Pgm_Volt_Comp:                 DS      1               ; Place holder
0092               30608     Pgm_Comm_Timing:                        DS      1               ; Programmed commutation ti
                             ming
0093               30609     _Pgm_Damping_Force:                     DS      1               ; Programmed damping force 
                             (unused - place holder)
0094               30610     _Pgm_Gov_Range:                 DS      1               ; Programmed governor range
0095               30611     _Pgm_Startup_Method:            DS      1               ; Programmed startup method (unused
                              - place holder)
0096               30612     Pgm_Min_Throttle:                       DS      1               ; Programmed throttle minim
                             um
0097               30613     Pgm_Max_Throttle:                       DS      1               ; Programmed throttle maxim
                             um
0098               30614     Pgm_Beep_Strength:                      DS      1               ; Programmed beep strength
0099               30615     Pgm_Beacon_Strength:            DS      1               ; Programmed beacon strength
009A               30616     Pgm_Beacon_Delay:                       DS      1               ; Programmed beacon delay
009B               30617     _Pgm_Throttle_Rate:                     DS      1               ; Programmed throttle rate 
                             (unused - place holder)
009C               30618     Pgm_Demag_Comp:                 DS      1               ; Programmed demag compensation
009D               30619     _Pgm_BEC_Voltage_High:          DS      1               ; Programmed BEC voltage
009E               30620     Pgm_Center_Throttle:            DS      1               ; Programmed throttle center (in bi
                             directional mode)
009F               30621     _Pgm_Main_Spoolup_Time:         DS      1               ; Programmed main spoolup time
00A0               30622     Pgm_Enable_Temp_Prot:           DS      1               ; Programmed temperature protection
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   473

                              enable
00A1               30623     Pgm_Enable_Power_Prot:          DS      1               ; Programmed low rpm power protecti
                             on enable
00A2               30624     _Pgm_Enable_Pwm_Input:          DS      1               ; Programmed PWM input signal enable
00A3               30625     _Pgm_Pwm_Dither:                        DS      1               ; Programmed output PWM dit
                             her
00A4               30626     Pgm_Brake_On_Stop:                      DS      1               ; Programmed braking when t
                             hrottle is zero
00A5               30627     Pgm_LED_Control:                        DS      1               ; Programmed LED control
                   30628     
                   30629     ; The sequence of the variables below is no longer of importance
00A6               30630     Pgm_Startup_Pwr_Decoded:                DS      1               ; Programmed startup power 
                             decoded
                   30631     
                   30632     
                   30633     ; Indirect addressing data segment
----               30634     ISEG AT 0D0h                                    
00D0               30635     Temp_Storage:                           DS      48              ; Temporary storage
                   30636     
                   30637     ;**** **** **** **** ****
----               30638     CSEG AT 1A00h            ; "Eeprom" segment
  0010             30639     EEPROM_FW_MAIN_REVISION         EQU     16              ; Main revision of the firmware
  0007             30640     EEPROM_FW_SUB_REVISION          EQU     7               ; Sub revision of the firmware
  0021             30641     EEPROM_LAYOUT_REVISION          EQU     33              ; Revision of the EEPROM layout
                   30642     
1A00 10            30643     Eep_FW_Main_Revision:           DB      EEPROM_FW_MAIN_REVISION                 ; EEPROM fi
                             rmware main revision number
1A01 07            30644     Eep_FW_Sub_Revision:            DB      EEPROM_FW_SUB_REVISION                  ; EEPROM fi
                             rmware sub revision number
1A02 21            30645     Eep_Layout_Revision:            DB      EEPROM_LAYOUT_REVISION                  ; EEPROM la
                             yout revision number
                   30646     
1A03 FF            30647     _Eep_Pgm_Gov_P_Gain:            DB      0FFh    
1A04 FF            30648     _Eep_Pgm_Gov_I_Gain:            DB      0FFh    
1A05 FF            30649     _Eep_Pgm_Gov_Mode:                      DB      0FFh    
1A06 FF            30650     _Eep_Pgm_Low_Voltage_Lim:       DB      0FFh                                               
                                  
1A07 FF            30651     _Eep_Pgm_Motor_Gain:            DB      0FFh    
1A08 FF            30652     _Eep_Pgm_Motor_Idle:            DB      0FFh                                            
1A09 09            30653     Eep_Pgm_Startup_Pwr:            DB      DEFAULT_PGM_STARTUP_PWR                 ; EEPROM co
                             py of programmed startup power
1A0A FF            30654     _Eep_Pgm_Pwm_Freq:                      DB      0FFh    
1A0B 01            30655     Eep_Pgm_Direction:                      DB      DEFAULT_PGM_DIRECTION                   ; E
                             EPROM copy of programmed rotation direction
1A0C FF            30656     _Eep_Pgm_Input_Pol:                     DB      0FFh
1A0D 55            30657     Eep_Initialized_L:                      DB      055h                                       
                                          ; EEPROM initialized signature low byte
1A0E AA            30658     Eep_Initialized_H:                      DB      0AAh                                       
                                          ; EEPROM initialized signature high byte
1A0F 01            30659     Eep_Enable_TX_Program:          DB      DEFAULT_PGM_ENABLE_TX_PROGRAM           ; EEPROM TX
                              programming enable
1A10 FF            30660     _Eep_Main_Rearm_Start:          DB      0FFh                                               
                                  
1A11 FF            30661     _Eep_Pgm_Gov_Setup_Target:      DB      0FFh                                               
                                  
1A12 FF            30662     _Eep_Pgm_Startup_Rpm:           DB      0FFh
1A13 FF            30663     _Eep_Pgm_Startup_Accel:         DB      0FFh
1A14 FF            30664     _Eep_Pgm_Volt_Comp:                     DB      0FFh    
1A15 03            30665     Eep_Pgm_Comm_Timing:            DB      DEFAULT_PGM_COMM_TIMING                 ; EEPROM co
                             py of programmed commutation timing
1A16 FF            30666     _Eep_Pgm_Damping_Force:         DB      0FFh
1A17 FF            30667     _Eep_Pgm_Gov_Range:                     DB      0FFh    
1A18 FF            30668     _Eep_Pgm_Startup_Method:                DB      0FFh
1A19 25            30669     Eep_Pgm_Min_Throttle:           DB      DEFAULT_PGM_MIN_THROTTLE                        ; E
                             EPROM copy of programmed minimum throttle
1A1A D0            30670     Eep_Pgm_Max_Throttle:           DB      DEFAULT_PGM_MAX_THROTTLE                        ; E
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   474

                             EPROM copy of programmed minimum throttle
1A1B 28            30671     Eep_Pgm_Beep_Strength:          DB      DEFAULT_PGM_BEEP_STRENGTH               ; EEPROM co
                             py of programmed beep strength
1A1C 50            30672     Eep_Pgm_Beacon_Strength:                DB      DEFAULT_PGM_BEACON_STRENGTH             ; E
                             EPROM copy of programmed beacon strength
1A1D 04            30673     Eep_Pgm_Beacon_Delay:           DB      DEFAULT_PGM_BEACON_DELAY                        ; E
                             EPROM copy of programmed beacon delay
1A1E FF            30674     _Eep_Pgm_Throttle_Rate:         DB      0FFh
1A1F 02            30675     Eep_Pgm_Demag_Comp:                     DB      DEFAULT_PGM_DEMAG_COMP                  ; E
                             EPROM copy of programmed demag compensation
1A20 FF            30676     _Eep_Pgm_BEC_Voltage_High:      DB      0FFh    
1A21 7A            30677     Eep_Pgm_Center_Throttle:                DB      DEFAULT_PGM_CENTER_THROTTLE             ; E
                             EPROM copy of programmed center throttle
1A22 FF            30678     _Eep_Pgm_Main_Spoolup_Time:     DB      0FFh
1A23 07            30679     Eep_Pgm_Temp_Prot_Enable:       DB      DEFAULT_PGM_ENABLE_TEMP_PROT            ; EEPROM co
                             py of programmed temperature protection enable
1A24 01            30680     Eep_Pgm_Enable_Power_Prot:      DB      DEFAULT_PGM_ENABLE_POWER_PROT           ; EEPROM co
                             py of programmed low rpm power protection enable
1A25 FF            30681     _Eep_Pgm_Enable_Pwm_Input:      DB      0FFh    
1A26 FF            30682     _Eep_Pgm_Pwm_Dither:            DB      0FFh    
1A27 00            30683     Eep_Pgm_Brake_On_Stop:          DB      DEFAULT_PGM_BRAKE_ON_STOP               ; EEPROM co
                             py of programmed braking when throttle is zero
1A28 00            30684     Eep_Pgm_LED_Control:            DB      DEFAULT_PGM_LED_CONTROL                 ; EEPROM co
                             py of programmed LED control
                   30685     
1A29 FF            30686     Eep_Dummy:                              DB      0FFh                                       
                                          ; EEPROM address for safety reason
                   30687     
----               30688     CSEG AT 1A60h
1A60 20202020      30689     Eep_Name:                                       DB      "                "                 
                                          ; Name tag (16 Bytes)
1A64 20202020                
1A68 20202020                
1A6C 20202020                
                   30690     
                   30691     ;**** **** **** **** ****
                   30692     Interrupt_Table_Definition              ; SiLabs interrupts
----               30711     CSEG AT 80h                     ; Code segment after interrupt vectors 
                   30712     
                   30713     ;**** **** **** **** ****
                   30714     
                   30715     ; Table definitions
0080 0406080C      30716     STARTUP_POWER_TABLE:    DB      04h, 06h, 08h, 0Ch, 10h, 18h, 20h, 30h, 40h, 60h, 80h, 0A0h
                             , 0C0h
0084 10182030                
0088 406080A0                
008C C0                      
                   30717     
                   30718     
                   30719     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   30720     ;
                   30721     ; Timer 0 interrupt routine
                   30722     ;
                   30723     ; No assumptions
                   30724     ;
                   30725     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   30726     IF MCU_48MHZ == 1
                             t0_int:
                                     inc     Timer0_X
                                     reti
                             ENDIF
                   30731     
                   30732     
                   30733     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   30734     ;
                   30735     ; Timer 1 interrupt routine
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   475

                   30736     ;
                   30737     ; No assumptions
                   30738     ;
                   30739     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
008D               30740     t1_int:
008D C2AF          30741             clr     IE_EA
008F C2A8          30742             clr     IE_EX0                  ; Disable int0 interrupts
0091 53E6EF        30743             anl     EIE1, #0EFh             ; Disable pca interrupts
0094 C28E          30744             clr     TCON_TR1                        ; Stop timer 1
0096 856B8B        30745             mov     TL1, DShot_Timer_Preset ; Reset sync timer
0099 C0D0          30746             push    PSW
009B D2D3          30747             setb    PSW.3                   ; Select register bank 1 for this interrupt
009D C0E0          30748             push    ACC
009F C0F0          30749             push    B                               ; Will be pop'ed by int0 exit
00A1 C2CA          30750             clr     TMR2CN0_TR2             ; Timer 2 disabled
00A3 A8CC          30751             mov     Temp1, TMR2L            ; Read timer value
00A5 A9CD          30752             mov     Temp2, TMR2H
00A7 D2CA          30753             setb    TMR2CN0_TR2             ; Timer 2 enabled
00A9 D2AF          30754             setb    IE_EA
                   30755             ; Reset timer 0
00AB 758A00        30756             mov     TL0, #0
                   30757             ; Check frame time length
00AE C3            30758             clr     C
00AF E8            30759             mov     A, Temp1
00B0 956C          30760             subb    A, DShot_Frame_Start_L
00B2 F8            30761             mov     Temp1, A
00B3 E9            30762             mov     A, Temp2
00B4 956D          30763             subb    A, DShot_Frame_Start_H
00B6 F9            30764             mov     Temp2, A
                   30765             ; Divide by 2 (or 4 for 48MHz). Unit is then us
00B7 C3            30766             clr     C
00B8 E9            30767             mov     A, Temp2
00B9 13            30768             rrc     A
00BA F9            30769             mov     Temp2, A
00BB E8            30770             mov     A, Temp1
00BC 13            30771             rrc     A
00BD F8            30772             mov     Temp1, A
00BE E566          30773             mov     A, Clock_Set_At_48MHz
00C0 6007          30774             jz      t1_int_frame_time_scaled
                   30775     
00C2 C3            30776             clr     C
00C3 E9            30777             mov     A, Temp2
00C4 13            30778             rrc     A
00C5 F9            30779             mov     Temp2, A
00C6 E8            30780             mov     A, Temp1
00C7 13            30781             rrc     A
00C8 F8            30782             mov     Temp1, A
                   30783     
00C9               30784     t1_int_frame_time_scaled:
00C9 E9            30785             mov     A, Temp2
00CA 7025          30786             jnz     t1_int_msb_fail ; Frame too long
00CC E8            30787             mov     A, Temp1
00CD 956E          30788             subb    A, DShot_Frame_Length_Thr
00CF 4020          30789             jc      t1_int_msb_fail ; Frame too short
00D1 956E          30790             subb    A, DShot_Frame_Length_Thr
00D3 501C          30791             jnc     t1_int_msb_fail ; Frame too long
                   30792     
                   30793             ; Check that correct number of pulses is received
00D5 E582          30794             mov     A, DPL                  ; Read current pointer
00D7 B41017        30795             cjne    A, #16, t1_int_msb_fail
                   30796     
                   30797             ; Decode transmitted data
00DA 7C00          30798             mov     Temp5, #0                       ; Reset timestamp
00DC 7B00          30799             mov     Temp4, #0                       ; High byte of receive buffer
00DE 7A00          30800             mov     Temp3, #0                       ; Low byte of receive buffer
00E0 7908          30801             mov     Temp2, #8                       ; Number of bits per byte
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   476

00E2 900000        30802             mov     DPTR, #0                        ; Set pointer
00E5 A86A          30803             mov     Temp1, DShot_Pwm_Thr; DShot pulse width criteria
00E7 E566          30804             mov     A, Clock_Set_At_48MHz
00E9 7004          30805             jnz     t1_int_decode
                   30806     
00EB C3            30807             clr     C
00EC E8            30808             mov     A, Temp1                        ; Scale pulse width criteria
00ED 13            30809             rrc     A
00EE F8            30810             mov     Temp1, A
                   30811     
00EF               30812     t1_int_decode:
00EF 01FA          30813             ajmp    t1_int_decode_msb
                   30814     
00F1               30815     t1_int_msb_fail:
00F1 900000        30816             mov     DPTR, #0                        ; Set pointer to start
00F4 D2A8          30817             setb    IE_EX0                  ; Enable int0 interrupts
00F6 D2AA          30818             setb    IE_EX1                  ; Enable int1 interrupts
00F8 61BA          30819             ajmp int0_int_outside_range
                   30820     
00FA               30821     t1_int_decode_msb:
                   30822             ; Decode DShot data Msb. Use more code space to save time (by not using loop)
                   30823             Decode_DShot_2Msb
                   30850             Decode_DShot_2Msb
                   30877             Decode_DShot_2Msb
                   30904             Decode_DShot_2Msb
016A 2175          30931             ajmp    t1_int_decode_lsb
                   30932     
016C               30933     t1_int_lsb_fail:
016C 900000        30934             mov     DPTR, #0                        ; Set pointer to start
016F D2A8          30935             setb    IE_EX0                  ; Enable int0 interrupts
0171 D2AA          30936             setb    IE_EX1                  ; Enable int1 interrupts
0173 61BA          30937             ajmp int0_int_outside_range
                   30938     
0175               30939     t1_int_decode_lsb:
                   30940             ; Decode DShot data Lsb
                   30941             Decode_DShot_2Lsb
                   30968             Decode_DShot_2Lsb
                   30995             Decode_DShot_2Lsb
                   31022             Decode_DShot_2Lsb
                   31049             ; XOR check (in inverted data, which is ok)
01E5 EB            31050             mov     A, Temp4
01E6 C4            31051             swap    A
01E7 6B            31052             xrl     A, Temp4
01E8 6A            31053             xrl     A, Temp3
01E9 54F0          31054             anl     A, #0F0h
01EB F9            31055             mov     Temp2, A
01EC EA            31056             mov     A, Temp3
01ED C4            31057             swap    A
01EE 54F0          31058             anl     A, #0F0h
01F0 C3            31059             clr     C
01F1 99            31060             subb    A, Temp2
01F2 6009          31061             jz      t1_int_xor_ok           ; XOR check
                   31062     
01F4 900000        31063             mov     DPTR, #0                        ; Set pointer to start
01F7 D2A8          31064             setb    IE_EX0                  ; Enable int0 interrupts
01F9 D2AA          31065             setb    IE_EX1                  ; Enable int1 interrupts
01FB 61BA          31066             ajmp int0_int_outside_range
                   31067     
01FD               31068     t1_int_xor_ok:
                   31069             ; Swap to be LSB aligned to 12 bits (and invert)
01FD EB            31070             mov     A, Temp4
01FE F4            31071             cpl     A
01FF C4            31072             swap A
0200 54F0          31073             anl     A, #0F0h                        ; Low nibble of high byte
0202 F9            31074             mov     Temp2, A
0203 EA            31075             mov     A, Temp3
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   477

0204 F4            31076             cpl     A
0205 C4            31077             swap    A
0206 540F          31078             anl     A, #0Fh                 ; High nibble of low byte 
0208 49            31079             orl     A, Temp2
0209 FA            31080             mov     Temp3, A
020A EB            31081             mov     A, Temp4                        ; High nibble of high byte
020B F4            31082             cpl     A
020C C4            31083             swap A
020D 540F          31084             anl     A, #0Fh
020F FB            31085             mov     Temp4, A
                   31086             ; Subtract 96 (still 12 bits)
0210 C3            31087             clr     C
0211 EA            31088             mov     A, Temp3
0212 F9            31089             mov     Temp2, A
0213 9460          31090             subb    A, #96
0215 FA            31091             mov     Temp3, A
0216 EB            31092             mov     A, Temp4
0217 9400          31093             subb    A, #0
0219 FB            31094             mov     Temp4, A
021A 5020          31095             jnc     t1_normal_range
                   31096     
021C C3            31097             clr     C       
021D E9            31098             mov     A, Temp2                ; Check for 0 or dshot command
021E 7B00          31099             mov     Temp4, #0
0220 7A00          31100             mov     Temp3, #0
0222 7900          31101             mov     Temp2, #0
0224 6016          31102             jz      t1_normal_range
                   31103             
0226 C3            31104             clr     C                               ; We are in the special dshot range
0227 13            31105             rrc     A                               ; Divide by 2
0228 5006          31106             jnc     t1_dshot_set_cmd        ; Check for tlm bit set (if not telemetry, Temp2 wi
                             ll be zero and result in invalid command)
                   31107     
022A F9            31108             mov     Temp2, A
022B C3            31109             clr     C
022C 9552          31110             subb A, Dshot_Cmd
022E 600A          31111             jz      t1_dshot_inc_cmd_cnt
                   31112     
0230               31113     t1_dshot_set_cmd:
0230 E9            31114             mov     A, Temp2
0231 F552          31115             mov     Dshot_Cmd, A
0233 755300        31116             mov     Dshot_Cmd_Cnt, #0
0236 7900          31117             mov     Temp2, #0
0238 8002          31118             jmp     t1_normal_range
                   31119             
023A               31120     t1_dshot_inc_cmd_cnt:
023A 0553          31121             inc     Dshot_Cmd_Cnt
                   31122             
023C               31123     t1_normal_range:
                   31124             ; Check for bidirectional operation (0=stop, 96-2095->fwd, 2096-4095->rev)
023C 303A27        31125             jnb     Flags3.PGM_BIDIR, t1_int_not_bidir      ; If not bidirectional operation - 
                             branch
                   31126     
                   31127             ; Subtract 2000 (still 12 bits)
023F C3            31128             clr     C
0240 EA            31129             mov     A, Temp3
0241 94D0          31130             subb    A, #0D0h
0243 F8            31131             mov     Temp1, A
0244 EB            31132             mov     A, Temp4
0245 9407          31133             subb    A, #07h
0247 F9            31134             mov     Temp2, A
0248 400B          31135             jc      t1_int_bidir_fwd                                ; If result is negative - b
                             ranch
                   31136     
024A E8            31137             mov     A, Temp1
024B FA            31138             mov     Temp3, A
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   478

024C E9            31139             mov     A, Temp2
024D FB            31140             mov     Temp4, A
024E 203509        31141             jb      Flags2.RCP_DIR_REV, t1_int_bidir_rev_chk        ; If same direction - branch
                   31142     
0251 D235          31143             setb    Flags2.RCP_DIR_REV
0253 415A          31144             ajmp    t1_int_bidir_rev_chk
                   31145     
0255               31146     t1_int_bidir_fwd:
0255 303502        31147             jnb     Flags2.RCP_DIR_REV, t1_int_bidir_rev_chk        ; If same direction - branch
                   31148     
0258 C235          31149             clr     Flags2.RCP_DIR_REV
                   31150     
025A               31151     t1_int_bidir_rev_chk:
025A 203902        31152             jb      Flags3.PGM_BIDIR_REV, ($+5)
                   31153     
025D B235          31154             cpl     Flags2.RCP_DIR_REV
                   31155     
025F C3            31156             clr     C                                                       ; Multiply throttle
                              value by 2
0260 EA            31157             mov     A, Temp3
0261 33            31158             rlc     A
0262 FA            31159             mov     Temp3, A
0263 EB            31160             mov     A, Temp4
0264 33            31161             rlc     A
0265 FB            31162             mov     Temp4, A
0266               31163     t1_int_not_bidir:
                   31164             ; Generate 4/256
0266 EB            31165             mov     A, Temp4
0267 2B            31166             add     A, Temp4
0268 3B            31167             addc    A, Temp4
0269 3B            31168             addc    A, Temp4
026A F9            31169             mov     Temp2, A
                   31170             ; Align to 11 bits
026B C3            31171             clr     C
026C EB            31172             mov     A, Temp4
026D 13            31173             rrc     A
026E FB            31174             mov     Temp4, A
026F EA            31175             mov     A, Temp3
0270 13            31176             rrc     A
0271 FA            31177             mov     Temp3, A
                   31178             ; Scale from 2000 to 2048
0272 EA            31179             mov     A, Temp3
0273 29            31180             add     A, Temp2        ; Holds 4/128
0274 FA            31181             mov     Temp3, A
0275 EB            31182             mov     A, Temp4
0276 3400          31183             addc    A, #0
0278 FB            31184             mov     Temp4, A
0279 30E304        31185             jnb     ACC.3, ($+7)
                   31186     
027C 7AFF          31187             mov     Temp3, #0FFh
027E 7BFF          31188             mov     Temp4, #0FFh
                   31189     
                   31190             ; Boost pwm during direct start
0280 E525          31191             mov     A, Flags1
0282 5403          31192             anl     A, #((1 SHL STARTUP_PHASE)+(1 SHL INITIAL_RUN_PHASE))
0284 601B          31193             jz      t1_int_startup_boosted
                   31194     
0286 202A18        31195             jb      Flags1.MOTOR_STARTED, t1_int_startup_boosted    ; Do not boost when changin
                             g direction in bidirectional mode
                   31196     
0289 E55D          31197             mov     A, Pwm_Limit_Beg                                ; Set 25% of max startup po
                             wer as minimum power
028B 33            31198             rlc     A
028C F9            31199             mov     Temp2, A
028D EB            31200             mov     A, Temp4
028E 7007          31201             jnz     t1_int_startup_boost_stall
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   479

                   31202     
0290 C3            31203             clr     C
0291 E9            31204             mov     A, Temp2
0292 9A            31205             subb    A, Temp3
0293 4002          31206             jc      t1_int_startup_boost_stall
                   31207     
0295 E9            31208             mov     A, Temp2
0296 FA            31209             mov     Temp3, A
                   31210     
0297               31211     t1_int_startup_boost_stall:
0297 E53C          31212             mov     A, Stall_Cnt                                    ; Add an extra power boost 
                             during start
0299 C4            31213             swap    A
029A 33            31214             rlc     A
029B 2A            31215             add     A, Temp3
029C FA            31216             mov     Temp3, A
029D EB            31217             mov     A, Temp4
029E 3400          31218             addc    A, #0
02A0 FB            31219             mov     Temp4, A
                   31220     
02A1               31221     t1_int_startup_boosted:
                   31222             ; Set 8bit value
02A1 C3            31223             clr     C
02A2 EA            31224             mov     A, Temp3
02A3 33            31225             rlc     A
02A4 C4            31226             swap    A
02A5 540F          31227             anl     A, #0Fh
02A7 F8            31228             mov     Temp1, A
02A8 EB            31229             mov     A, Temp4
02A9 33            31230             rlc     A
02AA C4            31231             swap    A
02AB 54F0          31232             anl     A, #0F0h
02AD 48            31233             orl     A, Temp1
02AE F8            31234             mov     Temp1, A
02AF 7005          31235             jnz     t1_int_zero_rcp_checked ; New_Rcp (Temp1) is only zero if all 11 bits are z
                             ero
                   31236     
02B1 EA            31237             mov     A, Temp3
02B2 6002          31238             jz      t1_int_zero_rcp_checked
                   31239     
02B4 7801          31240             mov     Temp1, #1
                   31241     
02B6               31242     t1_int_zero_rcp_checked:
                   31243             ; Align to 10 bits for 24MHz MCU
                   31244     IF MCU_48MHZ == 0
02B6 C3            31245             clr     C
02B7 EB            31246             mov     A, Temp4
02B8 13            31247             rrc     A
02B9 FB            31248             mov     Temp4, A
02BA EA            31249             mov     A, Temp3
02BB 13            31250             rrc     A
02BC FA            31251             mov     Temp3, A
                   31252     ENDIF
02BD 900000        31253             mov     DPTR, #0                                        ; Set pointer to start
02C0 D2A8          31254             setb    IE_EX0                                  ; Enable int0 interrupts
02C2 D2AA          31255             setb    IE_EX1                                  ; Enable int1 interrupts
                   31256             ; Decrement outside range counter
02C4 E522          31257             mov     A, Rcp_Outside_Range_Cnt
02C6 6002          31258             jz      ($+4)
                   31259     
02C8 1522          31260             dec     Rcp_Outside_Range_Cnt
                   31261     
02CA 819E          31262             ajmp    int0_int_pulse_ready
                   31263     
02CC               31264     t1_int_frame_fail:
02CC 900000        31265             mov     DPTR, #0                                        ; Set pointer to start
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   480

02CF D2A8          31266             setb    IE_EX0                                  ; Enable int0 interrupts
02D1 D2AA          31267             setb    IE_EX1                                  ; Enable int1 interrupts
02D3 61BA          31268             ajmp int0_int_outside_range
                   31269     
                   31270     
                   31271     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   31272     ;
                   31273     ; Timer 2 interrupt routine
                   31274     ;
                   31275     ; No assumptions
                   31276     ; Requirements: Temp variables can NOT be used since PSW.x is not set
                   31277     ;
                   31278     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
02D5               31279     t2_int: ; Happens every 32ms
02D5 C0D0          31280             push    PSW                     ; Preserve registers through interrupt
02D7 C0E0          31281             push    ACC
02D9 C2CF          31282             clr     TMR2CN0_TF2H                            ; Clear interrupt flag
02DB 0541          31283             inc     Timer2_X
                   31284     IF MCU_48MHZ == 1
                                     mov     A, Clock_Set_At_48MHz
                                     jz      t2_int_start
                             
                                     ; Check skip variable
                                     mov     A, Skip_T2_Int
                                     jz      t2_int_start                            ; Execute this interrupt
                             
                                     mov     Skip_T2_Int, #0
                                     ajmp    t2_int_exit
                             
                             t2_int_start:
                                     mov     Skip_T2_Int, #1                 ; Skip next interrupt
                             ENDIF
                   31298             ; Update RC pulse timeout counter 
02DD E523          31299             mov     A, Rcp_Timeout_Cntd                     ; RC pulse timeout count zero?
02DF 6002          31300             jz      ($+4)                                   ; Yes - do not decrement
                   31301     
02E1 1523          31302             dec     Rcp_Timeout_Cntd                        ; No decrement
                   31303     
                   31304             ; Check RC pulse against stop value
02E3 C3            31305             clr     C
02E4 E554          31306             mov     A, New_Rcp                              ; Load new pulse value
02E6 6005          31307             jz      t2_int_rcp_stop                 ; Check if pulse is below stop value
                   31308     
                   31309             ; RC pulse higher than stop value, reset stop counter
02E8 755500        31310             mov     Rcp_Stop_Cnt, #0                        ; Reset rcp stop counter
02EB 41F8          31311             ajmp    t2_int_exit
                   31312     
02ED               31313     t2_int_rcp_stop:
                   31314             ; RC pulse less than stop value
02ED E555          31315             mov     A, Rcp_Stop_Cnt                 ; Increment stop counter
02EF 2401          31316             add     A, #1
02F1 F555          31317             mov     Rcp_Stop_Cnt, A
02F3 5003          31318             jnc     ($+5)                                   ; Branch if counter has not wrapped
                   31319     
02F5 7555FF        31320             mov     Rcp_Stop_Cnt, #0FFh                     ; Set stop counter to max
                   31321     
02F8               31322     t2_int_exit:
02F8 D0E0          31323             pop     ACC                     ; Restore preserved registers
02FA D0D0          31324             pop     PSW
02FC 32            31325             reti
                   31326     
                   31327     
                   31328     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   31329     ;
                   31330     ; Timer 3 interrupt routine
                   31331     ;
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   481

                   31332     ; No assumptions
                   31333     ; Requirements: Temp variables can NOT be used since PSW.x is not set
                   31334     ;               ACC can not be used, as it is not pushed to stack
                   31335     ;
                   31336     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
02FD               31337     t3_int: ; Used for commutation timing
02FD C2AF          31338             clr     IE_EA                   ; Disable all interrupts
02FF 53E67F        31339             anl     EIE1, #7Fh              ; Disable timer 3 interrupts
0302 7592FA        31340             mov     TMR3RLL, #0FAh          ; Set a short delay before next interrupt
0305 7593FF        31341             mov     TMR3RLH, #0FFh
0308 C220          31342             clr     Flags0.T3_PENDING       ; Flag that timer has wrapped
030A 53917F        31343             anl     TMR3CN0, #07Fh          ; Timer 3 interrupt flag cleared
030D D2AF          31344             setb    IE_EA                   ; Enable all interrupts
030F 32            31345             reti
                   31346     
                   31347     
                   31348     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   31349     ;
                   31350     ; Int0 interrupt routine
                   31351     ;
                   31352     ; No assumptions
                   31353     ;
                   31354     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0310               31355     int0_int:       ; Used for RC pulse timing
0310 C0E0          31356             push    ACC
0312 E58A          31357             mov     A, TL0                  ; Read pwm for DShot immediately
                   31358             ; Test for DShot
0314 303408        31359             jnb     Flags2.RCP_DSHOT, int0_int_not_dshot
                   31360     
0317 856B8B        31361             mov     TL1, DShot_Timer_Preset ; Reset sync timer
031A F0            31362             movx    @DPTR, A                        ; Store pwm
031B A3            31363             inc     DPTR
031C D0E0          31364             pop     ACC
031E 32            31365             reti
                   31366     
                   31367             ; Not DShot
031F               31368     int0_int_not_dshot:
031F D0E0          31369             pop     ACC
0321 C2AF          31370             clr     IE_EA
0323 53E6EF        31371             anl     EIE1, #0EFh             ; Disable pca interrupts
0326 C0D0          31372             push    PSW                             ; Preserve registers through interrupt
0328 C0E0          31373             push    ACC
032A C0F0          31374             push    B
032C D2D3          31375             setb    PSW.3                   ; Select register bank 1 for this interrupt 
032E D2AF          31376             setb    IE_EA
                   31377             ; Get the counter values
                   31378             Get_Rcp_Capture_Values
                   31408             ; Scale down to 10 bits (for 24MHz, and 11 bits for 48MHz)
0340 30331F        31409             jnb     Flags2.RCP_MULTISHOT, int0_int_fall_not_multishot
                   31410     
                   31411             ; Multishot - Multiply by 2 and add 1/16 and 1/32
0343 E8            31412             mov     A, Temp1                ; Divide by 16
0344 C4            31413             swap A
0345 540F          31414             anl     A, #0Fh
0347 FA            31415             mov     Temp3, A
0348 E9            31416             mov     A, Temp2
0349 C4            31417             swap    A
034A 54F0          31418             anl     A, #0F0h
034C 4A            31419             orl     A, Temp3
034D FA            31420             mov     Temp3, A
034E C3            31421             clr     C                       ; Make divided by 32
034F 13            31422             rrc     A
0350 2A            31423             add     A, Temp3                ; Add 1/16 to 1/32
0351 FA            31424             mov     Temp3, A
0352 C3            31425             clr     C                       ; Multiply by 2
0353 E8            31426             mov     A, Temp1
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   482

0354 33            31427             rlc     A
0355 F8            31428             mov     Temp1, A
0356 E9            31429             mov     A, Temp2
0357 33            31430             rlc     A
0358 F9            31431             mov     Temp2, A
0359 E8            31432             mov     A, Temp1                ; Add 1/16 and 1/32
035A 2A            31433             add     A, Temp3
035B FA            31434             mov     Temp3, A
035C E9            31435             mov     A, Temp2
                   31436     IF MCU_48MHZ == 0
035D 3403          31437             addc    A, #03h         ; Add to low end, to make signal look like 20-40us
                   31438     ELSE
                                     addc    A, #06h
                             ENDIF
035F FB            31441             mov     Temp4, A
0360 61AB          31442             ajmp    int0_int_fall_gain_done
                   31443     
0362               31444     int0_int_fall_not_multishot:
0362 30320F        31445             jnb     Flags2.RCP_ONESHOT42, int0_int_fall_not_oneshot_42
                   31446     
                   31447             ; Oneshot42 - Add 2/256
0365 C3            31448             clr     C
0366 E8            31449             mov     A, Temp1
0367 33            31450             rlc     A
0368 E9            31451             mov     A, Temp2
0369 33            31452             rlc     A
036A FA            31453             mov     Temp3, A
036B E8            31454             mov     A, Temp1
036C 2A            31455             add     A, Temp3
036D FA            31456             mov     Temp3, A
036E E9            31457             mov     A, Temp2
036F 3400          31458             addc    A, #0
0371 FB            31459             mov     Temp4, A
0372 61AB          31460             ajmp    int0_int_fall_gain_done
                   31461     
0374               31462     int0_int_fall_not_oneshot_42:
0374 303115        31463             jnb     Flags2.RCP_ONESHOT125, int0_int_fall_not_oneshot_125
                   31464     
                   31465             ; Oneshot125 - multiply by 86/256
0377 E8            31466             mov     A, Temp1                ; Multiply by 86 and divide by 256
0378 75F056        31467             mov     B, #56h
037B A4            31468             mul     AB
037C AAF0          31469             mov     Temp3, B
037E E9            31470             mov     A, Temp2
037F 75F056        31471             mov     B, #56h
0382 A4            31472             mul     AB
0383 2A            31473             add     A, Temp3
0384 FA            31474             mov     Temp3, A
0385 C5F0          31475             xch     A, B
0387 3400          31476             addc    A, #0
0389 FB            31477             mov     Temp4, A
038A 61AB          31478             ajmp    int0_int_fall_gain_done
                   31479     
038C               31480     int0_int_fall_not_oneshot_125:
                   31481             ; Regular signal - multiply by 43/1024
                   31482     IF MCU_48MHZ == 1
                                     clr     C
                                     mov     A, Temp3                ; Divide by 2
                                     rrc     A
                                     mov     Temp3, A
                                     mov     A, Temp2
                                     rrc     A
                                     mov     Temp2, A
                                     mov     A, Temp1
                                     rrc     A
                                     mov     Temp1, A
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   483

                             ENDIF
038C E8            31494             mov     A, Temp1                ; Multiply by 43 and divide by 1024
                   31495     IF MCU_48MHZ == 0
038D 75F02B        31496             mov     B, #2Bh
                   31497     ELSE
                                     mov     B, #56h         ; Multiply by 86
                             ENDIF
0390 A4            31500             mul     AB
0391 AAF0          31501             mov     Temp3, B
0393 E9            31502             mov     A, Temp2
                   31503     IF MCU_48MHZ == 0
0394 75F02B        31504             mov     B, #2Bh
                   31505     ELSE
                                     mov     B, #56h         ; Multiply by 86
                             ENDIF
0397 A4            31508             mul     AB
0398 2A            31509             add     A, Temp3
0399 FA            31510             mov     Temp3, A
039A C5F0          31511             xch     A, B
039C 3400          31512             addc    A, #0
039E C3            31513             clr     C       
039F 13            31514             rrc     A                       ; Divide by 2 for total 512
03A0 FB            31515             mov     Temp4, A
03A1 EA            31516             mov     A, Temp3
03A2 13            31517             rrc     A
03A3 FA            31518             mov     Temp3, A
03A4 C3            31519             clr     C
03A5 EB            31520             mov     A, Temp4                ; Divide by 2 for total 1024
03A6 13            31521             rrc     A                                               
03A7 FB            31522             mov     Temp4, A
03A8 EA            31523             mov     A, Temp3
03A9 13            31524             rrc     A
03AA FA            31525             mov     Temp3, A
                   31526     
03AB               31527     int0_int_fall_gain_done:
                   31528             ; Check if 2235us or above (in order to ignore false pulses)
03AB C3            31529             clr     C
03AC EB            31530             mov     A, Temp4                                                ; Is pulse 2235us o
                             r higher?
                   31531     IF MCU_48MHZ == 0
03AD 9409          31532             subb A, #09h
                   31533     ELSE
                                     subb A, #12h
                             ENDIF
03AF 5009          31536             jnc     int0_int_outside_range                  ; Yes - ignore pulse
                   31537     
                   31538             ; Check if below 900us (in order to ignore false pulses)
03B1 C3            31539             clr     C
03B2 EA            31540             mov     A, Temp3
                   31541     IF MCU_48MHZ == 0
03B3 949A          31542             subb A, #9Ah
                   31543     ELSE
                                     subb A, #34h
                             ENDIF
03B5 EB            31546             mov     A, Temp4
                   31547     IF MCU_48MHZ == 0
03B6 9403          31548             subb A, #03h
                   31549     ELSE
                                     subb A, #07h
                             ENDIF
03B8 5016          31552             jnc     int0_int_check_full_range               ; No - proceed
                   31553     
03BA               31554     int0_int_outside_range:
03BA 0522          31555             inc     Rcp_Outside_Range_Cnt
03BC E522          31556             mov     A, Rcp_Outside_Range_Cnt
03BE 7002          31557             jnz     ($+4)
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   484

                   31558     
03C0 1522          31559             dec     Rcp_Outside_Range_Cnt
                   31560     
03C2 C3            31561             clr     C
03C3 E522          31562             mov     A, Rcp_Outside_Range_Cnt
03C5 9432          31563             subb    A, #50                                          ; Allow a given number of o
                             utside pulses
03C7 5002          31564             jnc     ($+4)
03C9 81F2          31565             ajmp    int0_int_set_timeout                    ; If outside limits - ignore first 
                             pulses
                   31566     
03CB 755400        31567             mov     New_Rcp, #0                                     ; Set pulse length to zero
03CE 81F5          31568             ajmp    int0_int_exit                                   ; Exit without reseting tim
                             eout
                   31569     
03D0               31570     int0_int_check_full_range:
                   31571             ; Decrement outside range counter
03D0 E522          31572             mov     A, Rcp_Outside_Range_Cnt
03D2 6002          31573             jz      ($+4)
                   31574     
03D4 1522          31575             dec     Rcp_Outside_Range_Cnt
                   31576     
                   31577             ; Calculate "1000us" plus throttle minimum
03D6 303606        31578             jnb     Flags2.RCP_FULL_RANGE, int0_int_set_min ; Check if full range is chosen
                   31579     
03D9 7C00          31580             mov     Temp5, #0                                               ; Set 1000us as def
                             ault minimum
                   31581     IF MCU_48MHZ == 0
03DB 7D04          31582             mov     Temp6, #4
                   31583     ELSE
                                     mov     Temp6, #8
                             ENDIF
03DD 61EA          31586             ajmp    int0_int_calculate
                   31587     
03DF               31588     int0_int_set_min:
03DF AC31          31589             mov     Temp5, Min_Throttle_L                   ; Min throttle value scaled
03E1 AD32          31590             mov     Temp6, Min_Throttle_H
03E3 303A04        31591             jnb     Flags3.PGM_BIDIR, ($+7)
                   31592     
03E6 AC33          31593             mov     Temp5, Center_Throttle_L                        ; Center throttle value sca
                             led
03E8 AD34          31594             mov     Temp6, Center_Throttle_H
                   31595     
03EA               31596     int0_int_calculate:
03EA C3            31597             clr     C
03EB EA            31598             mov     A, Temp3                                                ; Subtract minimum
03EC 9C            31599             subb    A, Temp5
03ED FA            31600             mov     Temp3, A
03EE EB            31601             mov     A, Temp4                                        
03EF 9D            31602             subb    A, Temp6
03F0 FB            31603             mov     Temp4, A
03F1 9208          31604             mov     Bit_Access_Int.0, C
03F3 AE60          31605             mov     Temp7, Throttle_Gain                            ; Load Temp7/Temp8 with thr
                             ottle gain
03F5 AF61          31606             mov     Temp8, Throttle_Gain_M
03F7 303A42        31607             jnb     Flags3.PGM_BIDIR, int0_int_not_bidir    ; If not bidirectional operation - 
                             branch
                   31608     
03FA 5007          31609             jnc     int0_int_bidir_fwd                                      ; If result is posi
                             tive - branch
                   31610     
03FC 203509        31611             jb      Flags2.RCP_DIR_REV, int0_int_bidir_rev_chk      ; If same direction - branch
                   31612     
03FF D235          31613             setb    Flags2.RCP_DIR_REV
0401 8108          31614             ajmp    int0_int_bidir_rev_chk
                   31615     
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   485

0403               31616     int0_int_bidir_fwd:
0403 303502        31617             jnb     Flags2.RCP_DIR_REV, int0_int_bidir_rev_chk      ; If same direction - branch
                   31618     
0406 C235          31619             clr     Flags2.RCP_DIR_REV
                   31620     
0408               31621     int0_int_bidir_rev_chk:
0408 303504        31622             jnb     Flags2.RCP_DIR_REV, ($+7)
                   31623     
040B AE62          31624             mov     Temp7, Throttle_Gain_BD_Rev             ; Load Temp7/Temp8 with throttle ga
                             in for bidirectional reverse
040D AF63          31625             mov     Temp8, Throttle_Gain_BD_Rev_M
                   31626     
040F 203902        31627             jb      Flags3.PGM_BIDIR_REV, ($+5)
                   31628     
0412 B235          31629             cpl     Flags2.RCP_DIR_REV
                   31630     
0414 C3            31631             clr     C                                                       ; Multiply throttle
                              value by 2
0415 EA            31632             mov     A, Temp3
0416 33            31633             rlc     A
0417 FA            31634             mov     Temp3, A
0418 EB            31635             mov     A, Temp4
0419 33            31636             rlc     A
041A FB            31637             mov     Temp4, A
041B A208          31638             mov     C, Bit_Access_Int.0
041D 500A          31639             jnc     int0_int_bidir_do_deadband              ; If result is positive - branch
                   31640     
041F EA            31641             mov     A, Temp3                                                ; Change sign
0420 F4            31642             cpl     A
0421 2401          31643             add     A, #1
0423 FA            31644             mov     Temp3, A
0424 EB            31645             mov     A, Temp4
0425 F4            31646             cpl     A
0426 3400          31647             addc    A, #0
0428 FB            31648             mov     Temp4, A
                   31649     
0429               31650     int0_int_bidir_do_deadband:
0429 C3            31651             clr     C                                                       ; Subtract deadband
042A EA            31652             mov     A, Temp3
                   31653     IF MCU_48MHZ == 0
042B 9428          31654             subb    A, #40
                   31655     ELSE
                                     subb    A, #80
                             ENDIF
042D FA            31658             mov     Temp3, A
042E EB            31659             mov     A, Temp4
042F 9400          31660             subb    A, #0
0431 FB            31661             mov     Temp4, A
0432 5014          31662             jnc     int0_int_do_throttle_gain
                   31663     
0434 7800          31664             mov     Temp1, #0
0436 7A00          31665             mov     Temp3, #0
0438 7B00          31666             mov     Temp4, #0
043A 8148          31667             ajmp    int0_int_do_throttle_gain
                   31668     
043C               31669     int0_int_not_bidir:
043C A208          31670             mov     C, Bit_Access_Int.0
043E 5008          31671             jnc     int0_int_do_throttle_gain               ; If result is positive - branch
                   31672     
0440               31673     int0_int_unidir_neg:
0440 7800          31674             mov     Temp1, #0                                               ; Yes - set to mini
                             mum
0442 7A00          31675             mov     Temp3, #0
0444 7B00          31676             mov     Temp4, #0
0446 819E          31677             ajmp    int0_int_pulse_ready
                   31678     
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   486

0448               31679     int0_int_do_throttle_gain:
                   31680             ; Boost pwm during direct start
0448 E525          31681             mov     A, Flags1
044A 5403          31682             anl     A, #((1 SHL STARTUP_PHASE)+(1 SHL INITIAL_RUN_PHASE))
044C 6019          31683             jz      int0_int_startup_boosted
                   31684     
044E 202A16        31685             jb      Flags1.MOTOR_STARTED, int0_int_startup_boosted  ; Do not boost when changin
                             g direction in bidirectional mode
                   31686     
0451 E55D          31687             mov     A, Pwm_Limit_Beg                                ; Set 25% of max startup po
                             wer as minimum power
                   31688     IF MCU_48MHZ == 1
                                     rlc     A
                             ENDIF
0453 F9            31691             mov     Temp2, A
0454 EB            31692             mov     A, Temp4
0455 7007          31693             jnz     int0_int_startup_boost_stall
                   31694     
0457 C3            31695             clr     C
0458 E9            31696             mov     A, Temp2
0459 9A            31697             subb    A, Temp3
045A 4002          31698             jc      int0_int_startup_boost_stall
                   31699     
045C E9            31700             mov     A, Temp2
045D FA            31701             mov     Temp3, A
                   31702     
045E               31703     int0_int_startup_boost_stall:
045E E53C          31704             mov     A, Stall_Cnt                                    ; Add an extra power boost 
                             during start
0460 C4            31705             swap    A
                   31706     IF MCU_48MHZ == 1
                                     rlc     A
                             ENDIF
0461 2A            31709             add     A, Temp3
0462 FA            31710             mov     Temp3, A
0463 EB            31711             mov     A, Temp4
0464 3400          31712             addc    A, #0
0466 FB            31713             mov     Temp4, A
                   31714     
0467               31715     int0_int_startup_boosted:
0467 EA            31716             mov     A, Temp3                                                ; Multiply throttle
                              value by throttle gain
0468 8EF0          31717             mov     B, Temp7                                                ; Temp7 has Throttl
                             e_Gain
046A A4            31718             mul     AB
046B F9            31719             mov     Temp2, A
046C AAF0          31720             mov     Temp3, B
046E EB            31721             mov     A, Temp4
046F 8EF0          31722             mov     B, Temp7                                                ; Temp7 has Throttl
                             e_Gain
0471 A4            31723             mul     AB
0472 2A            31724             add     A, Temp3
0473 FA            31725             mov     Temp3, A
0474 C5F0          31726             xch     A, B
0476 3400          31727             addc    A, #0
0478 FB            31728             mov     Temp4, A
0479 C3            31729             clr     C                                                       ; Generate 8bit num
                             ber
047A EB            31730             mov     A, Temp4
047B 13            31731             rrc     A
047C FD            31732             mov     Temp6, A
047D EA            31733             mov     A, Temp3
047E 13            31734             rrc     A
047F F8            31735             mov     Temp1, A
                   31736     IF MCU_48MHZ == 1
                                     clr     C
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   487

                                     mov     A, Temp6
                                     rrc     A
                                     mov     Temp6, A
                                     mov     A, Temp1
                                     rrc     A
                                     mov     Temp1, A
                             ENDIF
0480 0F            31745             inc     Temp8                                           ; Temp8 has Throttle_Gain_M
0481               31746     int0_int_gain_loop:
0481 EF            31747             mov     A, Temp8
0482 14            31748             dec     A
0483 6004          31749             jz      int0_int_gain_rcp_done                  ; Skip one multiply by 2 of New_Rcp
                   31750     
0485 C3            31751             clr     C
0486 E8            31752             mov     A, Temp1                                                ; Multiply New_Rcp 
                             by 2
0487 33            31753             rlc     A
0488 F8            31754             mov     Temp1, A
                   31755     
0489               31756     int0_int_gain_rcp_done:
0489 C3            31757             clr     C
048A E9            31758             mov     A, Temp2                                                ; Multiply pwm by 2
048B 33            31759             rlc     A
048C EA            31760             mov     A, Temp3
048D 33            31761             rlc     A
048E FA            31762             mov     Temp3, A
048F EB            31763             mov     A, Temp4
0490 33            31764             rlc     A
0491 FB            31765             mov     Temp4, A
0492 DFED          31766             djnz    Temp8, int0_int_gain_loop
                   31767     
0494 EB            31768             mov     A, Temp4
                   31769     IF MCU_48MHZ == 0
0495 30E206        31770             jnb     ACC.2, int0_int_pulse_ready             ; Check that RC pulse is within leg
                             al range
                   31771     ELSE
                                     jnb     ACC.3, int0_int_pulse_ready
                             ENDIF
                   31774     
0498 78FF          31775             mov     Temp1, #0FFh
049A 7AFF          31776             mov     Temp3, #0FFh
                   31777     IF MCU_48MHZ == 0
049C 7B03          31778             mov     Temp4, #3
                   31779     ELSE
                                     mov     Temp4, #7
                             ENDIF
                   31782     
049E               31783     int0_int_pulse_ready:
049E 8854          31784             mov     New_Rcp, Temp1                                  ; Store new pulse length
04A0 D230          31785             setb    Flags2.RCP_UPDATED                              ; Set updated flag
                   31786             ; Check if zero
04A2 E8            31787             mov     A, Temp1                                                ; Load new pulse va
                             lue
04A3 6003          31788             jz      ($+5)                                           ; Check if pulse is zero
                   31789     
04A5 755500        31790             mov     Rcp_Stop_Cnt, #0                                ; Reset rcp stop counter
                   31791     
                   31792             ; Set pwm limit
04A8 C3            31793             clr     C
04A9 E55B          31794             mov     A, Pwm_Limit                                    ; Limit to the smallest
04AB FC            31795             mov     Temp5, A                                                ; Store limit in Te
                             mp5
04AC 955C          31796             subb    A, Pwm_Limit_By_Rpm
04AE 4002          31797             jc      ($+4)
                   31798     
04B0 AC5C          31799             mov     Temp5, Pwm_Limit_By_Rpm                 
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   488

                   31800     
                   31801             ; Check against limit
04B2 C3            31802             clr     C
04B3 EC            31803             mov     A, Temp5
04B4 9554          31804             subb    A, New_Rcp
04B6 5008          31805             jnc     int0_int_set_pwm_registers
                   31806     
04B8 EC            31807             mov     A, Temp5                                                ; Multiply limit by
                              4 (8 for 48MHz MCUs)
                   31808     IF MCU_48MHZ == 0
04B9 75F004        31809             mov     B, #4
                   31810     ELSE
                                     mov     B, #8
                             ENDIF
04BC A4            31813             mul     AB
04BD FA            31814             mov     Temp3, A
04BE ABF0          31815             mov     Temp4, B
                   31816     
04C0               31817     int0_int_set_pwm_registers:
04C0 EA            31818             mov     A, Temp3
04C1 F4            31819             cpl     A
04C2 F8            31820             mov     Temp1, A
04C3 EB            31821             mov     A, Temp4
04C4 F4            31822             cpl     A
                   31823     IF MCU_48MHZ == 0
04C5 5403          31824             anl     A, #3
                   31825     ELSE
                                     anl     A, #7
                             ENDIF
04C7 F9            31828             mov     Temp2, A
                   31829     IF FETON_DELAY != 0
04C8 C3            31830             clr     C
04C9 E8            31831             mov     A, Temp1                                                ; Skew damping fet 
                             timing
                   31832     IF MCU_48MHZ == 0
04CA 940F          31833             subb    A, #FETON_DELAY
                   31834     ELSE
                                     subb    A, #(FETON_DELAY SHL 1)
                             ENDIF
04CC FA            31837             mov     Temp3, A
04CD E9            31838             mov     A, Temp2
04CE 9400          31839             subb    A, #0   
04D0 FB            31840             mov     Temp4, A
04D1 5004          31841             jnc     int0_int_set_pwm_damp_set
                   31842     
04D3 7A00          31843             mov     Temp3, #0
04D5 7B00          31844             mov     Temp4, #0
                   31845     
04D7               31846     int0_int_set_pwm_damp_set:
                   31847     ENDIF
04D7 8856          31848             mov     Power_Pwm_Reg_L, Temp1
04D9 8957          31849             mov     Power_Pwm_Reg_H, Temp2
                   31850     IF FETON_DELAY != 0
04DB 8A58          31851             mov     Damp_Pwm_Reg_L, Temp3
04DD 8B59          31852             mov     Damp_Pwm_Reg_H, Temp4
                   31853     ENDIF
04DF 75230A        31854             mov     Rcp_Timeout_Cntd, #10                   ; Set timeout count
                   31855     IF FETON_DELAY != 0
04E2 D0F0          31856             pop     B                                                       ; Restore preserved
                              registers
04E4 D0E0          31857             pop     ACC
04E6 D0D0          31858             pop     PSW
                   31859             Clear_COVF_Interrupt
                   31861             Enable_COVF_Interrupt                           ; Generate a pca interrupt
04EE 43E610        31863             orl     EIE1, #10h                                      ; Enable pca interrupts
04F1 32            31864             reti
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   489

                   31865     ELSE
                                     mov     A, Current_Power_Pwm_Reg_H
                             IF MCU_48MHZ == 0
                                     jnb     ACC.1, int0_int_set_pca_int_hi_pwm
                             ELSE
                                     jnb     ACC.2, int0_int_set_pca_int_hi_pwm
                             ENDIF
                             
                                     pop     B                                                       ; Restore preserved
                              registers
                                     pop     ACC
                                     pop     PSW
                                     Clear_COVF_Interrupt
                                     Enable_COVF_Interrupt                           ; Generate a pca interrupt
                                     orl     EIE1, #10h                                      ; Enable pca interrupts
                                     reti
                             
                             int0_int_set_pca_int_hi_pwm:
                                     pop     B                                                       ; Restore preserved
                              registers
                                     pop     ACC
                                     pop     PSW
                                     Clear_CCF_Interrupt
                                     Enable_CCF_Interrupt                            ; Generate pca interrupt
                                     orl     EIE1, #10h                                      ; Enable pca interrupts
                                     reti
                             ENDIF
                   31890     
04F2               31891     int0_int_set_timeout:
04F2 75230A        31892             mov     Rcp_Timeout_Cntd, #10                   ; Set timeout count
04F5               31893     int0_int_exit:
04F5 D0F0          31894             pop     B                                                       ; Restore preserved
                              registers
04F7 D0E0          31895             pop     ACC
04F9 D0D0          31896             pop     PSW
04FB 43E610        31897             orl     EIE1, #10h                                      ; Enable pca interrupts
04FE 32            31898             reti
                   31899     
                   31900     
                   31901     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   31902     ;
                   31903     ; Int1 interrupt routine
                   31904     ;
                   31905     ; No assumptions
                   31906     ;
                   31907     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
04FF               31908     int1_int:       ; Used for RC pulse timing
04FF C2AA          31909             clr     IE_EX1                  ; Disable int1 interrupts
0501 D28E          31910             setb    TCON_TR1                        ; Start timer 1
0503 C2CA          31911             clr     TMR2CN0_TR2                             ; Timer 2 disabled
0505 85CC6C        31912             mov     DShot_Frame_Start_L, TMR2L      ; Read timer value
0508 85CD6D        31913             mov     DShot_Frame_Start_H, TMR2H
050B D2CA          31914             setb    TMR2CN0_TR2                             ; Timer 2 enabled
050D 32            31915     reti
                   31916     
                   31917     
                   31918     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   31919     ;
                   31920     ; PCA interrupt routine
                   31921     ;
                   31922     ; No assumptions
                   31923     ;
                   31924     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
050E               31925     pca_int:        ; Used for setting pwm registers
050E C2AF          31926             clr     IE_EA
0510 C0D0          31927             push    PSW                             ; Preserve registers through interrupt
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   490

0512 C0E0          31928             push    ACC
0514 D2D3          31929             setb    PSW.3                   ; Select register bank 1 for this interrupt
                   31930     
                   31931     IF FETON_DELAY != 0                                     ; HI/LO enable style drivers
                   31932     
0516 A8F9          31933             mov     Temp1, PCA0L                            ; Read low byte, to transfer high b
                             yte to holding register
0518 E55A          31934             mov     A, Current_Power_Pwm_Reg_H
                   31935     IF MCU_48MHZ == 0
051A 30E10A        31936             jnb     ACC.1, pca_int_hi_pwm
                   31937     ELSE
                                     jnb     ACC.2, pca_int_hi_pwm
                             ENDIF
051D E5FA          31940             mov     A, PCA0H
                   31941     IF MCU_48MHZ == 0
051F 20E135        31942             jb      ACC.1, pca_int_exit                     ; Power below 50%, update pca in th
                             e 0x00-0x0F range
0522 20E032        31943             jb      ACC.0, pca_int_exit
                   31944     ELSE
                                     jb      ACC.2, pca_int_exit
                                     jb      ACC.1, pca_int_exit
                             ENDIF
0525 A12F          31948             ajmp    pca_int_set_pwm
                   31949     
0527               31950     pca_int_hi_pwm:
0527 E5FA          31951             mov     A, PCA0H
                   31952     IF MCU_48MHZ == 0
0529 30E12B        31953             jnb     ACC.1, pca_int_exit                     ; Power above 50%, update pca in th
                             e 0x20-0x2F range
052C 20E028        31954             jb      ACC.0, pca_int_exit
                   31955     ELSE
                                     jnb     ACC.2, pca_int_exit
                                     jb      ACC.1, pca_int_exit
                             ENDIF
                   31959     
052F               31960     pca_int_set_pwm:
                   31961             Set_Power_Pwm_Regs
                   31975             Set_Damp_Pwm_Regs
0547 85575A        31989             mov     Current_Power_Pwm_Reg_H, Power_Pwm_Reg_H
                   31990             Disable_COVF_Interrupt
                   31992     
                   31993     ELSE                                                            ; EN/PWM style drivers
                                     Set_Power_Pwm_Regs
                                     mov     Current_Power_Pwm_Reg_H, Power_Pwm_Reg_H
                                     Disable_COVF_Interrupt
                                     Disable_CCF_Interrupt
                             
                             ENDIF
                   32000     
                   32001             ; Pwm updated, enable/disable interrupts
054D D2A8          32002             setb    IE_EX0                                  ; Enable int0 interrupts
054F 303402        32003             jnb     Flags2.RCP_DSHOT, ($+5)
0552 D2AA          32004             setb    IE_EX1                                  ; Enable int1 interrupts (DShot onl
                             y)
0554 53E6EF        32005             anl     EIE1, #0EFh                             ; Disable pca interrupts
0557               32006     pca_int_exit:
                   32007             Clear_COVF_Interrupt
                   32009     IF FETON_DELAY == 0
                                     Clear_CCF_Interrupt
                             ENDIF
055A D0E0          32012             pop     ACC                                             ; Restore preserved registe
                             rs
055C D0D0          32013             pop     PSW
055E D2AF          32014             setb    IE_EA
0560 32            32015             reti
                   32016     
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   491

                   32017     
                   32018     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   32019     ;
                   32020     ; Wait xms ~(x*4*250)  (Different entry points) 
                   32021     ;
                   32022     ; No assumptions
                   32023     ;
                   32024     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0561               32025     wait1ms:        
0561 7901          32026             mov     Temp2, #1
0563 8014          32027             jmp     waitxms_o
                   32028     
0565               32029     wait3ms:        
0565 7903          32030             mov     Temp2, #3
0567 8010          32031             jmp     waitxms_o
                   32032     
0569               32033     wait10ms:       
0569 790A          32034             mov     Temp2, #10
056B 800C          32035             jmp     waitxms_o
                   32036     
056D               32037     wait30ms:       
056D 791E          32038             mov     Temp2, #30
056F 8008          32039             jmp     waitxms_o
                   32040     
0571               32041     wait100ms:      
0571 7964          32042             mov     Temp2, #100
0573 8004          32043             jmp     waitxms_o
                   32044     
0575               32045     wait200ms:      
0575 79C8          32046             mov     Temp2, #200
0577 8000          32047             jmp     waitxms_o
                   32048     
0579               32049     waitxms_o:      ; Outer loop
0579 7817          32050             mov     Temp1, #23
057B               32051     waitxms_m:      ; Middle loop
057B E4            32052             clr     A
057C D5E0FD        32053             djnz    ACC, $  ; Inner loop (42.7us - 1024 cycles)
057F D8FA          32054             djnz    Temp1, waitxms_m
0581 D9F6          32055             djnz    Temp2, waitxms_o
0583 22            32056             ret
                   32057     
                   32058     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   32059     ;
                   32060     ; Set pwm limit low rpm
                   32061     ;
                   32062     ; No assumptions
                   32063     ;
                   32064     ; Sets power limit for low rpms and disables demag for low rpms
                   32065     ;
                   32066     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0584               32067     set_pwm_limit_low_rpm:
                   32068             ; Set pwm limit
0584 78FF          32069             mov     Temp1, #0FFh                                    ; Default full power
0586 202828        32070             jb      Flags1.STARTUP_PHASE, set_pwm_limit_low_rpm_exit        ; Exit if startup p
                             hase set
                   32071     
0589 79A1          32072             mov     Temp2, #Pgm_Enable_Power_Prot           ; Check if low RPM power protection
                              is enabled
058B E7            32073             mov     A, @Temp2
058C 6023          32074             jz      set_pwm_limit_low_rpm_exit              ; Exit if disabled
                   32075     
058E E548          32076             mov     A, Comm_Period4x_H
0590 601F          32077             jz      set_pwm_limit_low_rpm_exit              ; Avoid divide by zero
                   32078     
0592 74FF          32079             mov     A, #255                                         ; Divide 255 by Comm_Period
                             4x_H
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   492

0594 8548F0        32080             mov     B, Comm_Period4x_H
0597 84            32081             div     AB
0598 853FF0        32082             mov     B, Low_Rpm_Pwr_Slope                    ; Multiply by slope
059B 302903        32083             jnb     Flags1.INITIAL_RUN_PHASE, ($+6) ; More protection for initial run phase 
059E 75F005        32084             mov     B, #5
05A1 A4            32085             mul     AB
05A2 F8            32086             mov     Temp1, A                                                ; Set new limit    
                                                  
05A3 C5F0          32087             xch     A, B
05A5 6002          32088             jz      ($+4)                                           ; Limit to max
                   32089             
05A7 78FF          32090             mov     Temp1, #0FFh                            
                   32091     
05A9 C3            32092             clr     C
05AA E8            32093             mov     A, Temp1                                                ; Limit to min
05AB 955D          32094             subb    A, Pwm_Limit_Beg
05AD 5002          32095             jnc     set_pwm_limit_low_rpm_exit
                   32096     
05AF A85D          32097             mov     Temp1, Pwm_Limit_Beg
                   32098     
05B1               32099     set_pwm_limit_low_rpm_exit:
05B1 885C          32100             mov     Pwm_Limit_By_Rpm, Temp1                         
05B3 22            32101             ret
                   32102             
                   32103     
                   32104     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   32105     ;
                   32106     ; Set pwm limit high rpm
                   32107     ;
                   32108     ; No assumptions
                   32109     ;
                   32110     ; Sets power limit for high rpms
                   32111     ;
                   32112     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
05B4               32113     set_pwm_limit_high_rpm:
                   32114     IF MCU_48MHZ == 1
                                     clr     C
                                     mov     A, Comm_Period4x_L
                                     subb    A, #0A0h                                ; Limit Comm_Period to 160, which i
                             s 500k erpm
                                     mov     A, Comm_Period4x_H
                                     subb    A, #00h
                             ELSE
05B4 C3            32121             clr     C
05B5 E547          32122             mov     A, Comm_Period4x_L
05B7 94E4          32123             subb    A, #0E4h                                ; Limit Comm_Period to 228, which i
                             s 350k erpm
05B9 E548          32124             mov     A, Comm_Period4x_H
05BB 9400          32125             subb    A, #00h
                   32126     ENDIF
05BD E55C          32127             mov     A, Pwm_Limit_By_Rpm
05BF 5003          32128             jnc     set_pwm_limit_high_rpm_inc_limit
                   32129             
05C1 14            32130             dec     A
05C2 A1C5          32131             ajmp    set_pwm_limit_high_rpm_store
                   32132             
05C4               32133     set_pwm_limit_high_rpm_inc_limit:
05C4 04            32134             inc     A
05C5               32135     set_pwm_limit_high_rpm_store:
05C5 6002          32136             jz      ($+4)
                   32137     
05C7 F55C          32138             mov     Pwm_Limit_By_Rpm, A
                   32139     
05C9 22            32140             ret
                   32141     
                   32142     
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   493

                   32143     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   32144     ;
                   32145     ; Start ADC conversion
                   32146     ;
                   32147     ; No assumptions
                   32148     ;
                   32149     ; Start conversion used for measuring power supply voltage
                   32150     ;
                   32151     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
05CA               32152     start_adc_conversion:
                   32153             ; Start adc
                   32154             Start_Adc 
05CD 22            32156             ret
                   32157     
                   32158     
                   32159     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   32160     ;
                   32161     ; Check temperature, power supply voltage and limit power
                   32162     ;
                   32163     ; No assumptions
                   32164     ;
                   32165     ; Used to limit main motor power in order to maintain the required voltage
                   32166     ;
                   32167     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
05CE               32168     check_temp_voltage_and_limit_power:
05CE 055E          32169             inc     Adc_Conversion_Cnt                      ; Increment conversion counter
05D0 C3            32170             clr     C
05D1 E55E          32171             mov     A, Adc_Conversion_Cnt           ; Is conversion count equal to temp rate?
05D3 9408          32172             subb    A, #8
05D5 4053          32173             jc      check_voltage_start                     ; No - check voltage
                   32174     
                   32175             ; Wait for ADC conversion to complete
05D7 30EDF4        32176             jnb     ADC0CN0_ADINT, check_temp_voltage_and_limit_power
                   32177             ; Read ADC result
                   32178             Read_Adc_Result
                   32181             ; Stop ADC
                   32182             Stop_Adc
                   32183     
05DE 755E00        32184             mov     Adc_Conversion_Cnt, #0          ; Yes - temperature check. Reset counter
05E1 E9            32185             mov     A, Temp2                                        ; Move ADC MSB to Temp3
05E2 FA            32186             mov     Temp3, A
05E3 79A0          32187             mov     Temp2, #Pgm_Enable_Temp_Prot    ; Is temp protection enabled?
05E5 E7            32188             mov     A, @Temp2
05E6 6041          32189             jz      temp_check_exit                 ; No - branch
                   32190     
05E8 EA            32191             mov     A, Temp3                                        ; Is temperature reading be
                             low 256?
05E9 7006          32192             jnz     temp_average_inc_dec            ; No - proceed
                   32193     
05EB E55F          32194             mov     A, Current_Average_Temp         ; Yes -  decrement average
05ED 6018          32195             jz      temp_average_updated            ; Already zero - no change
05EF 800C          32196             jmp     temp_average_dec                        ; Decrement 
                   32197     
05F1               32198     temp_average_inc_dec:
05F1 C3            32199             clr     C
05F2 E8            32200             mov     A, Temp1                                        ; Check if current temperat
                             ure is above or below average
05F3 955F          32201             subb    A, Current_Average_Temp
05F5 600E          32202             jz      temp_average_updated_load_acc   ; Equal - no change
                   32203     
05F7 E55F          32204             mov     A, Current_Average_Temp         ; Above - increment average
05F9 5005          32205             jnc     temp_average_inc                                
                   32206     
05FB 600A          32207             jz      temp_average_updated            ; Below - decrement average if average is n
                             ot already zero
05FD               32208     temp_average_dec:
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   494

05FD 14            32209             dec     A                                               ; Decrement average
05FE 8007          32210             jmp     temp_average_updated
                   32211     
0600               32212     temp_average_inc:
0600 04            32213             inc     A                                               ; Increment average
0601 60FA          32214             jz      temp_average_dec
0603 8002          32215             jmp     temp_average_updated
                   32216     
0605               32217     temp_average_updated_load_acc:
0605 E55F          32218             mov     A, Current_Average_Temp
0607               32219     temp_average_updated:
0607 F55F          32220             mov     Current_Average_Temp, A
0609 C3            32221             clr     C
060A 9569          32222             subb    A, Temp_Prot_Limit                      ; Is temperature below first limit?
060C 401B          32223             jc      temp_check_exit                 ; Yes - exit
                   32224     
060E 755BC0        32225             mov  Pwm_Limit, #192                    ; No - limit pwm
                   32226     
0611 C3            32227             clr     C
0612 9404          32228             subb    A, #(TEMP_LIMIT_STEP/2)         ; Is temperature below second limit
0614 4013          32229             jc      temp_check_exit                 ; Yes - exit
                   32230     
0616 755B80        32231             mov  Pwm_Limit, #128                    ; No - limit pwm
                   32232     
0619 C3            32233             clr     C
061A 9404          32234             subb    A, #(TEMP_LIMIT_STEP/2)         ; Is temperature below third limit
061C 400B          32235             jc      temp_check_exit                 ; Yes - exit
                   32236     
061E 755B40        32237             mov  Pwm_Limit, #64                             ; No - limit pwm
                   32238     
0621 C3            32239             clr     C
0622 9404          32240             subb    A, #(TEMP_LIMIT_STEP/2)         ; Is temperature below final limit
0624 4003          32241             jc      temp_check_exit                 ; Yes - exit
                   32242     
0626 755B00        32243             mov  Pwm_Limit, #0                              ; No - limit pwm
                   32244     
0629               32245     temp_check_exit:
0629 22            32246             ret
                   32247     
062A               32248     check_voltage_start:
                   32249             ; Increase pwm limit
062A E55B          32250             mov  A, Pwm_Limit
062C 2410          32251             add     A, #16                  
062E 5002          32252             jnc     ($+4)                                   ; If not max - branch
                   32253     
0630 74FF          32254             mov     A, #255
                   32255     
0632 F55B          32256             mov     Pwm_Limit, A                            ; Increment limit 
0634 22            32257             ret
                   32258     
                   32259     
                   32260     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   32261     ;
                   32262     ; Set startup PWM routine
                   32263     ;
                   32264     ; Either the SETTLE_PHASE or the STEPPER_PHASE flag must be set
                   32265     ;
                   32266     ; Used for pwm control during startup
                   32267     ;
                   32268     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0635               32269     set_startup_pwm:        
                   32270             ; Adjust startup power
0635 7432          32271             mov     A, #50                                          ; Set power
0637 79A6          32272             mov     Temp2, #Pgm_Startup_Pwr_Decoded
0639 87F0          32273             mov     B, @Temp2
063B A4            32274             mul     AB
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   495

063C C5F0          32275             xch     A, B
063E A2F7          32276             mov     C, B.7                                          ; Multiply result by 2 (uni
                             ty gain is 128)
0640 33            32277             rlc     A
0641 F55D          32278             mov     Pwm_Limit_Beg, A                                ; Set initial pwm limit
0643 22            32279             ret
                   32280     
                   32281     
                   32282     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   32283     ;
                   32284     ; Initialize timing routine
                   32285     ;
                   32286     ; No assumptions
                   32287     ;
                   32288     ; Part of initialization before motor start
                   32289     ;
                   32290     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0644               32291     initialize_timing: 
0644 754700        32292             mov     Comm_Period4x_L, #00h                           ; Set commutation period re
                             gisters
0647 7548F0        32293             mov     Comm_Period4x_H, #0F0h
064A 22            32294             ret
                   32295     
                   32296     
                   32297     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   32298     ;
                   32299     ; Calculate next commutation timing routine
                   32300     ;
                   32301     ; No assumptions
                   32302     ;
                   32303     ; Called immediately after each commutation
                   32304     ; Also sets up timer 3 to wait advance timing
                   32305     ; Two entry points are used
                   32306     ;
                   32307     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
064B               32308     calc_next_comm_timing:          ; Entry point for run phase
                   32309             ; Read commutation time
064B C2AF          32310             clr     IE_EA
064D C2CA          32311             clr     TMR2CN0_TR2             ; Timer 2 disabled
064F A8CC          32312             mov     Temp1, TMR2L            ; Load timer value
0651 A9CD          32313             mov     Temp2, TMR2H    
0653 AA41          32314             mov     Temp3, Timer2_X
0655 30CF01        32315             jnb     TMR2CN0_TF2H, ($+4)     ; Check if interrupt is pending
0658 0A            32316             inc     Temp3                   ; If it is pending, then timer has already wrapped
0659 D2CA          32317             setb    TMR2CN0_TR2             ; Timer 2 enabled
065B D2AF          32318             setb    IE_EA
                   32319     IF MCU_48MHZ == 1
                                     clr     C
                                     mov     A, Temp3
                                     rrc     A
                                     mov     Temp3, A
                                     mov     A, Temp2
                                     rrc     A
                                     mov     Temp2, A
                                     mov     A, Temp1
                                     rrc     A
                                     mov     Temp1, A
                             ENDIF
                   32331             ; Calculate this commutation time
065D AB42          32332             mov     Temp4, Prev_Comm_L
065F AC43          32333             mov     Temp5, Prev_Comm_H
0661 8842          32334             mov     Prev_Comm_L, Temp1              ; Store timestamp as previous commutation
0663 8943          32335             mov     Prev_Comm_H, Temp2
0665 C3            32336             clr     C
0666 E8            32337             mov     A, Temp1
0667 9B            32338             subb    A, Temp4                                ; Calculate the new commutation time
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   496

0668 F8            32339             mov     Temp1, A
0669 E9            32340             mov     A, Temp2
066A 9C            32341             subb    A, Temp5
066B 202808        32342             jb      Flags1.STARTUP_PHASE, calc_next_comm_startup
                   32343     
                   32344     IF MCU_48MHZ == 1
                                     anl     A, #7Fh
                             ENDIF
066E F9            32347             mov     Temp2, A
066F 302C02        32348             jnb     Flags1.HIGH_RPM, ($+5)  ; Branch if high rpm
0672 E15B          32349             ajmp    calc_next_comm_timing_fast
                   32350     
0674 C1B4          32351             ajmp    calc_next_comm_normal
                   32352     
0676               32353     calc_next_comm_startup:
0676 AD44          32354             mov     Temp6, Prev_Comm_X
0678 8A44          32355             mov     Prev_Comm_X, Temp3              ; Store extended timestamp as previous comm
                             utation
067A F9            32356             mov     Temp2, A
067B EA            32357             mov     A, Temp3
067C 9D            32358             subb    A, Temp6                                ; Calculate the new extended commut
                             ation time
                   32359     IF MCU_48MHZ == 1
                                     anl     A, #7Fh
                             ENDIF
067D FA            32362             mov     Temp3, A
067E 6006          32363             jz      calc_next_comm_startup_no_X
                   32364     
0680 78FF          32365             mov     Temp1, #0FFh
0682 79FF          32366             mov     Temp2, #0FFh
0684 C199          32367             ajmp    calc_next_comm_startup_average
                   32368     
0686               32369     calc_next_comm_startup_no_X:
0686 AE45          32370             mov     Temp7, Prev_Prev_Comm_L
0688 AF46          32371             mov     Temp8, Prev_Prev_Comm_H
068A 8B45          32372             mov     Prev_Prev_Comm_L, Temp4
068C 8C46          32373             mov     Prev_Prev_Comm_H, Temp5
068E A842          32374             mov     Temp1, Prev_Comm_L              ; Reload this commutation time  
0690 A943          32375             mov     Temp2, Prev_Comm_H
0692 C3            32376             clr     C
0693 E8            32377             mov     A, Temp1
0694 9E            32378             subb    A, Temp7                                ; Calculate the new commutation tim
                             e based upon the two last commutations (to reduce sensitivity to offset)
0695 F8            32379             mov     Temp1, A
0696 E9            32380             mov     A, Temp2
0697 9F            32381             subb    A, Temp8
0698 F9            32382             mov     Temp2, A
                   32383     
0699               32384     calc_next_comm_startup_average:
0699 C3            32385             clr     C
069A E548          32386             mov     A, Comm_Period4x_H              ; Average with previous and save
069C 13            32387             rrc     A
069D FB            32388             mov     Temp4, A
069E E547          32389             mov     A, Comm_Period4x_L
06A0 13            32390             rrc     A
06A1 FA            32391             mov     Temp3, A
06A2 E8            32392             mov     A, Temp1                        
06A3 2A            32393             add     A, Temp3
06A4 F547          32394             mov     Comm_Period4x_L, A
06A6 E9            32395             mov     A, Temp2
06A7 3B            32396             addc    A, Temp4
06A8 F548          32397             mov     Comm_Period4x_H, A
06AA 5006          32398             jnc     ($+8)
                   32399     
06AC 7547FF        32400             mov     Comm_Period4x_L, #0FFh
06AF 7548FF        32401             mov     Comm_Period4x_H, #0FFh
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   497

                   32402     
06B2 E101          32403             ajmp    calc_new_wait_times_setup
                   32404     
06B4               32405     calc_next_comm_normal:
                   32406             ; Calculate new commutation time 
06B4 AA47          32407             mov     Temp3, Comm_Period4x_L  ; Comm_Period4x(-l-h) holds the time of 4 commutati
                             ons
06B6 AB48          32408             mov     Temp4, Comm_Period4x_H
06B8 AC47          32409             mov     Temp5, Comm_Period4x_L  ; Copy variables
06BA AD48          32410             mov     Temp6, Comm_Period4x_H
06BC 7E04          32411             mov     Temp7, #4                               ; Divide Comm_Period4x 4 times as d
                             efault
06BE 7F02          32412             mov     Temp8, #2                               ; Divide new commutation time 2 tim
                             es as default
06C0 C3            32413             clr     C
06C1 EB            32414             mov     A, Temp4
06C2 9404          32415             subb    A, #04h
06C4 400D          32416             jc      calc_next_comm_avg_period_div
                   32417     
06C6 1E            32418             dec     Temp7                           ; Reduce averaging time constant for low sp
                             eeds
06C7 1F            32419             dec     Temp8
                   32420     
06C8 C3            32421             clr     C
06C9 EB            32422             mov     A, Temp4
06CA 9408          32423             subb    A, #08h
06CC 4005          32424             jc      calc_next_comm_avg_period_div
                   32425     
06CE 202902        32426             jb      Flags1.INITIAL_RUN_PHASE, calc_next_comm_avg_period_div ; Do not average ve
                             ry fast during initial run
                   32427     
06D1 1E            32428             dec     Temp7                           ; Reduce averaging time constant more for e
                             ven lower speeds
06D2 1F            32429             dec     Temp8
                   32430     
06D3               32431     calc_next_comm_avg_period_div:
06D3 C3            32432             clr     C
06D4 ED            32433             mov     A, Temp6                                        
06D5 13            32434             rrc     A                                       ; Divide by 2
06D6 FD            32435             mov     Temp6, A        
06D7 EC            32436             mov     A, Temp5                                
06D8 13            32437             rrc     A
06D9 FC            32438             mov     Temp5, A
06DA DEF7          32439             djnz    Temp7, calc_next_comm_avg_period_div
                   32440     
06DC C3            32441             clr     C
06DD EA            32442             mov     A, Temp3
06DE 9C            32443             subb    A, Temp5                                ; Subtract a fraction
06DF FA            32444             mov     Temp3, A
06E0 EB            32445             mov     A, Temp4
06E1 9D            32446             subb    A, Temp6
06E2 FB            32447             mov     Temp4, A
06E3 EF            32448             mov     A, Temp8                                ; Divide new time
06E4 6009          32449             jz      calc_next_comm_new_period_div_done
                   32450     
06E6               32451     calc_next_comm_new_period_div:
06E6 C3            32452             clr     C
06E7 E9            32453             mov     A, Temp2                                        
06E8 13            32454             rrc     A                                       ; Divide by 2
06E9 F9            32455             mov     Temp2, A        
06EA E8            32456             mov     A, Temp1                                
06EB 13            32457             rrc     A
06EC F8            32458             mov     Temp1, A
06ED DFF7          32459             djnz    Temp8, calc_next_comm_new_period_div
                   32460     
06EF               32461     calc_next_comm_new_period_div_done:
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   498

06EF EA            32462             mov     A, Temp3
06F0 28            32463             add     A, Temp1                                ; Add the divided new time
06F1 FA            32464             mov     Temp3, A
06F2 EB            32465             mov     A, Temp4
06F3 39            32466             addc    A, Temp2
06F4 FB            32467             mov     Temp4, A
06F5 8A47          32468             mov     Comm_Period4x_L, Temp3  ; Store Comm_Period4x_X
06F7 8B48          32469             mov     Comm_Period4x_H, Temp4
06F9 5006          32470             jnc     calc_new_wait_times_setup; If period larger than 0xffff - go to slow case
                   32471     
06FB 7BFF          32472             mov     Temp4, #0FFh
06FD 8B47          32473             mov     Comm_Period4x_L, Temp4  ; Set commutation period registers to very slow tim
                             ing (0xffff)
06FF 8B48          32474             mov     Comm_Period4x_H, Temp4
                   32475     
0701               32476     calc_new_wait_times_setup:      
                   32477             ; Set high rpm bit (if above 156k erpm)
0701 C3            32478             clr     C
0702 EB            32479             mov     A, Temp4
0703 9402          32480             subb    A, #2
0705 5002          32481             jnc     ($+4)
                   32482     
0707 D22C          32483             setb    Flags1.HIGH_RPM                 ; Set high rpm bit
                   32484             
                   32485             ; Load programmed commutation timing
0709 302804        32486             jnb     Flags1.STARTUP_PHASE, calc_new_wait_per_startup_done    ; Set dedicated tim
                             ing during startup
                   32487     
070C 7F03          32488             mov     Temp8, #3
070E E12C          32489             ajmp    calc_new_wait_per_demag_done
                   32490     
0710               32491     calc_new_wait_per_startup_done:
0710 7892          32492             mov     Temp1, #Pgm_Comm_Timing ; Load timing setting
0712 E6            32493             mov     A, @Temp1                               
0713 FF            32494             mov     Temp8, A                                ; Store in Temp8
0714 C3            32495             clr     C
0715 E53D          32496             mov     A, Demag_Detected_Metric        ; Check demag metric
0717 9482          32497             subb    A, #130
0719 4011          32498             jc      calc_new_wait_per_demag_done
                   32499     
071B 0F            32500             inc     Temp8                           ; Increase timing
                   32501     
071C C3            32502             clr     C
071D E53D          32503             mov     A, Demag_Detected_Metric
071F 94A0          32504             subb    A, #160
0721 4001          32505             jc      ($+3)
                   32506     
0723 0F            32507             inc     Temp8                           ; Increase timing again
                   32508     
0724 C3            32509             clr     C
0725 EF            32510             mov     A, Temp8                                ; Limit timing to max
0726 9406          32511             subb    A, #6
0728 4002          32512             jc      ($+4)
                   32513     
072A 7F05          32514             mov     Temp8, #5                               ; Set timing to max
                   32515     
072C               32516     calc_new_wait_per_demag_done:
                   32517             ; Set timing reduction
072C 7E02          32518             mov     Temp7, #2
                   32519             ; Load current commutation timing
072E E548          32520             mov     A, Comm_Period4x_H              ; Divide 4 times
0730 C4            32521             swap    A
0731 540F          32522             anl     A, #00Fh
0733 F9            32523             mov     Temp2, A
0734 E548          32524             mov     A, Comm_Period4x_H
0736 C4            32525             swap    A
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   499

0737 54F0          32526             anl     A, #0F0h
0739 F8            32527             mov     Temp1, A
073A E547          32528             mov     A, Comm_Period4x_L
073C C4            32529             swap    A
073D 540F          32530             anl     A, #00Fh
073F 28            32531             add     A, Temp1
0740 F8            32532             mov     Temp1, A
                   32533     
0741 C3            32534             clr     C
0742 E8            32535             mov     A, Temp1
0743 9E            32536             subb    A, Temp7
0744 FA            32537             mov     Temp3, A
0745 E9            32538             mov     A, Temp2                                
0746 9400          32539             subb    A, #0
0748 FB            32540             mov     Temp4, A
0749 4009          32541             jc      load_min_time                   ; Check that result is still positive
                   32542     
074B C3            32543             clr     C
074C EA            32544             mov     A, Temp3
074D 9401          32545             subb    A, #1
074F EB            32546             mov     A, Temp4                        
0750 9400          32547             subb    A, #0
0752 5004          32548             jnc     calc_new_wait_times_exit        ; Check that result is still above minumum
                   32549     
0754               32550     load_min_time:
0754 7A01          32551             mov     Temp3, #1
0756 E4            32552             clr     A
0757 FB            32553             mov     Temp4, A 
                   32554     
0758               32555     calc_new_wait_times_exit:       
0758 0207A7        32556             ljmp    wait_advance_timing
                   32557     
                   32558     
                   32559     ; Fast calculation (Comm_Period4x_H less than 2)
075B               32560     calc_next_comm_timing_fast:                     
                   32561             ; Calculate new commutation time
075B AA47          32562             mov     Temp3, Comm_Period4x_L  ; Comm_Period4x(-l-h) holds the time of 4 commutati
                             ons
075D AB48          32563             mov     Temp4, Comm_Period4x_H
075F EB            32564             mov     A, Temp4                                ; Divide by 2 4 times
0760 C4            32565             swap    A
0761 FE            32566             mov     Temp7, A
0762 EA            32567             mov     A, Temp3
0763 C4            32568             swap A
0764 540F          32569             anl     A, #0Fh
0766 4E            32570             orl     A, Temp7
0767 FC            32571             mov     Temp5, A
0768 C3            32572             clr     C
0769 EA            32573             mov     A, Temp3                                ; Subtract a fraction
076A 9C            32574             subb    A, Temp5
076B FA            32575             mov     Temp3, A
076C EB            32576             mov     A, Temp4                                
076D 9400          32577             subb    A, #0
076F FB            32578             mov     Temp4, A
0770 C3            32579             clr     C
0771 E8            32580             mov     A, Temp1
0772 13            32581             rrc     A                                       ; Divide by 2 2 times
0773 C3            32582             clr     C
0774 13            32583             rrc     A
0775 F8            32584             mov     Temp1, A
0776 EA            32585             mov     A, Temp3                                ; Add the divided new time
0777 28            32586             add     A, Temp1
0778 FA            32587             mov     Temp3, A
0779 EB            32588             mov     A, Temp4
077A 3400          32589             addc    A, #0
077C FB            32590             mov     Temp4, A
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   500

077D 8A47          32591             mov     Comm_Period4x_L, Temp3  ; Store Comm_Period4x_X
077F 8B48          32592             mov     Comm_Period4x_H, Temp4
0781 C3            32593             clr     C
0782 EB            32594             mov     A, Temp4                                ; If erpm below 156k - go to normal
                              case
0783 9402          32595             subb    A, #2
0785 4002          32596             jc      ($+4)
                   32597     
0787 C22C          32598             clr     Flags1.HIGH_RPM                 ; Clear high rpm bit
                   32599     
                   32600             ; Set timing reduction
0789 7802          32601             mov     Temp1, #2
078B EB            32602             mov     A, Temp4                                ; Divide by 2 4 times
078C C4            32603             swap    A
078D FE            32604             mov     Temp7, A
078E 7B00          32605             mov     Temp4, #0
0790 EA            32606             mov     A, Temp3
0791 C4            32607             swap A
0792 540F          32608             anl     A, #0Fh
0794 4E            32609             orl     A, Temp7
0795 FA            32610             mov     Temp3, A
0796 C3            32611             clr     C
0797 EA            32612             mov     A, Temp3
0798 98            32613             subb    A, Temp1
0799 FA            32614             mov     Temp3, A
079A 4005          32615             jc      load_min_time_fast              ; Check that result is still positive
                   32616     
079C C3            32617             clr     C
079D 9401          32618             subb    A, #1
079F 5002          32619             jnc     calc_new_wait_times_fast_done   ; Check that result is still above minumum
                   32620     
07A1               32621     load_min_time_fast:
07A1 7A01          32622             mov     Temp3, #1
                   32623     
07A3               32624     calc_new_wait_times_fast_done:  
07A3 7892          32625             mov     Temp1, #Pgm_Comm_Timing ; Load timing setting
07A5 E6            32626             mov     A, @Temp1                               
07A6 FF            32627             mov     Temp8, A                                ; Store in Temp8
                   32628     
                   32629     
                   32630     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   32631     ;
                   32632     ; Wait advance timing routine
                   32633     ;
                   32634     ; No assumptions
                   32635     ; NOTE: Be VERY careful if using temp registers. They are passed over this routine
                   32636     ;
                   32637     ; Waits for the advance timing to elapse and sets up the next zero cross wait
                   32638     ;
                   32639     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
07A7               32640     wait_advance_timing:    
07A7 302002        32641             jnb     Flags0.T3_PENDING, ($+5)
07AA E1A7          32642             ajmp    wait_advance_timing
                   32643     
                   32644             ; Setup next wait time
07AC 854E92        32645             mov     TMR3RLL, Wt_ZC_Tout_Start_L
07AF 854F93        32646             mov     TMR3RLH, Wt_ZC_Tout_Start_H
07B2 D220          32647             setb    Flags0.T3_PENDING
07B4 43E680        32648             orl     EIE1, #80h      ; Enable timer 3 interrupts
                   32649     
                   32650     
                   32651     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   32652     ;
                   32653     ; Calculate new wait times routine
                   32654     ;
                   32655     ; No assumptions
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   501

                   32656     ;
                   32657     ; Calculates new wait times
                   32658     ;
                   32659     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
07B7               32660     calc_new_wait_times:    
07B7 C3            32661             clr     C
07B8 E4            32662             clr     A
07B9 9A            32663             subb    A, Temp3                                ; Negate
07BA F8            32664             mov     Temp1, A        
07BB E4            32665             clr     A
07BC 9B            32666             subb    A, Temp4                                
07BD F9            32667             mov     Temp2, A        
                   32668     IF MCU_48MHZ == 1
                                     clr     C
                                     mov     A, Temp1                                ; Multiply by 2
                                     rlc     A
                                     mov     Temp1, A
                                     mov     A, Temp2
                                     rlc     A
                                     mov     Temp2, A
                             ENDIF
07BE 302C03        32677             jnb     Flags1.HIGH_RPM, ($+6)  ; Branch if high rpm
07C1 020835        32678             ljmp    calc_new_wait_times_fast
                   32679     
07C4 E8            32680             mov     A, Temp1                                ; Copy values
07C5 FA            32681             mov     Temp3, A
07C6 E9            32682             mov     A, Temp2
07C7 FB            32683             mov     Temp4, A
07C8 D3            32684             setb    C                                       ; Negative numbers - set carry
07C9 E9            32685             mov     A, Temp2                                
07CA 13            32686             rrc     A                                       ; Divide by 2
07CB FD            32687             mov     Temp6, A
07CC E8            32688             mov     A, Temp1
07CD 13            32689             rrc     A
07CE FC            32690             mov     Temp5, A
07CF 884E          32691             mov     Wt_Zc_Tout_Start_L, Temp1; Set 15deg time for zero cross scan timeout
07D1 894F          32692             mov     Wt_Zc_Tout_Start_H, Temp2
07D3 C3            32693             clr     C
07D4 EF            32694             mov     A, Temp8                                ; (Temp8 has Pgm_Comm_Timing)
07D5 9403          32695             subb    A, #3                           ; Is timing normal?
07D7 6038          32696             jz      store_times_decrease    ; Yes - branch
                   32697     
07D9 EF            32698             mov     A, Temp8                                
07DA 20E00C        32699             jb      ACC.0, adjust_timing_two_steps  ; If an odd number - branch
                   32700     
07DD E8            32701             mov     A, Temp1                                ; Add 7.5deg and store in Temp1/2
07DE 2C            32702             add     A, Temp5
07DF F8            32703             mov     Temp1, A
07E0 E9            32704             mov     A, Temp2
07E1 3D            32705             addc    A, Temp6
07E2 F9            32706             mov     Temp2, A
07E3 EC            32707             mov     A, Temp5                                ; Store 7.5deg in Temp3/4
07E4 FA            32708             mov     Temp3, A
07E5 ED            32709             mov     A, Temp6                        
07E6 FB            32710             mov     Temp4, A
07E7 8013          32711             jmp     store_times_up_or_down
                   32712     
07E9               32713     adjust_timing_two_steps:
07E9 E8            32714             mov     A, Temp1                                ; Add 15deg and store in Temp1/2
07EA 28            32715             add     A, Temp1
07EB F8            32716             mov     Temp1, A
07EC E9            32717             mov     A, Temp2
07ED 39            32718             addc    A, Temp2
07EE F9            32719             mov     Temp2, A
07EF C3            32720             clr     C
07F0 E8            32721             mov     A, Temp1
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   502

07F1 2401          32722             add     A, #1
07F3 F8            32723             mov     Temp1, A
07F4 E9            32724             mov     A, Temp2
07F5 3400          32725             addc    A, #0
07F7 F9            32726             mov     Temp2, A
07F8 7AFF          32727             mov     Temp3, #-1                              ; Store minimum time in Temp3/4
07FA 7BFF          32728             mov     Temp4, #0FFh
                   32729     
07FC               32730     store_times_up_or_down:
07FC C3            32731             clr     C
07FD EF            32732             mov     A, Temp8                                
07FE 9403          32733             subb    A, #3                                   ; Is timing higher than normal?
0800 400F          32734             jc      store_times_decrease            ; No - branch
                   32735     
0802               32736     store_times_increase:
0802 8A50          32737             mov     Wt_Comm_Start_L, Temp3          ; Now commutation time (~60deg) divided by 
                             4 (~15deg nominal)
0804 8B51          32738             mov     Wt_Comm_Start_H, Temp4
0806 884A          32739             mov     Wt_Adv_Start_L, Temp1           ; New commutation advance time (~15deg nomi
                             nal)
0808 894B          32740             mov     Wt_Adv_Start_H, Temp2
080A 8C4C          32741             mov     Wt_Zc_Scan_Start_L, Temp5       ; Use this value for zero cross scan delay 
                             (7.5deg)
080C 8D4D          32742             mov     Wt_Zc_Scan_Start_H, Temp6
080E 02086A        32743             ljmp    wait_before_zc_scan
                   32744     
0811               32745     store_times_decrease:
0811 8850          32746             mov     Wt_Comm_Start_L, Temp1          ; Now commutation time (~60deg) divided by 
                             4 (~15deg nominal)
0813 8951          32747             mov     Wt_Comm_Start_H, Temp2
0815 8A4A          32748             mov     Wt_Adv_Start_L, Temp3           ; New commutation advance time (~15deg nomi
                             nal)
0817 8B4B          32749             mov     Wt_Adv_Start_H, Temp4
0819 8C4C          32750             mov     Wt_Zc_Scan_Start_L, Temp5       ; Use this value for zero cross scan delay 
                             (7.5deg)
081B 8D4D          32751             mov     Wt_Zc_Scan_Start_H, Temp6
081D 302812        32752             jnb     Flags1.STARTUP_PHASE, store_times_exit
                   32753     
0820 7550F0        32754             mov     Wt_Comm_Start_L, #0F0h          ; Set very short delays for all but advance
                              time during startup, in order to widen zero cross capture range
0823 7551FF        32755             mov     Wt_Comm_Start_H, #0FFh
0826 754CF0        32756             mov     Wt_Zc_Scan_Start_L, #0F0h
0829 754DFF        32757             mov     Wt_Zc_Scan_Start_H, #0FFh
082C 754EF0        32758             mov     Wt_Zc_Tout_Start_L, #0F0h
082F 754FFF        32759             mov     Wt_Zc_Tout_Start_H, #0FFh
                   32760     
0832               32761     store_times_exit:
0832 02086A        32762             ljmp    wait_before_zc_scan
                   32763     
                   32764     
0835               32765     calc_new_wait_times_fast:       
0835 E8            32766             mov     A, Temp1                                ; Copy values
0836 FA            32767             mov     Temp3, A
0837 D3            32768             setb    C                                       ; Negative numbers - set carry
0838 E8            32769             mov     A, Temp1                                ; Divide by 2
0839 13            32770             rrc     A
083A FC            32771             mov     Temp5, A
083B 884E          32772             mov     Wt_Zc_Tout_Start_L, Temp1; Set 15deg time for zero cross scan timeout
083D C3            32773             clr     C
083E EF            32774             mov     A, Temp8                                ; (Temp8 has Pgm_Comm_Timing)
083F 9403          32775             subb    A, #3                           ; Is timing normal?
0841 6021          32776             jz      store_times_decrease_fast; Yes - branch
                   32777     
0843 EF            32778             mov     A, Temp8                                
0844 20E007        32779             jb      ACC.0, adjust_timing_two_steps_fast     ; If an odd number - branch
                   32780     
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   503

0847 E8            32781             mov     A, Temp1                                ; Add 7.5deg and store in Temp1
0848 2C            32782             add     A, Temp5
0849 F8            32783             mov     Temp1, A
084A EC            32784             mov     A, Temp5                                ; Store 7.5deg in Temp3
084B FA            32785             mov     Temp3, A
084C 0155          32786             ajmp    store_times_up_or_down_fast
                   32787     
084E               32788     adjust_timing_two_steps_fast:
084E E8            32789             mov     A, Temp1                                ; Add 15deg and store in Temp1
084F 28            32790             add     A, Temp1
0850 2401          32791             add     A, #1
0852 F8            32792             mov     Temp1, A
0853 7AFF          32793             mov     Temp3, #-1                      ; Store minimum time in Temp3
                   32794     
0855               32795     store_times_up_or_down_fast:
0855 C3            32796             clr     C
0856 EF            32797             mov     A, Temp8                                
0857 9403          32798             subb    A, #3                           ; Is timing higher than normal?
0859 4009          32799             jc      store_times_decrease_fast; No - branch
                   32800     
085B               32801     store_times_increase_fast:
085B 8A50          32802             mov     Wt_Comm_Start_L, Temp3          ; Now commutation time (~60deg) divided by 
                             4 (~15deg nominal)
085D 884A          32803             mov     Wt_Adv_Start_L, Temp1           ; New commutation advance time (~15deg nomi
                             nal)
085F 8C4C          32804             mov     Wt_Zc_Scan_Start_L, Temp5       ; Use this value for zero cross scan delay 
                             (7.5deg)
0861 02086A        32805             ljmp    wait_before_zc_scan
                   32806     
0864               32807     store_times_decrease_fast:
0864 8850          32808             mov     Wt_Comm_Start_L, Temp1          ; Now commutation time (~60deg) divided by 
                             4 (~15deg nominal)
0866 8A4A          32809             mov     Wt_Adv_Start_L, Temp3           ; New commutation advance time (~15deg nomi
                             nal)
0868 8C4C          32810             mov     Wt_Zc_Scan_Start_L, Temp5       ; Use this value for zero cross scan delay 
                             (7.5deg)
                   32811     
                   32812     
                   32813     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   32814     ;
                   32815     ; Wait before zero cross scan routine
                   32816     ;
                   32817     ; No assumptions
                   32818     ;
                   32819     ; Waits for the zero cross scan wait time to elapse
                   32820     ; Also sets up timer 3 for the zero cross scan timeout time
                   32821     ;
                   32822     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
086A               32823     wait_before_zc_scan:    
086A 302002        32824             jnb     Flags0.T3_PENDING, ($+5)
086D 016A          32825             ajmp    wait_before_zc_scan
                   32826     
086F 753A02        32827             mov     Startup_Zc_Timeout_Cntd, #2
0872               32828     setup_zc_scan_timeout:
0872 D220          32829             setb    Flags0.T3_PENDING
0874 43E680        32830             orl     EIE1, #80h                      ; Enable timer 3 interrupts
0877 E525          32831             mov     A, Flags1
0879 5403          32832             anl     A, #((1 SHL STARTUP_PHASE)+(1 SHL INITIAL_RUN_PHASE))
087B 6034          32833             jz      wait_before_zc_scan_exit                
                   32834     
087D A847          32835             mov     Temp1, Comm_Period4x_L  ; Set long timeout when starting
087F A948          32836             mov     Temp2, Comm_Period4x_H
0881 C3            32837             clr     C
0882 E9            32838             mov     A, Temp2
0883 13            32839             rrc     A
0884 F9            32840             mov     Temp2, A
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   504

0885 E8            32841             mov     A, Temp1
0886 13            32842             rrc     A
0887 F8            32843             mov     Temp1, A
                   32844     IF MCU_48MHZ == 0
0888 C3            32845             clr     C
0889 E9            32846             mov     A, Temp2
088A 13            32847             rrc     A
088B F9            32848             mov     Temp2, A
088C E8            32849             mov     A, Temp1
088D 13            32850             rrc     A
088E F8            32851             mov     Temp1, A
                   32852     ENDIF
088F 302804        32853             jnb     Flags1.STARTUP_PHASE, setup_zc_scan_timeout_startup_done
                   32854     
0892 E9            32855             mov     A, Temp2
0893 2440          32856             add     A, #40h                         ; Increase timeout somewhat to avoid false 
                             wind up
0895 F9            32857             mov     Temp2, A
                   32858     
0896               32859     setup_zc_scan_timeout_startup_done:
0896 C2AF          32860             clr     IE_EA
0898 53E67F        32861             anl     EIE1, #7Fh                      ; Disable timer 3 interrupts
089B 759100        32862             mov     TMR3CN0, #00h                   ; Timer 3 disabled and interrupt flag clear
                             ed
089E C3            32863             clr     C
089F E4            32864             clr     A
08A0 98            32865             subb    A, Temp1                                ; Set timeout
08A1 F594          32866             mov     TMR3L, A
08A3 E4            32867             clr     A
08A4 99            32868             subb    A, Temp2                
08A5 F595          32869             mov     TMR3H, A
08A7 759104        32870             mov     TMR3CN0, #04h                   ; Timer 3 enabled and interrupt flag cleared
08AA D220          32871             setb    Flags0.T3_PENDING
08AC 43E680        32872             orl     EIE1, #80h                      ; Enable timer 3 interrupts
08AF D2AF          32873             setb    IE_EA
                   32874     
08B1               32875     wait_before_zc_scan_exit:          
08B1 22            32876             ret
                   32877     
                   32878     
                   32879     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   32880     ;
                   32881     ; Wait for comparator to go low/high routines
                   32882     ;
                   32883     ; No assumptions
                   32884     ;
                   32885     ; Waits for the zero cross scan wait time to elapse
                   32886     ; Then scans for comparator going low/high
                   32887     ;
                   32888     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
08B2               32889     wait_for_comp_out_low:
08B2 D221          32890             setb    Flags0.DEMAG_DETECTED           ; Set demag detected flag as default
08B4 754900        32891             mov     Comparator_Read_Cnt, #0         ; Reset number of comparator reads
08B7 752000        32892             mov     Bit_Access, #00h                        ; Desired comparator output
08BA 302B03        32893             jnb     Flags1.DIR_CHANGE_BRAKE, ($+6)
08BD 752040        32894             mov     Bit_Access, #40h                
08C0 01D0          32895             ajmp    wait_for_comp_out_start
                   32896     
08C2               32897     wait_for_comp_out_high:
08C2 D221          32898             setb    Flags0.DEMAG_DETECTED           ; Set demag detected flag as default
08C4 754900        32899             mov     Comparator_Read_Cnt, #0         ; Reset number of comparator reads
08C7 752040        32900             mov     Bit_Access, #40h                        ; Desired comparator output
08CA 302B03        32901             jnb     Flags1.DIR_CHANGE_BRAKE, ($+6)
08CD 752000        32902             mov     Bit_Access, #00h                
                   32903     
08D0               32904     wait_for_comp_out_start:
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   505

                   32905             ; Set number of comparator readings
08D0 7801          32906             mov     Temp1, #1                                       ; Number of OK readings req
                             uired
08D2 7901          32907             mov     Temp2, #1                                       ; Max number of readings re
                             quired
08D4 202C20        32908             jb      Flags1.HIGH_RPM, comp_scale_samples     ; Branch if high rpm
                   32909     
08D7 E525          32910             mov     A, Flags1                                       ; Clear demag detected flag
                              if start phases
08D9 5403          32911             anl     A, #((1 SHL STARTUP_PHASE)+(1 SHL INITIAL_RUN_PHASE))
08DB 6002          32912             jz      ($+4)
                   32913                     
08DD C221          32914             clr     Flags0.DEMAG_DETECTED
                   32915     
08DF 7914          32916             mov     Temp2, #20                              ; Too low value (~<15) causes rough
                              running at pwm harmonics. Too high a value (~>35) causes the RCT4215 630 to run rough on full throttle
08E1 E548          32917             mov     A, Comm_Period4x_H                      ; Set number of readings higher for
                              lower speeds
08E3 C3            32918             clr     C
08E4 13            32919             rrc     A
08E5 7001          32920             jnz     ($+3)
08E7 04            32921             inc     A
08E8 F8            32922             mov     Temp1, A
08E9 C3            32923             clr     C                                               
08EA 9414          32924             subb    A, #20
08EC 4002          32925             jc      ($+4)
                   32926     
08EE 7814          32927             mov     Temp1, #20
                   32928             
08F0 302804        32929             jnb     Flags1.STARTUP_PHASE, comp_scale_samples
                   32930     
08F3 781B          32931             mov     Temp1, #27                              ; Set many samples during startup, 
                             approximately one pwm period
08F5 791B          32932             mov     Temp2, #27
                   32933     
08F7               32934     comp_scale_samples:
                   32935     IF MCU_48MHZ == 1
                                     clr     C
                                     mov     A, Temp1
                                     rlc     A
                                     mov     Temp1, A
                                     clr     C
                                     mov     A, Temp2
                                     rlc     A
                                     mov     Temp2, A
                             ENDIF
08F7               32945     comp_check_timeout:
08F7 202010        32946             jb      Flags0.T3_PENDING, comp_check_timeout_not_timed_out             ; Has zero 
                             cross scan timeout elapsed?
                   32947     
08FA E549          32948             mov     A, Comparator_Read_Cnt                  ; Check that comparator has been re
                             ad
08FC 600C          32949             jz      comp_check_timeout_not_timed_out        ; If not read - branch
                   32950     
08FE 302803        32951             jnb     Flags1.STARTUP_PHASE, comp_check_timeout_timeout_extended       ; Extend ti
                             meout during startup
                   32952     
0901 D53A04        32953             djnz    Startup_Zc_Timeout_Cntd, comp_check_timeout_extend_timeout
                   32954     
0904               32955     comp_check_timeout_timeout_extended:
0904 D222          32956             setb    Flags0.COMP_TIMED_OUT
0906 2177          32957             ajmp    setup_comm_wait
                   32958     
0908               32959     comp_check_timeout_extend_timeout:
0908 1172          32960             call    setup_zc_scan_timeout
090A               32961     comp_check_timeout_not_timed_out:
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   506

090A 0549          32962             inc     Comparator_Read_Cnt                     ; Increment comparator read count
                   32963             Read_Comp_Out                                   ; Read comparator output
090E 5440          32965             anl     A, #40h
0910 B52002        32966             cjne    A, Bit_Access, comp_read_wrong
0913 2161          32967             ajmp    comp_read_ok
                   32968             
0915               32969     comp_read_wrong:
0915 302809        32970             jnb     Flags1.STARTUP_PHASE, comp_read_wrong_not_startup
                   32971     
0918 08            32972             inc     Temp1                                   ; Increment number of OK readings r
                             equired
0919 C3            32973             clr     C
091A E8            32974             mov     A, Temp1
091B 99            32975             subb    A, Temp2                                        ; If above initial requirem
                             ent - do not increment further
091C 4001          32976             jc      ($+3)
091E 18            32977             dec     Temp1
                   32978     
091F 01F7          32979             ajmp    comp_check_timeout                      ; Continue to look for good ones
                   32980     
0921               32981     comp_read_wrong_not_startup:
0921 20210A        32982             jb      Flags0.DEMAG_DETECTED, comp_read_wrong_extend_timeout
                   32983     
0924 08            32984             inc     Temp1                                   ; Increment number of OK readings r
                             equired
0925 C3            32985             clr     C
0926 E8            32986             mov     A, Temp1
0927 99            32987             subb    A, Temp2                                        
0928 4002          32988             jc      ($+4)
092A 01D0          32989             ajmp    wait_for_comp_out_start         ; If above initial requirement - go back an
                             d restart
                   32990     
092C 01F7          32991             ajmp    comp_check_timeout                      ; Otherwise - take another reading
                   32992     
092E               32993     comp_read_wrong_extend_timeout:
092E C221          32994             clr     Flags0.DEMAG_DETECTED           ; Clear demag detected flag
0930 53E67F        32995             anl     EIE1, #7Fh                              ; Disable timer 3 interrupts
0933 759100        32996             mov     TMR3CN0, #00h                           ; Timer 3 disabled and interrupt fl
                             ag cleared
0936 302C11        32997             jnb     Flags1.HIGH_RPM, comp_read_wrong_low_rpm        ; Branch if not high rpm
                   32998     
0939 759400        32999             mov     TMR3L, #00h                             ; Set timeout to ~1ms
                   33000     IF MCU_48MHZ == 1
                                     mov     TMR3H, #0F0h
                             ELSE
093C 7595F8        33003             mov     TMR3H, #0F8h
                   33004     ENDIF
093F               33005     comp_read_wrong_timeout_set:
093F 759104        33006             mov     TMR3CN0, #04h                           ; Timer 3 enabled and interrupt fla
                             g cleared
0942 D220          33007             setb    Flags0.T3_PENDING
0944 43E680        33008             orl     EIE1, #80h                              ; Enable timer 3 interrupts
0947 0208D0        33009             ljmp    wait_for_comp_out_start         ; If comparator output is not correct - go 
                             back and restart
                   33010     
094A               33011     comp_read_wrong_low_rpm:
094A E548          33012             mov     A, Comm_Period4x_H                      ; Set timeout to ~4x comm period 4x
                              value
094C 7EFF          33013             mov     Temp7, #0FFh                            ; Default to long
                   33014     IF MCU_48MHZ == 1
                                     clr     C
                                     rlc     A
                                     jc      comp_read_wrong_load_timeout
                             
                             ENDIF
094E C3            33020             clr     C
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   507

094F 33            33021             rlc     A
0950 4005          33022             jc      comp_read_wrong_load_timeout
                   33023     
0952 C3            33024             clr     C
0953 33            33025             rlc     A
0954 4001          33026             jc      comp_read_wrong_load_timeout
                   33027     
0956 FE            33028             mov     Temp7, A
                   33029     
0957               33030     comp_read_wrong_load_timeout:
0957 C3            33031             clr     C
0958 E4            33032             clr     A
0959 9E            33033             subb    A, Temp7
095A 759400        33034             mov     TMR3L, #0
095D F595          33035             mov     TMR3H, A
095F 213F          33036             ajmp    comp_read_wrong_timeout_set
                   33037     
0961               33038     comp_read_ok:
0961 C3            33039             clr     C
0962 E539          33040             mov     A, Startup_Cnt                          ; Force a timeout for the first com
                             mutation
0964 9401          33041             subb    A, #1
0966 5002          33042             jnc     ($+4)
0968 01D0          33043             ajmp    wait_for_comp_out_start
                   33044     
096A 302102        33045             jnb     Flags0.DEMAG_DETECTED, ($+5)    ; Do not accept correct comparator output i
                             f it is demag
096D 01D0          33046             ajmp    wait_for_comp_out_start
                   33047     
096F D802          33048             djnz    Temp1, comp_read_ok_jmp         ; Decrement readings counter - repeat compa
                             rator reading if not zero
0971 2175          33049             ajmp    ($+4)
                   33050     
0973               33051     comp_read_ok_jmp:
0973 01F7          33052             ajmp    comp_check_timeout
                   33053     
0975 C222          33054             clr     Flags0.COMP_TIMED_OUT
                   33055     
                   33056     
                   33057     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   33058     ;
                   33059     ; Setup commutation timing routine
                   33060     ;
                   33061     ; No assumptions
                   33062     ;
                   33063     ; Sets up and starts wait from commutation to zero cross
                   33064     ;
                   33065     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0977               33066     setup_comm_wait:
0977 C2AF          33067             clr     IE_EA
0979 53E67F        33068             anl     EIE1, #7Fh              ; Disable timer 3 interrupts
097C 759100        33069             mov     TMR3CN0, #00h           ; Timer 3 disabled and interrupt flag cleared
097F 855094        33070             mov     TMR3L, Wt_Comm_Start_L
0982 855195        33071             mov     TMR3H, Wt_Comm_Start_H
0985 759104        33072             mov     TMR3CN0, #04h           ; Timer 3 enabled and interrupt flag cleared
                   33073             ; Setup next wait time
0988 854A92        33074             mov     TMR3RLL, Wt_Adv_Start_L
098B 854B93        33075             mov     TMR3RLH, Wt_Adv_Start_H
098E D220          33076             setb    Flags0.T3_PENDING
0990 43E680        33077             orl     EIE1, #80h              ; Enable timer 3 interrupts
0993 D2AF          33078             setb    IE_EA                   ; Enable interrupts again
                   33079     
                   33080     
                   33081     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   33082     ;
                   33083     ; Evaluate comparator integrity
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   508

                   33084     ;
                   33085     ; No assumptions
                   33086     ;
                   33087     ; Checks comparator signal behaviour versus expected behaviour
                   33088     ;
                   33089     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0995               33090     evaluate_comparator_integrity:
0995 E525          33091             mov     A, Flags1
0997 5403          33092             anl     A, #((1 SHL STARTUP_PHASE)+(1 SHL INITIAL_RUN_PHASE))
0999 6007          33093             jz      eval_comp_check_timeout
                   33094     
099B 202902        33095             jb      Flags1.INITIAL_RUN_PHASE, ($+5) ; Do not increment beyond startup phase
099E 0539          33096             inc     Startup_Cnt                                     ; Increment counter
09A0 8010          33097             jmp     eval_comp_exit
                   33098     
09A2               33099     eval_comp_check_timeout:
09A2 30220D        33100             jnb     Flags0.COMP_TIMED_OUT, eval_comp_exit   ; Has timeout elapsed?
09A5 202B0A        33101             jb      Flags1.DIR_CHANGE_BRAKE, eval_comp_exit ; Do not exit run mode if it is bra
                             king
09A8 202107        33102             jb      Flags0.DEMAG_DETECTED, eval_comp_exit   ; Do not exit run mode if it is a d
                             emag situation
09AB 1581          33103             dec     SP                                                              ; Routine e
                             xit without "ret" command
09AD 1581          33104             dec     SP
09AF 021351        33105             ljmp    run_to_wait_for_power_on_fail                   ; Yes - exit run mode
                   33106     
09B2               33107     eval_comp_exit:
09B2 22            33108             ret
                   33109     
                   33110     
                   33111     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   33112     ;
                   33113     ; Wait for commutation routine
                   33114     ;
                   33115     ; No assumptions
                   33116     ;
                   33117     ; Waits from zero cross to commutation 
                   33118     ;
                   33119     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
09B3               33120     wait_for_comm: 
                   33121             ; Update demag metric
09B3 7800          33122             mov     Temp1, #0
09B5 302102        33123             jnb     Flags0.DEMAG_DETECTED, ($+5)
                   33124     
09B8 7801          33125             mov     Temp1, #1
                   33126     
09BA E53D          33127             mov     A, Demag_Detected_Metric        ; Sliding average of 8, 256 when demag and 
                             0 when not. Limited to minimum 120
09BC 75F007        33128             mov     B, #7
09BF A4            33129             mul     AB                                      ; Multiply by 7
09C0 F9            33130             mov     Temp2, A
09C1 E5F0          33131             mov     A, B                                    ; Add new value for current demag s
                             tatus
09C3 28            33132             add     A, Temp1                                
09C4 F5F0          33133             mov     B, A
09C6 E9            33134             mov     A, Temp2
09C7 A2F0          33135             mov     C, B.0                          ; Divide by 8
09C9 13            33136             rrc     A                                       
09CA A2F1          33137             mov     C, B.1
09CC 13            33138             rrc     A
09CD A2F2          33139             mov     C, B.2
09CF 13            33140             rrc     A
09D0 F53D          33141             mov     Demag_Detected_Metric, A
09D2 C3            33142             clr     C
09D3 9478          33143             subb    A, #120                         ; Limit to minimum 120
09D5 5003          33144             jnc     ($+5)
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   509

                   33145     
09D7 753D78        33146             mov     Demag_Detected_Metric, #120
                   33147     
09DA C3            33148             clr     C
09DB E53D          33149             mov     A, Demag_Detected_Metric        ; Check demag metric
09DD 953E          33150             subb    A, Demag_Pwr_Off_Thresh
09DF 4009          33151             jc      wait_for_comm_wait              ; Cut power if many consecutive demags. Thi
                             s will help retain sync during hard accelerations
                   33152     
                   33153             All_pwmFETs_off
                   33163             Set_Pwms_Off
                   33165     
09EA               33166     wait_for_comm_wait:
09EA 302002        33167             jnb Flags0.T3_PENDING, ($+5)                    
09ED 21EA          33168             ajmp    wait_for_comm_wait
                   33169     
                   33170             ; Setup next wait time
09EF 854C92        33171             mov     TMR3RLL, Wt_Zc_Scan_Start_L
09F2 854D93        33172             mov     TMR3RLH, Wt_Zc_Scan_Start_H
09F5 D220          33173             setb    Flags0.T3_PENDING
09F7 43E680        33174             orl     EIE1, #80h                      ; Enable timer 3 interrupts
09FA 22            33175             ret
                   33176     
                   33177     
                   33178     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   33179     ;
                   33180     ; Commutation routines
                   33181     ;
                   33182     ; No assumptions
                   33183     ;
                   33184     ; Performs commutation switching 
                   33185     ;
                   33186     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   33187     ; Comm phase 1 to comm phase 2
09FB               33188     comm1comm2:     
                   33189             Set_RPM_Out
09FB 203810        33190             jb      Flags3.PGM_DIR_REV, comm12_rev
                   33191     
09FE C2AF          33192             clr     IE_EA                           ; Disable all interrupts
                   33193             BcomFET_off                             ; Turn off comfet
                   33195             AcomFET_on                              ; Turn on comfet
                   33200             Set_Pwm_C                                       ; To reapply power after a demag cut
0A07 D2AF          33207             setb    IE_EA
                   33208             Set_Comp_Phase_B                        ; Set comparator phase
0A0C 41CB          33210             jmp     comm_exit
                   33211     
0A0E               33212     comm12_rev:     
0A0E C2AF          33213             clr     IE_EA                           ; Disable all interrupts
                   33214             BcomFET_off                             ; Turn off comfet
                   33216             CcomFET_on                              ; Turn on comfet (reverse)
                   33221             Set_Pwm_A                                       ; To reapply power after a demag cut
0A17 D2AF          33228             setb    IE_EA
                   33229             Set_Comp_Phase_B                        ; Set comparator phase
0A1C 41CB          33231             jmp     comm_exit
                   33232     
                   33233     
                   33234     ; Comm phase 2 to comm phase 3
0A1E               33235     comm2comm3:     
                   33236             Clear_RPM_Out
0A1E 203810        33237             jb      Flags3.PGM_DIR_REV, comm23_rev
                   33238     
0A21 C2AF          33239             clr     IE_EA                           ; Disable all interrupts
                   33240             CpwmFET_off                             ; Turn off pwmfet
                   33246             Set_Pwm_B                                       ; To reapply power after a demag cut
                   33253             AcomFET_on
0A2A D2AF          33258             setb    IE_EA
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   510

                   33259             Set_Comp_Phase_C                        ; Set comparator phase
0A2F 41CB          33261             ajmp    comm_exit
                   33262     
0A31               33263     comm23_rev:
0A31 C2AF          33264             clr     IE_EA                           ; Disable all interrupts
                   33265             ApwmFET_off                             ; Turn off pwmfet (reverse)
                   33271             Set_Pwm_B                                       ; To reapply power after a demag cut
                   33278             CcomFET_on
0A3A D2AF          33283             setb    IE_EA
                   33284             Set_Comp_Phase_A                        ; Set comparator phase (reverse)
0A3F 41CB          33286             ajmp    comm_exit
                   33287     
                   33288     
                   33289     ; Comm phase 3 to comm phase 4
0A41               33290     comm3comm4:     
                   33291             Set_RPM_Out
0A41 203810        33292             jb      Flags3.PGM_DIR_REV, comm34_rev
                   33293     
0A44 C2AF          33294             clr     IE_EA                           ; Disable all interrupts
                   33295             AcomFET_off                             ; Turn off comfet
                   33297             CcomFET_on                              ; Turn on comfet
                   33302             Set_Pwm_B                                       ; To reapply power after a demag cut
0A4D D2AF          33309             setb    IE_EA
                   33310             Set_Comp_Phase_A                        ; Set comparator phase
0A52 8077          33312             jmp     comm_exit
                   33313     
0A54               33314     comm34_rev:     
0A54 C2AF          33315             clr     IE_EA                           ; Disable all interrupts
                   33316             CcomFET_off                             ; Turn off comfet (reverse)
                   33318             AcomFET_on                              ; Turn on comfet (reverse)
                   33323             Set_Pwm_B                                       ; To reapply power after a demag cut
0A5D D2AF          33330             setb    IE_EA
                   33331             Set_Comp_Phase_C                        ; Set comparator phase (reverse)
0A62 8067          33333             jmp     comm_exit
                   33334     
                   33335     
                   33336     ; Comm phase 4 to comm phase 5
0A64               33337     comm4comm5:     
                   33338             Clear_RPM_Out
0A64 203810        33339             jb      Flags3.PGM_DIR_REV, comm45_rev
                   33340     
0A67 C2AF          33341             clr     IE_EA                           ; Disable all interrupts
                   33342             BpwmFET_off                             ; Turn off pwmfet
                   33348             Set_Pwm_A                                       ; To reapply power after a demag cut
                   33355             CcomFET_on
0A70 D2AF          33360             setb    IE_EA
                   33361             Set_Comp_Phase_B                        ; Set comparator phase
0A75 8054          33363             jmp     comm_exit
                   33364     
0A77               33365     comm45_rev:
0A77 C2AF          33366             clr     IE_EA                           ; Disable all interrupts
                   33367             BpwmFET_off                             ; Turn off pwmfet
                   33373             Set_Pwm_C
                   33380             AcomFET_on                              ; To reapply power after a demag cut
0A80 D2AF          33385             setb    IE_EA
                   33386             Set_Comp_Phase_B                        ; Set comparator phase
0A85 8044          33388             jmp     comm_exit
                   33389     
                   33390     
                   33391     ; Comm phase 5 to comm phase 6
0A87               33392     comm5comm6:     
                   33393             Set_RPM_Out
0A87 203810        33394             jb      Flags3.PGM_DIR_REV, comm56_rev
                   33395     
0A8A C2AF          33396             clr     IE_EA                           ; Disable all interrupts
                   33397             CcomFET_off                             ; Turn off comfet
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   511

                   33399             BcomFET_on                              ; Turn on comfet
                   33404             Set_Pwm_A                                       ; To reapply power after a demag cut
0A93 D2AF          33411             setb    IE_EA
                   33412             Set_Comp_Phase_C                        ; Set comparator phase
0A98 8031          33414             jmp     comm_exit
                   33415     
0A9A               33416     comm56_rev:
0A9A C2AF          33417             clr     IE_EA                           ; Disable all interrupts
                   33418             AcomFET_off                             ; Turn off comfet (reverse)
                   33420             BcomFET_on                              ; Turn on comfet
                   33425             Set_Pwm_C                                       ; To reapply power after a demag cut
0AA3 D2AF          33432             setb    IE_EA
                   33433             Set_Comp_Phase_A                        ; Set comparator phase (reverse)
0AA8 8021          33435             jmp     comm_exit
                   33436     
                   33437     
                   33438     ; Comm phase 6 to comm phase 1
0AAA               33439     comm6comm1:     
                   33440             Clear_RPM_Out
0AAA 203810        33441             jb      Flags3.PGM_DIR_REV, comm61_rev
                   33442     
0AAD C2AF          33443             clr     IE_EA                           ; Disable all interrupts
                   33444             ApwmFET_off                             ; Turn off pwmfet
                   33450             Set_Pwm_C
                   33457             BcomFET_on                              ; To reapply power after a demag cut
0AB6 D2AF          33462             setb    IE_EA
                   33463             Set_Comp_Phase_A                        ; Set comparator phase
0ABB 800E          33465             jmp     comm_exit
                   33466     
0ABD               33467     comm61_rev:
0ABD C2AF          33468             clr     IE_EA                           ; Disable all interrupts
                   33469             CpwmFET_off                             ; Turn off pwmfet (reverse)
                   33475             Set_Pwm_A
                   33482             BcomFET_on                              ; To reapply power after a demag cut
0AC6 D2AF          33487             setb    IE_EA
                   33488             Set_Comp_Phase_C                        ; Set comparator phase (reverse)
                   33490     
0ACB               33491     comm_exit:
0ACB 22            33492             ret
                   33493     
                   33494     
                   33495     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   33496     ;
                   33497     ; Beeper routines (4 different entry points) 
                   33498     ;
                   33499     ; No assumptions
                   33500     ;
                   33501     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0ACC               33502     beep_f1:        ; Entry point 1, load beeper frequency 1 settings
0ACC 7A14          33503             mov     Temp3, #20      ; Off wait loop length
0ACE 7B78          33504             mov     Temp4, #120     ; Number of beep pulses
0AD0 8012          33505             jmp     beep
                   33506     
0AD2               33507     beep_f2:        ; Entry point 2, load beeper frequency 2 settings
0AD2 7A10          33508             mov     Temp3, #16
0AD4 7B8C          33509             mov     Temp4, #140
0AD6 800C          33510             jmp     beep
                   33511     
0AD8               33512     beep_f3:        ; Entry point 3, load beeper frequency 3 settings
0AD8 7A0D          33513             mov     Temp3, #13
0ADA 7BB4          33514             mov     Temp4, #180
0ADC 8006          33515             jmp     beep
                   33516     
0ADE               33517     beep_f4:        ; Entry point 4, load beeper frequency 4 settings
0ADE 7A0B          33518             mov     Temp3, #11
0AE0 7BC8          33519             mov     Temp4, #200
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   512

0AE2 8000          33520             jmp     beep
                   33521     
0AE4               33522     beep:   ; Beep loop start
0AE4 E564          33523             mov     A, Beep_Strength
0AE6 D5E001        33524             djnz    ACC, beep_start
0AE9 22            33525             ret
                   33526     
0AEA               33527     beep_start:
0AEA 7902          33528             mov     Temp2, #2
0AEC               33529     beep_onoff:
0AEC E4            33530             clr     A
                   33531             BcomFET_off             ; BcomFET off
0AEF D5E0FD        33533             djnz    ACC, $          ; Allow some time after comfet is turned off
                   33534             BpwmFET_on              ; BpwmFET on (in order to charge the driver of the BcomFET)
0AF4 D5E0FD        33539             djnz    ACC, $          ; Let the pwmfet be turned on a while
                   33540             BpwmFET_off             ; BpwmFET off again
0AF9 D5E0FD        33546             djnz    ACC, $          ; Allow some time after pwmfet is turned off
                   33547             BcomFET_on              ; BcomFET on
0AFE D5E0FD        33552             djnz    ACC, $          ; Allow some time after comfet is turned on
                   33553             ; Turn on pwmfet
0B01 E9            33554             mov     A, Temp2
0B02 20E002        33555             jb      ACC.0, beep_apwmfet_on
                   33556             ApwmFET_on              ; ApwmFET on
0B07               33561     beep_apwmfet_on:
0B07 30E002        33562             jnb     ACC.0, beep_cpwmfet_on
                   33563             CpwmFET_on              ; CpwmFET on
0B0C               33568     beep_cpwmfet_on:
0B0C E564          33569             mov     A, Beep_Strength
0B0E D5E0FD        33570             djnz    ACC, $          
                   33571             ; Turn off pwmfet
0B11 E9            33572             mov     A, Temp2
0B12 20E002        33573             jb      ACC.0, beep_apwmfet_off
                   33574             ApwmFET_off             ; ApwmFET off
0B17               33580     beep_apwmfet_off:
0B17 30E002        33581             jnb     ACC.0, beep_cpwmfet_off
                   33582             CpwmFET_off             ; CpwmFET off
0B1C               33588     beep_cpwmfet_off:
0B1C 7496          33589             mov     A, #150         ; 25s off
0B1E D5E0FD        33590             djnz    ACC, $          
0B21 D9C9          33591             djnz    Temp2, beep_onoff
                   33592             ; Copy variable
0B23 EA            33593             mov     A, Temp3
0B24 F8            33594             mov     Temp1, A        
0B25               33595     beep_off:               ; Fets off loop
0B25 D5E0FD        33596             djnz    ACC, $
0B28 D8FB          33597             djnz    Temp1,  beep_off
0B2A DBB8          33598             djnz    Temp4,  beep
                   33599             BcomFET_off             ; BcomFET off
0B2E 22            33601             ret
                   33602     
                   33603     
                   33604     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   33605     ;
                   33606     ; Switch power off routine
                   33607     ;
                   33608     ; No assumptions
                   33609     ;
                   33610     ; Switches all fets off 
                   33611     ;
                   33612     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0B2F               33613     switch_power_off:
                   33614             All_pwmFETs_Off         ; Turn off all pwm fets
                   33624             All_comFETs_Off         ; Turn off all commutation fets
                   33628             Set_Pwms_Off
0B3E 22            33630             ret                     
                   33631     
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   513

                   33632     
                   33633     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   33634     ;
                   33635     ; Set default parameters
                   33636     ;
                   33637     ; No assumptions
                   33638     ;
                   33639     ; Sets default programming parameters
                   33640     ;
                   33641     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0B3F               33642     set_default_parameters:
0B3F 7880          33643             mov     Temp1, #_Pgm_Gov_P_Gain
0B41 76FF          33644             mov     @Temp1, #0FFh   ; Governor P gain
0B43 08            33645             inc     Temp1
0B44 76FF          33646             mov     @Temp1, #0FFh   ; Governor I gain
0B46 08            33647             inc     Temp1
0B47 76FF          33648             mov     @Temp1, #0FFh   ; Governor mode
0B49 08            33649             inc     Temp1
0B4A 76FF          33650             mov     @Temp1, #0FFh   ; Low voltage limit
0B4C 08            33651             inc     Temp1
0B4D 76FF          33652             mov     @Temp1, #0FFh   ; Multi gain
0B4F 08            33653             inc     Temp1
0B50 76FF          33654             mov     @Temp1, #0FFh   
0B52 08            33655             inc     Temp1
0B53 7609          33656             mov     @Temp1, #DEFAULT_PGM_STARTUP_PWR
0B55 08            33657             inc     Temp1
0B56 76FF          33658             mov     @Temp1, #0FFh   ; Pwm freq
0B58 08            33659             inc     Temp1
0B59 7601          33660             mov     @Temp1, #DEFAULT_PGM_DIRECTION
                   33661     
0B5B 788C          33662             mov     Temp1, #Pgm_Enable_TX_Program
0B5D 7601          33663             mov     @Temp1, #DEFAULT_PGM_ENABLE_TX_PROGRAM
0B5F 08            33664             inc     Temp1
0B60 76FF          33665             mov     @Temp1, #0FFh   ; Main rearm start
0B62 08            33666             inc     Temp1
0B63 76FF          33667             mov     @Temp1, #0FFh   ; Governor setup target
0B65 08            33668             inc     Temp1
0B66 76FF          33669             mov     @Temp1, #0FFh   ; Startup rpm   
0B68 08            33670             inc     Temp1
0B69 76FF          33671             mov     @Temp1, #0FFh   ; Startup accel
0B6B 08            33672             inc     Temp1
0B6C 76FF          33673             mov     @Temp1, #0FFh   ; Voltage comp
0B6E 08            33674             inc     Temp1
0B6F 7603          33675             mov     @Temp1, #DEFAULT_PGM_COMM_TIMING
0B71 08            33676             inc     Temp1
0B72 76FF          33677             mov     @Temp1, #0FFh   ; Damping force 
0B74 08            33678             inc     Temp1
0B75 76FF          33679             mov     @Temp1, #0FFh   ; Governor range
0B77 08            33680             inc     Temp1
0B78 76FF          33681             mov     @Temp1, #0FFh   ; Startup method        
0B7A 08            33682             inc     Temp1
0B7B 7625          33683             mov     @Temp1, #DEFAULT_PGM_MIN_THROTTLE
0B7D 08            33684             inc     Temp1
0B7E 76D0          33685             mov     @Temp1, #DEFAULT_PGM_MAX_THROTTLE
0B80 08            33686             inc     Temp1
0B81 7628          33687             mov     @Temp1, #DEFAULT_PGM_BEEP_STRENGTH
0B83 08            33688             inc     Temp1
0B84 7650          33689             mov     @Temp1, #DEFAULT_PGM_BEACON_STRENGTH
0B86 08            33690             inc     Temp1
0B87 7604          33691             mov     @Temp1, #DEFAULT_PGM_BEACON_DELAY
0B89 08            33692             inc     Temp1
0B8A 76FF          33693             mov     @Temp1, #0FFh   ; Throttle rate 
0B8C 08            33694             inc     Temp1
0B8D 7602          33695             mov     @Temp1, #DEFAULT_PGM_DEMAG_COMP
0B8F 08            33696             inc     Temp1
0B90 76FF          33697             mov     @Temp1, #0FFh   ; Bec voltage high
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   514

0B92 08            33698             inc     Temp1
0B93 767A          33699             mov     @Temp1, #DEFAULT_PGM_CENTER_THROTTLE
0B95 08            33700             inc     Temp1
0B96 76FF          33701             mov     @Temp1, #0FFh   
0B98 08            33702             inc     Temp1
0B99 7607          33703             mov     @Temp1, #DEFAULT_PGM_ENABLE_TEMP_PROT
0B9B 08            33704             inc     Temp1
0B9C 7601          33705             mov     @Temp1, #DEFAULT_PGM_ENABLE_POWER_PROT
0B9E 08            33706             inc     Temp1
0B9F 76FF          33707             mov     @Temp1, #0FFh   ; Enable pwm input
0BA1 08            33708             inc     Temp1
0BA2 76FF          33709             mov     @Temp1, #0FFh   ; Pwm dither
0BA4 08            33710             inc     Temp1
0BA5 7600          33711             mov     @Temp1, #DEFAULT_PGM_BRAKE_ON_STOP
0BA7 08            33712             inc     Temp1
0BA8 7600          33713             mov     @Temp1, #DEFAULT_PGM_LED_CONTROL
0BAA 22            33714             ret
                   33715     
                   33716     
                   33717     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   33718     ;
                   33719     ; Scale throttle cal
                   33720     ;
                   33721     ; No assumptions
                   33722     ;
                   33723     ; Scales a throttle cal value
                   33724     ; Input is ACC, output is Temp2/Temp1
                   33725     ;
                   33726     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0BAB               33727     scale_throttle_cal:
0BAB FA            33728             mov     Temp3, A
0BAC 75F00C        33729             mov     B, #0Ch                 ; Calculate "3%" (for going from 1000us to numerica
                             l 1024)
0BAF A4            33730             mul     AB
0BB0 ABF0          33731             mov     Temp4, B
0BB2 EA            33732             mov     A, Temp3
0BB3 C3            33733             clr     C                               ; Shift to 9 bits
0BB4 33            33734             rlc     A
0BB5 F8            33735             mov     Temp1, A
0BB6 7401          33736             mov     A, #1
0BB8 33            33737             rlc     A
0BB9 F9            33738             mov     Temp2, A
0BBA E8            33739             mov     A, Temp1                        ; Shift to 10 bits
0BBB C3            33740             clr     C
0BBC 33            33741             rlc     A
0BBD F8            33742             mov     Temp1, A
0BBE E9            33743             mov     A, Temp2
0BBF 33            33744             rlc     A
0BC0 F9            33745             mov     Temp2, A
0BC1 E8            33746             mov     A, Temp1                        ; Add "3%"
0BC2 C3            33747             clr     C
0BC3 2B            33748             add     A, Temp4
0BC4 F8            33749             mov     Temp1, A
0BC5 E9            33750             mov     A, Temp2
0BC6 3400          33751             addc    A, #0
0BC8 F9            33752             mov     Temp2, A
                   33753     IF MCU_48MHZ == 1
                                     mov     A, Temp1                        ; Shift to 11 bits
                                     clr     C
                                     rlc     A
                                     mov     Temp1, A
                                     mov     A, Temp2
                                     rlc     A
                                     mov     Temp2, A
                             ENDIF
0BC9 22            33762     ret
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   515

                   33763     
                   33764     
                   33765     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   33766     ;
                   33767     ; Decode settings
                   33768     ;
                   33769     ; No assumptions
                   33770     ;
                   33771     ; Decodes various settings
                   33772     ;
                   33773     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0BCA               33774     decode_settings:
                   33775             ; Load programmed direction
0BCA 7888          33776             mov     Temp1, #Pgm_Direction   
0BCC E6            33777             mov     A, @Temp1                               
0BCD C3            33778             clr     C
0BCE 9403          33779             subb    A, #3
0BD0 D23A          33780             setb    Flags3.PGM_BIDIR
0BD2 5002          33781             jnc     ($+4)
                   33782     
0BD4 C23A          33783             clr     Flags3.PGM_BIDIR
                   33784     
0BD6 C238          33785             clr     Flags3.PGM_DIR_REV
0BD8 E6            33786             mov     A, @Temp1                               
0BD9 30E102        33787             jnb     ACC.1, ($+5)
0BDC D238          33788             setb    Flags3.PGM_DIR_REV
0BDE A238          33789             mov     C, Flags3.PGM_DIR_REV
0BE0 9239          33790             mov     Flags3.PGM_BIDIR_REV, C
                   33791             ; Decode startup power
0BE2 7886          33792             mov     Temp1, #Pgm_Startup_Pwr         
0BE4 E6            33793             mov     A, @Temp1                               
0BE5 14            33794             dec     A       
0BE6 900080        33795             mov     DPTR, #STARTUP_POWER_TABLE
0BE9 93            33796             movc A, @A+DPTR 
0BEA 78A6          33797             mov     Temp1, #Pgm_Startup_Pwr_Decoded
0BEC F6            33798             mov     @Temp1, A       
                   33799             ; Decode low rpm power slope
0BED 7886          33800             mov     Temp1, #Pgm_Startup_Pwr
0BEF E6            33801             mov     A, @Temp1
0BF0 F53F          33802             mov     Low_Rpm_Pwr_Slope, A
0BF2 C3            33803             clr     C
0BF3 9402          33804             subb    A, #2
0BF5 5003          33805             jnc     ($+5)
0BF7 753F02        33806             mov     Low_Rpm_Pwr_Slope, #2
                   33807             ; Decode demag compensation
0BFA 789C          33808             mov     Temp1, #Pgm_Demag_Comp          
0BFC E6            33809             mov     A, @Temp1                               
0BFD 753EFF        33810             mov     Demag_Pwr_Off_Thresh, #255      ; Set default
                   33811     
0C00 B40203        33812             cjne    A, #2, decode_demag_high
                   33813     
0C03 753EA0        33814             mov     Demag_Pwr_Off_Thresh, #160      ; Settings for demag comp low
                   33815     
0C06               33816     decode_demag_high:
0C06 B40303        33817             cjne    A, #3, decode_demag_done
                   33818     
0C09 753E82        33819             mov     Demag_Pwr_Off_Thresh, #130      ; Settings for demag comp high
                   33820     
0C0C               33821     decode_demag_done:
                   33822             ; Decode temperature protection limit
0C0C 78A0          33823             mov     Temp1, #Pgm_Enable_Temp_Prot
0C0E E6            33824             mov     A, @Temp1
0C0F F8            33825             mov     Temp1, A
0C10 6006          33826             jz      decode_temp_done
                   33827     
0C12 7428          33828             mov     A, #(TEMP_LIMIT-TEMP_LIMIT_STEP)
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   516

0C14               33829     decode_temp_step:
0C14 2409          33830             add     A, #TEMP_LIMIT_STEP
0C16 D8FC          33831             djnz    Temp1, decode_temp_step
                   33832     
0C18               33833     decode_temp_done:
0C18 F569          33834             mov     Temp_Prot_Limit, A
                   33835             ; Decode throttle cal
0C1A 7896          33836             mov     Temp1, #Pgm_Min_Throttle                ; Throttle cal is in 4us units
0C1C E6            33837             mov     A, @Temp1
0C1D 71AB          33838             call    scale_throttle_cal
0C1F 8831          33839             mov     Min_Throttle_L, Temp1
0C21 8932          33840             mov     Min_Throttle_H, Temp2
0C23 789E          33841             mov     Temp1, #Pgm_Center_Throttle     ; Throttle cal is in 4us units
0C25 E6            33842             mov     A, @Temp1
0C26 71AB          33843             call    scale_throttle_cal
0C28 8833          33844             mov     Center_Throttle_L, Temp1
0C2A 8934          33845             mov     Center_Throttle_H, Temp2
0C2C 7897          33846             mov     Temp1, #Pgm_Max_Throttle                ; Throttle cal is in 4us units
0C2E E6            33847             mov     A, @Temp1
0C2F 71AB          33848             call    scale_throttle_cal
0C31 8835          33849             mov     Max_Throttle_L, Temp1
0C33 8936          33850             mov     Max_Throttle_H, Temp2
0C35 712F          33851             call    switch_power_off
0C37 22            33852             ret
                   33853     
                   33854     
                   33855     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   33856     ;
                   33857     ; Find throttle gains
                   33858     ;
                   33859     ; No assumptions
                   33860     ;
                   33861     ; Finds throttle gains for both directions in bidirectional mode
                   33862     ;
                   33863     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0C38               33864     find_throttle_gains:
                   33865             ; Check if full range is chosen
0C38 303611        33866             jnb     Flags2.RCP_FULL_RANGE, find_throttle_gains_normal
                   33867     
0C3B 7A00          33868             mov     Temp3, #0               ; Min throttle
0C3D 7B00          33869             mov     Temp4, #0
0C3F 7CFF          33870             mov     Temp5, #255     ; Max throttle
0C41 7D00          33871             mov     Temp6, #0
0C43 7E00          33872             mov     Temp7, #0               ; Deadband
0C45 919E          33873             call    find_throttle_gain
0C47 8B61          33874             mov     Throttle_Gain_M, Temp4
0C49 8A60          33875             mov     Throttle_Gain, Temp3
0C4B 22            33876             ret
                   33877     
0C4C               33878     find_throttle_gains_normal:
                   33879             ; Check if bidirectional operation
0C4C 303A22        33880             jnb     Flags3.PGM_BIDIR, find_throttle_gains_bidir_done
                   33881     
0C4F 7896          33882             mov     Temp1, #Pgm_Min_Throttle
0C51 E6            33883             mov     A, @Temp1
0C52 FA            33884             mov     Temp3, A
0C53 7B00          33885             mov     Temp4, #0
0C55 789E          33886             mov     Temp1, #Pgm_Center_Throttle
0C57 E6            33887             mov     A, @Temp1
0C58 FC            33888             mov     Temp5, A
0C59 7D00          33889             mov     Temp6, #0
0C5B C3            33890             clr     C
0C5C EA            33891             mov     A, Temp3                        ; Scale gains in bidirectional
0C5D 33            33892             rlc     A
0C5E FA            33893             mov     Temp3, A
0C5F EB            33894             mov     A, Temp4
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   517

0C60 33            33895             rlc     A
0C61 FB            33896             mov     Temp4, A
0C62 C3            33897             clr     C
0C63 EC            33898             mov     A, Temp5
0C64 33            33899             rlc     A
0C65 FC            33900             mov     Temp5, A
0C66 ED            33901             mov     A, Temp6
0C67 33            33902             rlc     A
0C68 FD            33903             mov     Temp6, A
0C69 7E0A          33904             mov     Temp7, #10              ; Compensate for deadband in bidirectional
0C6B 919E          33905             call    find_throttle_gain
0C6D 8B63          33906             mov     Throttle_Gain_BD_Rev_M, Temp4
0C6F 8A62          33907             mov     Throttle_Gain_BD_Rev, Temp3
                   33908     
0C71               33909     find_throttle_gains_bidir_done:
0C71 7896          33910             mov     Temp1, #Pgm_Min_Throttle
0C73 303A02        33911             jnb     Flags3.PGM_BIDIR, ($+5)
                   33912     
0C76 789E          33913             mov     Temp1, #Pgm_Center_Throttle
                   33914     
0C78 E6            33915             mov     A, @Temp1
0C79 FA            33916             mov     Temp3, A
0C7A 7B00          33917             mov     Temp4, #0
0C7C 7897          33918             mov     Temp1, #Pgm_Max_Throttle
0C7E E6            33919             mov     A, @Temp1
0C7F FC            33920             mov     Temp5, A
0C80 7D00          33921             mov     Temp6, #0
0C82 7E00          33922             mov     Temp7, #0                       ; No deadband
0C84 303A10        33923             jnb     Flags3.PGM_BIDIR, find_throttle_gain_fwd
                   33924     
0C87 C3            33925             clr     C
0C88 EA            33926             mov     A, Temp3                        ; Scale gains in bidirectional
0C89 33            33927             rlc     A
0C8A FA            33928             mov     Temp3, A
0C8B EB            33929             mov     A, Temp4
0C8C 33            33930             rlc     A
0C8D FB            33931             mov     Temp4, A
0C8E C3            33932             clr     C
0C8F EC            33933             mov     A, Temp5
0C90 33            33934             rlc     A
0C91 FC            33935             mov     Temp5, A
0C92 ED            33936             mov     A, Temp6
0C93 33            33937             rlc     A
0C94 FD            33938             mov     Temp6, A
0C95 7E0A          33939             mov     Temp7, #10              ; Compensate for deadband in bidirectional
                   33940     
0C97               33941     find_throttle_gain_fwd:
0C97 919E          33942             call    find_throttle_gain
0C99 8B61          33943             mov     Throttle_Gain_M, Temp4
0C9B 8A60          33944             mov     Throttle_Gain, Temp3
0C9D 22            33945             ret
                   33946     
                   33947     
                   33948     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   33949     ;
                   33950     ; Find throttle gain
                   33951     ;
                   33952     ; The difference between max and min throttle must be more than 140us (a Pgm_xxx_Throttle d
                             ifference of 35)
                   33953     ; Temp4/3 holds min throttle, Temp6/5 holds max throttle, Temp7 holds deadband, Temp4/Temp3
                              gives resulting gain
                   33954     ;
                   33955     ; Finds throttle gain from throttle calibration values
                   33956     ;
                   33957     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0C9E               33958     find_throttle_gain:
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   518

                   33959             ; Subtract deadband from max
0C9E C3            33960             clr     C
0C9F EC            33961             mov     A, Temp5
0CA0 9E            33962             subb    A, Temp7
0CA1 FC            33963             mov     Temp5, A
0CA2 ED            33964             mov     A, Temp6
0CA3 9400          33965             subb    A, #0
0CA5 FD            33966             mov     Temp6, A
                   33967             ; Calculate difference
0CA6 C3            33968             clr     C
0CA7 EC            33969             mov     A, Temp5
0CA8 9A            33970             subb    A, Temp3
0CA9 FC            33971             mov     Temp5, A
0CAA ED            33972             mov     A, Temp6
0CAB 9B            33973             subb    A, Temp4
0CAC FD            33974             mov     Temp6, A
                   33975             ; Check that difference is minimum 35
0CAD C3            33976             clr     C
0CAE EC            33977             mov     A, Temp5
0CAF 9423          33978             subb    A, #35
0CB1 ED            33979             mov     A, Temp6
0CB2 9400          33980             subb    A, #0
0CB4 5004          33981             jnc     ($+6)
                   33982     
0CB6 7C23          33983             mov     Temp5, #35
0CB8 7D00          33984             mov     Temp6, #0
                   33985     
                   33986             ; Check that difference is maximum 511
0CBA C3            33987             clr     C
0CBB EC            33988             mov     A, Temp5
0CBC 94FF          33989             subb    A, #255
0CBE ED            33990             mov     A, Temp6
0CBF 9401          33991             subb    A, #1
0CC1 4004          33992             jc      ($+6)
                   33993     
0CC3 7CFF          33994             mov     Temp5, #255
0CC5 7D01          33995             mov     Temp6, #1
                   33996     
                   33997             ; Find gain
0CC7 7BFF          33998             mov     Temp4, #0FFh
0CC9               33999     find_throttle_gain_loop:
0CC9 0B            34000             inc     Temp4
0CCA 7A00          34001             mov     Temp3, #0
0CCC               34002     test_throttle_gain:
0CCC 0A            34003             inc     Temp3
0CCD EA            34004             mov     A, Temp3
0CCE 7009          34005             jnz     test_throttle_gain_mult
                   34006     
0CD0 C3            34007             clr     C
0CD1 EC            34008             mov     A, Temp5                        ; Set multiplier x2 and range /2
0CD2 33            34009             rlc     A
0CD3 FC            34010             mov     Temp5, A
0CD4 ED            34011             mov     A, Temp6
0CD5 33            34012             rlc     A
0CD6 FD            34013             mov     Temp6, A
0CD7 81C9          34014             ajmp    find_throttle_gain_loop
                   34015     
0CD9               34016     test_throttle_gain_mult:
0CD9 EC            34017             mov     A, Temp5                        ; A has difference, B has gain
0CDA 8AF0          34018             mov     B, Temp3
0CDC A4            34019             mul     AB
0CDD AEF0          34020             mov     Temp7, B
0CDF ED            34021             mov     A, Temp6
0CE0 8AF0          34022             mov     B, Temp3
0CE2 A4            34023             mul     AB
0CE3 2E            34024             add     A, Temp7
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   519

0CE4 947C          34025             subb    A, #124
0CE6 40E4          34026             jc      test_throttle_gain
                   34027     
0CE8 EA            34028             mov     A, Temp3
0CE9 F4            34029             cpl     A
0CEA 60DD          34030             jz      find_throttle_gain_loop
                   34031     
0CEC 22            34032             ret
                   34033     
                   34034     
                   34035     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   34036     ;
                   34037     ; Average throttle 
                   34038     ;
                   34039     ; Outputs result in Temp8
                   34040     ;
                   34041     ; Averages throttle calibration readings
                   34042     ;
                   34043     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0CED               34044     average_throttle:
0CED D236          34045             setb    Flags2.RCP_FULL_RANGE   ; Set range to 1000-2020us
0CEF 9138          34046             call    find_throttle_gains     ; Set throttle gains
0CF1 12056D        34047             call wait30ms           
0CF4 12056D        34048             call wait30ms
0CF7 7A00          34049             mov     Temp3, #0
0CF9 7B00          34050             mov     Temp4, #0
0CFB 7C10          34051             mov     Temp5, #16              ; Average 16 measurments
0CFD               34052     average_throttle_meas:
0CFD 120565        34053             call    wait3ms                 ; Wait for new RC pulse value
0D00 E554          34054             mov     A, New_Rcp              ; Get new RC pulse value
0D02 2A            34055             add     A, Temp3
0D03 FA            34056             mov     Temp3, A
0D04 7400          34057             mov     A, #0
0D06 3B            34058             addc A, Temp4
0D07 FB            34059             mov     Temp4, A
0D08 DCF3          34060             djnz    Temp5, average_throttle_meas
                   34061     
0D0A 7C04          34062             mov     Temp5, #4                       ; Shift 4 times
0D0C               34063     average_throttle_div:
0D0C C3            34064             clr     C
0D0D EB            34065             mov     A, Temp4                ; Shift right 
0D0E 13            34066             rrc     A      
0D0F FB            34067             mov     Temp4, A   
0D10 EA            34068             mov     A, Temp3   
0D11 13            34069             rrc     A      
0D12 FA            34070             mov     Temp3, A   
0D13 DCF7          34071             djnz    Temp5, average_throttle_div
                   34072     
0D15 FF            34073             mov     Temp8, A                ; Copy to Temp8
0D16 EB            34074             mov     A, Temp4
0D17 6002          34075             jz      ($+4)
                   34076     
0D19 7FFF          34077             mov     Temp8, #0FFh
                   34078     
0D1B C236          34079             clr     Flags2.RCP_FULL_RANGE
0D1D 9138          34080             call    find_throttle_gains     ; Set throttle gains
0D1F 22            34081             ret
                   34082     
                   34083     
                   34084     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   34085     ;
                   34086     ; LED control
                   34087     ;
                   34088     ; No assumptions
                   34089     ;
                   34090     ; Controls LEDs
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   520

                   34091     ;
                   34092     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0D20               34093     led_control:
0D20 78A5          34094             mov     Temp1, #Pgm_LED_Control
0D22 E6            34095             mov     A, @Temp1
0D23 F9            34096             mov     Temp2, A
0D24 5403          34097             anl     A, #03h
                   34098             Set_LED_0
0D26 7000          34099             jnz     led_0_done
                   34100             Clear_LED_0
0D28               34101     led_0_done:
0D28 E9            34102             mov     A, Temp2
0D29 540C          34103             anl     A, #0Ch
                   34104             Set_LED_1
0D2B 7000          34105             jnz     led_1_done
                   34106             Clear_LED_1
0D2D               34107     led_1_done:
0D2D E9            34108             mov     A, Temp2
0D2E 5430          34109             anl     A, #030h
                   34110             Set_LED_2
0D30 7000          34111             jnz     led_2_done
                   34112             Clear_LED_2
0D32               34113     led_2_done:
0D32 E9            34114             mov     A, Temp2
0D33 54C0          34115             anl     A, #0C0h
                   34116             Set_LED_3
0D35 7000          34117             jnz     led_3_done
                   34118             Clear_LED_3
0D37               34119     led_3_done:
0D37 22            34120             ret
                   34121     
                   34122     
                   34123     
                   34124     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   34125     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   34126     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   34127     ;
                   34128     ; Main program start
                   34129     ;
                   34130     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   34131     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   34132     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   34133     
0D38               34134     pgm_start:
                   34135             ; Initialize flash keys to invalid values
0D38 756700        34136             mov     Flash_Key_1, #0
0D3B 756800        34137             mov     Flash_Key_2, #0
                   34138             ; Disable the WDT.
0D3E 7597DE        34139             mov     WDTCN, #0DEh            ; Disable watchdog
0D41 7597AD        34140             mov     WDTCN, #0ADh            
                   34141             ; Initialize stack
0D44 7581C0        34142             mov     SP, #0c0h                       ; Stack = 64 upper bytes of RAM
                   34143             ; Initialize VDD monitor
0D47 43FF80        34144             orl     VDM0CN, #080h           ; Enable the VDD monitor
0D4A 75EF06        34145             mov     RSTSRC, #06h    ; Set missing clock and VDD monitor as a reset source if no
                             t 1S capable
                   34146             ; Set clock frequency
0D4D 75A900        34147             mov     CLKSEL, #00h            ; Set clock divider to 1
                   34148             ; Switch power off
0D50 712F          34149             call    switch_power_off
                   34150             ; Ports initialization
0D52 7580FF        34151             mov     P0, #P0_INIT
0D55 75F1D1        34152             mov     P0MDIN, #P0_DIGITAL
0D58 75A400        34153             mov     P0MDOUT, #P0_PUSHPULL
0D5B 7580FF        34154             mov     P0, #P0_INIT
0D5E 75D4FF        34155             mov     P0SKIP, #P0_SKIP                                
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   521

0D61 759007        34156             mov     P1, #P1_INIT
0D64 75F23F        34157             mov     P1MDIN, #P1_DIGITAL
0D67 75A53F        34158             mov     P1MDOUT, #P1_PUSHPULL
0D6A 759007        34159             mov     P1, #P1_INIT
0D6D 75D53F        34160             mov     P1SKIP, #P1_SKIP                                
0D70 75A601        34161             mov     P2MDOUT, #P2_PUSHPULL                           
                   34162             ; Initialize the XBAR and related functionality
                   34163             Initialize_Xbar
                   34166             ; Switch power off again, after initializing ports
0D79 712F          34167             call    switch_power_off
                   34168             ; Clear RAM
0D7B E4            34169             clr     A                               ; Clear accumulator
0D7C F8            34170             mov     Temp1, A                        ; Clear Temp1
0D7D               34171             clear_ram:      
0D7D F6            34172             mov     @Temp1, A                       ; Clear RAM
0D7E D8FD          34173             djnz Temp1, clear_ram   ; Is A not zero? - jump
                   34174             ; Set default programmed parameters
0D80 713F          34175             call    set_default_parameters
                   34176             ; Read all programmed parameters
0D82 121387        34177             call read_all_eeprom_parameters
                   34178             ; Set beep strength
0D85 7898          34179             mov     Temp1, #Pgm_Beep_Strength
0D87 8664          34180             mov     Beep_Strength, @Temp1
                   34181             ; Set initial arm variable
0D89 753001        34182             mov     Initial_Arm, #1
                   34183             ; Initializing beep
0D8C C2AF          34184             clr     IE_EA                   ; Disable interrupts explicitly
0D8E 120575        34185             call wait200ms  
0D91 51CC          34186             call beep_f1
0D93 12056D        34187             call wait30ms
0D96 51D2          34188             call beep_f2
0D98 12056D        34189             call wait30ms
0D9B 51D8          34190             call beep_f3
0D9D 12056D        34191             call wait30ms
0DA0 B120          34192             call    led_control
                   34193     
                   34194     
                   34195     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   34196     ;
                   34197     ; No signal entry point
                   34198     ;
                   34199     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0DA2               34200     init_no_signal:
                   34201             ; Disable interrupts explicitly
0DA2 C2AF          34202             clr     IE_EA
                   34203             ; Initialize flash keys to invalid values
0DA4 756700        34204             mov     Flash_Key_1, #0
0DA7 756800        34205             mov     Flash_Key_2, #0
                   34206             ; Check if input signal is high for more than 15ms
0DAA 78FA          34207             mov     Temp1, #250
0DAC               34208     input_high_check_1:
0DAC 79FA          34209             mov     Temp2, #250
0DAE               34210     input_high_check_2:
0DAE 308004        34211             jnb     RTX_PORT.RTX_PIN, bootloader_done       ; Look for low
0DB1 D9FB          34212             djnz    Temp2, input_high_check_2
0DB3 D8F7          34213             djnz    Temp1, input_high_check_1
                   34214     
                   34215     ;       ljmp    1C00h                   ; Jump to bootloader
                   34216     
0DB5               34217     bootloader_done:
                   34218             ; Decode settings
0DB5 71CA          34219             call    decode_settings
                   34220             ; Find throttle gain from stored min and max settings
0DB7 9138          34221             call    find_throttle_gains
                   34222             ; Set beep strength
0DB9 7898          34223             mov     Temp1, #Pgm_Beep_Strength
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   522

0DBB 8664          34224             mov     Beep_Strength, @Temp1
                   34225             ; Switch power off
0DBD 712F          34226             call    switch_power_off
                   34227             ; Set clock frequency
                   34228     IF MCU_48MHZ == 1
                                     Set_MCU_Clk_24MHz
                             ENDIF
                   34231             ; Setup timers for pwm input
0DBF 75E400        34232             mov     IT01CF, #RTX_PIN        ; Route RCP input to INT0
0DC2 758811        34233             mov     TCON, #11h              ; Timer 0 run and INT0 edge triggered
0DC5 758E04        34234             mov     CKCON0, #04h            ; Timer 0 clock is system clock
0DC8 758909        34235             mov     TMOD, #09h              ; Timer 0 set to 16bits and gated by INT0
0DCB 75C804        34236             mov     TMR2CN0, #04h           ; Timer 2 enabled
0DCE 759104        34237             mov     TMR3CN0, #04h           ; Timer 3 enabled
                   34238             Initialize_PCA                  ; Initialize PCA
                   34256             Set_Pwm_Polarity                ; Set pwm polarity
                   34258             Enable_Power_Pwm_Module ; Enable power pwm module
                   34264             Enable_Damp_Pwm_Module  ; Enable damping pwm module
                   34270             ; Enable interrupts
                   34271     IF MCU_48MHZ == 0
0DE6 75A821        34272             mov     IE, #21h                        ; Enable timer 2 interrupts and INT0 interr
                             upts
                   34273     ELSE
                                     mov     IE, #23h                        ; Enable timer 0, timer 2 interrupts and IN
                             T0 interrupts
                             ENDIF
0DE9 75E690        34276             mov     EIE1, #90h              ; Enable timer 3 and PCA0 interrupts
0DEC 75B801        34277             mov     IP, #01h                        ; High priority to INT0 interrupts
                   34278             ; Initialize comparator
                   34279             Initialize_Comparator   ; Initialize comparator
                   34282             ; Initialize ADC
                   34283             Initialize_Adc                  ; Initialize ADC operation
0E04 120561        34293             call    wait1ms
0E07 D2AF          34294             setb    IE_EA                   ; Enable all interrupts
                   34295             ; Reset stall count
0E09 753C00        34296             mov     Stall_Cnt, #0
                   34297             ; Initialize RC pulse
0E0C C230          34298             clr     Flags2.RCP_UPDATED                      ; Clear updated flag
0E0E 120575        34299             call wait200ms
                   34300             ; Clear all shot flags
0E11 C231          34301             clr     Flags2.RCP_ONESHOT125                   ; Clear OneShot125 flag
0E13 C232          34302             clr     Flags2.RCP_ONESHOT42                    ; Clear OneShot42 flag
0E15 C233          34303             clr     Flags2.RCP_MULTISHOT                    ; Clear Multishot flag
0E17 C234          34304             clr     Flags2.RCP_DSHOT                                ; Clear DShot flag
0E19 755200        34305             mov     Dshot_Cmd, #0                                   ; Clear Dshot command
0E1C 755300        34306             mov     Dshot_Cmd_Cnt, #0                               ; Clear Dshot command count
                   34307             ; Test whether signal is regular pwm
0E1F 752200        34308             mov     Rcp_Outside_Range_Cnt, #0               ; Reset out of range counter
0E22 120571        34309             call wait100ms                                          ; Wait for new RC pulse
0E25 C3            34310             clr     C
0E26 E522          34311             mov     A, Rcp_Outside_Range_Cnt                        ; Check how many pulses wer
                             e outside normal range ("900-2235us")
0E28 940A          34312             subb    A, #10                                          
0E2A 5002          34313             jnc     ($+4)
0E2C C1F6          34314             ajmp    validate_rcp_start
                   34315     
                   34316             ; Test whether signal is OneShot125
0E2E D231          34317             setb    Flags2.RCP_ONESHOT125                   ; Set OneShot125 flag
0E30 752200        34318             mov     Rcp_Outside_Range_Cnt, #0               ; Reset out of range counter
0E33 120571        34319             call wait100ms                                          ; Wait for new RC pulse
0E36 C3            34320             clr     C
0E37 E522          34321             mov     A, Rcp_Outside_Range_Cnt                        ; Check how many pulses wer
                             e outside normal range ("900-2235us")
0E39 940A          34322             subb    A, #10
0E3B 5002          34323             jnc     ($+4)
0E3D C1F6          34324             ajmp    validate_rcp_start
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   523

                   34325     
                   34326             ; Test whether signal is OneShot42
0E3F C231          34327             clr     Flags2.RCP_ONESHOT125
0E41 D232          34328             setb    Flags2.RCP_ONESHOT42                    ; Set OneShot42 flag
0E43 752200        34329             mov     Rcp_Outside_Range_Cnt, #0               ; Reset out of range counter
0E46 120571        34330             call wait100ms                                          ; Wait for new RC pulse
0E49 C3            34331             clr     C
0E4A E522          34332             mov     A, Rcp_Outside_Range_Cnt                        ; Check how many pulses wer
                             e outside normal range ("900-2235us")
0E4C 940A          34333             subb    A, #10
0E4E 5002          34334             jnc     ($+4)
0E50 C1F6          34335             ajmp    validate_rcp_start
                   34336     
                   34337             ; Setup timers for DShot
0E52 75E480        34338             mov     IT01CF, #(80h+(RTX_PIN SHL 4)+(RTX_PIN))        ; Route RCP input to INT0/1
                             , with INT1 inverted
0E55 758851        34339             mov     TCON, #51h              ; Timer 0/1 run and INT0 edge triggered
0E58 758E01        34340             mov     CKCON0, #01h            ; Timer 0/1 clock is system clock divided by 4 (for
                              DShot150)
0E5B 7589AA        34341             mov     TMOD, #0AAh             ; Timer 0/1 set to 8bits auto reload and gated by I
                             NT0
0E5E 758C00        34342             mov     TH0, #0                 ; Auto reload value zero
0E61 758D00        34343             mov     TH1, #0
                   34344             ; Setup interrupts for DShot
0E64 C2A9          34345             clr     IE_ET0                  ; Disable timer 0 interrupts
0E66 D2AB          34346             setb    IE_ET1                  ; Enable timer 1 interrupts
0E68 D2AA          34347             setb    IE_EX1                  ; Enable int1 interrupts
                   34348             ; Setup variables for DSshot150
                   34349     IF MCU_48MHZ == 1
                                     mov     DShot_Timer_Preset, #128                        ; Load DShot sync timer pre
                             set (for DShot150)
                             ELSE
0E6A 756BC0        34352             mov     DShot_Timer_Preset, #192
                   34353     ENDIF
0E6D 756A14        34354             mov     DShot_Pwm_Thr, #20                              ; Load DShot qualification 
                             pwm threshold (for DShot150)
0E70 756E50        34355             mov     DShot_Frame_Length_Thr, #80             ; Load DShot frame length criteria
                   34356             ; Test whether signal is DShot150
0E73 C232          34357             clr     Flags2.RCP_ONESHOT42
0E75 D234          34358             setb    Flags2.RCP_DSHOT
0E77 75220A        34359             mov     Rcp_Outside_Range_Cnt, #10              ; Set out of range counter
0E7A 120571        34360             call wait100ms                                          ; Wait for new RC pulse
0E7D 756A10        34361             mov     DShot_Pwm_Thr, #16                              ; Load DShot regular pwm th
                             reshold
0E80 C3            34362             clr     C
0E81 E522          34363             mov     A, Rcp_Outside_Range_Cnt                        ; Check if pulses were acce
                             pted
0E83 940A          34364             subb    A, #10
0E85 755200        34365             mov     Dshot_Cmd, #0
0E88 755300        34366             mov     Dshot_Cmd_Cnt, #0
0E8B 4069          34367             jc      validate_rcp_start
                   34368     
                   34369             ; Setup variables for DShot300
0E8D 758E0C        34370             mov     CKCON0, #0Ch                                    ; Timer 0/1 clock is system
                              clock (for DShot300)
                   34371     IF MCU_48MHZ == 1
                                     mov     DShot_Timer_Preset, #0                  ; Load DShot sync timer preset (for
                              DShot300)
                             ELSE
0E90 756B80        34374             mov     DShot_Timer_Preset, #128
                   34375     ENDIF
0E93 756A28        34376             mov     DShot_Pwm_Thr, #40                              ; Load DShot qualification 
                             pwm threshold (for DShot300)
0E96 756E28        34377             mov     DShot_Frame_Length_Thr, #40             ; Load DShot frame length criteria
                   34378             ; Test whether signal is DShot300
0E99 75220A        34379             mov     Rcp_Outside_Range_Cnt, #10              ; Set out of range counter
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   524

0E9C 120571        34380             call wait100ms                                          ; Wait for new RC pulse
0E9F 756A20        34381             mov     DShot_Pwm_Thr, #32                              ; Load DShot regular pwm th
                             reshold
0EA2 C3            34382             clr     C
0EA3 E522          34383             mov     A, Rcp_Outside_Range_Cnt                        ; Check if pulses were acce
                             pted
0EA5 940A          34384             subb    A, #10
0EA7 755200        34385             mov     Dshot_Cmd, #0
0EAA 755300        34386             mov     Dshot_Cmd_Cnt, #0
0EAD 4047          34387             jc      validate_rcp_start
                   34388     
                   34389             ; Setup variables for DShot600
0EAF 758E0C        34390             mov     CKCON0, #0Ch                                    ; Timer 0/1 clock is system
                              clock (for DShot600)
                   34391     IF MCU_48MHZ == 1
                                     mov     DShot_Timer_Preset, #128                        ; Load DShot sync timer pre
                             set (for DShot600)
                             ELSE
0EB2 756BC0        34394             mov     DShot_Timer_Preset, #192
                   34395     ENDIF
0EB5 756A14        34396             mov     DShot_Pwm_Thr, #20                              ; Load DShot qualification 
                             pwm threshold (for DShot600)
0EB8 756E14        34397             mov     DShot_Frame_Length_Thr, #20             ; Load DShot frame length criteria
                   34398             ; Test whether signal is DShot600
0EBB 75220A        34399             mov     Rcp_Outside_Range_Cnt, #10              ; Set out of range counter
0EBE 120571        34400             call wait100ms                                          ; Wait for new RC pulse
0EC1 756A10        34401             mov     DShot_Pwm_Thr, #16                              ; Load DShot regular pwm th
                             reshold
0EC4 C3            34402             clr     C
0EC5 E522          34403             mov     A, Rcp_Outside_Range_Cnt                        ; Check if pulses were acce
                             pted
0EC7 940A          34404             subb    A, #10
0EC9 755200        34405             mov     Dshot_Cmd, #0
0ECC 755300        34406             mov     Dshot_Cmd_Cnt, #0
0ECF 4025          34407             jc      validate_rcp_start
                   34408     
                   34409             ; Setup timers for Multishot
0ED1 75E400        34410             mov     IT01CF, #RTX_PIN        ; Route RCP input to INT0
0ED4 758811        34411             mov     TCON, #11h              ; Timer 0 run and INT0 edge triggered
0ED7 758E04        34412             mov     CKCON0, #04h            ; Timer 0 clock is system clock
0EDA 758909        34413             mov     TMOD, #09h              ; Timer 0 set to 16bits and gated by INT0
                   34414             ; Setup interrupts for Multishot
0EDD D2A9          34415             setb    IE_ET0                  ; Enable timer 0 interrupts
0EDF C2AB          34416             clr     IE_ET1                  ; Disable timer 1 interrupts
0EE1 C2AA          34417             clr     IE_EX1                  ; Disable int1 interrupts
                   34418             ; Test whether signal is Multishot
0EE3 C234          34419             clr     Flags2.RCP_DSHOT
0EE5 D233          34420             setb    Flags2.RCP_MULTISHOT                    ; Set Multishot flag
0EE7 752200        34421             mov     Rcp_Outside_Range_Cnt, #0               ; Reset out of range counter
0EEA 120571        34422             call wait100ms                                          ; Wait for new RC pulse
0EED C3            34423             clr     C
0EEE E522          34424             mov     A, Rcp_Outside_Range_Cnt                        ; Check how many pulses wer
                             e outside normal range ("900-2235us")
0EF0 940A          34425             subb    A, #10
0EF2 4002          34426             jc      validate_rcp_start
                   34427     
0EF4 A1A2          34428             ajmp    init_no_signal
                   34429     
0EF6               34430     validate_rcp_start:
                   34431             ; Validate RC pulse
0EF6 120565        34432             call wait3ms                                            ; Wait for new RC pulse
0EF9 203003        34433             jb      Flags2.RCP_UPDATED, ($+6)               ; Is there an updated RC pulse avai
                             lable - proceed
0EFC 020DA2        34434             ljmp    init_no_signal                                  ; Go back to detect input s
                             ignal
                   34435     
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   525

                   34436             ; Beep arm sequence start signal
0EFF C2AF          34437             clr     IE_EA                                           ; Disable all interrupts
0F01 51CC          34438             call beep_f1                                            ; Signal that RC pulse is r
                             eady
0F03 51CC          34439             call beep_f1
0F05 51CC          34440             call beep_f1
0F07 D2AF          34441             setb    IE_EA                                           ; Enable all interrupts
0F09 120575        34442             call wait200ms  
                   34443     
                   34444             ; Arming sequence start
0F0C               34445     arming_start:
0F0C 203403        34446             jb      Flags2.RCP_DSHOT, ($+6) ; Disable tx programming for DShot
0F0F 303A03        34447             jnb     Flags3.PGM_BIDIR, ($+6)
                   34448     
0F12 020FB4        34449             ljmp    program_by_tx_checked   ; Disable tx programming if bidirectional operation
                   34450     
0F15 120565        34451             call wait3ms
0F18 788C          34452             mov     Temp1, #Pgm_Enable_TX_Program; Start programming mode entry if enabled
0F1A E6            34453             mov     A, @Temp1                               
0F1B C3            34454             clr     C
0F1C 9401          34455             subb    A, #1                           ; Is TX programming enabled?
0F1E 5002          34456             jnc     arming_initial_arm_check        ; Yes - proceed
                   34457     
0F20 E1B4          34458             jmp     program_by_tx_checked   ; No - branch
                   34459     
0F22               34460     arming_initial_arm_check:
0F22 E530          34461             mov     A, Initial_Arm                  ; Yes - check if it is initial arm sequence
0F24 C3            34462             clr     C
0F25 9401          34463             subb    A, #1                           ; Is it the initial arm sequence?
0F27 5002          34464             jnc     arming_check                    ; Yes - proceed
                   34465     
0F29 E1B4          34466             jmp     program_by_tx_checked   ; No - branch
                   34467     
0F2B               34468     arming_check:
                   34469             ; Initialize flash keys to valid values
0F2B 7567A5        34470             mov     Flash_Key_1, #0A5h
0F2E 7568F1        34471             mov     Flash_Key_2, #0F1h
                   34472             ; Throttle calibration and tx program entry
0F31 7F02          34473             mov     Temp8, #2                               ; Set 1 seconds wait time
0F33               34474     throttle_high_cal:                      
0F33 D236          34475             setb    Flags2.RCP_FULL_RANGE   ; Set range to 1000-2020us
0F35 9138          34476             call    find_throttle_gains             ; Set throttle gains
0F37 120571        34477             call wait100ms                          ; Wait for new throttle value
0F3A C2AF          34478             clr     IE_EA                           ; Disable interrupts (freeze New_Rcp value)
0F3C C236          34479             clr     Flags2.RCP_FULL_RANGE   ; Set programmed range
0F3E 9138          34480             call    find_throttle_gains             ; Set throttle gains
0F40 C3            34481             clr     C
0F41 E554          34482             mov     A, New_Rcp                      ; Load new RC pulse value
0F43 947F          34483             subb    A, #(255/2)                     ; Is RC pulse above midstick?
0F45 D2AF          34484             setb    IE_EA                           ; Enable interrupts
0F47 406B          34485             jc      program_by_tx_checked   ; No - branch
                   34486     
0F49 120561        34487             call wait1ms            
0F4C C2AF          34488             clr     IE_EA                           ; Disable all interrupts
0F4E 51DE          34489             call beep_f4
0F50 D2AF          34490             setb    IE_EA                           ; Enable all interrupts
0F52 DFDF          34491             djnz    Temp8, throttle_high_cal        ; Continue to wait
                   34492     
0F54 91ED          34493             call    average_throttle
0F56 C3            34494             clr     C
0F57 EF            34495             mov     A, Temp8
0F58 7897          34496             mov     Temp1, #Pgm_Max_Throttle        ; Store
0F5A F6            34497             mov     @Temp1, A                       
0F5B 120575        34498             call wait200ms                          
0F5E 121474        34499             call    success_beep
                   34500     
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   526

0F61               34501     throttle_low_cal_start:
0F61 7F0A          34502             mov     Temp8, #10                      ; Set 3 seconds wait time
0F63               34503     throttle_low_cal:                       
0F63 D236          34504             setb    Flags2.RCP_FULL_RANGE   ; Set range to 1000-2020us
0F65 9138          34505             call    find_throttle_gains             ; Set throttle gains
0F67 120571        34506             call wait100ms
0F6A C2AF          34507             clr     IE_EA                           ; Disable interrupts (freeze New_Rcp value)
0F6C C236          34508             clr     Flags2.RCP_FULL_RANGE   ; Set programmed range
0F6E 9138          34509             call    find_throttle_gains             ; Set throttle gains
0F70 C3            34510             clr     C
0F71 E554          34511             mov     A, New_Rcp                      ; Load new RC pulse value
0F73 947F          34512             subb    A, #(255/2)                     ; Below midstick?
0F75 D2AF          34513             setb    IE_EA                           ; Enable interrupts
0F77 50E8          34514             jnc     throttle_low_cal_start  ; No - start over
                   34515     
0F79 120561        34516             call wait1ms            
0F7C C2AF          34517             clr     IE_EA                           ; Disable all interrupts
0F7E 51CC          34518             call beep_f1
0F80 120569        34519             call wait10ms
0F83 51CC          34520             call beep_f1
0F85 D2AF          34521             setb    IE_EA                           ; Enable all interrupts
0F87 DFDA          34522             djnz    Temp8, throttle_low_cal ; Continue to wait
                   34523     
0F89 91ED          34524             call    average_throttle
0F8B EF            34525             mov     A, Temp8
0F8C 2403          34526             add     A, #3                           ; Add about 1%
0F8E 7896          34527             mov     Temp1, #Pgm_Min_Throttle        ; Store
0F90 F6            34528             mov     @Temp1, A                       
0F91 F8            34529             mov     Temp1, A                                ; Min throttle in Temp1
0F92 7997          34530             mov     Temp2, #Pgm_Max_Throttle
0F94 E7            34531             mov     A, @Temp2
0F95 C3            34532             clr     C
0F96 9423          34533             subb    A, #35                          ; Subtract 35 (140us) from max throttle
0F98 4003          34534             jc      program_by_tx_entry_limit
0F9A 98            34535             subb    A, Temp1                                ; Subtract min from max
0F9B 5006          34536             jnc     program_by_tx_entry_store
                   34537     
0F9D               34538     program_by_tx_entry_limit:
0F9D E8            34539             mov     A, Temp1                                ; Load min
0F9E 2423          34540             add     A, #35                          ; Make max 140us higher than min
0FA0 7897          34541             mov     Temp1, #Pgm_Max_Throttle        ; Store new max
0FA2 F6            34542             mov     @Temp1, A
                   34543     
0FA3               34544     program_by_tx_entry_store:
0FA3 120575        34545             call wait200ms                          
0FA6 1213CE        34546             call erase_and_store_all_in_eeprom      
0FA9 1214A3        34547             call    success_beep_inverted
                   34548     
0FAC               34549     program_by_tx_entry_wait:
0FAC 120571        34550             call wait100ms
0FAF 9138          34551             call    find_throttle_gains             ; Set throttle gains
0FB1 020DA2        34552             ljmp    init_no_signal                  ; Go back
                   34553     
0FB4               34554     program_by_tx_checked:
                   34555             ; Initialize flash keys to invalid values
0FB4 756700        34556             mov     Flash_Key_1, #0
0FB7 756800        34557             mov     Flash_Key_2, #0
0FBA 120571        34558             call wait100ms                          ; Wait for new throttle value
0FBD C3            34559             clr     C
0FBE E554          34560             mov     A, New_Rcp                      ; Load new RC pulse value
0FC0 9401          34561             subb    A, #1                           ; Below stop?
0FC2 4002          34562             jc      arm_end_beep                    ; Yes - proceed
                   34563     
0FC4 E10C          34564             jmp     arming_start                    ; No - start over
                   34565     
0FC6               34566     arm_end_beep:
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   527

                   34567             ; Beep arm sequence end signal
0FC6 C2AF          34568             clr     IE_EA                           ; Disable all interrupts
0FC8 51DE          34569             call beep_f4                            ; Signal that rcpulse is ready
0FCA 51DE          34570             call beep_f4
0FCC 51DE          34571             call beep_f4
0FCE D2AF          34572             setb    IE_EA                           ; Enable all interrupts
0FD0 120575        34573             call wait200ms
                   34574     
                   34575             ; Clear initial arm variable
0FD3 753000        34576             mov     Initial_Arm, #0
                   34577     
                   34578             ; Armed and waiting for power on
0FD6               34579     wait_for_power_on:
0FD6 E4            34580             clr     A
0FD7 F537          34581             mov     Power_On_Wait_Cnt_L, A  ; Clear wait counter
0FD9 F538          34582             mov     Power_On_Wait_Cnt_H, A  
0FDB               34583     wait_for_power_on_loop:
0FDB 0537          34584             inc     Power_On_Wait_Cnt_L             ; Increment low wait counter
0FDD E537          34585             mov     A, Power_On_Wait_Cnt_L
0FDF F4            34586             cpl     A
0FE0 703F          34587             jnz     wait_for_power_on_no_beep; Counter wrapping (about 3 sec)
                   34588     
0FE2 0538          34589             inc     Power_On_Wait_Cnt_H             ; Increment high wait counter
0FE4 789A          34590             mov     Temp1, #Pgm_Beacon_Delay
0FE6 E6            34591             mov     A, @Temp1
0FE7 7819          34592             mov     Temp1, #25              ; Approximately 1 min
0FE9 14            34593             dec     A
0FEA 6012          34594             jz      beep_delay_set
                   34595     
0FEC 7832          34596             mov     Temp1, #50              ; Approximately 2 min
0FEE 14            34597             dec     A
0FEF 600D          34598             jz      beep_delay_set
                   34599     
0FF1 787D          34600             mov     Temp1, #125             ; Approximately 5 min
0FF3 14            34601             dec     A
0FF4 6008          34602             jz      beep_delay_set
                   34603     
0FF6 78FA          34604             mov     Temp1, #250             ; Approximately 10 min
0FF8 14            34605             dec     A
0FF9 6003          34606             jz      beep_delay_set
                   34607     
0FFB 753800        34608             mov     Power_On_Wait_Cnt_H, #0         ; Reset counter for infinite delay
                   34609     
0FFE               34610     beep_delay_set:
0FFE C3            34611             clr     C
0FFF E538          34612             mov     A, Power_On_Wait_Cnt_H
1001 98            34613             subb    A, Temp1                                ; Check against chosen delay
1002 401D          34614             jc      wait_for_power_on_no_beep; Has delay elapsed?
                   34615     
1004 120B2F        34616             call    switch_power_off                ; Switch power off in case braking is set
1007 120561        34617             call    wait1ms
100A 1538          34618             dec     Power_On_Wait_Cnt_H             ; Decrement high wait counter
100C 753700        34619             mov     Power_On_Wait_Cnt_L, #0 ; Set low wait counter
100F 7899          34620             mov     Temp1, #Pgm_Beacon_Strength
1011 8664          34621             mov     Beep_Strength, @Temp1
1013 C2AF          34622             clr     IE_EA                           ; Disable all interrupts
1015 120ADE        34623             call beep_f4                            ; Signal that there is no signal
1018 D2AF          34624             setb    IE_EA                           ; Enable all interrupts
101A 7898          34625             mov     Temp1, #Pgm_Beep_Strength
101C 8664          34626             mov     Beep_Strength, @Temp1
101E 120571        34627             call wait100ms                          ; Wait for new RC pulse to be measured
                   34628     
1021               34629     wait_for_power_on_no_beep:
1021 120569        34630             call wait10ms
1024 E523          34631             mov     A, Rcp_Timeout_Cntd                     ; Load RC pulse timeout counter val
                             ue
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   528

1026 7003          34632             jnz     wait_for_power_on_not_missing   ; If it is not zero - proceed
                   34633     
1028 020DA2        34634             jmp     init_no_signal                          ; If pulses missing - go back to de
                             tect input signal
                   34635     
102B               34636     wait_for_power_on_not_missing:
102B C3            34637             clr     C
102C E554          34638             mov     A, New_Rcp                      ; Load new RC pulse value
102E 9401          34639             subb    A, #1                           ; Higher than stop
1030 500A          34640             jnc     wait_for_power_on_nonzero       ; Yes - proceed
                   34641     
1032 C3            34642             clr     C
1033 E552          34643             mov     A, Dshot_Cmd
1035 9401          34644             subb    A, #1                           ; 1 or higher
1037 5016          34645             jnc     check_dshot_cmd         ; Check Dshot command
                   34646     
1039 020FDB        34647             ljmp    wait_for_power_on_loop  ; If not Dshot command - start over
                   34648     
103C               34649     wait_for_power_on_nonzero:
103C 120571        34650             lcall wait100ms                 ; Wait to see if start pulse was only a glitch
103F E523          34651             mov     A, Rcp_Timeout_Cntd             ; Load RC pulse timeout counter value
1041 7003          34652             jnz     ($+5)                           ; If it is not zero - proceed
1043 020DA2        34653             ljmp    init_no_signal                  ; If it is zero (pulses missing) - go back 
                             to detect input signal
                   34654     
1046 755200        34655             mov     Dshot_Cmd, #0
1049 755300        34656             mov     Dshot_Cmd_Cnt, #0
104C 0211F1        34657             ljmp init_start
                   34658     
104F               34659     check_dshot_cmd:
104F C3            34660             clr     C
1050 E552          34661             mov     A, Dshot_Cmd
1052 9401          34662             subb A, #1
1054 7017          34663             jnz     dshot_beep_2
                   34664     
1056 C2AF          34665             clr     IE_EA
1058 120B2F        34666             call    switch_power_off                ; Switch power off in case braking is set
105B 7899          34667             mov     Temp1, #Pgm_Beacon_Strength
105D 8664          34668             mov     Beep_Strength, @Temp1
105F 120ACC        34669             call beep_f1
1062 7898          34670             mov     Temp1, #Pgm_Beep_Strength
1064 8664          34671             mov     Beep_Strength, @Temp1
1066 D2AF          34672             setb    IE_EA   
1068 120571        34673             call wait100ms  
106B 21E3          34674             jmp     clear_dshot_cmd
                   34675     
106D               34676     dshot_beep_2:   
106D C3            34677             clr     C
106E E552          34678             mov     A, Dshot_Cmd
1070 9402          34679             subb A, #2
1072 7017          34680             jnz     dshot_beep_3
                   34681     
1074 C2AF          34682             clr     IE_EA
1076 120B2F        34683             call    switch_power_off                ; Switch power off in case braking is set
1079 7899          34684             mov     Temp1, #Pgm_Beacon_Strength
107B 8664          34685             mov     Beep_Strength, @Temp1
107D 120AD2        34686             call beep_f2
1080 7898          34687             mov     Temp1, #Pgm_Beep_Strength
1082 8664          34688             mov     Beep_Strength, @Temp1
1084 D2AF          34689             setb    IE_EA   
1086 120571        34690             call wait100ms  
1089 21E3          34691             jmp     clear_dshot_cmd
                   34692     
108B               34693     dshot_beep_3:           
108B C3            34694             clr     C
108C E552          34695             mov     A, Dshot_Cmd
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   529

108E 9403          34696             subb A, #3
1090 7017          34697             jnz     dshot_beep_4
                   34698     
1092 C2AF          34699             clr     IE_EA
1094 120B2F        34700             call    switch_power_off                ; Switch power off in case braking is set
1097 7899          34701             mov     Temp1, #Pgm_Beacon_Strength
1099 8664          34702             mov     Beep_Strength, @Temp1
109B 120AD8        34703             call beep_f3
109E 7898          34704             mov     Temp1, #Pgm_Beep_Strength
10A0 8664          34705             mov     Beep_Strength, @Temp1
10A2 D2AF          34706             setb    IE_EA   
10A4 120571        34707             call wait100ms  
10A7 21E3          34708             jmp     clear_dshot_cmd
                   34709     
10A9               34710     dshot_beep_4:
10A9 C3            34711             clr     C
10AA E552          34712             mov     A, Dshot_Cmd
10AC 9404          34713             subb A, #4
10AE 7017          34714             jnz     dshot_beep_5
                   34715     
10B0 C2AF          34716             clr     IE_EA
10B2 120B2F        34717             call    switch_power_off                ; Switch power off in case braking is set
10B5 7899          34718             mov     Temp1, #Pgm_Beacon_Strength
10B7 8664          34719             mov     Beep_Strength, @Temp1
10B9 120ADE        34720             call beep_f4
10BC 7898          34721             mov     Temp1, #Pgm_Beep_Strength
10BE 8664          34722             mov     Beep_Strength, @Temp1
10C0 D2AF          34723             setb    IE_EA   
10C2 120571        34724             call wait100ms          
10C5 21E3          34725             jmp     clear_dshot_cmd
                   34726     
10C7               34727     dshot_beep_5:
10C7 C3            34728             clr     C
10C8 E552          34729             mov     A, Dshot_Cmd
10CA 9405          34730             subb A, #5
10CC 7017          34731             jnz     dshot_direction_1
                   34732     
10CE C2AF          34733             clr     IE_EA
10D0 120B2F        34734             call    switch_power_off                ; Switch power off in case braking is set
10D3 7899          34735             mov     Temp1, #Pgm_Beacon_Strength
10D5 8664          34736             mov     Beep_Strength, @Temp1
10D7 120ADE        34737             call beep_f4
10DA 7898          34738             mov     Temp1, #Pgm_Beep_Strength
10DC 8664          34739             mov     Beep_Strength, @Temp1
10DE D2AF          34740             setb    IE_EA   
10E0 120571        34741             call wait100ms  
10E3 21E3          34742             jmp     clear_dshot_cmd
                   34743     
10E5               34744     dshot_direction_1:
10E5 C3            34745             clr     C
10E6 E552          34746             mov     A, Dshot_Cmd
10E8 9407          34747             subb A, #7
10EA 7019          34748             jnz     dshot_direction_2
                   34749     
10EC C3            34750             clr     C
10ED E553          34751             mov     A, Dshot_Cmd_Cnt
10EF 9406          34752             subb A, #6                                      ; Needs to receive it 6 times in a 
                             row
10F1 5002          34753             jnc     ($+4)                                   ; Same as "jc dont_clear_dshot_cmd"
10F3 012B          34754             ajmp wait_for_power_on_not_missing
                   34755     
10F5 7401          34756             mov     A, #1
10F7 303A02        34757             jnb     Flags3.PGM_BIDIR, ($+5)
10FA 7403          34758             mov     A, #3
10FC 7888          34759             mov     Temp1, #Pgm_Direction
10FE F6            34760             mov     @Temp1, A
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   530

10FF C238          34761             clr     Flags3.PGM_DIR_REV
1101 C239          34762             clr     Flags3.PGM_BIDIR_REV
1103 21E3          34763             jmp     clear_dshot_cmd
                   34764     
1105               34765     dshot_direction_2:
1105 C3            34766             clr     C
1106 E552          34767             mov     A, Dshot_Cmd
1108 9408          34768             subb A, #8
110A 7019          34769             jnz     dshot_direction_bidir_off
                   34770     
110C C3            34771             clr     C
110D E553          34772             mov     A, Dshot_Cmd_Cnt
110F 9406          34773             subb A, #6                                      ; Needs to receive it 6 times in a 
                             row
1111 5002          34774             jnc     ($+4)                                   ; Same as "jc dont_clear_dshot_cmd"
1113 012B          34775             ajmp wait_for_power_on_not_missing
                   34776     
1115 7402          34777             mov     A, #2
1117 303A02        34778             jnb     Flags3.PGM_BIDIR, ($+5)
111A 7404          34779             mov     A, #4
111C 7888          34780             mov     Temp1, #Pgm_Direction
111E F6            34781             mov     @Temp1, A
111F D238          34782             setb Flags3.PGM_DIR_REV
1121 D239          34783             setb Flags3.PGM_BIDIR_REV
1123 21E3          34784             jmp     clear_dshot_cmd
                   34785     
1125               34786     dshot_direction_bidir_off:
1125 C3            34787             clr     C
1126 E552          34788             mov     A, Dshot_Cmd
1128 9409          34789             subb A, #9
112A 7017          34790             jnz     dshot_direction_bidir_on
                   34791     
112C C3            34792             clr     C
112D E553          34793             mov     A, Dshot_Cmd_Cnt
112F 9406          34794             subb A, #6                                      ; Needs to receive it 6 times in a 
                             row
1131 5002          34795             jnc     ($+4)                                   ; Same as "jc dont_clear_dshot_cmd"
1133 012B          34796             ajmp wait_for_power_on_not_missing
                   34797     
1135 303A0B        34798             jnb     Flags3.PGM_BIDIR, dshot_direction_bidir_on
                   34799     
1138 C3            34800             clr     C
1139 7888          34801             mov     Temp1, #Pgm_Direction
113B E6            34802             mov     A, @Temp1
113C 9402          34803             subb    A, #2
113E F6            34804             mov     @Temp1, A
113F C23A          34805             clr     Flags3.PGM_BIDIR
1141 21E3          34806             jmp     clear_dshot_cmd
                   34807     
1143               34808     dshot_direction_bidir_on:
1143 C3            34809             clr     C
1144 E552          34810             mov     A, Dshot_Cmd
1146 940A          34811             subb A, #10
1148 7016          34812             jnz     dshot_direction_normal
                   34813     
114A C3            34814             clr     C
114B E553          34815             mov     A, Dshot_Cmd_Cnt
114D 9406          34816             subb A, #6                                      ; Needs to receive it 6 times in a 
                             row
114F 5002          34817             jnc     ($+4)                                   ; Same as "jc dont_clear_dshot_cmd"
1151 012B          34818             ajmp wait_for_power_on_not_missing
                   34819     
1153 203A0A        34820             jb      Flags3.PGM_BIDIR, dshot_direction_normal
                   34821     
1156 7888          34822             mov     Temp1, #Pgm_Direction
1158 E6            34823             mov     A, @Temp1
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   531

1159 2402          34824             add     A, #2
115B F6            34825             mov     @Temp1, A
115C D23A          34826             setb    Flags3.PGM_BIDIR
115E 21E3          34827             jmp     clear_dshot_cmd
                   34828     
1160               34829     dshot_direction_normal: 
1160 C3            34830             clr     C
1161 E552          34831             mov     A, Dshot_Cmd
1163 9414          34832             subb A, #20
1165 7025          34833             jnz     dshot_direction_reverse
                   34834     
1167 C3            34835             clr     C
1168 E553          34836             mov     A, Dshot_Cmd_Cnt
116A 9406          34837             subb A, #6                                      ; Needs to receive it 6 times in a 
                             row
116C 5002          34838             jnc     ($+4)                                   ; Same as "jc dont_clear_dshot_cmd"
116E 012B          34839             ajmp wait_for_power_on_not_missing
                   34840     
1170 C2AF          34841             clr     IE_EA                                   ; DPTR used in interrupts
1172 901A0B        34842             mov     DPTR, #Eep_Pgm_Direction                ; Read from flash
1175 7400          34843             mov     A, #0
1177 93            34844             movc    A, @A+DPTR
1178 D2AF          34845             setb    IE_EA
117A 7888          34846             mov     Temp1, #Pgm_Direction
117C F6            34847             mov     @Temp1, A
117D 13            34848             rrc     A                                               ; Lsb to carry
117E C238          34849             clr     Flags3.PGM_DIR_REV
1180 C239          34850             clr     Flags3.PGM_BIDIR_REV
1182 4002          34851             jc      ($+4)
1184 D238          34852             setb    Flags3.PGM_DIR_REV
1186 4002          34853             jc      ($+4)
1188 D239          34854             setb    Flags3.PGM_BIDIR_REV
118A 8057          34855             jmp     clear_dshot_cmd
                   34856     
118C               34857     dshot_direction_reverse:                        ; Temporary reverse
118C C3            34858             clr     C
118D E552          34859             mov     A, Dshot_Cmd
118F 9415          34860             subb A, #21
1191 7038          34861             jnz     dshot_save_settings
                   34862     
1193 C3            34863             clr     C
1194 E553          34864             mov     A, Dshot_Cmd_Cnt
1196 9406          34865             subb A, #6                                      ; Needs to receive it 6 times in a 
                             row
1198 404F          34866             jc      dont_clear_dshot_cmd
                   34867             
119A C2AF          34868             clr     IE_EA                                   ; DPTR used in interrupts
119C 901A0B        34869             mov     DPTR, #Eep_Pgm_Direction                ; Read from flash
119F 7400          34870             mov     A, #0
11A1 93            34871             movc    A, @A+DPTR
11A2 D2AF          34872             setb    IE_EA
11A4 F8            34873             mov     Temp1, A
11A5 B80102        34874             cjne    Temp1, #1, ($+5)
11A8 7402          34875             mov     A, #2
11AA B80202        34876             cjne    Temp1, #2, ($+5)
11AD 7401          34877             mov     A, #1
11AF B80302        34878             cjne    Temp1, #3, ($+5)
11B2 7404          34879             mov     A, #4
11B4 B80402        34880             cjne    Temp1, #4, ($+5)
11B7 7403          34881             mov     A, #3
11B9 7888          34882             mov     Temp1, #Pgm_Direction
11BB F6            34883             mov     @Temp1, A
11BC 13            34884             rrc     A                                               ; Lsb to carry
11BD C238          34885             clr     Flags3.PGM_DIR_REV
11BF C239          34886             clr     Flags3.PGM_BIDIR_REV
11C1 4002          34887             jc      ($+4)
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   532

11C3 D238          34888             setb    Flags3.PGM_DIR_REV
11C5 4002          34889             jc      ($+4)
11C7 D239          34890             setb    Flags3.PGM_BIDIR_REV
11C9 8018          34891             jmp     clear_dshot_cmd
                   34892     
11CB               34893     dshot_save_settings:
11CB C3            34894             clr     C
11CC E552          34895             mov     A, Dshot_Cmd
11CE 940C          34896             subb A, #12
11D0 7011          34897             jnz     clear_dshot_cmd
                   34898     
11D2 7567A5        34899             mov     Flash_Key_1, #0A5h                      ; Initialize flash keys to valid va
                             lues
11D5 7568F1        34900             mov     Flash_Key_2, #0F1h
11D8 C3            34901             clr     C
11D9 E553          34902             mov     A, Dshot_Cmd_Cnt
11DB 9406          34903             subb A, #6                                      ; Needs to receive it 6 times in a 
                             row
11DD 400A          34904             jc      dont_clear_dshot_cmd
                   34905     
11DF 71CE          34906             call erase_and_store_all_in_eeprom
11E1 D2AF          34907             setb    IE_EA
                   34908             
11E3               34909     clear_dshot_cmd:
11E3 755200        34910             mov     Dshot_Cmd, #0
11E6 755300        34911             mov     Dshot_Cmd_Cnt, #0
                   34912     
11E9               34913     dont_clear_dshot_cmd:
11E9 756700        34914             mov     Flash_Key_1, #0                 ; Initialize flash keys to invalid values
11EC 756800        34915             mov     Flash_Key_2, #0
11EF 012B          34916             jmp     wait_for_power_on_not_missing
                   34917     
                   34918     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   34919     ;
                   34920     ; Start entry point
                   34921     ;
                   34922     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
11F1               34923     init_start:
11F1 C2AF          34924             clr     IE_EA
11F3 120B2F        34925             call switch_power_off
11F6 E4            34926             clr     A
11F7 D2AF          34927             setb    IE_EA
11F9 E4            34928             clr     A
11FA F55E          34929             mov     Adc_Conversion_Cnt, A
11FC F524          34930             mov     Flags0, A                               ; Clear flags0
11FE F525          34931             mov     Flags1, A                               ; Clear flags1
1200 F53D          34932             mov     Demag_Detected_Metric, A        ; Clear demag metric
                   34933             ;**** **** **** **** ****
                   34934             ; Motor start beginning
                   34935             ;**** **** **** **** **** 
1202 755E08        34936             mov     Adc_Conversion_Cnt, #8                          ; Make sure a temp reading 
                             is done
1205 120561        34937             call wait1ms
1208 1205CA        34938             call start_adc_conversion
120B               34939     read_initial_temp:
120B 30EDFD        34940             jnb     ADC0CN0_ADINT, read_initial_temp
                   34941             Read_Adc_Result                                         ; Read initial temperature
1212 E9            34944             mov     A, Temp2
1213 7001          34945             jnz     ($+3)                                                   ; Is reading below 
                             256?
                   34946     
1215 F8            34947             mov     Temp1, A                                                        ; Yes - set
                              average temperature value to zero
                   34948     
1216 885F          34949             mov     Current_Average_Temp, Temp1                     ; Set initial average tempe
                             rature
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   533

1218 1205CE        34950             call check_temp_voltage_and_limit_power
121B 755E08        34951             mov     Adc_Conversion_Cnt, #8                          ; Make sure a temp reading 
                             is done next time
                   34952             ; Set up start operating conditions
121E C2AF          34953             clr     IE_EA                           ; Disable interrupts
1220 120635        34954             call set_startup_pwm
1223 855D5B        34955             mov     Pwm_Limit, Pwm_Limit_Beg
1226 855D5C        34956             mov     Pwm_Limit_By_Rpm, Pwm_Limit_Beg
1229 D2AF          34957             setb    IE_EA
                   34958             ; Begin startup sequence
                   34959     IF MCU_48MHZ == 1
                                     Set_MCU_Clk_48MHz
                             ENDIF
122B 303A07        34962             jnb     Flags3.PGM_BIDIR, init_start_bidir_done ; Check if bidirectional operation
                   34963     
122E C238          34964             clr     Flags3.PGM_DIR_REV                      ; Set spinning direction. Default f
                             wd
1230 303502        34965             jnb     Flags2.RCP_DIR_REV, ($+5)       ; Check force direction
1233 D238          34966             setb    Flags3.PGM_DIR_REV                      ; Set spinning direction
                   34967     
1235               34968     init_start_bidir_done:
1235 D228          34969             setb    Flags1.STARTUP_PHASE            ; Set startup phase flag
1237 753900        34970             mov     Startup_Cnt, #0                 ; Reset counter
123A 120A87        34971             call comm5comm6                         ; Initialize commutation
123D 120AAA        34972             call comm6comm1                         
1240 120644        34973             call initialize_timing                  ; Initialize timing
1243 12064B        34974             call    calc_next_comm_timing           ; Set virtual commutation point
1246 120644        34975             call initialize_timing                  ; Initialize timing
1249 12064B        34976             call    calc_next_comm_timing           
124C 120644        34977             call    initialize_timing                       ; Initialize timing
                   34978     
                   34979     
                   34980     
                   34981     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   34982     ;
                   34983     ; Run entry point
                   34984     ;
                   34985     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   34986     
                   34987     ; Run 1 = B(p-on) + C(n-pwm) - comparator A evaluated
                   34988     ; Out_cA changes from low to high
124F               34989     run1:
124F 1208C2        34990             call wait_for_comp_out_high     ; Wait for high
                   34991     ;               setup_comm_wait         ; Setup wait time from zero cross to commutation
                   34992     ;               evaluate_comparator_integrity   ; Check whether comparator reading has been
                              normal
1252 1209B3        34993             call wait_for_comm                      ; Wait from zero cross to commutation
1255 1209FB        34994             call comm1comm2                 ; Commutate
1258 12064B        34995             call calc_next_comm_timing      ; Calculate next timing and wait advance timing wait
                   34996     ;               wait_advance_timing             ; Wait advance timing and start zero cross 
                             wait
                   34997     ;               calc_new_wait_times
                   34998     ;               wait_before_zc_scan             ; Wait zero cross wait and start zero cross
                              timeout
                   34999     
                   35000     ; Run 2 = A(p-on) + C(n-pwm) - comparator B evaluated
                   35001     ; Out_cB changes from high to low
125B               35002     run2:
125B 1208B2        35003             call wait_for_comp_out_low
                   35004     ;               setup_comm_wait
                   35005     ;               evaluate_comparator_integrity
125E 202C03        35006             jb      Flags1.HIGH_RPM, ($+6)  ; Skip if high rpm
1261 120584        35007             lcall set_pwm_limit_low_rpm
1264 302C03        35008             jnb     Flags1.HIGH_RPM, ($+6)  ; Do if high rpm
1267 1205B4        35009             lcall set_pwm_limit_high_rpm
126A 1209B3        35010             call wait_for_comm
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   534

126D 120A1E        35011             call comm2comm3
1270 12064B        35012             call calc_next_comm_timing
                   35013     ;               wait_advance_timing
                   35014     ;               calc_new_wait_times
                   35015     ;               wait_before_zc_scan
                   35016     
                   35017     ; Run 3 = A(p-on) + B(n-pwm) - comparator C evaluated
                   35018     ; Out_cC changes from low to high
1273               35019     run3:
1273 1208C2        35020             call wait_for_comp_out_high
                   35021     ;               setup_comm_wait
                   35022     ;               evaluate_comparator_integrity
1276 1209B3        35023             call wait_for_comm
1279 120A41        35024             call comm3comm4
127C 12064B        35025             call calc_next_comm_timing
                   35026     ;               wait_advance_timing
                   35027     ;               calc_new_wait_times
                   35028     ;               wait_before_zc_scan
                   35029     
                   35030     ; Run 4 = C(p-on) + B(n-pwm) - comparator A evaluated
                   35031     ; Out_cA changes from high to low
127F               35032     run4:
127F 1208B2        35033             call wait_for_comp_out_low
                   35034     ;               setup_comm_wait
                   35035     ;               evaluate_comparator_integrity
1282 1209B3        35036             call wait_for_comm
1285 120A64        35037             call comm4comm5
1288 12064B        35038             call calc_next_comm_timing
                   35039     ;               wait_advance_timing
                   35040     ;               calc_new_wait_times
                   35041     ;               wait_before_zc_scan
                   35042     
                   35043     ; Run 5 = C(p-on) + A(n-pwm) - comparator B evaluated
                   35044     ; Out_cB changes from low to high
128B               35045     run5:
128B 1208C2        35046             call wait_for_comp_out_high
                   35047     ;               setup_comm_wait
                   35048     ;               evaluate_comparator_integrity
128E 1209B3        35049             call wait_for_comm
1291 120A87        35050             call comm5comm6
1294 12064B        35051             call calc_next_comm_timing
                   35052     ;               wait_advance_timing
                   35053     ;               calc_new_wait_times
                   35054     ;               wait_before_zc_scan
                   35055     
                   35056     ; Run 6 = B(p-on) + A(n-pwm) - comparator C evaluated
                   35057     ; Out_cC changes from high to low
1297               35058     run6:
1297 1205CA        35059             call start_adc_conversion
129A 1208B2        35060             call wait_for_comp_out_low
                   35061     ;               setup_comm_wait
                   35062     ;               evaluate_comparator_integrity
129D 1209B3        35063             call wait_for_comm
12A0 120AAA        35064             call comm6comm1
12A3 1205CE        35065             call check_temp_voltage_and_limit_power
12A6 12064B        35066             call calc_next_comm_timing
                   35067     ;               wait_advance_timing
                   35068     ;               calc_new_wait_times
                   35069     ;               wait_before_zc_scan
                   35070     
                   35071             ; Check if it is direct startup
12A9 302827        35072             jnb     Flags1.STARTUP_PHASE, normal_run_checks
                   35073     
                   35074             ; Set spoolup power variables
12AC 855D5B        35075             mov     Pwm_Limit, Pwm_Limit_Beg                ; Set initial max power
                   35076             ; Check startup counter
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   535

12AF 7918          35077             mov     Temp2, #24                              ; Set nominal startup parameters
12B1 7A0C          35078             mov     Temp3, #12
12B3 C3            35079             clr     C
12B4 E539          35080             mov     A, Startup_Cnt                          ; Load counter
12B6 99            35081             subb    A, Temp2                                        ; Is counter above requirem
                             ent?
12B7 400E          35082             jc      direct_start_check_rcp          ; No - proceed
                   35083     
12B9 C228          35084             clr     Flags1.STARTUP_PHASE            ; Clear startup phase flag
12BB D229          35085             setb    Flags1.INITIAL_RUN_PHASE                ; Set initial run phase flag
12BD 8A3B          35086             mov     Initial_Run_Rot_Cntd, Temp3     ; Set initial run rotation count
12BF 855D5B        35087             mov     Pwm_Limit, Pwm_Limit_Beg
12C2 855D5C        35088             mov     Pwm_Limit_By_Rpm, Pwm_Limit_Beg
12C5 800C          35089             jmp     normal_run_checks
                   35090     
12C7               35091     direct_start_check_rcp:
12C7 C3            35092             clr     C
12C8 E554          35093             mov     A, New_Rcp                              ; Load new pulse value
12CA 9401          35094             subb    A, #1                                   ; Check if pulse is below stop value
12CC 4003          35095             jc      ($+5)
                   35096     
12CE 02124F        35097             ljmp    run1                                            ; Continue to run 
                   35098     
12D1 6159          35099             jmp     run_to_wait_for_power_on
                   35100     
                   35101     
12D3               35102     normal_run_checks:
                   35103             ; Check if it is initial run phase
12D3 30291F        35104             jnb     Flags1.INITIAL_RUN_PHASE, initial_run_phase_done        ; If not initial ru
                             n phase - branch
12D6 202B1C        35105             jb      Flags1.DIR_CHANGE_BRAKE, initial_run_phase_done ; If a direction change - b
                             ranch
                   35106     
                   35107             ; Decrement startup rotaton count
12D9 E53B          35108             mov     A, Initial_Run_Rot_Cntd
12DB 14            35109             dec     A
                   35110             ; Check number of initial rotations
12DC 7006          35111             jnz     initial_run_check_startup_rot   ; Branch if counter is not zero
                   35112     
12DE C229          35113             clr     Flags1.INITIAL_RUN_PHASE                ; Clear initial run phase flag
12E0 D22A          35114             setb    Flags1.MOTOR_STARTED            ; Set motor started
12E2 414F          35115             jmp run1                                                ; Continue with normal run
                   35116     
12E4               35117     initial_run_check_startup_rot:
12E4 F53B          35118             mov     Initial_Run_Rot_Cntd, A         ; Not zero - store counter
                   35119     
12E6 203A07        35120             jb      Flags3.PGM_BIDIR, initial_run_continue_run      ; Check if bidirectional op
                             eration
                   35121     
12E9 C3            35122             clr     C
12EA E554          35123             mov     A, New_Rcp                              ; Load new pulse value
12EC 9401          35124             subb    A, #1                                   ; Check if pulse is below stop value
12EE 4003          35125             jc      ($+5)
                   35126     
12F0               35127     initial_run_continue_run:
12F0 02124F        35128             ljmp    run1                                            ; Continue to run 
                   35129     
12F3 8064          35130             jmp     run_to_wait_for_power_on
                   35131     
12F5               35132     initial_run_phase_done:
                   35133             ; Reset stall count
12F5 753C00        35134             mov     Stall_Cnt, #0
                   35135             ; Exit run loop after a given time
12F8 203A0F        35136             jb      Flags3.PGM_BIDIR, run6_check_timeout    ; Check if bidirectional operation
                   35137     
12FB 78FA          35138             mov     Temp1, #250
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   536

12FD 79A4          35139             mov     Temp2, #Pgm_Brake_On_Stop
12FF E7            35140             mov     A, @Temp2
1300 6002          35141             jz      ($+4)
                   35142     
1302 7803          35143             mov     Temp1, #3                                       ; About 100ms before stoppi
                             ng when brake is set
                   35144     
1304 C3            35145             clr     C
1305 E555          35146             mov     A, Rcp_Stop_Cnt                 ; Load stop RC pulse counter low byte value
1307 98            35147             subb    A, Temp1                                        ; Is number of stop RC puls
                             es above limit?
1308 504F          35148             jnc     run_to_wait_for_power_on                ; Yes, go back to wait for poweron
                   35149     
130A               35150     run6_check_timeout:
130A E523          35151             mov     A, Rcp_Timeout_Cntd                     ; Load RC pulse timeout counter val
                             ue
130C 604B          35152             jz      run_to_wait_for_power_on                ; If it is zero - go back to wait f
                             or poweron
                   35153     
130E               35154     run6_check_dir:
130E 303A17        35155             jnb     Flags3.PGM_BIDIR, run6_check_speed              ; Check if bidirectional op
                             eration
                   35156     
1311 203805        35157             jb      Flags3.PGM_DIR_REV, run6_check_dir_rev          ; Check if actual rotation 
                             direction
1314 203507        35158             jb      Flags2.RCP_DIR_REV, run6_check_dir_change       ; Matches force direction
1317 800F          35159             jmp     run6_check_speed
                   35160     
1319               35161     run6_check_dir_rev:
1319 303502        35162             jnb     Flags2.RCP_DIR_REV, run6_check_dir_change
131C 800A          35163             jmp     run6_check_speed
                   35164     
131E               35165     run6_check_dir_change:
131E 202B07        35166             jb      Flags1.DIR_CHANGE_BRAKE, run6_check_speed
                   35167     
1321 D22B          35168             setb    Flags1.DIR_CHANGE_BRAKE         ; Set brake flag
1323 855D5B        35169             mov     Pwm_Limit, Pwm_Limit_Beg                ; Set max power while braking
1326 417F          35170             jmp     run4                                            ; Go back to run 4, thereby
                              changing force direction
                   35171     
1328               35172     run6_check_speed:
1328 78F0          35173             mov     Temp1, #0F0h                            ; Default minimum speed
132A 302B05        35174             jnb     Flags1.DIR_CHANGE_BRAKE, run6_brake_done; Is it a direction change?
                   35175     
132D 855D5B        35176             mov     Pwm_Limit, Pwm_Limit_Beg        ; Set max power while braking
1330 7820          35177             mov     Temp1, #20h                             ; Bidirectional braking termination
                              speed
                   35178     
1332               35179     run6_brake_done:
1332 C3            35180             clr     C
1333 E548          35181             mov     A, Comm_Period4x_H                      ; Is Comm_Period4x more than 32ms (
                             ~1220 eRPM)?
1335 98            35182             subb    A, Temp1
1336 5003          35183             jnc     ($+5)                                   ; Yes - stop or turn direction 
1338 02124F        35184             ljmp    run1                                            ; No - go back to run 1
                   35185     
133B 302B1B        35186             jnb     Flags1.DIR_CHANGE_BRAKE, run_to_wait_for_power_on       ; If it is not a di
                             rection change - stop
                   35187     
133E C22B          35188             clr     Flags1.DIR_CHANGE_BRAKE         ; Clear brake flag
1340 C238          35189             clr     Flags3.PGM_DIR_REV                      ; Set spinning direction. Default f
                             wd
1342 303502        35190             jnb     Flags2.RCP_DIR_REV, ($+5)       ; Check force direction
1345 D238          35191             setb    Flags3.PGM_DIR_REV                      ; Set spinning direction
1347 D229          35192             setb    Flags1.INITIAL_RUN_PHASE
1349 753B12        35193             mov     Initial_Run_Rot_Cntd, #18
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   537

134C 855D5B        35194             mov     Pwm_Limit, Pwm_Limit_Beg                ; Set initial max power
134F 414F          35195             jmp     run1                                            ; Go back to run 1 
                   35196     
1351               35197     run_to_wait_for_power_on_fail:  
1351 053C          35198             inc     Stall_Cnt                                       ; Increment stall count
1353 E554          35199             mov     A, New_Rcp                              ; Check if RCP is zero, then it is 
                             a normal stop                        
1355 6002          35200             jz      run_to_wait_for_power_on
1357 615C          35201             ajmp    run_to_wait_for_power_on_stall_done
                   35202     
1359               35203     run_to_wait_for_power_on:       
1359 753C00        35204             mov     Stall_Cnt, #0
                   35205     
135C               35206     run_to_wait_for_power_on_stall_done:
135C C2AF          35207             clr     IE_EA
135E 120B2F        35208             call switch_power_off
1361 752400        35209             mov     Flags0, #0                              ; Clear flags0
1364 752500        35210             mov     Flags1, #0                              ; Clear flags1
                   35211     IF MCU_48MHZ == 1
                                     Set_MCU_Clk_24MHz
                             ENDIF
1367 D2AF          35214             setb    IE_EA
1369 120571        35215             call    wait100ms                                       ; Wait for pwm to be stopped
136C 120B2F        35216             call switch_power_off
136F 78A4          35217             mov     Temp1, #Pgm_Brake_On_Stop
1371 E6            35218             mov     A, @Temp1
1372 6006          35219             jz      run_to_wait_for_power_on_brake_done
                   35220     
                   35221             AcomFET_on
                   35226             BcomFET_on
                   35231             CcomFET_on
                   35236     
137A               35237     run_to_wait_for_power_on_brake_done:
137A C3            35238             clr     C
137B E53C          35239             mov     A, Stall_Cnt
137D 9404          35240             subb    A, #4
137F 4003          35241             jc      jmp_wait_for_power_on
1381 020DA2        35242             jmp     init_no_signal
                   35243     
1384               35244     jmp_wait_for_power_on:
1384 020FD6        35245             jmp     wait_for_power_on                       ; Go back to wait for power on
                   35246     
                   35247     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   35248     
                   35249     ;$include (BLHeliPgm.inc) ; Include source code for programming the ESC
                +1 35250     ;**** **** **** **** ****
                +1 35251     ;
                +1 35252     ; BLHeli program for controlling brushless motors in helicopters and multirotors
                +1 35253     ;
                +1 35254     ; Copyright 2011, 2012 Steffen Skaug
                +1 35255     ; This program is distributed under the terms of the GNU General Public License
                +1 35256     ;
                +1 35257     ; This file is part of BLHeli.
                +1 35258     ;
                +1 35259     ; BLHeli is free software: you can redistribute it and/or modify
                +1 35260     ; it under the terms of the GNU General Public License as published by
                +1 35261     ; the Free Software Foundation, either version 3 of the License, or
                +1 35262     ; (at your option) any later version.
                +1 35263     ;
                +1 35264     ; BLHeli is distributed in the hope that it will be useful,
                +1 35265     ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                +1 35266     ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                +1 35267     ; GNU General Public License for more details.
                +1 35268     ;
                +1 35269     ; You should have received a copy of the GNU General Public License
                +1 35270     ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   538

                +1 35271     ;
                +1 35272     ;**** **** **** **** ****
                +1 35273     ;
                +1 35274     ; BLHeliTxPgm SiLabs                                      
                +1 35275     ;                                                         
                +1 35276     ; EEPROM is not available in SiLabs MCUs                  
                +1 35277     ; Therefore a segment of the flash is used as "EEPROM"    
                +1 35278     ;                                                         
                +1 35279     ;**** **** **** **** ****
                +1 35280     
                +1 35281     
                +1 35282     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                +1 35283     ;
                +1 35284     ; Read all eeprom parameters routine
                +1 35285     ;
                +1 35286     ; No assumptions
                +1 35287     ;
                +1 35288     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
1387            +1 35289     read_all_eeprom_parameters:     
                +1 35290             ; Check initialized signature
1387 901A0D     +1 35291             mov     DPTR, #Eep_Initialized_L
138A 7820       +1 35292             mov     Temp1, #Bit_Access
138C 9107       +1 35293             call read_eeprom_byte
138E E520       +1 35294             mov     A, Bit_Access
1390 B4550A     +1 35295             cjne    A, #055h, read_eeprom_store_defaults
1393 A3         +1 35296             inc     DPTR                            ; Now Eep_Initialized_H
1394 9107       +1 35297             call read_eeprom_byte
1396 E520       +1 35298             mov     A, Bit_Access
1398 B4AA02     +1 35299             cjne    A, #0AAh, read_eeprom_store_defaults
139B 8013       +1 35300             jmp     read_eeprom_read
                +1 35301     
                +1 35302     
139D            +1 35303     read_eeprom_store_defaults:
139D 7567A5     +1 35304             mov     Flash_Key_1, #0A5h
13A0 7568F1     +1 35305             mov     Flash_Key_2, #0F1h
13A3 120B3F     +1 35306             call set_default_parameters     
13A6 71CE       +1 35307             call erase_and_store_all_in_eeprom      
13A8 756700     +1 35308             mov     Flash_Key_1, #0
13AB 756800     +1 35309             mov     Flash_Key_2, #0
13AE 801D       +1 35310             jmp     read_eeprom_exit
                +1 35311     
13B0            +1 35312     read_eeprom_read:
                +1 35313             ; Read eeprom
13B0 901A03     +1 35314             mov     DPTR, #_Eep_Pgm_Gov_P_Gain
13B3 7880       +1 35315             mov     Temp1, #_Pgm_Gov_P_Gain 
13B5 7B0A       +1 35316             mov     Temp4, #10
13B7            +1 35317     read_eeprom_block1:
13B7 9107       +1 35318             call read_eeprom_byte
13B9 A3         +1 35319             inc     DPTR                            
13BA 08         +1 35320             inc     Temp1                   
13BB DBFA       +1 35321             djnz    Temp4, read_eeprom_block1
                +1 35322     
13BD 901A0F     +1 35323             mov     DPTR, #Eep_Enable_TX_Program
13C0 788C       +1 35324             mov     Temp1, #Pgm_Enable_TX_Program   
13C2 7B1A       +1 35325             mov     Temp4, #26      ; 26 parameters
13C4            +1 35326     read_eeprom_block2:
13C4 9107       +1 35327             call read_eeprom_byte
13C6 A3         +1 35328             inc     DPTR                            
13C7 08         +1 35329             inc     Temp1           
13C8 DBFA       +1 35330             djnz    Temp4, read_eeprom_block2
                +1 35331     
13CA 901A29     +1 35332             mov     DPTR, #Eep_Dummy                        ; Set pointer to uncritical area
                +1 35333     
13CD            +1 35334     read_eeprom_exit:
13CD 22         +1 35335             ret
                +1 35336     
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   539

                +1 35337     
                +1 35338     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                +1 35339     ;
                +1 35340     ; Erase flash and store all parameter value in EEPROM routine
                +1 35341     ;
                +1 35342     ; No assumptions
                +1 35343     ;
                +1 35344     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
13CE            +1 35345     erase_and_store_all_in_eeprom:
13CE C2AF       +1 35346             clr     IE_EA                                   ; Disable interrupts
13D0 914A       +1 35347             call    read_tags
13D2 9127       +1 35348             call    erase_flash                             ; Erase flash
                +1 35349     
13D4 901A00     +1 35350             mov     DPTR, #Eep_FW_Main_Revision     ; Store firmware main revision
13D7 7410       +1 35351             mov     A, #EEPROM_FW_MAIN_REVISION
13D9 910C       +1 35352             call write_eeprom_byte_from_acc
                +1 35353     
13DB A3         +1 35354             inc     DPTR                                            ; Now firmware sub revision
13DC 7407       +1 35355             mov     A, #EEPROM_FW_SUB_REVISION
13DE 910C       +1 35356             call write_eeprom_byte_from_acc
                +1 35357     
13E0 A3         +1 35358             inc     DPTR                                            ; Now layout revision
13E1 7421       +1 35359             mov     A, #EEPROM_LAYOUT_REVISION
13E3 910C       +1 35360             call write_eeprom_byte_from_acc
                +1 35361     
                +1 35362             ; Write eeprom
13E5 901A03     +1 35363             mov     DPTR, #_Eep_Pgm_Gov_P_Gain
13E8 7880       +1 35364             mov     Temp1, #_Pgm_Gov_P_Gain
13EA 7B0A       +1 35365             mov     Temp4, #10
13EC            +1 35366     write_eeprom_block1:
13EC 910B       +1 35367             call write_eeprom_byte
13EE A3         +1 35368             inc     DPTR                                            
13EF 08         +1 35369             inc     Temp1                                   
13F0 DBFA       +1 35370             djnz    Temp4, write_eeprom_block1
                +1 35371     
13F2 901A0F     +1 35372             mov     DPTR, #Eep_Enable_TX_Program
13F5 788C       +1 35373             mov     Temp1, #Pgm_Enable_TX_Program   
13F7 7B1A       +1 35374             mov     Temp4, #26      ; 26 parameters
13F9            +1 35375     write_eeprom_block2:
13F9 910B       +1 35376             call write_eeprom_byte
13FB A3         +1 35377             inc     DPTR                                            
13FC 08         +1 35378             inc     Temp1                                   
13FD DBFA       +1 35379             djnz    Temp4, write_eeprom_block2
                +1 35380     
13FF 915D       +1 35381             call    write_tags
1401 913B       +1 35382             call write_eeprom_signature
1403 901A29     +1 35383             mov     DPTR, #Eep_Dummy                        ; Set pointer to uncritical area
1406 22         +1 35384             ret     
                +1 35385     
                +1 35386     
                +1 35387     
                +1 35388     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                +1 35389     ;
                +1 35390     ; Read eeprom byte routine
                +1 35391     ;
                +1 35392     ; Gives data in A and in address given by Temp1. Assumes address in DPTR 
                +1 35393     ; Also assumes address high byte to be zero
                +1 35394     ;
                +1 35395     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
1407            +1 35396     read_eeprom_byte:
1407 E4         +1 35397             clr     A
1408 93         +1 35398             movc    A, @A+DPTR                      ; Read from flash
1409 F6         +1 35399             mov     @Temp1, A
140A 22         +1 35400             ret
                +1 35401     
                +1 35402     
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   540

                +1 35403     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                +1 35404     ;
                +1 35405     ; Write eeprom byte routine
                +1 35406     ;
                +1 35407     ; Assumes data in address given by Temp1, or in accumulator. Assumes address in DPTR 
                +1 35408     ; Also assumes address high byte to be zero
                +1 35409     ;
                +1 35410     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
140B            +1 35411     write_eeprom_byte:
140B E6         +1 35412             mov     A, @Temp1
140C            +1 35413     write_eeprom_byte_from_acc:
140C 438F01     +1 35414             orl     PSCTL, #01h                     ; Set the PSWE bit
140F 538FFD     +1 35415             anl     PSCTL, #0FDh                    ; Clear the PSEE bit
1412 FF         +1 35416             mov     Temp8, A
1413 C3         +1 35417             clr     C
1414 E583       +1 35418             mov     A, DPH                          ; Check that address is not in bootloader a
                             rea
1416 941C       +1 35419             subb    A, #1Ch
1418 4001       +1 35420             jc      ($+3)
                +1 35421     
141A 22         +1 35422             ret
                +1 35423     
141B EF         +1 35424             mov     A, Temp8
141C 8567B7     +1 35425             mov     FLKEY, Flash_Key_1              ; First key code
141F 8568B7     +1 35426             mov     FLKEY, Flash_Key_2              ; Second key code
1422 F0         +1 35427             movx    @DPTR, A                                ; Write to flash
1423 538FFE     +1 35428             anl     PSCTL, #0FEh                    ; Clear the PSWE bit
1426 22         +1 35429             ret
                +1 35430     
                +1 35431     
                +1 35432     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                +1 35433     ;
                +1 35434     ; Erase flash routine (erases the flash segment used for "eeprom" variables)
                +1 35435     ;
                +1 35436     ; No assumptions
                +1 35437     ;
                +1 35438     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
1427            +1 35439     erase_flash:    
1427 438F02     +1 35440             orl     PSCTL, #02h                     ; Set the PSEE bit
142A 438F01     +1 35441             orl     PSCTL, #01h                     ; Set the PSWE bit
142D 8567B7     +1 35442             mov     FLKEY, Flash_Key_1              ; First key code
1430 8568B7     +1 35443             mov     FLKEY, Flash_Key_2              ; Second key code
1433 901A0D     +1 35444             mov     DPTR, #Eep_Initialized_L        
1436 F0         +1 35445             movx    @DPTR, A
1437 538FFC     +1 35446             anl     PSCTL, #0FCh                    ; Clear the PSEE and PSWE bits
143A 22         +1 35447             ret
                +1 35448     
                +1 35449     
                +1 35450     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                +1 35451     ;
                +1 35452     ; Write eeprom signature routine
                +1 35453     ;
                +1 35454     ; No assumptions
                +1 35455     ;
                +1 35456     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
143B            +1 35457     write_eeprom_signature: 
143B 901A0D     +1 35458             mov     DPTR, #Eep_Initialized_L
143E 7455       +1 35459             mov     A, #055h
1440 910C       +1 35460             call write_eeprom_byte_from_acc
                +1 35461     
1442 901A0E     +1 35462             mov     DPTR, #Eep_Initialized_H
1445 74AA       +1 35463             mov     A, #0AAh
1447 910C       +1 35464             call write_eeprom_byte_from_acc
1449 22         +1 35465             ret
                +1 35466     
                +1 35467     
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   541

                +1 35468     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                +1 35469     ;
                +1 35470     ; Read all tags from flash and store in temporary storage
                +1 35471     ;
                +1 35472     ; No assumptions
                +1 35473     ;
                +1 35474     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
144A            +1 35475     read_tags:
144A 7A30       +1 35476             mov     Temp3, #48                              ; Number of tags
144C 79D0       +1 35477             mov     Temp2, #Temp_Storage            ; Set RAM address
144E 7820       +1 35478             mov     Temp1, #Bit_Access
1450 901A40     +1 35479             mov     DPTR, #Eep_ESC_Layout           ; Set flash address
1453            +1 35480     read_tag:       
1453 9107       +1 35481             call read_eeprom_byte
1455 E520       +1 35482             mov     A, Bit_Access
1457 F7         +1 35483             mov     @Temp2, A                       ; Write to RAM
1458 09         +1 35484             inc     Temp2
1459 A3         +1 35485             inc     DPTR
145A DAF7       +1 35486             djnz Temp3, read_tag    
145C 22         +1 35487             ret
                +1 35488     
                +1 35489     
                +1 35490     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                +1 35491     ;
                +1 35492     ; Write all tags from temporary storage and store in flash
                +1 35493     ;
                +1 35494     ; No assumptions
                +1 35495     ;
                +1 35496     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
145D            +1 35497     write_tags:
145D 7A30       +1 35498             mov     Temp3, #48                              ; Number of tags
145F 79D0       +1 35499             mov     Temp2, #Temp_Storage            ; Set RAM address
1461 901A40     +1 35500             mov     DPTR, #Eep_ESC_Layout           ; Set flash address
1464            +1 35501     write_tag:      
1464 E7         +1 35502             mov     A, @Temp2                       ; Read from RAM
1465 910C       +1 35503             call write_eeprom_byte_from_acc
1467 09         +1 35504             inc     Temp2
1468 A3         +1 35505             inc     DPTR
1469 DAF9       +1 35506             djnz Temp3, write_tag   
146B 22         +1 35507             ret
                +1 35508     
                +1 35509     
                +1 35510     ;**;**** **** **** **** **** **** **** **** **** **** **** **** ****
                +1 35511     ;
                +1 35512     ; Wait 1 second routine
                +1 35513     ;
                +1 35514     ; No assumptions
                +1 35515     ;
                +1 35516     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
146C            +1 35517     wait1s:
146C 7C05       +1 35518             mov     Temp5, #5
146E            +1 35519     wait1s_loop:
146E 120575     +1 35520             call wait200ms
1471 DCFB       +1 35521             djnz    Temp5, wait1s_loop
1473 22         +1 35522             ret
                +1 35523     
                +1 35524     
                +1 35525     ;**;**** **** **** **** **** **** **** **** **** **** **** **** ****
                +1 35526     ;
                +1 35527     ; Success beep routine
                +1 35528     ;
                +1 35529     ; No assumptions
                +1 35530     ;
                +1 35531     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
1474            +1 35532     success_beep:
1474 C2AF       +1 35533             clr     IE_EA                           ; Disable all interrupts
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   542

1476 120ACC     +1 35534             call beep_f1
1479 120AD2     +1 35535             call beep_f2
147C 120AD8     +1 35536             call beep_f3
147F 120ADE     +1 35537             call beep_f4
1482 120569     +1 35538             call wait10ms
1485 120ACC     +1 35539             call beep_f1
1488 120AD2     +1 35540             call beep_f2
148B 120AD8     +1 35541             call beep_f3
148E 120ADE     +1 35542             call beep_f4
1491 120569     +1 35543             call wait10ms
1494 120ACC     +1 35544             call beep_f1
1497 120AD2     +1 35545             call beep_f2
149A 120AD8     +1 35546             call beep_f3
149D 120ADE     +1 35547             call beep_f4
14A0 D2AF       +1 35548             setb    IE_EA                           ; Enable all interrupts
14A2 22         +1 35549             ret
                +1 35550     
                +1 35551     
                +1 35552     ;**;**** **** **** **** **** **** **** **** **** **** **** **** ****
                +1 35553     ;
                +1 35554     ; Success beep inverted routine
                +1 35555     ;
                +1 35556     ; No assumptions
                +1 35557     ;
                +1 35558     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
14A3            +1 35559     success_beep_inverted:
14A3 C2AF       +1 35560             clr     IE_EA                           ; Disable all interrupts
14A5 120ADE     +1 35561             call beep_f4
14A8 120AD8     +1 35562             call beep_f3
14AB 120AD2     +1 35563             call beep_f2
14AE 120ACC     +1 35564             call beep_f1
14B1 120569     +1 35565             call wait10ms
14B4 120ADE     +1 35566             call beep_f4
14B7 120AD8     +1 35567             call beep_f3
14BA 120AD2     +1 35568             call beep_f2
14BD 120ACC     +1 35569             call beep_f1
14C0 120569     +1 35570             call wait10ms
14C3 120ADE     +1 35571             call beep_f4
14C6 120AD8     +1 35572             call beep_f3
14C9 120AD2     +1 35573             call beep_f2
14CC 120ACC     +1 35574             call beep_f1
14CF D2AF       +1 35575             setb    IE_EA                           ; Enable all interrupts
14D1 22         +1 35576             ret
                +1 35577     
                +1 35578     
                   35579     ;$include (BLHeliBootLoad.inc) ; Include source code for bootloader
                +1 35580     ; BLHeli bootloader for SiLabs MCUs. Based upon AVRootloader (copyright HR)
                +1 35581     
  7840          +1 35582     XTAL                                    EQU     25000000        
                +1 35583     
  1C00          +1 35584     BOOT_START                      EQU     1C00h   ; Bootloader segment address
  1E10          +1 35585     BOOT_DELAY                      EQU     XTAL/4  ; About 250ms (don't set to fast to avoid c
                             onnection problems)
  4B00          +1 35586     BOOT_BAUDRATE                   EQU     19200   ; Only used if no baudrate detection activa
                             ted, XTAL is than important
  0006          +1 35587     BOOT_VERSION                    EQU     6               ; Version 6 (must be not changed)
  0001          +1 35588     BOOT_PAGES                      EQU     1               ; Number of flash segments for boot
                             loader
                +1 35589     
  001A          +1 35590     UART_LOOP                               EQU     26              ; Depends upon timing of pu
                             tc, getc 
  FFE6          +1 35591     BAUDTIME                                EQU     ((XTAL/BOOT_BAUDRATE)/3)-UART_LOOP
                +1 35592     
  0030          +1 35593     SUCCESS                         EQU     030h
  00C0          +1 35594     ERRORVERIFY                     EQU     0C0h
  00C1          +1 35595     ERRORCOMMAND                    EQU     0C1h
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   543

  00C2          +1 35596     ERRORCRC                                EQU     0C2h
  00C5          +1 35597     ERRORPROG                               EQU     0C5h
                +1 35598     
  A001          +1 35599     POLYNOM                         EQU     0A001h          ; CRC Polynom
                +1 35600     
  REG           +1 35601     Xl                                      EQU     R0                      ; Temporary X
  REG           +1 35602     Xh                                      EQU     R1
  REG           +1 35603     Paral                           EQU     R2                      ; Params for UART
  REG           +1 35604     Parah                           EQU     R3      
  REG           +1 35605     Cmdl                                    EQU     R4                      ; Commands
  REG           +1 35606     Cmdh                                    EQU     R5      
  REG           +1 35607     Cntl                                    EQU     R6                      ; Baudtime
  REG           +1 35608     Cnth                                    EQU     R7
                +1 35609     
----            +1 35610     DSEG AT 20h                                     
0020            +1 35611     Bit_Reg:                                DS      1                       ; Bit storage regis
                             ter
0021            +1 35612     Byte_Reg:                               DS      1                       ; Byte storage regi
                             ster
0022            +1 35613     Crcl:                           DS      1                       ; CRC 16Bit
0023            +1 35614     Crch:                           DS      1
0024            +1 35615     Baudl:                          DS      1                       ; Baudtime
0025            +1 35616     Baudh:                          DS      1
0026            +1 35617     Bit_Cnt:                                DS      1                       ; Counter in UART l
                             oops
0027            +1 35618     Byte_Cntl:                      DS      1                       ; Generic counter
0028            +1 35619     Byte_Cnth:                      DS      1                       
0029            +1 35620     BL_Flash_Key_1:         DS      1                       ; Flash keys
002A            +1 35621     BL_Flash_Key_2:         DS      1
                +1 35622     
----            +1 35623     CSEG AT BOOT_START              ; Bootloader start
1C00 C2AF       +1 35624     init:clr        IE_EA
                +1 35625             ; Select register bank 0 for main program routines
1C02 C2D3       +1 35626             clr     PSW.3                           ; Select register bank 0 for main program r
                             outines      
                +1 35627             ; Disable the WDT.
1C04 7597DE     +1 35628             mov     WDTCN, #0DEh                    ; Disable watchdog
1C07 7597AD     +1 35629             mov     WDTCN, #0ADh            
                +1 35630             ; Initialize stack
1C0A 7581C0     +1 35631             mov     SP, #0c0h                               ; Stack = 64 upper bytes of RAM
                +1 35632             ; Initialize clock
1C0D 75A900     +1 35633             mov     CLKSEL, #00h                    ; Set clock divider to 1
                +1 35634             ; Initialize VDD monitor
1C10 43FF80     +1 35635             orl     VDM0CN, #080h                   ; Enable the VDD monitor
1C13 752438     +1 35636             mov     Baudl, #38h                     ; Wait 100us
1C16 752503     +1 35637             mov     Baudh, #03h
1C19 B1DB       +1 35638             acall waitf
                +1 35639             ; Initialize flash keys
1C1B 7529A5     +1 35640             mov     BL_Flash_Key_1, #0A5h   ; First key code
1C1E 752AF1     +1 35641             mov     BL_Flash_Key_2, #0F1h   ; Second key code
                +1 35642             ; Initialize ports
1C21 43F101     +1 35643             orl     RTX_MDIN, #(1 SHL RTX_PIN)              ; Set digital
1C24 53A4FE     +1 35644             anl     RTX_MDOUT, #NOT(1 SHL RTX_PIN)  ; Disable pushpull
1C27 D280       +1 35645             setb    RTX_PORT.RTX_PIN                                ; Set data high
1C29 75D4FF     +1 35646             mov     RTX_SKIP, #0FFh
1C2C 75E340     +1 35647             mov     XBR2, #40h;                                     ; Enable crossbar
                +1 35648             ; Set number of connect attempts before exiting bootloader
1C2F 7DFA       +1 35649             mov     Cmdh, #250
                +1 35650     
                +1 35651             ; Identifier scanning
1C31 7803       +1 35652     abd:    mov     Xl, #(low(BOOT_DELAY / 6)+1)
1C33 7906       +1 35653             mov     Xh, #(high(BOOT_DELAY / 6)+1)
1C35 7C01       +1 35654             mov     Cmdl, #(high((BOOT_DELAY / 6) SHR 8)+1)
1C37 752200     +1 35655             mov     Crcl, #0
1C3A 752300     +1 35656             mov     Crch, #0
1C3D 901DE8     +1 35657             mov     DPTR, #BOOT_SIGN
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   544

1C40 7B06       +1 35658             mov     Parah, #(BOOT_MSG - BOOT_SIGN)
1C42 7524E6     +1 35659             mov     Baudl, #low(BAUDTIME)
1C45 7525FF     +1 35660             mov     Baudh, #high(BAUDTIME)
                +1 35661     
1C48            +1 35662     wait_for_low:
1C48 308002     +1 35663             jnb     RTX_PORT.RTX_PIN, ($+5)
1C4B 8148       +1 35664             ajmp wait_for_low
                +1 35665     
                +1 35666             ; Identifier (BOOT_SIGN) scanning with timeout and checksum
1C4D 208008     +1 35667     id1:    jb      RTX_PORT.RTX_PIN, id3   ; Look for high
1C50 D8FB       +1 35668             djnz    Xl, id1                         ; Subtract 1 from X (BOOT_DELAY)
1C52 D9F9       +1 35669             djnz    Xh, id1
1C54 DCF7       +1 35670             djnz    Cmdl, id1 
                +1 35671     
1C56 81BA       +1 35672             ajmp    exit
                +1 35673     
1C58 308008     +1 35674     id3:    jnb     RTX_PORT.RTX_PIN, id4   ; Look for low
1C5B D8FB       +1 35675             djnz    Xl, id3                         ; Subtract 1 from X (BOOT_DELAY)
1C5D D9F9       +1 35676             djnz    Xh, id3
1C5F DCF7       +1 35677             djnz    Cmdl, id3
                +1 35678     
1C61 81BA       +1 35679             ajmp    exit
                +1 35680     
1C63 B19B       +1 35681     id4:    acall getx                              ; Read character
1C65 E4         +1 35682             clr     A                       
1C66 93         +1 35683             movc A, @A+DPTR                 ; Load BOOT_SIGN character
1C67 A3         +1 35684             inc     DPTR
1C68 C3         +1 35685             clr     C
1C69 9A         +1 35686             subb    A, Paral                                ; Compare with read character
1C6A 6004       +1 35687             jz      id5
1C6C DDC3       +1 35688             djnz    Cmdh, abd                               ; Retry if not last connect attempt
1C6E 81BA       +1 35689             ajmp    exit
                +1 35690     
1C70            +1 35691     id5:
1C70 DBDB       +1 35692             djnz    Parah, id1
                +1 35693     
1C72 B18D       +1 35694             acall getw                              ; Read CRC
1C74 6002       +1 35695             jz      ($+4)                           ; Check CRC
1C76 8131       +1 35696             ajmp    abd
                +1 35697             
                +1 35698             ; Send info about chip/bootloader (BOOT_MSG + BOOT_INFO)
1C78 7B08       +1 35699             mov     Parah, #((BOOT_INFO - BOOT_MSG) + 4)
1C7A E4         +1 35700     in1:    clr     A                       
1C7B 93         +1 35701             movc A, @A+DPTR                 ; Load character
1C7C FA         +1 35702             mov     Paral, A
1C7D A3         +1 35703             inc     DPTR
1C7E B16E       +1 35704             acall putc
1C80 DBF8       +1 35705             djnz    Parah, in1
                +1 35706     
                +1 35707     
                +1 35708             ; Main commandloop
                +1 35709             ; 0=Run/restart 
                +1 35710             ; 1=Program flash, 2=Erase flash, 3=Read flash
                +1 35711             ; 0xFF=Set address, 0xFE=Set buffer, 0xFD=Keep alive 
1C82 7A30       +1 35712     main:mov        Paral, #SUCCESS
1C84 B16E       +1 35713     mai1:acall putc
1C86 752200     +1 35714             mov     Crcl, #0                                ; Reset CRC
1C89 752300     +1 35715             mov     Crch, #0
1C8C B18D       +1 35716             acall getw                              ; Get command
1C8E EA         +1 35717             mov     A, Paral
1C8F FC         +1 35718             mov     Cmdl, A
1C90 EB         +1 35719             mov     A, Parah
1C91 FD         +1 35720             mov     Cmdh, A
1C92 C3         +1 35721             clr     C
1C93 ED         +1 35722             mov     A, Cmdh
1C94 94FE       +1 35723             subb    A, #0FEh
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   545

1C96 400E       +1 35724             jc      mai2                                    ; Jump if not set address or set bu
                             ffer 
                +1 35725     
1C98 B18D       +1 35726             acall getw                              ; Address or number of bytes
1C9A 8A27       +1 35727             mov     Byte_Cntl, Paral                ; Store number of bytes for set buffer
1C9C 8B28       +1 35728             mov     Byte_Cnth, Parah        
1C9E ED         +1 35729             mov     A, Cmdh
1C9F 30E004     +1 35730             jnb     ACC.0, mai2                     ; Jump if set buffer
                +1 35731     
1CA2 8A82       +1 35732             mov     DPL, Paral                      ; Store flash address (for set address)
1CA4 8B83       +1 35733             mov     DPH, Parah
                +1 35734     
1CA6 B18D       +1 35735     mai2:acall getw                         ; Get CRC
1CA8 7AC2       +1 35736             mov     Paral, #ERRORCRC
1CAA 70D8       +1 35737             jnz     mai1
1CAC C3         +1 35738             clr     C
1CAD ED         +1 35739             mov     A, Cmdh
1CAE 94FE       +1 35740             subb    A, #0FEh
1CB0 6019       +1 35741             jz      setbuf                          ; If command is set buffer, receive data
1CB2 50CE       +1 35742             jnc     main
                +1 35743     
1CB4 BD0029     +1 35744             cjne    Cmdh, #0, mai4                  ; Jump if command != 0 (and not set buffer)
                +1 35745     
                +1 35746             ; Run application/restart bootloader
1CB7 EC         +1 35747             mov     A, Cmdl
1CB8 600F       +1 35748             jz      rst
1CBA 752000     +1 35749     exit:mov        Bit_Access, #0                  ; Clear variable used by flash lock detect
1CBD 7521FF     +1 35750             mov     Bit_Access_Int, #0FFh   ; Set variable to indicate that program execution c
                             ame from bootloader
1CC0 752900     +1 35751             mov     BL_Flash_Key_1, #0              ; Set flash keys to invalid values
1CC3 752A00     +1 35752             mov     BL_Flash_Key_2, #0
1CC6 020000     +1 35753             ljmp    0000h
1CC9 8100       +1 35754     rst:    ajmp    init
                +1 35755     
                +1 35756             ; Set buffer
1CCB A827       +1 35757     setbuf:mov Xl, Byte_Cntl                        ; Set number of bytes 
1CCD A928       +1 35758             mov     Xh, Byte_Cnth
1CCF 08         +1 35759             inc     Xl      
1CD0 09         +1 35760             inc     Xh      
1CD1 D804       +1 35761     set4:djnz       Xl, set5
1CD3 D902       +1 35762             djnz    Xh, set5
1CD5 81DD       +1 35763             ajmp    set6
                +1 35764     
1CD7 B191       +1 35765     set5:acall getc                         ; Receive data
1CD9 EA         +1 35766             mov     A, Paral
1CDA F2         +1 35767             movx    @Xl, A                          ; Store data in XRAM
1CDB 81D1       +1 35768             ajmp    set4
                +1 35769     
1CDD 0D         +1 35770     set6:inc        Cmdh    
1CDE 81A6       +1 35771             ajmp    mai2
                +1 35772     
1CE0 C3         +1 35773     mai4:clr        C
1CE1 ED         +1 35774             mov     A, Cmdh
1CE2 9403       +1 35775             subb    A, #3
1CE4 5051       +1 35776             jnc     mai5                                    ; Jump if command >= 3
                +1 35777     
                +1 35778             ; Program/erase
1CE6 ED         +1 35779             mov     A, Cmdh
1CE7 A2E0       +1 35780             mov     C, ACC.0
1CE9 9200       +1 35781             mov     Bit_Reg.0, C    
1CEB 7AC5       +1 35782             mov     Paral, #ERRORPROG
1CED C3         +1 35783             clr     C
1CEE E582       +1 35784             mov     A, DPL
1CF0 9400       +1 35785             subb    A, #low(BOOT_START)
1CF2 E583       +1 35786             mov     A, DPH
1CF4 941C       +1 35787             subb    A, #high(BOOT_START)
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   546

1CF6 508C       +1 35788             jnc     mai1                                    ; Jump if in bootloader segment
1CF8 200010     +1 35789             jb      Bit_Reg.0, pro3         ; Jump if program command
                +1 35790     
                +1 35791             ; Erase flash
1CFB 438F02     +1 35792             orl     PSCTL, #02h                     ; Set the PSEE bit
1CFE 438F01     +1 35793             orl     PSCTL, #01h                     ; Set the PSWE bit
1D01 8529B7     +1 35794             mov     FLKEY, BL_Flash_Key_1   ; First key code
1D04 852AB7     +1 35795             mov     FLKEY, BL_Flash_Key_2   ; Second key code
1D07 F0         +1 35796             movx    @DPTR, A
1D08 300027     +1 35797             jnb     Bit_Reg.0, pro6         ; Jump if erase command
                +1 35798     
                +1 35799             ; Program flash
1D0B A827       +1 35800     pro3:mov        Xl, Byte_Cntl                   ; Set number of bytes 
1D0D A928       +1 35801             mov     Xh, Byte_Cnth
1D0F 08         +1 35802             inc     Xl      
1D10 09         +1 35803             inc     Xh      
1D11 438F01     +1 35804             orl     PSCTL, #01h                     ; Set the PSWE bit
1D14 538FFD     +1 35805             anl     PSCTL, #0FDh                    ; Clear the PSEE bit
1D17 D804       +1 35806     pro4:djnz       Xl, pro5
1D19 D902       +1 35807             djnz    Xh, pro5
1D1B A132       +1 35808             ajmp    pro6
                +1 35809     
1D1D            +1 35810     pro5:
1D1D C3         +1 35811             clr     C
1D1E E583       +1 35812             mov     A, DPH                          ; Check that address is not in bootloader a
                             rea
1D20 941C       +1 35813             subb    A, #1Ch
1D22 4003       +1 35814             jc      ($+5)
                +1 35815     
1D24 A3         +1 35816             inc     DPTR                                    ; Increment flash address
1D25 A117       +1 35817             ajmp    pro4
                +1 35818     
1D27 E2         +1 35819             movx    A, @Xl                          ; Read from XRAM                
1D28 8529B7     +1 35820             mov     FLKEY, BL_Flash_Key_1   ; First key code
1D2B 852AB7     +1 35821             mov     FLKEY, BL_Flash_Key_2   ; Second key code
1D2E F0         +1 35822             movx    @DPTR, A                                ; Write to flash
1D2F A3         +1 35823             inc     DPTR                                    ; Increment flash address
1D30 A117       +1 35824             ajmp    pro4
                +1 35825     
1D32 538FFC     +1 35826     pro6:anl        PSCTL, #0FCh                    ; Clear the PSEE and PSWE bits
1D35 8182       +1 35827             ajmp    main                                    ; Successfully done erase or program
                +1 35828     
                +1 35829             ; Read flash
1D37 7AC1       +1 35830     mai5:mov        Paral, #ERRORCOMMAND    ; Illegal command
1D39 BD030C     +1 35831             cjne    Cmdh, #3, mai6                  ; Jump if not read flash command
                +1 35832     
1D3C E4         +1 35833     rd1:    clr     A
1D3D 93         +1 35834             movc    A, @A+DPTR                      ; Read from flash
1D3E A3         +1 35835             inc     DPTR                                    ; Increment flash address
1D3F FA         +1 35836             mov     Paral, A
1D40 B152       +1 35837             acall putp
1D42 DCF8       +1 35838             djnz    Cmdl, rd1                       ; Decrement bytes to read       
                +1 35839     
1D44 B14A       +1 35840             acall putw                              ; CRC
1D46 8182       +1 35841             ajmp    main
                +1 35842     
1D48 8184       +1 35843     mai6:ajmp       mai1
                +1 35844     
                +1 35845     
                +1 35846     
                +1 35847     
                +1 35848             ; Send char with crc
1D4A AA22       +1 35849     putw:mov        Paral, Crcl
1D4C AB23       +1 35850             mov     Parah, Crch
1D4E B16E       +1 35851             acall putc
1D50 EB         +1 35852             mov     A, Parah
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   547

1D51 FA         +1 35853             mov     Paral, A
1D52 EA         +1 35854     putp:mov        A, Paral
1D53 6222       +1 35855             xrl     Crcl, A
1D55 752608     +1 35856             mov     Bit_Cnt, #8
1D58 C3         +1 35857     put1:clr        C
1D59 E523       +1 35858             mov     A, Crch
1D5B 13         +1 35859             rrc     A
1D5C F523       +1 35860             mov     Crch, A
1D5E E522       +1 35861             mov     A, Crcl
1D60 13         +1 35862             rrc     A
1D61 F522       +1 35863             mov     Crcl, A
1D63 5006       +1 35864             jnc     put2
                +1 35865     
1D65 6323A0     +1 35866             xrl     Crch, #high(POLYNOM)
1D68 632201     +1 35867             xrl     Crcl, #low(POLYNOM)
                +1 35868     
1D6B D526EA     +1 35869     put2:djnz       Bit_Cnt, put1
                +1 35870     
                +1 35871     
                +1 35872             ; Send char
1D6E B1DB       +1 35873     putc:acall waitf
1D70 B1DB       +1 35874             acall waitf
1D72 75260A     +1 35875             mov     Bit_Cnt, #10
1D75 EA         +1 35876             mov     A, Paral
1D76 F4         +1 35877             cpl     A
1D77 200102     +1 35878     put3:jb Bit_Reg.1, ($+5)
1D7A D280       +1 35879             setb    RTX_PORT.RTX_PIN                ; Set pin high
1D7C 300102     +1 35880             jnb     Bit_Reg.1, ($+5)
1D7F C280       +1 35881             clr     RTX_PORT.RTX_PIN                ; Set pin low
1D81 B1DB       +1 35882             acall waitf                                                     
1D83 C3         +1 35883             clr     C
1D84 13         +1 35884             rrc     A
1D85 4002       +1 35885             jc      put4            
                +1 35886                                                     
1D87 C201       +1 35887             clr     Bit_Reg.1
                +1 35888     
1D89 D526EB     +1 35889     put4:djnz       Bit_Cnt, put3
                +1 35890     
1D8C 22         +1 35891             ret
                +1 35892     
                +1 35893     
                +1 35894             ; Receive char/word
1D8D B191       +1 35895     getw:acall getc
1D8F EA         +1 35896             mov     A, Paral
1D90 FB         +1 35897             mov     Parah, A
1D91 208002     +1 35898     getc:jb RTX_PORT.RTX_PIN, ($+5) ; Wait for high
1D94 A191       +1 35899             ajmp    getc
                +1 35900     
1D96 308002     +1 35901     get1:jnb        RTX_PORT.RTX_PIN, ($+5) ; Wait for low
1D99 A196       +1 35902             ajmp    get1
                +1 35903     
1D9B 752608     +1 35904     getx:mov        Bit_Cnt, #8
1D9E AE24       +1 35905             mov     Cntl, Baudl
1DA0 AF25       +1 35906             mov     Cnth, Baudh
1DA2 C3         +1 35907             clr     C
1DA3 EF         +1 35908             mov     A, Cnth                         ; Wait half a baud
1DA4 13         +1 35909             rrc     A
1DA5 FF         +1 35910             mov     Cnth, A
1DA6 EE         +1 35911             mov     A, Cntl
1DA7 13         +1 35912             rrc     A
1DA8 FE         +1 35913             mov     Cntl, A
1DA9 B1DF       +1 35914             acall waith
1DAB B1DB       +1 35915     get2:acall waitf                                ; Wait one baud                            
                                                  
1DAD C3         +1 35916             clr     C
1DAE EA         +1 35917             mov     A, Paral
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   548

1DAF 13         +1 35918             rrc     A
1DB0 308002     +1 35919             jnb     RTX_PORT.RTX_PIN, ($+5)                 
1DB3 4480       +1 35920             orl     A, #080h
                +1 35921     
1DB5 FA         +1 35922             mov     Paral, A
1DB6 30E703     +1 35923             jnb     ACC.7, ($+6) 
1DB9 632201     +1 35924             xrl     Crcl, #low(POLYNOM)
                +1 35925     
1DBC C3         +1 35926             clr     C
1DBD E523       +1 35927             mov     A, Crch
1DBF 13         +1 35928             rrc     A
1DC0 F523       +1 35929             mov     Crch, A
1DC2 E522       +1 35930             mov     A, Crcl
1DC4 13         +1 35931             rrc     A
1DC5 F522       +1 35932             mov     Crcl, A
1DC7 5006       +1 35933             jnc     get3                            
                +1 35934     
1DC9 6323A0     +1 35935             xrl     Crch, #high(POLYNOM)
1DCC 632201     +1 35936             xrl     Crcl, #low(POLYNOM)
                +1 35937     
1DCF D526D9     +1 35938     get3:djnz       Bit_Cnt, get2
                +1 35939     
1DD2 E522       +1 35940             mov     A, Crcl 
1DD4 6523       +1 35941             xrl     A, Crch 
1DD6 6523       +1 35942             xrl     A, Crch 
1DD8 F522       +1 35943             mov     Crcl, A
1DDA 22         +1 35944             ret
                +1 35945     
                +1 35946     
                +1 35947             ; UART delays                                                                      
                                  
1DDB AE24       +1 35948     waitf:mov       Cntl, Baudl     
1DDD AF25       +1 35949             mov     Cnth, Baudh
1DDF 0E         +1 35950     waith:inc Cntl
1DE0 0F         +1 35951             inc     Cnth
1DE1 DEFE       +1 35952     wait1:djnz Cntl, wait1
1DE3 DFFC       +1 35953             djnz Cnth, wait1
                +1 35954     
1DE5 D201       +1 35955             setb    Bit_Reg.1
1DE7 22         +1 35956             ret                                                                     
                +1 35957     
                +1 35958     
1DE8 424C4865   +1 35959     BOOT_SIGN:      DB      "BLHeli"        
1DEC 6C69                    
                +1 35960     
1DEE 34373164   +1 35961     BOOT_MSG:               DB      "471d"          ; Interface-MCU_BootlaoderRevision
                +1 35962     
1DF2 E8B10601   +1 35963     BOOT_INFO:      DB      SIGNATURE_001, SIGNATURE_002, BOOT_VERSION, BOOT_PAGES
                +1 35964     
                   35965     
                   35966     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   35967     
                   35968     
                   35969     
----               35970     CSEG AT 19FDh
19FD               35971     reset:
19FD 020D38        35972     ljmp    pgm_start
                   35973     
                   35974     
                   35975     
                   35976     END
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   549

SYMBOL TABLE LISTING
------ ----- -------


N A M E                              T Y P E  V A L U E   ATTRIBUTES

ABD . . . . . . . . . . . . . . . .  C ADDR   1C31H   A   
ACC . . . . . . . . . . . . . . . .  D ADDR   00E0H   A   
ACC_ACC0. . . . . . . . . . . . . .  B ADDR   00E0H.0 A   
ACC_ACC1. . . . . . . . . . . . . .  B ADDR   00E0H.1 A   
ACC_ACC2. . . . . . . . . . . . . .  B ADDR   00E0H.2 A   
ACC_ACC3. . . . . . . . . . . . . .  B ADDR   00E0H.3 A   
ACC_ACC4. . . . . . . . . . . . . .  B ADDR   00E0H.4 A   
ACC_ACC5. . . . . . . . . . . . . .  B ADDR   00E0H.5 A   
ACC_ACC6. . . . . . . . . . . . . .  B ADDR   00E0H.6 A   
ACC_ACC7. . . . . . . . . . . . . .  B ADDR   00E0H.7 A   
ACOMFET . . . . . . . . . . . . . .  N NUMB   0000H   A   
ADC0. . . . . . . . . . . . . . . .  D ADDR   00BDH   A   
ADC0AC. . . . . . . . . . . . . . .  D ADDR   00B3H   A   
ADC0CF. . . . . . . . . . . . . . .  D ADDR   00BCH   A   
ADC0CN0 . . . . . . . . . . . . . .  D ADDR   00E8H   A   
ADC0CN0_ADBMEN. . . . . . . . . . .  B ADDR   00E8H.6 A   
ADC0CN0_ADBUSY. . . . . . . . . . .  B ADDR   00E8H.4 A   
ADC0CN0_ADCM0 . . . . . . . . . . .  B ADDR   00E8H.0 A   
ADC0CN0_ADCM1 . . . . . . . . . . .  B ADDR   00E8H.1 A   
ADC0CN0_ADCM2 . . . . . . . . . . .  B ADDR   00E8H.2 A   
ADC0CN0_ADEN. . . . . . . . . . . .  B ADDR   00E8H.7 A   
ADC0CN0_ADINT . . . . . . . . . . .  B ADDR   00E8H.5 A   
ADC0CN0_ADWINT. . . . . . . . . . .  B ADDR   00E8H.3 A   
ADC0CN1 . . . . . . . . . . . . . .  D ADDR   00B2H   A   
ADC0EOC_IRQN. . . . . . . . . . . .  N NUMB   000AH   A   
ADC0GT. . . . . . . . . . . . . . .  D ADDR   00C3H   A   
ADC0GTH . . . . . . . . . . . . . .  D ADDR   00C4H   A   
ADC0GTL . . . . . . . . . . . . . .  D ADDR   00C3H   A   
ADC0H . . . . . . . . . . . . . . .  D ADDR   00BEH   A   
ADC0L . . . . . . . . . . . . . . .  D ADDR   00BDH   A   
ADC0LT. . . . . . . . . . . . . . .  D ADDR   00C5H   A   
ADC0LTH . . . . . . . . . . . . . .  D ADDR   00C6H   A   
ADC0LTL . . . . . . . . . . . . . .  D ADDR   00C5H   A   
ADC0MX. . . . . . . . . . . . . . .  D ADDR   00BBH   A   
ADC0PWR . . . . . . . . . . . . . .  D ADDR   00DFH   A   
ADC0TK. . . . . . . . . . . . . . .  D ADDR   00B9H   A   
ADC0WC_IRQN . . . . . . . . . . . .  N NUMB   0009H   A   
ADC_CONVERSION_CNT. . . . . . . . .  D ADDR   005EH   A   
ADJUST_TIMING_TWO_STEPS . . . . . .  C ADDR   07E9H   A   
ADJUST_TIMING_TWO_STEPS_FAST. . . .  C ADDR   084EH   A   
APWMFET . . . . . . . . . . . . . .  N NUMB   0005H   A   
ARMING_CHECK. . . . . . . . . . . .  C ADDR   0F2BH   A   
ARMING_INITIAL_ARM_CHECK. . . . . .  C ADDR   0F22H   A   
ARMING_START. . . . . . . . . . . .  C ADDR   0F0CH   A   
ARM_END_BEEP. . . . . . . . . . . .  C ADDR   0FC6H   A   
AVERAGE_THROTTLE. . . . . . . . . .  C ADDR   0CEDH   A   
AVERAGE_THROTTLE_DIV. . . . . . . .  C ADDR   0D0CH   A   
AVERAGE_THROTTLE_MEAS . . . . . . .  C ADDR   0CFDH   A   
A_. . . . . . . . . . . . . . . . .  N NUMB   0001H   A   
B . . . . . . . . . . . . . . . . .  D ADDR   00F0H   A   
BAUDH . . . . . . . . . . . . . . .  D ADDR   0025H   A   
BAUDL . . . . . . . . . . . . . . .  D ADDR   0024H   A   
BAUDTIME. . . . . . . . . . . . . .  N NUMB   FFE6H   A   
BCOMFET . . . . . . . . . . . . . .  N NUMB   0001H   A   
BEEP. . . . . . . . . . . . . . . .  C ADDR   0AE4H   A   
BEEP_APWMFET_OFF. . . . . . . . . .  C ADDR   0B17H   A   
BEEP_APWMFET_ON . . . . . . . . . .  C ADDR   0B07H   A   
BEEP_CPWMFET_OFF. . . . . . . . . .  C ADDR   0B1CH   A   
BEEP_CPWMFET_ON . . . . . . . . . .  C ADDR   0B0CH   A   
BEEP_DELAY_SET. . . . . . . . . . .  C ADDR   0FFEH   A   
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   550

BEEP_F1 . . . . . . . . . . . . . .  C ADDR   0ACCH   A   
BEEP_F2 . . . . . . . . . . . . . .  C ADDR   0AD2H   A   
BEEP_F3 . . . . . . . . . . . . . .  C ADDR   0AD8H   A   
BEEP_F4 . . . . . . . . . . . . . .  C ADDR   0ADEH   A   
BEEP_OFF. . . . . . . . . . . . . .  C ADDR   0B25H   A   
BEEP_ONOFF. . . . . . . . . . . . .  C ADDR   0AECH   A   
BEEP_START. . . . . . . . . . . . .  C ADDR   0AEAH   A   
BEEP_STRENGTH . . . . . . . . . . .  D ADDR   0064H   A   
BIT_ACCESS. . . . . . . . . . . . .  D ADDR   0020H   A   
BIT_ACCESS_INT. . . . . . . . . . .  D ADDR   0021H   A   
BIT_CNT . . . . . . . . . . . . . .  D ADDR   0026H   A   
BIT_REG . . . . . . . . . . . . . .  D ADDR   0020H   A   
BL_FLASH_KEY_1. . . . . . . . . . .  D ADDR   0029H   A   
BL_FLASH_KEY_2. . . . . . . . . . .  D ADDR   002AH   A   
BOOTLOADER_DONE . . . . . . . . . .  C ADDR   0DB5H   A   
BOOT_BAUDRATE . . . . . . . . . . .  N NUMB   4B00H   A   
BOOT_DELAY. . . . . . . . . . . . .  N NUMB   1E10H   A   
BOOT_INFO . . . . . . . . . . . . .  C ADDR   1DF2H   A   
BOOT_MSG. . . . . . . . . . . . . .  C ADDR   1DEEH   A   
BOOT_PAGES. . . . . . . . . . . . .  N NUMB   0001H   A   
BOOT_SIGN . . . . . . . . . . . . .  C ADDR   1DE8H   A   
BOOT_START. . . . . . . . . . . . .  N NUMB   1C00H   A   
BOOT_VERSION. . . . . . . . . . . .  N NUMB   0006H   A   
BPWMFET . . . . . . . . . . . . . .  N NUMB   0004H   A   
BYTE_CNTH . . . . . . . . . . . . .  D ADDR   0028H   A   
BYTE_CNTL . . . . . . . . . . . . .  D ADDR   0027H   A   
BYTE_REG. . . . . . . . . . . . . .  D ADDR   0021H   A   
B_. . . . . . . . . . . . . . . . .  N NUMB   0002H   A   
B_B0. . . . . . . . . . . . . . . .  B ADDR   00F0H.0 A   
B_B1. . . . . . . . . . . . . . . .  B ADDR   00F0H.1 A   
B_B2. . . . . . . . . . . . . . . .  B ADDR   00F0H.2 A   
B_B3. . . . . . . . . . . . . . . .  B ADDR   00F0H.3 A   
B_B4. . . . . . . . . . . . . . . .  B ADDR   00F0H.4 A   
B_B5. . . . . . . . . . . . . . . .  B ADDR   00F0H.5 A   
B_B6. . . . . . . . . . . . . . . .  B ADDR   00F0H.6 A   
B_B7. . . . . . . . . . . . . . . .  B ADDR   00F0H.7 A   
CALC_NEW_WAIT_PER_DEMAG_DONE. . . .  C ADDR   072CH   A   
CALC_NEW_WAIT_PER_STARTUP_DONE. . .  C ADDR   0710H   A   
CALC_NEW_WAIT_TIMES . . . . . . . .  C ADDR   07B7H   A   
CALC_NEW_WAIT_TIMES_EXIT. . . . . .  C ADDR   0758H   A   
CALC_NEW_WAIT_TIMES_FAST. . . . . .  C ADDR   0835H   A   
CALC_NEW_WAIT_TIMES_FAST_DONE . . .  C ADDR   07A3H   A   
CALC_NEW_WAIT_TIMES_SETUP . . . . .  C ADDR   0701H   A   
CALC_NEXT_COMM_AVG_PERIOD_DIV . . .  C ADDR   06D3H   A   
CALC_NEXT_COMM_NEW_PERIOD_DIV . . .  C ADDR   06E6H   A   
CALC_NEXT_COMM_NEW_PERIOD_DIV_DONE.  C ADDR   06EFH   A   
CALC_NEXT_COMM_NORMAL . . . . . . .  C ADDR   06B4H   A   
CALC_NEXT_COMM_STARTUP. . . . . . .  C ADDR   0676H   A   
CALC_NEXT_COMM_STARTUP_AVERAGE. . .  C ADDR   0699H   A   
CALC_NEXT_COMM_STARTUP_NO_X . . . .  C ADDR   0686H   A   
CALC_NEXT_COMM_TIMING . . . . . . .  C ADDR   064BH   A   
CALC_NEXT_COMM_TIMING_FAST. . . . .  C ADDR   075BH   A   
CCOMFET . . . . . . . . . . . . . .  N NUMB   0002H   A   
CENTER_THROTTLE_H . . . . . . . . .  D ADDR   0034H   A   
CENTER_THROTTLE_L . . . . . . . . .  D ADDR   0033H   A   
CHECK_DSHOT_CMD . . . . . . . . . .  C ADDR   104FH   A   
CHECK_TEMP_VOLTAGE_AND_LIMIT_POWER.  C ADDR   05CEH   A   
CHECK_VOLTAGE_START . . . . . . . .  C ADDR   062AH   A   
CKCON0. . . . . . . . . . . . . . .  D ADDR   008EH   A   
CLEAR_DSHOT_CMD . . . . . . . . . .  C ADDR   11E3H   A   
CLEAR_RAM . . . . . . . . . . . . .  C ADDR   0D7DH   A   
CLKSEL. . . . . . . . . . . . . . .  D ADDR   00A9H   A   
CLOCK_SET_AT_48MHZ. . . . . . . . .  D ADDR   0066H   A   
CMDH. . . . . . . . . . . . . . . .    REG    R5          
CMDL. . . . . . . . . . . . . . . .    REG    R4          
CMP0CN0 . . . . . . . . . . . . . .  D ADDR   009BH   A   
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   551

CMP0MD. . . . . . . . . . . . . . .  D ADDR   009DH   A   
CMP0MX. . . . . . . . . . . . . . .  D ADDR   009FH   A   
CMP0_IRQN . . . . . . . . . . . . .  N NUMB   000CH   A   
CMP1CN0 . . . . . . . . . . . . . .  D ADDR   00BFH   A   
CMP1MD. . . . . . . . . . . . . . .  D ADDR   00ABH   A   
CMP1MX. . . . . . . . . . . . . . .  D ADDR   00AAH   A   
CMP1_IRQN . . . . . . . . . . . . .  N NUMB   000DH   A   
CNTH. . . . . . . . . . . . . . . .    REG    R7          
CNTL. . . . . . . . . . . . . . . .    REG    R6          
COMM12_REV. . . . . . . . . . . . .  C ADDR   0A0EH   A   
COMM1COMM2. . . . . . . . . . . . .  C ADDR   09FBH   A   
COMM23_REV. . . . . . . . . . . . .  C ADDR   0A31H   A   
COMM2COMM3. . . . . . . . . . . . .  C ADDR   0A1EH   A   
COMM34_REV. . . . . . . . . . . . .  C ADDR   0A54H   A   
COMM3COMM4. . . . . . . . . . . . .  C ADDR   0A41H   A   
COMM45_REV. . . . . . . . . . . . .  C ADDR   0A77H   A   
COMM4COMM5. . . . . . . . . . . . .  C ADDR   0A64H   A   
COMM56_REV. . . . . . . . . . . . .  C ADDR   0A9AH   A   
COMM5COMM6. . . . . . . . . . . . .  C ADDR   0A87H   A   
COMM61_REV. . . . . . . . . . . . .  C ADDR   0ABDH   A   
COMM6COMM1. . . . . . . . . . . . .  C ADDR   0AAAH   A   
COMM_EXIT . . . . . . . . . . . . .  C ADDR   0ACBH   A   
COMM_PERIOD4X_H . . . . . . . . . .  D ADDR   0048H   A   
COMM_PERIOD4X_L . . . . . . . . . .  D ADDR   0047H   A   
COMPARATOR_READ_CNT . . . . . . . .  D ADDR   0049H   A   
COMP_CHECK_TIMEOUT. . . . . . . . .  C ADDR   08F7H   A   
COMP_CHECK_TIMEOUT_EXTEND_TIMEOUT .  C ADDR   0908H   A   
COMP_CHECK_TIMEOUT_NOT_TIMED_OUT. .  C ADDR   090AH   A   
COMP_CHECK_TIMEOUT_TIMEOUT_EXTENDED  C ADDR   0904H   A   
COMP_COM. . . . . . . . . . . . . .  N NUMB   0002H   A   
COMP_READ_OK. . . . . . . . . . . .  C ADDR   0961H   A   
COMP_READ_OK_JMP. . . . . . . . . .  C ADDR   0973H   A   
COMP_READ_WRONG . . . . . . . . . .  C ADDR   0915H   A   
COMP_READ_WRONG_EXTEND_TIMEOUT. . .  C ADDR   092EH   A   
COMP_READ_WRONG_LOAD_TIMEOUT. . . .  C ADDR   0957H   A   
COMP_READ_WRONG_LOW_RPM . . . . . .  C ADDR   094AH   A   
COMP_READ_WRONG_NOT_STARTUP . . . .  C ADDR   0921H   A   
COMP_READ_WRONG_TIMEOUT_SET . . . .  C ADDR   093FH   A   
COMP_SCALE_SAMPLES. . . . . . . . .  C ADDR   08F7H   A   
COMP_TIMED_OUT. . . . . . . . . . .  N NUMB   0002H   A   
CPWMFET . . . . . . . . . . . . . .  N NUMB   0003H   A   
CRC0AUTO. . . . . . . . . . . . . .  D ADDR   00D2H   A   
CRC0CN0 . . . . . . . . . . . . . .  D ADDR   00CEH   A   
CRC0CNT . . . . . . . . . . . . . .  D ADDR   00D3H   A   
CRC0DAT . . . . . . . . . . . . . .  D ADDR   00DEH   A   
CRC0FLIP. . . . . . . . . . . . . .  D ADDR   00CFH   A   
CRC0IN. . . . . . . . . . . . . . .  D ADDR   00DDH   A   
CRCH. . . . . . . . . . . . . . . .  D ADDR   0023H   A   
CRCL. . . . . . . . . . . . . . . .  D ADDR   0022H   A   
CURRENT_AVERAGE_TEMP. . . . . . . .  D ADDR   005FH   A   
CURRENT_POWER_PWM_REG_H . . . . . .  D ADDR   005AH   A   
C_. . . . . . . . . . . . . . . . .  N NUMB   0003H   A   
DAMP_PWM_REG_H. . . . . . . . . . .  D ADDR   0059H   A   
DAMP_PWM_REG_L. . . . . . . . . . .  D ADDR   0058H   A   
DEBUGPIN. . . . . . . . . . . . . .  N NUMB   0000H   A   
DECODE_DEMAG_DONE . . . . . . . . .  C ADDR   0C0CH   A   
DECODE_DEMAG_HIGH . . . . . . . . .  C ADDR   0C06H   A   
DECODE_SETTINGS . . . . . . . . . .  C ADDR   0BCAH   A   
DECODE_TEMP_DONE. . . . . . . . . .  C ADDR   0C18H   A   
DECODE_TEMP_STEP. . . . . . . . . .  C ADDR   0C14H   A   
DEFAULT_PGM_BEACON_DELAY. . . . . .  N NUMB   0004H   A   
DEFAULT_PGM_BEACON_STRENGTH . . . .  N NUMB   0050H   A   
DEFAULT_PGM_BEEP_STRENGTH . . . . .  N NUMB   0028H   A   
DEFAULT_PGM_BRAKE_ON_STOP . . . . .  N NUMB   0000H   A   
DEFAULT_PGM_CENTER_THROTTLE . . . .  N NUMB   007AH   A   
DEFAULT_PGM_COMM_TIMING . . . . . .  N NUMB   0003H   A   
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   552

DEFAULT_PGM_DEMAG_COMP. . . . . . .  N NUMB   0002H   A   
DEFAULT_PGM_DIRECTION . . . . . . .  N NUMB   0001H   A   
DEFAULT_PGM_ENABLE_POWER_PROT . . .  N NUMB   0001H   A   
DEFAULT_PGM_ENABLE_TEMP_PROT. . . .  N NUMB   0007H   A   
DEFAULT_PGM_ENABLE_TX_PROGRAM . . .  N NUMB   0001H   A   
DEFAULT_PGM_LED_CONTROL . . . . . .  N NUMB   0000H   A   
DEFAULT_PGM_MAX_THROTTLE. . . . . .  N NUMB   00D0H   A   
DEFAULT_PGM_MIN_THROTTLE. . . . . .  N NUMB   0025H   A   
DEFAULT_PGM_STARTUP_PWR . . . . . .  N NUMB   0009H   A   
DEMAG_DETECTED. . . . . . . . . . .  N NUMB   0001H   A   
DEMAG_DETECTED_METRIC . . . . . . .  D ADDR   003DH   A   
DEMAG_PWR_OFF_THRESH. . . . . . . .  D ADDR   003EH   A   
DERIVID . . . . . . . . . . . . . .  D ADDR   00ADH   A   
DEVICEID. . . . . . . . . . . . . .  D ADDR   00B5H   A   
DIRECT_START_CHECK_RCP. . . . . . .  C ADDR   12C7H   A   
DIR_CHANGE_BRAKE. . . . . . . . . .  N NUMB   0003H   A   
DONT_CLEAR_DSHOT_CMD. . . . . . . .  C ADDR   11E9H   A   
DP. . . . . . . . . . . . . . . . .  D ADDR   0082H   A   
DPH . . . . . . . . . . . . . . . .  D ADDR   0083H   A   
DPL . . . . . . . . . . . . . . . .  D ADDR   0082H   A   
DSHOT_BEEP_2. . . . . . . . . . . .  C ADDR   106DH   A   
DSHOT_BEEP_3. . . . . . . . . . . .  C ADDR   108BH   A   
DSHOT_BEEP_4. . . . . . . . . . . .  C ADDR   10A9H   A   
DSHOT_BEEP_5. . . . . . . . . . . .  C ADDR   10C7H   A   
DSHOT_CMD . . . . . . . . . . . . .  D ADDR   0052H   A   
DSHOT_CMD_CNT . . . . . . . . . . .  D ADDR   0053H   A   
DSHOT_DIRECTION_1 . . . . . . . . .  C ADDR   10E5H   A   
DSHOT_DIRECTION_2 . . . . . . . . .  C ADDR   1105H   A   
DSHOT_DIRECTION_BIDIR_OFF . . . . .  C ADDR   1125H   A   
DSHOT_DIRECTION_BIDIR_ON. . . . . .  C ADDR   1143H   A   
DSHOT_DIRECTION_NORMAL. . . . . . .  C ADDR   1160H   A   
DSHOT_DIRECTION_REVERSE . . . . . .  C ADDR   118CH   A   
DSHOT_FRAME_LENGTH_THR. . . . . . .  D ADDR   006EH   A   
DSHOT_FRAME_START_H . . . . . . . .  D ADDR   006DH   A   
DSHOT_FRAME_START_L . . . . . . . .  D ADDR   006CH   A   
DSHOT_PWM_THR . . . . . . . . . . .  D ADDR   006AH   A   
DSHOT_SAVE_SETTINGS . . . . . . . .  C ADDR   11CBH   A   
DSHOT_TIMER_PRESET. . . . . . . . .  D ADDR   006BH   A   
D_. . . . . . . . . . . . . . . . .  N NUMB   0004H   A   
EEPROM_FW_MAIN_REVISION . . . . . .  N NUMB   0010H   A   
EEPROM_FW_SUB_REVISION. . . . . . .  N NUMB   0007H   A   
EEPROM_LAYOUT_REVISION. . . . . . .  N NUMB   0021H   A   
EEP_DUMMY . . . . . . . . . . . . .  C ADDR   1A29H   A   
EEP_ENABLE_TX_PROGRAM . . . . . . .  C ADDR   1A0FH   A   
EEP_ESC_LAYOUT. . . . . . . . . . .  C ADDR   1A40H   A   
EEP_ESC_MCU . . . . . . . . . . . .  C ADDR   1A50H   A   
EEP_FW_MAIN_REVISION. . . . . . . .  C ADDR   1A00H   A   
EEP_FW_SUB_REVISION . . . . . . . .  C ADDR   1A01H   A   
EEP_INITIALIZED_H . . . . . . . . .  C ADDR   1A0EH   A   
EEP_INITIALIZED_L . . . . . . . . .  C ADDR   1A0DH   A   
EEP_LAYOUT_REVISION . . . . . . . .  C ADDR   1A02H   A   
EEP_NAME. . . . . . . . . . . . . .  C ADDR   1A60H   A   
EEP_PGM_BEACON_DELAY. . . . . . . .  C ADDR   1A1DH   A   
EEP_PGM_BEACON_STRENGTH . . . . . .  C ADDR   1A1CH   A   
EEP_PGM_BEEP_STRENGTH . . . . . . .  C ADDR   1A1BH   A   
EEP_PGM_BRAKE_ON_STOP . . . . . . .  C ADDR   1A27H   A   
EEP_PGM_CENTER_THROTTLE . . . . . .  C ADDR   1A21H   A   
EEP_PGM_COMM_TIMING . . . . . . . .  C ADDR   1A15H   A   
EEP_PGM_DEMAG_COMP. . . . . . . . .  C ADDR   1A1FH   A   
EEP_PGM_DIRECTION . . . . . . . . .  C ADDR   1A0BH   A   
EEP_PGM_ENABLE_POWER_PROT . . . . .  C ADDR   1A24H   A   
EEP_PGM_LED_CONTROL . . . . . . . .  C ADDR   1A28H   A   
EEP_PGM_MAX_THROTTLE. . . . . . . .  C ADDR   1A1AH   A   
EEP_PGM_MIN_THROTTLE. . . . . . . .  C ADDR   1A19H   A   
EEP_PGM_STARTUP_PWR . . . . . . . .  C ADDR   1A09H   A   
EEP_PGM_TEMP_PROT_ENABLE. . . . . .  C ADDR   1A23H   A   
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   553

EIE1. . . . . . . . . . . . . . . .  D ADDR   00E6H   A   
EIP1. . . . . . . . . . . . . . . .  D ADDR   00F3H   A   
ERASE_AND_STORE_ALL_IN_EEPROM . . .  C ADDR   13CEH   A   
ERASE_FLASH . . . . . . . . . . . .  C ADDR   1427H   A   
ERRORCOMMAND. . . . . . . . . . . .  N NUMB   00C1H   A   
ERRORCRC. . . . . . . . . . . . . .  N NUMB   00C2H   A   
ERRORPROG . . . . . . . . . . . . .  N NUMB   00C5H   A   
ERRORVERIFY . . . . . . . . . . . .  N NUMB   00C0H   A   
ESCNO . . . . . . . . . . . . . . .  N NUMB   000BH   A   
EVALUATE_COMPARATOR_INTEGRITY . . .  C ADDR   0995H   A   
EVAL_COMP_CHECK_TIMEOUT . . . . . .  C ADDR   09A2H   A   
EVAL_COMP_EXIT. . . . . . . . . . .  C ADDR   09B2H   A   
EXIT. . . . . . . . . . . . . . . .  C ADDR   1CBAH   A   
E_. . . . . . . . . . . . . . . . .  N NUMB   0005H   A   
FETON_DELAY . . . . . . . . . . . .  N NUMB   000FH   A   
FIND_THROTTLE_GAIN. . . . . . . . .  C ADDR   0C9EH   A   
FIND_THROTTLE_GAINS . . . . . . . .  C ADDR   0C38H   A   
FIND_THROTTLE_GAINS_BIDIR_DONE. . .  C ADDR   0C71H   A   
FIND_THROTTLE_GAINS_NORMAL. . . . .  C ADDR   0C4CH   A   
FIND_THROTTLE_GAIN_FWD. . . . . . .  C ADDR   0C97H   A   
FIND_THROTTLE_GAIN_LOOP . . . . . .  C ADDR   0CC9H   A   
FLAGS0. . . . . . . . . . . . . . .  D ADDR   0024H   A   
FLAGS1. . . . . . . . . . . . . . .  D ADDR   0025H   A   
FLAGS2. . . . . . . . . . . . . . .  D ADDR   0026H   A   
FLAGS3. . . . . . . . . . . . . . .  D ADDR   0027H   A   
FLASH_KEY_1 . . . . . . . . . . . .  D ADDR   0067H   A   
FLASH_KEY_2 . . . . . . . . . . . .  D ADDR   0068H   A   
FLKEY . . . . . . . . . . . . . . .  D ADDR   00B7H   A   
F_. . . . . . . . . . . . . . . . .  N NUMB   0006H   A   
GET1. . . . . . . . . . . . . . . .  C ADDR   1D96H   A   
GET2. . . . . . . . . . . . . . . .  C ADDR   1DABH   A   
GET3. . . . . . . . . . . . . . . .  C ADDR   1DCFH   A   
GETC. . . . . . . . . . . . . . . .  C ADDR   1D91H   A   
GETW. . . . . . . . . . . . . . . .  C ADDR   1D8DH   A   
GETX. . . . . . . . . . . . . . . .  C ADDR   1D9BH   A   
G_. . . . . . . . . . . . . . . . .  N NUMB   0007H   A   
HFO0CAL . . . . . . . . . . . . . .  D ADDR   00C7H   A   
HIGH_RPM. . . . . . . . . . . . . .  N NUMB   0004H   A   
H_. . . . . . . . . . . . . . . . .  N NUMB   0008H   A   
ID1 . . . . . . . . . . . . . . . .  C ADDR   1C4DH   A   
ID3 . . . . . . . . . . . . . . . .  C ADDR   1C58H   A   
ID4 . . . . . . . . . . . . . . . .  C ADDR   1C63H   A   
ID5 . . . . . . . . . . . . . . . .  C ADDR   1C70H   A   
IE. . . . . . . . . . . . . . . . .  D ADDR   00A8H   A   
IE_EA . . . . . . . . . . . . . . .  B ADDR   00A8H.7 A   
IE_ES0. . . . . . . . . . . . . . .  B ADDR   00A8H.4 A   
IE_ESPI0. . . . . . . . . . . . . .  B ADDR   00A8H.6 A   
IE_ET0. . . . . . . . . . . . . . .  B ADDR   00A8H.1 A   
IE_ET1. . . . . . . . . . . . . . .  B ADDR   00A8H.3 A   
IE_ET2. . . . . . . . . . . . . . .  B ADDR   00A8H.5 A   
IE_EX0. . . . . . . . . . . . . . .  B ADDR   00A8H.0 A   
IE_EX1. . . . . . . . . . . . . . .  B ADDR   00A8H.2 A   
IN1 . . . . . . . . . . . . . . . .  C ADDR   1C7AH   A   
INIT. . . . . . . . . . . . . . . .  C ADDR   1C00H   A   
INITIALIZED_H_DUMMY . . . . . . . .  I ADDR   008BH   A   
INITIALIZED_L_DUMMY . . . . . . . .  I ADDR   008AH   A   
INITIALIZE_TIMING . . . . . . . . .  C ADDR   0644H   A   
INITIAL_ARM . . . . . . . . . . . .  D ADDR   0030H   A   
INITIAL_RUN_CHECK_STARTUP_ROT . . .  C ADDR   12E4H   A   
INITIAL_RUN_CONTINUE_RUN. . . . . .  C ADDR   12F0H   A   
INITIAL_RUN_PHASE . . . . . . . . .  N NUMB   0001H   A   
INITIAL_RUN_PHASE_DONE. . . . . . .  C ADDR   12F5H   A   
INITIAL_RUN_ROT_CNTD. . . . . . . .  D ADDR   003BH   A   
INIT_NO_SIGNAL. . . . . . . . . . .  C ADDR   0DA2H   A   
INIT_START. . . . . . . . . . . . .  C ADDR   11F1H   A   
INIT_START_BIDIR_DONE . . . . . . .  C ADDR   1235H   A   
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   554

INPUT_HIGH_CHECK_1. . . . . . . . .  C ADDR   0DACH   A   
INPUT_HIGH_CHECK_2. . . . . . . . .  C ADDR   0DAEH   A   
INT0_INT. . . . . . . . . . . . . .  C ADDR   0310H   A   
INT0_INT_BIDIR_DO_DEADBAND. . . . .  C ADDR   0429H   A   
INT0_INT_BIDIR_FWD. . . . . . . . .  C ADDR   0403H   A   
INT0_INT_BIDIR_REV_CHK. . . . . . .  C ADDR   0408H   A   
INT0_INT_CALCULATE. . . . . . . . .  C ADDR   03EAH   A   
INT0_INT_CHECK_FULL_RANGE . . . . .  C ADDR   03D0H   A   
INT0_INT_DO_THROTTLE_GAIN . . . . .  C ADDR   0448H   A   
INT0_INT_EXIT . . . . . . . . . . .  C ADDR   04F5H   A   
INT0_INT_FALL_GAIN_DONE . . . . . .  C ADDR   03ABH   A   
INT0_INT_FALL_NOT_MULTISHOT . . . .  C ADDR   0362H   A   
INT0_INT_FALL_NOT_ONESHOT_125 . . .  C ADDR   038CH   A   
INT0_INT_FALL_NOT_ONESHOT_42. . . .  C ADDR   0374H   A   
INT0_INT_GAIN_LOOP. . . . . . . . .  C ADDR   0481H   A   
INT0_INT_GAIN_RCP_DONE. . . . . . .  C ADDR   0489H   A   
INT0_INT_NOT_BIDIR. . . . . . . . .  C ADDR   043CH   A   
INT0_INT_NOT_DSHOT. . . . . . . . .  C ADDR   031FH   A   
INT0_INT_OUTSIDE_RANGE. . . . . . .  C ADDR   03BAH   A   
INT0_INT_PULSE_READY. . . . . . . .  C ADDR   049EH   A   
INT0_INT_SET_MIN. . . . . . . . . .  C ADDR   03DFH   A   
INT0_INT_SET_PWM_DAMP_SET . . . . .  C ADDR   04D7H   A   
INT0_INT_SET_PWM_REGISTERS. . . . .  C ADDR   04C0H   A   
INT0_INT_SET_TIMEOUT. . . . . . . .  C ADDR   04F2H   A   
INT0_INT_STARTUP_BOOSTED. . . . . .  C ADDR   0467H   A   
INT0_INT_STARTUP_BOOST_STALL. . . .  C ADDR   045EH   A   
INT0_INT_UNIDIR_NEG . . . . . . . .  C ADDR   0440H   A   
INT0_IRQN . . . . . . . . . . . . .  N NUMB   0000H   A   
INT1_INT. . . . . . . . . . . . . .  C ADDR   04FFH   A   
INT1_IRQN . . . . . . . . . . . . .  N NUMB   0002H   A   
IP. . . . . . . . . . . . . . . . .  D ADDR   00B8H   A   
IP_PS0. . . . . . . . . . . . . . .  B ADDR   00B8H.4 A   
IP_PSPI0. . . . . . . . . . . . . .  B ADDR   00B8H.6 A   
IP_PT0. . . . . . . . . . . . . . .  B ADDR   00B8H.1 A   
IP_PT1. . . . . . . . . . . . . . .  B ADDR   00B8H.3 A   
IP_PT2. . . . . . . . . . . . . . .  B ADDR   00B8H.5 A   
IP_PX0. . . . . . . . . . . . . . .  B ADDR   00B8H.0 A   
IP_PX1. . . . . . . . . . . . . . .  B ADDR   00B8H.2 A   
IT01CF. . . . . . . . . . . . . . .  D ADDR   00E4H   A   
I_. . . . . . . . . . . . . . . . .  N NUMB   0009H   A   
JMP_WAIT_FOR_POWER_ON . . . . . . .  C ADDR   1384H   A   
J_. . . . . . . . . . . . . . . . .  N NUMB   000AH   A   
K_. . . . . . . . . . . . . . . . .  N NUMB   000BH   A   
LED_0_DONE. . . . . . . . . . . . .  C ADDR   0D28H   A   
LED_1_DONE. . . . . . . . . . . . .  C ADDR   0D2DH   A   
LED_2_DONE. . . . . . . . . . . . .  C ADDR   0D32H   A   
LED_3_DONE. . . . . . . . . . . . .  C ADDR   0D37H   A   
LED_CONTROL . . . . . . . . . . . .  C ADDR   0D20H   A   
LFO0CN. . . . . . . . . . . . . . .  D ADDR   00B1H   A   
LOAD_MIN_TIME . . . . . . . . . . .  C ADDR   0754H   A   
LOAD_MIN_TIME_FAST. . . . . . . . .  C ADDR   07A1H   A   
LOW_RPM_PWR_SLOPE . . . . . . . . .  D ADDR   003FH   A   
L_. . . . . . . . . . . . . . . . .  N NUMB   000CH   A   
MAI1. . . . . . . . . . . . . . . .  C ADDR   1C84H   A   
MAI2. . . . . . . . . . . . . . . .  C ADDR   1CA6H   A   
MAI4. . . . . . . . . . . . . . . .  C ADDR   1CE0H   A   
MAI5. . . . . . . . . . . . . . . .  C ADDR   1D37H   A   
MAI6. . . . . . . . . . . . . . . .  C ADDR   1D48H   A   
MAIN. . . . . . . . . . . . . . . .  C ADDR   1C82H   A   
MAX_THROTTLE_H. . . . . . . . . . .  D ADDR   0036H   A   
MAX_THROTTLE_L. . . . . . . . . . .  D ADDR   0035H   A   
MCU_48MHZ . . . . . . . . . . . . .  N NUMB   0000H   A   
MIN_THROTTLE_H. . . . . . . . . . .  D ADDR   0032H   A   
MIN_THROTTLE_L. . . . . . . . . . .  D ADDR   0031H   A   
MOTOR_STARTED . . . . . . . . . . .  N NUMB   0002H   A   
MUX_A . . . . . . . . . . . . . . .  N NUMB   0001H   A   
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   555

MUX_B . . . . . . . . . . . . . . .  N NUMB   0003H   A   
MUX_C . . . . . . . . . . . . . . .  N NUMB   0005H   A   
M_. . . . . . . . . . . . . . . . .  N NUMB   000DH   A   
NEW_RCP . . . . . . . . . . . . . .  D ADDR   0054H   A   
NORMAL_RUN_CHECKS . . . . . . . . .  C ADDR   12D3H   A   
N_. . . . . . . . . . . . . . . . .  N NUMB   000EH   A   
O_. . . . . . . . . . . . . . . . .  N NUMB   000FH   A   
P0. . . . . . . . . . . . . . . . .  D ADDR   0080H   A   
P0MASK. . . . . . . . . . . . . . .  D ADDR   00FEH   A   
P0MAT . . . . . . . . . . . . . . .  D ADDR   00FDH   A   
P0MDIN. . . . . . . . . . . . . . .  D ADDR   00F1H   A   
P0MDOUT . . . . . . . . . . . . . .  D ADDR   00A4H   A   
P0SKIP. . . . . . . . . . . . . . .  D ADDR   00D4H   A   
P0_B0 . . . . . . . . . . . . . . .  B ADDR   0080H.0 A   
P0_B1 . . . . . . . . . . . . . . .  B ADDR   0080H.1 A   
P0_B2 . . . . . . . . . . . . . . .  B ADDR   0080H.2 A   
P0_B3 . . . . . . . . . . . . . . .  B ADDR   0080H.3 A   
P0_B4 . . . . . . . . . . . . . . .  B ADDR   0080H.4 A   
P0_B5 . . . . . . . . . . . . . . .  B ADDR   0080H.5 A   
P0_B6 . . . . . . . . . . . . . . .  B ADDR   0080H.6 A   
P0_B7 . . . . . . . . . . . . . . .  B ADDR   0080H.7 A   
P0_DIGITAL. . . . . . . . . . . . .  N NUMB   FFD1H   A   
P0_INIT . . . . . . . . . . . . . .  N NUMB   00FFH   A   
P0_PUSHPULL . . . . . . . . . . . .  N NUMB   0000H   A   
P0_SKIP . . . . . . . . . . . . . .  N NUMB   00FFH   A   
P1. . . . . . . . . . . . . . . . .  D ADDR   0090H   A   
P1MASK. . . . . . . . . . . . . . .  D ADDR   00EEH   A   
P1MAT . . . . . . . . . . . . . . .  D ADDR   00EDH   A   
P1MDIN. . . . . . . . . . . . . . .  D ADDR   00F2H   A   
P1MDOUT . . . . . . . . . . . . . .  D ADDR   00A5H   A   
P1SKIP. . . . . . . . . . . . . . .  D ADDR   00D5H   A   
P1_B0 . . . . . . . . . . . . . . .  B ADDR   0090H.0 A   
P1_B1 . . . . . . . . . . . . . . .  B ADDR   0090H.1 A   
P1_B2 . . . . . . . . . . . . . . .  B ADDR   0090H.2 A   
P1_B3 . . . . . . . . . . . . . . .  B ADDR   0090H.3 A   
P1_B4 . . . . . . . . . . . . . . .  B ADDR   0090H.4 A   
P1_B5 . . . . . . . . . . . . . . .  B ADDR   0090H.5 A   
P1_B6 . . . . . . . . . . . . . . .  B ADDR   0090H.6 A   
P1_B7 . . . . . . . . . . . . . . .  B ADDR   0090H.7 A   
P1_DIGITAL. . . . . . . . . . . . .  N NUMB   003FH   A   
P1_INIT . . . . . . . . . . . . . .  N NUMB   0007H   A   
P1_PUSHPULL . . . . . . . . . . . .  N NUMB   003FH   A   
P1_SKIP . . . . . . . . . . . . . .  N NUMB   003FH   A   
P2. . . . . . . . . . . . . . . . .  D ADDR   00A0H   A   
P2MDOUT . . . . . . . . . . . . . .  D ADDR   00A6H   A   
P2_B0 . . . . . . . . . . . . . . .  B ADDR   00A0H.0 A   
P2_B1 . . . . . . . . . . . . . . .  B ADDR   00A0H.1 A   
P2_PUSHPULL . . . . . . . . . . . .  N NUMB   0001H   A   
PARAH . . . . . . . . . . . . . . .    REG    R3          
PARAL . . . . . . . . . . . . . . .    REG    R2          
PCA0. . . . . . . . . . . . . . . .  D ADDR   00F9H   A   
PCA0CENT. . . . . . . . . . . . . .  D ADDR   009EH   A   
PCA0CLR . . . . . . . . . . . . . .  D ADDR   009CH   A   
PCA0CN0 . . . . . . . . . . . . . .  D ADDR   00D8H   A   
PCA0CN0_CCF0. . . . . . . . . . . .  B ADDR   00D8H.0 A   
PCA0CN0_CCF1. . . . . . . . . . . .  B ADDR   00D8H.1 A   
PCA0CN0_CCF2. . . . . . . . . . . .  B ADDR   00D8H.2 A   
PCA0CN0_CF. . . . . . . . . . . . .  B ADDR   00D8H.7 A   
PCA0CN0_CR. . . . . . . . . . . . .  B ADDR   00D8H.6 A   
PCA0CP0 . . . . . . . . . . . . . .  D ADDR   00FBH   A   
PCA0CP1 . . . . . . . . . . . . . .  D ADDR   00E9H   A   
PCA0CP2 . . . . . . . . . . . . . .  D ADDR   00EBH   A   
PCA0CPH0. . . . . . . . . . . . . .  D ADDR   00FCH   A   
PCA0CPH1. . . . . . . . . . . . . .  D ADDR   00EAH   A   
PCA0CPH2. . . . . . . . . . . . . .  D ADDR   00ECH   A   
PCA0CPL0. . . . . . . . . . . . . .  D ADDR   00FBH   A   
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   556

PCA0CPL1. . . . . . . . . . . . . .  D ADDR   00E9H   A   
PCA0CPL2. . . . . . . . . . . . . .  D ADDR   00EBH   A   
PCA0CPM0. . . . . . . . . . . . . .  D ADDR   00DAH   A   
PCA0CPM1. . . . . . . . . . . . . .  D ADDR   00DBH   A   
PCA0CPM2. . . . . . . . . . . . . .  D ADDR   00DCH   A   
PCA0H . . . . . . . . . . . . . . .  D ADDR   00FAH   A   
PCA0L . . . . . . . . . . . . . . .  D ADDR   00F9H   A   
PCA0MD. . . . . . . . . . . . . . .  D ADDR   00D9H   A   
PCA0POL . . . . . . . . . . . . . .  D ADDR   0096H   A   
PCA0PWM . . . . . . . . . . . . . .  D ADDR   00F7H   A   
PCA0_IRQN . . . . . . . . . . . . .  N NUMB   000BH   A   
PCA_INT . . . . . . . . . . . . . .  C ADDR   050EH   A   
PCA_INT_EXIT. . . . . . . . . . . .  C ADDR   0557H   A   
PCA_INT_HI_PWM. . . . . . . . . . .  C ADDR   0527H   A   
PCA_INT_SET_PWM . . . . . . . . . .  C ADDR   052FH   A   
PCON0 . . . . . . . . . . . . . . .  D ADDR   0087H   A   
PGM_BEACON_DELAY. . . . . . . . . .  I ADDR   009AH   A   
PGM_BEACON_STRENGTH . . . . . . . .  I ADDR   0099H   A   
PGM_BEEP_STRENGTH . . . . . . . . .  I ADDR   0098H   A   
PGM_BIDIR . . . . . . . . . . . . .  N NUMB   0002H   A   
PGM_BIDIR_REV . . . . . . . . . . .  N NUMB   0001H   A   
PGM_BRAKE_ON_STOP . . . . . . . . .  I ADDR   00A4H   A   
PGM_CENTER_THROTTLE . . . . . . . .  I ADDR   009EH   A   
PGM_COMM_TIMING . . . . . . . . . .  I ADDR   0092H   A   
PGM_DEMAG_COMP. . . . . . . . . . .  I ADDR   009CH   A   
PGM_DIRECTION . . . . . . . . . . .  I ADDR   0088H   A   
PGM_DIR_REV . . . . . . . . . . . .  N NUMB   0000H   A   
PGM_ENABLE_POWER_PROT . . . . . . .  I ADDR   00A1H   A   
PGM_ENABLE_TEMP_PROT. . . . . . . .  I ADDR   00A0H   A   
PGM_ENABLE_TX_PROGRAM . . . . . . .  I ADDR   008CH   A   
PGM_INPUT_POL . . . . . . . . . . .  I ADDR   0089H   A   
PGM_LED_CONTROL . . . . . . . . . .  I ADDR   00A5H   A   
PGM_MAX_THROTTLE. . . . . . . . . .  I ADDR   0097H   A   
PGM_MIN_THROTTLE. . . . . . . . . .  I ADDR   0096H   A   
PGM_START . . . . . . . . . . . . .  C ADDR   0D38H   A   
PGM_STARTUP_PWR . . . . . . . . . .  I ADDR   0086H   A   
PGM_STARTUP_PWR_DECODED . . . . . .  I ADDR   00A6H   A   
PMATCH_IRQN . . . . . . . . . . . .  N NUMB   0008H   A   
POLYNOM . . . . . . . . . . . . . .  N NUMB   A001H   A   
POWER_ON_WAIT_CNT_H . . . . . . . .  D ADDR   0038H   A   
POWER_ON_WAIT_CNT_L . . . . . . . .  D ADDR   0037H   A   
POWER_PWM_REG_H . . . . . . . . . .  D ADDR   0057H   A   
POWER_PWM_REG_L . . . . . . . . . .  D ADDR   0056H   A   
PREV_COMM_H . . . . . . . . . . . .  D ADDR   0043H   A   
PREV_COMM_L . . . . . . . . . . . .  D ADDR   0042H   A   
PREV_COMM_X . . . . . . . . . . . .  D ADDR   0044H   A   
PREV_PREV_COMM_H. . . . . . . . . .  D ADDR   0046H   A   
PREV_PREV_COMM_L. . . . . . . . . .  D ADDR   0045H   A   
PRO3. . . . . . . . . . . . . . . .  C ADDR   1D0BH   A   
PRO4. . . . . . . . . . . . . . . .  C ADDR   1D17H   A   
PRO5. . . . . . . . . . . . . . . .  C ADDR   1D1DH   A   
PRO6. . . . . . . . . . . . . . . .  C ADDR   1D32H   A   
PROGRAM_BY_TX_CHECKED . . . . . . .  C ADDR   0FB4H   A   
PROGRAM_BY_TX_ENTRY_LIMIT . . . . .  C ADDR   0F9DH   A   
PROGRAM_BY_TX_ENTRY_STORE . . . . .  C ADDR   0FA3H   A   
PROGRAM_BY_TX_ENTRY_WAIT. . . . . .  C ADDR   0FACH   A   
PRTDRV. . . . . . . . . . . . . . .  D ADDR   00F6H   A   
PSCTL . . . . . . . . . . . . . . .  D ADDR   008FH   A   
PSW . . . . . . . . . . . . . . . .  D ADDR   00D0H   A   
PSW_AC. . . . . . . . . . . . . . .  B ADDR   00D0H.6 A   
PSW_CY. . . . . . . . . . . . . . .  B ADDR   00D0H.7 A   
PSW_F0. . . . . . . . . . . . . . .  B ADDR   00D0H.5 A   
PSW_F1. . . . . . . . . . . . . . .  B ADDR   00D0H.1 A   
PSW_OV. . . . . . . . . . . . . . .  B ADDR   00D0H.2 A   
PSW_PARITY. . . . . . . . . . . . .  B ADDR   00D0H.0 A   
PSW_RS0 . . . . . . . . . . . . . .  B ADDR   00D0H.3 A   
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   557

PSW_RS1 . . . . . . . . . . . . . .  B ADDR   00D0H.4 A   
PUT1. . . . . . . . . . . . . . . .  C ADDR   1D58H   A   
PUT2. . . . . . . . . . . . . . . .  C ADDR   1D6BH   A   
PUT3. . . . . . . . . . . . . . . .  C ADDR   1D77H   A   
PUT4. . . . . . . . . . . . . . . .  C ADDR   1D89H   A   
PUTC. . . . . . . . . . . . . . . .  C ADDR   1D6EH   A   
PUTP. . . . . . . . . . . . . . . .  C ADDR   1D52H   A   
PUTW. . . . . . . . . . . . . . . .  C ADDR   1D4AH   A   
PWM_LIMIT . . . . . . . . . . . . .  D ADDR   005BH   A   
PWM_LIMIT_BEG . . . . . . . . . . .  D ADDR   005DH   A   
PWM_LIMIT_BY_RPM. . . . . . . . . .  D ADDR   005CH   A   
P_. . . . . . . . . . . . . . . . .  N NUMB   0010H   A   
Q_. . . . . . . . . . . . . . . . .  N NUMB   0011H   A   
RCP_DIR_REV . . . . . . . . . . . .  N NUMB   0005H   A   
RCP_DSHOT . . . . . . . . . . . . .  N NUMB   0004H   A   
RCP_FULL_RANGE. . . . . . . . . . .  N NUMB   0006H   A   
RCP_IN. . . . . . . . . . . . . . .  N NUMB   0000H   A   
RCP_MULTISHOT . . . . . . . . . . .  N NUMB   0003H   A   
RCP_ONESHOT125. . . . . . . . . . .  N NUMB   0001H   A   
RCP_ONESHOT42 . . . . . . . . . . .  N NUMB   0002H   A   
RCP_OUTSIDE_RANGE_CNT . . . . . . .  D ADDR   0022H   A   
RCP_STOP_CNT. . . . . . . . . . . .  D ADDR   0055H   A   
RCP_TIMEOUT_CNTD. . . . . . . . . .  D ADDR   0023H   A   
RCP_UPDATED . . . . . . . . . . . .  N NUMB   0000H   A   
RD1 . . . . . . . . . . . . . . . .  C ADDR   1D3CH   A   
READ_ALL_EEPROM_PARAMETERS. . . . .  C ADDR   1387H   A   
READ_EEPROM_BLOCK1. . . . . . . . .  C ADDR   13B7H   A   
READ_EEPROM_BLOCK2. . . . . . . . .  C ADDR   13C4H   A   
READ_EEPROM_BYTE. . . . . . . . . .  C ADDR   1407H   A   
READ_EEPROM_EXIT. . . . . . . . . .  C ADDR   13CDH   A   
READ_EEPROM_READ. . . . . . . . . .  C ADDR   13B0H   A   
READ_EEPROM_STORE_DEFAULTS. . . . .  C ADDR   139DH   A   
READ_INITIAL_TEMP . . . . . . . . .  C ADDR   120BH   A   
READ_TAG. . . . . . . . . . . . . .  C ADDR   1453H   A   
READ_TAGS . . . . . . . . . . . . .  C ADDR   144AH   A   
REF0CN. . . . . . . . . . . . . . .  D ADDR   00D1H   A   
REG0CN. . . . . . . . . . . . . . .  D ADDR   00C9H   A   
RESET . . . . . . . . . . . . . . .  C ADDR   19FDH   A   
REVID . . . . . . . . . . . . . . .  D ADDR   00B6H   A   
RST . . . . . . . . . . . . . . . .  C ADDR   1CC9H   A   
RSTSRC. . . . . . . . . . . . . . .  D ADDR   00EFH   A   
RTX_MDIN. . . . . . . . . . . . . .  D ADDR   00F1H   A   
RTX_MDOUT . . . . . . . . . . . . .  D ADDR   00A4H   A   
RTX_PIN . . . . . . . . . . . . . .  N NUMB   0000H   A   
RTX_PORT. . . . . . . . . . . . . .  D ADDR   0080H   A   
RTX_SKIP. . . . . . . . . . . . . .  D ADDR   00D4H   A   
RUN1. . . . . . . . . . . . . . . .  C ADDR   124FH   A   
RUN2. . . . . . . . . . . . . . . .  C ADDR   125BH   A   
RUN3. . . . . . . . . . . . . . . .  C ADDR   1273H   A   
RUN4. . . . . . . . . . . . . . . .  C ADDR   127FH   A   
RUN5. . . . . . . . . . . . . . . .  C ADDR   128BH   A   
RUN6. . . . . . . . . . . . . . . .  C ADDR   1297H   A   
RUN6_BRAKE_DONE . . . . . . . . . .  C ADDR   1332H   A   
RUN6_CHECK_DIR. . . . . . . . . . .  C ADDR   130EH   A   
RUN6_CHECK_DIR_CHANGE . . . . . . .  C ADDR   131EH   A   
RUN6_CHECK_DIR_REV. . . . . . . . .  C ADDR   1319H   A   
RUN6_CHECK_SPEED. . . . . . . . . .  C ADDR   1328H   A   
RUN6_CHECK_TIMEOUT. . . . . . . . .  C ADDR   130AH   A   
RUN_TO_WAIT_FOR_POWER_ON. . . . . .  C ADDR   1359H   A   
RUN_TO_WAIT_FOR_POWER_ON_BRAKE_DONE  C ADDR   137AH   A   
RUN_TO_WAIT_FOR_POWER_ON_FAIL . . .  C ADDR   1351H   A   
RUN_TO_WAIT_FOR_POWER_ON_STALL_DONE  C ADDR   135CH   A   
R_. . . . . . . . . . . . . . . . .  N NUMB   0012H   A   
SBUF0 . . . . . . . . . . . . . . .  D ADDR   0099H   A   
SCALE_THROTTLE_CAL. . . . . . . . .  C ADDR   0BABH   A   
SCON0 . . . . . . . . . . . . . . .  D ADDR   0098H   A   
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   558

SCON0_MCE . . . . . . . . . . . . .  B ADDR   0098H.5 A   
SCON0_RB8 . . . . . . . . . . . . .  B ADDR   0098H.2 A   
SCON0_REN . . . . . . . . . . . . .  B ADDR   0098H.4 A   
SCON0_RI. . . . . . . . . . . . . .  B ADDR   0098H.0 A   
SCON0_SMODE . . . . . . . . . . . .  B ADDR   0098H.7 A   
SCON0_TB8 . . . . . . . . . . . . .  B ADDR   0098H.3 A   
SCON0_TI. . . . . . . . . . . . . .  B ADDR   0098H.1 A   
SET4. . . . . . . . . . . . . . . .  C ADDR   1CD1H   A   
SET5. . . . . . . . . . . . . . . .  C ADDR   1CD7H   A   
SET6. . . . . . . . . . . . . . . .  C ADDR   1CDDH   A   
SETBUF. . . . . . . . . . . . . . .  C ADDR   1CCBH   A   
SETUP_COMM_WAIT . . . . . . . . . .  C ADDR   0977H   A   
SETUP_ZC_SCAN_TIMEOUT . . . . . . .  C ADDR   0872H   A   
SETUP_ZC_SCAN_TIMEOUT_STARTUP_DONE.  C ADDR   0896H   A   
SET_DEFAULT_PARAMETERS. . . . . . .  C ADDR   0B3FH   A   
SET_PWM_LIMIT_HIGH_RPM. . . . . . .  C ADDR   05B4H   A   
SET_PWM_LIMIT_HIGH_RPM_INC_LIMIT. .  C ADDR   05C4H   A   
SET_PWM_LIMIT_HIGH_RPM_STORE. . . .  C ADDR   05C5H   A   
SET_PWM_LIMIT_LOW_RPM . . . . . . .  C ADDR   0584H   A   
SET_PWM_LIMIT_LOW_RPM_EXIT. . . . .  C ADDR   05B1H   A   
SET_STARTUP_PWM . . . . . . . . . .  C ADDR   0635H   A   
SIGNATURE_001 . . . . . . . . . . .  N NUMB   00E8H   A   
SIGNATURE_002 . . . . . . . . . . .  N NUMB   00B1H   A   
SKIP_T2_INT . . . . . . . . . . . .  D ADDR   0065H   A   
SMB0ADM . . . . . . . . . . . . . .  D ADDR   00D6H   A   
SMB0ADR . . . . . . . . . . . . . .  D ADDR   00D7H   A   
SMB0CF. . . . . . . . . . . . . . .  D ADDR   00C1H   A   
SMB0CN0 . . . . . . . . . . . . . .  D ADDR   00C0H   A   
SMB0CN0_ACK . . . . . . . . . . . .  B ADDR   00C0H.1 A   
SMB0CN0_ACKRQ . . . . . . . . . . .  B ADDR   00C0H.3 A   
SMB0CN0_ARBLOST . . . . . . . . . .  B ADDR   00C0H.2 A   
SMB0CN0_MASTER. . . . . . . . . . .  B ADDR   00C0H.7 A   
SMB0CN0_SI. . . . . . . . . . . . .  B ADDR   00C0H.0 A   
SMB0CN0_STA . . . . . . . . . . . .  B ADDR   00C0H.5 A   
SMB0CN0_STO . . . . . . . . . . . .  B ADDR   00C0H.4 A   
SMB0CN0_TXMODE. . . . . . . . . . .  B ADDR   00C0H.6 A   
SMB0DAT . . . . . . . . . . . . . .  D ADDR   00C2H   A   
SMB0TC. . . . . . . . . . . . . . .  D ADDR   00ACH   A   
SMBUS0_IRQN . . . . . . . . . . . .  N NUMB   0007H   A   
SP. . . . . . . . . . . . . . . . .  D ADDR   0081H   A   
SPI0CFG . . . . . . . . . . . . . .  D ADDR   00A1H   A   
SPI0CKR . . . . . . . . . . . . . .  D ADDR   00A2H   A   
SPI0CN0 . . . . . . . . . . . . . .  D ADDR   00F8H   A   
SPI0CN0_MODF. . . . . . . . . . . .  B ADDR   00F8H.5 A   
SPI0CN0_NSSMD0. . . . . . . . . . .  B ADDR   00F8H.2 A   
SPI0CN0_NSSMD1. . . . . . . . . . .  B ADDR   00F8H.3 A   
SPI0CN0_RXOVRN. . . . . . . . . . .  B ADDR   00F8H.4 A   
SPI0CN0_SPIEN . . . . . . . . . . .  B ADDR   00F8H.0 A   
SPI0CN0_SPIF. . . . . . . . . . . .  B ADDR   00F8H.7 A   
SPI0CN0_TXBMT . . . . . . . . . . .  B ADDR   00F8H.1 A   
SPI0CN0_WCOL. . . . . . . . . . . .  B ADDR   00F8H.6 A   
SPI0DAT . . . . . . . . . . . . . .  D ADDR   00A3H   A   
SPI0_IRQN . . . . . . . . . . . . .  N NUMB   0006H   A   
STALL_CNT . . . . . . . . . . . . .  D ADDR   003CH   A   
STARTUP_CNT . . . . . . . . . . . .  D ADDR   0039H   A   
STARTUP_PHASE . . . . . . . . . . .  N NUMB   0000H   A   
STARTUP_POWER_TABLE . . . . . . . .  C ADDR   0080H   A   
STARTUP_ZC_TIMEOUT_CNTD . . . . . .  D ADDR   003AH   A   
START_ADC_CONVERSION. . . . . . . .  C ADDR   05CAH   A   
STORE_TIMES_DECREASE. . . . . . . .  C ADDR   0811H   A   
STORE_TIMES_DECREASE_FAST . . . . .  C ADDR   0864H   A   
STORE_TIMES_EXIT. . . . . . . . . .  C ADDR   0832H   A   
STORE_TIMES_INCREASE. . . . . . . .  C ADDR   0802H   A   
STORE_TIMES_INCREASE_FAST . . . . .  C ADDR   085BH   A   
STORE_TIMES_UP_OR_DOWN. . . . . . .  C ADDR   07FCH   A   
STORE_TIMES_UP_OR_DOWN_FAST . . . .  C ADDR   0855H   A   
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   559

SUCCESS . . . . . . . . . . . . . .  N NUMB   0030H   A   
SUCCESS_BEEP. . . . . . . . . . . .  C ADDR   1474H   A   
SUCCESS_BEEP_INVERTED . . . . . . .  C ADDR   14A3H   A   
SWITCH_POWER_OFF. . . . . . . . . .  C ADDR   0B2FH   A   
S_. . . . . . . . . . . . . . . . .  N NUMB   0013H   A   
T1_DSHOT_INC_CMD_CNT. . . . . . . .  C ADDR   023AH   A   
T1_DSHOT_SET_CMD. . . . . . . . . .  C ADDR   0230H   A   
T1_INT. . . . . . . . . . . . . . .  C ADDR   008DH   A   
T1_INT_BIDIR_FWD. . . . . . . . . .  C ADDR   0255H   A   
T1_INT_BIDIR_REV_CHK. . . . . . . .  C ADDR   025AH   A   
T1_INT_DECODE . . . . . . . . . . .  C ADDR   00EFH   A   
T1_INT_DECODE_LSB . . . . . . . . .  C ADDR   0175H   A   
T1_INT_DECODE_MSB . . . . . . . . .  C ADDR   00FAH   A   
T1_INT_FRAME_FAIL . . . . . . . . .  C ADDR   02CCH   A   
T1_INT_FRAME_TIME_SCALED. . . . . .  C ADDR   00C9H   A   
T1_INT_LSB_FAIL . . . . . . . . . .  C ADDR   016CH   A   
T1_INT_MSB_FAIL . . . . . . . . . .  C ADDR   00F1H   A   
T1_INT_NOT_BIDIR. . . . . . . . . .  C ADDR   0266H   A   
T1_INT_STARTUP_BOOSTED. . . . . . .  C ADDR   02A1H   A   
T1_INT_STARTUP_BOOST_STALL. . . . .  C ADDR   0297H   A   
T1_INT_XOR_OK . . . . . . . . . . .  C ADDR   01FDH   A   
T1_INT_ZERO_RCP_CHECKED . . . . . .  C ADDR   02B6H   A   
T1_NORMAL_RANGE . . . . . . . . . .  C ADDR   023CH   A   
T2_INT. . . . . . . . . . . . . . .  C ADDR   02D5H   A   
T2_INT_EXIT . . . . . . . . . . . .  C ADDR   02F8H   A   
T2_INT_RCP_STOP . . . . . . . . . .  C ADDR   02EDH   A   
T3_INT. . . . . . . . . . . . . . .  C ADDR   02FDH   A   
T3_PENDING. . . . . . . . . . . . .  N NUMB   0000H   A   
TCON. . . . . . . . . . . . . . . .  D ADDR   0088H   A   
TCON_IE0. . . . . . . . . . . . . .  B ADDR   0088H.1 A   
TCON_IE1. . . . . . . . . . . . . .  B ADDR   0088H.3 A   
TCON_IT0. . . . . . . . . . . . . .  B ADDR   0088H.0 A   
TCON_IT1. . . . . . . . . . . . . .  B ADDR   0088H.2 A   
TCON_TF0. . . . . . . . . . . . . .  B ADDR   0088H.5 A   
TCON_TF1. . . . . . . . . . . . . .  B ADDR   0088H.7 A   
TCON_TR0. . . . . . . . . . . . . .  B ADDR   0088H.4 A   
TCON_TR1. . . . . . . . . . . . . .  B ADDR   0088H.6 A   
TEMP1 . . . . . . . . . . . . . . .    REG    R0          
TEMP2 . . . . . . . . . . . . . . .    REG    R1          
TEMP3 . . . . . . . . . . . . . . .    REG    R2          
TEMP4 . . . . . . . . . . . . . . .    REG    R3          
TEMP5 . . . . . . . . . . . . . . .    REG    R4          
TEMP6 . . . . . . . . . . . . . . .    REG    R5          
TEMP7 . . . . . . . . . . . . . . .    REG    R6          
TEMP8 . . . . . . . . . . . . . . .    REG    R7          
TEMP_AVERAGE_DEC. . . . . . . . . .  C ADDR   05FDH   A   
TEMP_AVERAGE_INC. . . . . . . . . .  C ADDR   0600H   A   
TEMP_AVERAGE_INC_DEC. . . . . . . .  C ADDR   05F1H   A   
TEMP_AVERAGE_UPDATED. . . . . . . .  C ADDR   0607H   A   
TEMP_AVERAGE_UPDATED_LOAD_ACC . . .  C ADDR   0605H   A   
TEMP_CHECK_EXIT . . . . . . . . . .  C ADDR   0629H   A   
TEMP_LIMIT. . . . . . . . . . . . .  N NUMB   0031H   A   
TEMP_LIMIT_STEP . . . . . . . . . .  N NUMB   0009H   A   
TEMP_PROT_LIMIT . . . . . . . . . .  D ADDR   0069H   A   
TEMP_STORAGE. . . . . . . . . . . .  I ADDR   00D0H   A   
TEST_THROTTLE_GAIN. . . . . . . . .  C ADDR   0CCCH   A   
TEST_THROTTLE_GAIN_MULT . . . . . .  C ADDR   0CD9H   A   
TH0 . . . . . . . . . . . . . . . .  D ADDR   008CH   A   
TH1 . . . . . . . . . . . . . . . .  D ADDR   008DH   A   
THROTTLE_GAIN . . . . . . . . . . .  D ADDR   0060H   A   
THROTTLE_GAIN_BD_REV. . . . . . . .  D ADDR   0062H   A   
THROTTLE_GAIN_BD_REV_M. . . . . . .  D ADDR   0063H   A   
THROTTLE_GAIN_M . . . . . . . . . .  D ADDR   0061H   A   
THROTTLE_HIGH_CAL . . . . . . . . .  C ADDR   0F33H   A   
THROTTLE_LOW_CAL. . . . . . . . . .  C ADDR   0F63H   A   
THROTTLE_LOW_CAL_START. . . . . . .  C ADDR   0F61H   A   
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   560

TIMER0_IRQN . . . . . . . . . . . .  N NUMB   0001H   A   
TIMER0_X. . . . . . . . . . . . . .  D ADDR   0040H   A   
TIMER1_IRQN . . . . . . . . . . . .  N NUMB   0003H   A   
TIMER2_IRQN . . . . . . . . . . . .  N NUMB   0005H   A   
TIMER2_X. . . . . . . . . . . . . .  D ADDR   0041H   A   
TIMER3_IRQN . . . . . . . . . . . .  N NUMB   000EH   A   
TL0 . . . . . . . . . . . . . . . .  D ADDR   008AH   A   
TL1 . . . . . . . . . . . . . . . .  D ADDR   008BH   A   
TMOD. . . . . . . . . . . . . . . .  D ADDR   0089H   A   
TMR2. . . . . . . . . . . . . . . .  D ADDR   00CCH   A   
TMR2CN0 . . . . . . . . . . . . . .  D ADDR   00C8H   A   
TMR2CN0_T2SPLIT . . . . . . . . . .  B ADDR   00C8H.3 A   
TMR2CN0_T2XCLK. . . . . . . . . . .  B ADDR   00C8H.0 A   
TMR2CN0_TF2CEN. . . . . . . . . . .  B ADDR   00C8H.4 A   
TMR2CN0_TF2H. . . . . . . . . . . .  B ADDR   00C8H.7 A   
TMR2CN0_TF2L. . . . . . . . . . . .  B ADDR   00C8H.6 A   
TMR2CN0_TF2LEN. . . . . . . . . . .  B ADDR   00C8H.5 A   
TMR2CN0_TR2 . . . . . . . . . . . .  B ADDR   00C8H.2 A   
TMR2H . . . . . . . . . . . . . . .  D ADDR   00CDH   A   
TMR2L . . . . . . . . . . . . . . .  D ADDR   00CCH   A   
TMR2RL. . . . . . . . . . . . . . .  D ADDR   00CAH   A   
TMR2RLH . . . . . . . . . . . . . .  D ADDR   00CBH   A   
TMR2RLL . . . . . . . . . . . . . .  D ADDR   00CAH   A   
TMR3. . . . . . . . . . . . . . . .  D ADDR   0094H   A   
TMR3CN0 . . . . . . . . . . . . . .  D ADDR   0091H   A   
TMR3H . . . . . . . . . . . . . . .  D ADDR   0095H   A   
TMR3L . . . . . . . . . . . . . . .  D ADDR   0094H   A   
TMR3RL. . . . . . . . . . . . . . .  D ADDR   0092H   A   
TMR3RLH . . . . . . . . . . . . . .  D ADDR   0093H   A   
TMR3RLL . . . . . . . . . . . . . .  D ADDR   0092H   A   
T_. . . . . . . . . . . . . . . . .  N NUMB   0014H   A   
UART0_IRQN. . . . . . . . . . . . .  N NUMB   0004H   A   
UART_LOOP . . . . . . . . . . . . .  N NUMB   001AH   A   
U_. . . . . . . . . . . . . . . . .  N NUMB   0015H   A   
VALIDATE_RCP_START. . . . . . . . .  C ADDR   0EF6H   A   
VDM0CN. . . . . . . . . . . . . . .  D ADDR   00FFH   A   
V_. . . . . . . . . . . . . . . . .  N NUMB   0016H   A   
WAIT1 . . . . . . . . . . . . . . .  C ADDR   1DE1H   A   
WAIT100MS . . . . . . . . . . . . .  C ADDR   0571H   A   
WAIT10MS. . . . . . . . . . . . . .  C ADDR   0569H   A   
WAIT1MS . . . . . . . . . . . . . .  C ADDR   0561H   A   
WAIT1S. . . . . . . . . . . . . . .  C ADDR   146CH   A   
WAIT1S_LOOP . . . . . . . . . . . .  C ADDR   146EH   A   
WAIT200MS . . . . . . . . . . . . .  C ADDR   0575H   A   
WAIT30MS. . . . . . . . . . . . . .  C ADDR   056DH   A   
WAIT3MS . . . . . . . . . . . . . .  C ADDR   0565H   A   
WAITF . . . . . . . . . . . . . . .  C ADDR   1DDBH   A   
WAITH . . . . . . . . . . . . . . .  C ADDR   1DDFH   A   
WAITXMS_M . . . . . . . . . . . . .  C ADDR   057BH   A   
WAITXMS_O . . . . . . . . . . . . .  C ADDR   0579H   A   
WAIT_ADVANCE_TIMING . . . . . . . .  C ADDR   07A7H   A   
WAIT_BEFORE_ZC_SCAN . . . . . . . .  C ADDR   086AH   A   
WAIT_BEFORE_ZC_SCAN_EXIT. . . . . .  C ADDR   08B1H   A   
WAIT_FOR_COMM . . . . . . . . . . .  C ADDR   09B3H   A   
WAIT_FOR_COMM_WAIT. . . . . . . . .  C ADDR   09EAH   A   
WAIT_FOR_COMP_OUT_HIGH. . . . . . .  C ADDR   08C2H   A   
WAIT_FOR_COMP_OUT_LOW . . . . . . .  C ADDR   08B2H   A   
WAIT_FOR_COMP_OUT_START . . . . . .  C ADDR   08D0H   A   
WAIT_FOR_LOW. . . . . . . . . . . .  C ADDR   1C48H   A   
WAIT_FOR_POWER_ON . . . . . . . . .  C ADDR   0FD6H   A   
WAIT_FOR_POWER_ON_LOOP. . . . . . .  C ADDR   0FDBH   A   
WAIT_FOR_POWER_ON_NONZERO . . . . .  C ADDR   103CH   A   
WAIT_FOR_POWER_ON_NOT_MISSING . . .  C ADDR   102BH   A   
WAIT_FOR_POWER_ON_NO_BEEP . . . . .  C ADDR   1021H   A   
WDTCN . . . . . . . . . . . . . . .  D ADDR   0097H   A   
WRITE_EEPROM_BLOCK1 . . . . . . . .  C ADDR   13ECH   A   
A51 MACRO ASSEMBLER  BLHELI_S                                                             10/13/2019 12:56:47 PAGE   561

WRITE_EEPROM_BLOCK2 . . . . . . . .  C ADDR   13F9H   A   
WRITE_EEPROM_BYTE . . . . . . . . .  C ADDR   140BH   A   
WRITE_EEPROM_BYTE_FROM_ACC. . . . .  C ADDR   140CH   A   
WRITE_EEPROM_SIGNATURE. . . . . . .  C ADDR   143BH   A   
WRITE_TAG . . . . . . . . . . . . .  C ADDR   1464H   A   
WRITE_TAGS. . . . . . . . . . . . .  C ADDR   145DH   A   
WT_ADV_START_H. . . . . . . . . . .  D ADDR   004BH   A   
WT_ADV_START_L. . . . . . . . . . .  D ADDR   004AH   A   
WT_COMM_START_H . . . . . . . . . .  D ADDR   0051H   A   
WT_COMM_START_L . . . . . . . . . .  D ADDR   0050H   A   
WT_ZC_SCAN_START_H. . . . . . . . .  D ADDR   004DH   A   
WT_ZC_SCAN_START_L. . . . . . . . .  D ADDR   004CH   A   
WT_ZC_TOUT_START_H. . . . . . . . .  D ADDR   004FH   A   
WT_ZC_TOUT_START_L. . . . . . . . .  D ADDR   004EH   A   
W_. . . . . . . . . . . . . . . . .  N NUMB   0017H   A   
XBR0. . . . . . . . . . . . . . . .  D ADDR   00E1H   A   
XBR1. . . . . . . . . . . . . . . .  D ADDR   00E2H   A   
XBR2. . . . . . . . . . . . . . . .  D ADDR   00E3H   A   
XH. . . . . . . . . . . . . . . . .    REG    R1          
XL. . . . . . . . . . . . . . . . .    REG    R0          
XTAL. . . . . . . . . . . . . . . .  N NUMB   7840H   A   
_EEP_MAIN_REARM_START . . . . . . .  C ADDR   1A10H   A   
_EEP_PGM_BEC_VOLTAGE_HIGH . . . . .  C ADDR   1A20H   A   
_EEP_PGM_DAMPING_FORCE. . . . . . .  C ADDR   1A16H   A   
_EEP_PGM_ENABLE_PWM_INPUT . . . . .  C ADDR   1A25H   A   
_EEP_PGM_GOV_I_GAIN . . . . . . . .  C ADDR   1A04H   A   
_EEP_PGM_GOV_MODE . . . . . . . . .  C ADDR   1A05H   A   
_EEP_PGM_GOV_P_GAIN . . . . . . . .  C ADDR   1A03H   A   
_EEP_PGM_GOV_RANGE. . . . . . . . .  C ADDR   1A17H   A   
_EEP_PGM_GOV_SETUP_TARGET . . . . .  C ADDR   1A11H   A   
_EEP_PGM_INPUT_POL. . . . . . . . .  C ADDR   1A0CH   A   
_EEP_PGM_LOW_VOLTAGE_LIM. . . . . .  C ADDR   1A06H   A   
_EEP_PGM_MAIN_SPOOLUP_TIME. . . . .  C ADDR   1A22H   A   
_EEP_PGM_MOTOR_GAIN . . . . . . . .  C ADDR   1A07H   A   
_EEP_PGM_MOTOR_IDLE . . . . . . . .  C ADDR   1A08H   A   
_EEP_PGM_PWM_DITHER . . . . . . . .  C ADDR   1A26H   A   
_EEP_PGM_PWM_FREQ . . . . . . . . .  C ADDR   1A0AH   A   
_EEP_PGM_STARTUP_ACCEL. . . . . . .  C ADDR   1A13H   A   
_EEP_PGM_STARTUP_METHOD . . . . . .  C ADDR   1A18H   A   
_EEP_PGM_STARTUP_RPM. . . . . . . .  C ADDR   1A12H   A   
_EEP_PGM_THROTTLE_RATE. . . . . . .  C ADDR   1A1EH   A   
_EEP_PGM_VOLT_COMP. . . . . . . . .  C ADDR   1A14H   A   
_PGM_BEC_VOLTAGE_HIGH . . . . . . .  I ADDR   009DH   A   
_PGM_DAMPING_FORCE. . . . . . . . .  I ADDR   0093H   A   
_PGM_ENABLE_PWM_INPUT . . . . . . .  I ADDR   00A2H   A   
_PGM_GOV_I_GAIN . . . . . . . . . .  I ADDR   0081H   A   
_PGM_GOV_MODE . . . . . . . . . . .  I ADDR   0082H   A   
_PGM_GOV_P_GAIN . . . . . . . . . .  I ADDR   0080H   A   
_PGM_GOV_RANGE. . . . . . . . . . .  I ADDR   0094H   A   
_PGM_GOV_SETUP_TARGET . . . . . . .  I ADDR   008EH   A   
_PGM_LOW_VOLTAGE_LIM. . . . . . . .  I ADDR   0083H   A   
_PGM_MAIN_REARM_START . . . . . . .  I ADDR   008DH   A   
_PGM_MAIN_SPOOLUP_TIME. . . . . . .  I ADDR   009FH   A   
_PGM_MOTOR_GAIN . . . . . . . . . .  I ADDR   0084H   A   
_PGM_MOTOR_IDLE . . . . . . . . . .  I ADDR   0085H   A   
_PGM_PWM_DITHER . . . . . . . . . .  I ADDR   00A3H   A   
_PGM_PWM_FREQ . . . . . . . . . . .  I ADDR   0087H   A   
_PGM_STARTUP_ACCEL. . . . . . . . .  I ADDR   0090H   A   
_PGM_STARTUP_METHOD . . . . . . . .  I ADDR   0095H   A   
_PGM_STARTUP_RPM. . . . . . . . . .  I ADDR   008FH   A   
_PGM_THROTTLE_RATE. . . . . . . . .  I ADDR   009BH   A   
_PGM_VOLT_COMP. . . . . . . . . . .  I ADDR   0091H   A   


REGISTER BANK(S) USED: 0 


ASSEMBLY COMPLETE.  0 WARNING(S), 0 ERROR(S)
